"""
Death Counter - Single File Installer
This is a self-extracting installer that contains all necessary files.
"""

# CRITICAL: Single instance check BEFORE any imports
# This must be the absolute first thing that happens
import sys
if sys.platform == 'win32':
    import ctypes
    from ctypes import wintypes
    
    # Try to create a named mutex
    mutex_name = "DeathCounterInstaller_SingleInstance_Mutex"
    mutex = ctypes.windll.kernel32.CreateMutexW(None, False, mutex_name)
    last_error = ctypes.windll.kernel32.GetLastError()
    
    # If mutex already exists, another instance is running
    if last_error == 183:  # ERROR_ALREADY_EXISTS
        import ctypes.wintypes
        user32 = ctypes.windll.user32
        kernel32 = ctypes.windll.kernel32
        
        # Try to find and bring existing window to front
        def enum_windows_callback(hwnd, lParam):
            if user32.IsWindowVisible(hwnd):
                length = user32.GetWindowTextLengthW(hwnd)
                if length > 0:
                    buffer = ctypes.create_unicode_buffer(length + 1)
                    user32.GetWindowTextW(hwnd, buffer, length + 1)
                    if "Death Counter" in buffer.value:
                        user32.SetForegroundWindow(hwnd)
                        user32.ShowWindow(hwnd, 9)  # SW_RESTORE
                        return False  # Stop enumeration
            return True
        
        EnumWindowsProc = ctypes.WINFUNCTYPE(ctypes.c_bool, ctypes.POINTER(ctypes.c_int), ctypes.POINTER(ctypes.c_int))
        callback = EnumWindowsProc(enum_windows_callback)
        user32.EnumWindows(callback, None)
        
        sys.exit(0)

import os
import base64
import subprocess
import shutil
import tempfile
from pathlib import Path
import tkinter as tk
from tkinter import ttk, messagebox, scrolledtext
import threading
import webbrowser

# Embedded files (base64 encoded)
EMBEDDED_FILES = {
  "multi_game_death_counter.py": "IiIiDQpNdWx0aS1HYW1lIERlYXRoIENvdW50ZXIgRGFlbW9uDQpTdXBwb3J0cyBtdWx0aXBsZSBnYW1lcyB3aXRoIGNvbmZpZ3VyYWJsZSBkZXRlY3Rpb24gcmVnaW9ucyBhbmQga2V5d29yZHMuDQpBdXRvbWF0aWNhbGx5IHRyYWNrcyBkZWF0aHMgYWNyb3NzIGRpZmZlcmVudCBnYW1lcy4NCkF1dG8tZGV0ZWN0cyB3aGljaCBnYW1lIGlzIHJ1bm5pbmcgYnkgY2hlY2tpbmcgcHJvY2VzcyBuYW1lcy4NCg0KUmVxdWlyZW1lbnRzOg0KICAgIHBpcCBpbnN0YWxsIG1zcyBwaWxsb3cgcHl0ZXNzZXJhY3Qgb3BlbmN2LXB5dGhvbiBudW1weSBwc3V0aWwNCiIiIg0KDQppbXBvcnQgb3MNCmltcG9ydCBzeXMNCmltcG9ydCB0aW1lDQppbXBvcnQgY3R5cGVzDQppbXBvcnQganNvbg0KaW1wb3J0IHRyYWNlYmFjaw0KaW1wb3J0IHN1YnByb2Nlc3MNCmltcG9ydCBwc3V0aWwNCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lDQpmcm9tIHR5cGluZyBpbXBvcnQgRGljdCwgTGlzdCwgVHVwbGUsIE9wdGlvbmFsDQoNCiMgV2luZG93cyBBUEkgdHlwZXMgZm9yIHdpbmRvdyBkZXRlY3Rpb24NCnRyeToNCiAgICBmcm9tIGN0eXBlcyBpbXBvcnQgd2ludHlwZXMNCmV4Y2VwdCBJbXBvcnRFcnJvcjoNCiAgICB3aW50eXBlcyA9IE5vbmUNCg0KaW1wb3J0IGN2Mg0KaW1wb3J0IG51bXB5IGFzIG5wDQpmcm9tIFBJTCBpbXBvcnQgSW1hZ2UNCmZyb20gbXNzIGltcG9ydCBtc3MNCmltcG9ydCBweXRlc3NlcmFjdA0KDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCiMgQ09ORklHVVJBVElPTg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQgKHdvcmtzIGZvciBib3RoIC5leGUgYW5kIC5weSkNCmRlZiBnZXRfYmFzZV9kaXIoKToNCiAgICAiIiJHZXQgdGhlIGJhc2UgZGlyZWN0b3J5IC0gc2FtZSBmb2xkZXIgYXMgdGhpcyBzY3JpcHQuIiIiDQogICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgICMgUnVubmluZyBhcyBjb21waWxlZCAuZXhlIC0gdXNlIHRoZSBkaXJlY3Rvcnkgd2hlcmUgLmV4ZSBpcyBsb2NhdGVkDQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKHN5cy5leGVjdXRhYmxlKSkNCiAgICBlbHNlOg0KICAgICAgICAjIFJ1bm5pbmcgYXMgc2NyaXB0IC0gdXNlIHRoZSBkaXJlY3Rvcnkgd2hlcmUgdGhlIHNjcmlwdCBpcyBsb2NhdGVkDQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkNCg0KQkFTRV9ESVIgPSBnZXRfYmFzZV9kaXIoKQ0KQ09ORklHX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJnYW1lc19jb25maWcuanNvbiIpDQpMT0NLX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb24ubG9jayIpDQpSRUFEWV9GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGFlbW9uLnJlYWR5IikgICMgU2lnbmFsIGZpbGUgY3JlYXRlZCBhZnRlciBmdWxsIGluaXRpYWxpemF0aW9uDQpTVE9QX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJTVE9QIikNCg0KREVCVUdfUkFXID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVidWdfY2FwdHVyZV9yYXcucG5nIikNCkRFQlVHX09DUiA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYnVnX2NhcHR1cmUucG5nIikNCkRFQlVHX0xPRyA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYnVnLmxvZyIpDQoNCkRFQVRIX1RYVCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYXRoX2NvdW50ZXIudHh0IikNClNUQVRFX0pTT04gPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9zdGF0ZS5qc29uIikNCkNVUlJFTlRfR0FNRV9UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJjdXJyZW50X2dhbWUudHh0IikgICMgQ3VycmVudCBnYW1lIG5hbWUgZm9yIFN0cmVhbWVyLmJvdA0KQ1VSUkVOVF9ERUFUSFNfVFhUID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiY3VycmVudF9kZWF0aHMudHh0IikgICMgQ3VycmVudCBnYW1lIGRlYXRoIGNvdW50IGZvciBTdHJlYW1lci5ib3QNClRPVEFMX0RFQVRIU19UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJ0b3RhbF9kZWF0aHMudHh0IikgICMgVG90YWwgZGVhdGhzIGFjcm9zcyBhbGwgZ2FtZXMgZm9yIFN0cmVhbWVyLmJvdA0KDQojIEZpbmQgVGVzc2VyYWN0IGV4ZWN1dGFibGUgLSBjaGVjayBjb21tb24gbG9jYXRpb25zDQpkZWYgZmluZF90ZXNzZXJhY3RfZXhlY3V0YWJsZSgpOg0KICAgICIiIkZpbmQgVGVzc2VyYWN0IE9DUiBleGVjdXRhYmxlIGluIGNvbW1vbiBpbnN0YWxsYXRpb24gbG9jYXRpb25zLiIiIg0KICAgICMgQ29tbW9uIFRlc3NlcmFjdCBpbnN0YWxsYXRpb24gcGF0aHMNCiAgICBjb21tb25fcGF0aHMgPSBbDQogICAgICAgIHIiQzpcUHJvZ3JhbSBGaWxlc1xUZXNzZXJhY3QtT0NSXHRlc3NlcmFjdC5leGUiLA0KICAgICAgICByIkM6XFByb2dyYW0gRmlsZXMgKHg4NilcVGVzc2VyYWN0LU9DUlx0ZXNzZXJhY3QuZXhlIiwNCiAgICAgICAgb3MucGF0aC5qb2luKG9zLmdldGVudignUHJvZ3JhbUZpbGVzJywgcidDOlxQcm9ncmFtIEZpbGVzJyksICdUZXNzZXJhY3QtT0NSJywgJ3Rlc3NlcmFjdC5leGUnKSwNCiAgICAgICAgb3MucGF0aC5qb2luKG9zLmdldGVudignUHJvZ3JhbUZpbGVzKHg4NiknLCByJ0M6XFByb2dyYW0gRmlsZXMgKHg4NiknKSwgJ1Rlc3NlcmFjdC1PQ1InLCAndGVzc2VyYWN0LmV4ZScpLA0KICAgIF0NCiAgICANCiAgICAjIENoZWNrIGlmIHRlc3NlcmFjdCBpcyBpbiBQQVRIDQogICAgdHJ5Og0KICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3Rlc3NlcmFjdCcsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MikNCiAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgPT0gMDoNCiAgICAgICAgICAgIHJldHVybiAndGVzc2VyYWN0JyAgIyBVc2UgY29tbWFuZCBuYW1lIGlmIGluIFBBVEgNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICANCiAgICAjIENoZWNrIGNvbW1vbiBwYXRocw0KICAgIGZvciBwYXRoIGluIGNvbW1vbl9wYXRoczoNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocGF0aCk6DQogICAgICAgICAgICByZXR1cm4gcGF0aA0KICAgIA0KICAgICMgRGVmYXVsdCBmYWxsYmFjaw0KICAgIHJldHVybiByIkM6XFByb2dyYW0gRmlsZXNcVGVzc2VyYWN0LU9DUlx0ZXNzZXJhY3QuZXhlIg0KDQpURVNTRVJBQ1RfRVhFID0gZmluZF90ZXNzZXJhY3RfZXhlY3V0YWJsZSgpDQpweXRlc3NlcmFjdC5weXRlc3NlcmFjdC50ZXNzZXJhY3RfY21kID0gVEVTU0VSQUNUX0VYRQ0KDQojIERlZmF1bHQgc2V0dGluZ3MNCkRFRkFVTFRfU0VUVElOR1MgPSB7DQogICAgInRpY2tfc2Vjb25kcyI6IDAuMzAsDQogICAgImRlYnVnX2V2ZXJ5X3RpY2tzIjogMzAsDQogICAgImNvbnNlY3V0aXZlX2hpdHMiOiAyLA0KICAgICJjb29sZG93bl9zZWNvbmRzIjogOC4wLA0KICAgICJtb25pdG9yX2luZGV4IjogMSwgICMgMS1pbmRleGVkIChtb25pdG9yIDEgaXMgcHJpbWFyeSkNCn0NCg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQojIERFRkFVTFQgR0FNRSBDT05GSUdTDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCkRFRkFVTFRfR0FNRVMgPSB7DQogICAgIkVsZGVuIFJpbmciOiB7DQogICAgICAgICJyZWdpb24iOiB7InVzZV9wZXJjZW50YWdlcyI6IFRydWUsICJsZWZ0IjogMC4yNzA4LCAidG9wIjogMC40MzUyLCAid2lkdGgiOiAwLjQ1ODMsICJoZWlnaHQiOiAwLjE4NTJ9LA0KICAgICAgICAia2V5d29yZHMiOiBbIllPVURJRUQiLCAiWU9VRElFIiwgIkRJRUQiXSwNCiAgICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IC1jIHRlc3NlZGl0X2NoYXJfd2hpdGVsaXN0PVlPVURJRUFERlQiLA0KICAgICAgICAibW9uaXRvcl9pbmRleCI6IDIsDQogICAgICAgICJwcm9jZXNzX25hbWVzIjogWyJlbGRlbnJpbmcuZXhlIiwgImVsZGVuIHJpbmcuZXhlIl0sICAjIFByb2Nlc3MgbmFtZXMgdG8gZGV0ZWN0DQogICAgfSwNCiAgICAiRGFyayBTb3VscyAzIjogew0KICAgICAgICAicmVnaW9uIjogeyJ1c2VfcGVyY2VudGFnZXMiOiBUcnVlLCAibGVmdCI6IDAuMjcwOCwgInRvcCI6IDAuNDM1MiwgIndpZHRoIjogMC40NTgzLCAiaGVpZ2h0IjogMC4xODUyfSwNCiAgICAgICAgImtleXdvcmRzIjogWyJZT1VESUVEIiwgIllPVURJRSIsICJZT1VEMUVEIiwgIllPVURsRUQiLCAiWU9VREkiLCAiT1VESUVEIiwgIllPVURJRTAiXSwNCiAgICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IC1jIHRlc3NlZGl0X2NoYXJfd2hpdGVsaXN0PVlPVURJRUFERlQiLA0KICAgICAgICAibW9uaXRvcl9pbmRleCI6IDIsDQogICAgICAgICJwcm9jZXNzX25hbWVzIjogWyJkYXJrc291bHNpaWkuZXhlIiwgImRhcmsgc291bHMgaWlpLmV4ZSJdLA0KICAgIH0sDQogICAgIkRhcmsgU291bHMgUmVtYXN0ZXJlZCI6IHsNCiAgICAgICAgInJlZ2lvbiI6IHsidXNlX3BlcmNlbnRhZ2VzIjogVHJ1ZSwgImxlZnQiOiAwLjI3MDgsICJ0b3AiOiAwLjQzNTIsICJ3aWR0aCI6IDAuNDU4MywgImhlaWdodCI6IDAuMTg1Mn0sDQogICAgICAgICJrZXl3b3JkcyI6IFsiWU9VRElFRCIsICJZT1VESUUiLCAiWU9VRDFFRCIsICJZT1VEbEVEIiwgIllPVURJIiwgIk9VRElFRCIsICJZT1VESUUwIl0sDQogICAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyAtYyB0ZXNzZWRpdF9jaGFyX3doaXRlbGlzdD1ZT1VESUVBREZUIiwNCiAgICAgICAgIm1vbml0b3JfaW5kZXgiOiAyLA0KICAgICAgICAicHJvY2Vzc19uYW1lcyI6IFsiZGFya3NvdWxzcmVtYXN0ZXJlZC5leGUiLCAiZGFyayBzb3VscyByZW1hc3RlcmVkLmV4ZSJdLA0KICAgIH0sDQogICAgIkRhcmsgU291bHMgSUk6IFNjaG9sYXIgb2YgdGhlIEZpcnN0IFNpbiI6IHsNCiAgICAgICAgInJlZ2lvbiI6IHsidXNlX3BlcmNlbnRhZ2VzIjogVHJ1ZSwgImxlZnQiOiAwLjI3MDgsICJ0b3AiOiAwLjQzNTIsICJ3aWR0aCI6IDAuNDU4MywgImhlaWdodCI6IDAuMTg1Mn0sDQogICAgICAgICJrZXl3b3JkcyI6IFsiWU9VRElFRCIsICJZT1VESUUiLCAiWU9VRDFFRCIsICJZT1VEbEVEIiwgIllPVURJIiwgIk9VRElFRCIsICJZT1VESUUwIl0sDQogICAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyAtYyB0ZXNzZWRpdF9jaGFyX3doaXRlbGlzdD1ZT1VESUVBREZUIiwNCiAgICAgICAgIm1vbml0b3JfaW5kZXgiOiAyLA0KICAgICAgICAicHJvY2Vzc19uYW1lcyI6IFsiZGFya3NvdWxzaWkuZXhlIiwgImRhcmsgc291bHMgaWkuZXhlIiwgImRhcmtzb3VsczIuZXhlIl0sDQogICAgfSwNCiAgICAiU2VraXJvIjogew0KICAgICAgICAicmVnaW9uIjogeyJ1c2VfcGVyY2VudGFnZXMiOiBUcnVlLCAibGVmdCI6IDAuMzgwMiwgInRvcCI6IDAuMjY4NSwgIndpZHRoIjogMC4yMjQwLCAiaGVpZ2h0IjogMC40MDc0fSwNCiAgICAgICAgImtleXdvcmRzIjogWyJERUFUSCIsICLmrbsiXSwNCiAgICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IiwNCiAgICAgICAgInRlc3NlcmFjdF9sYW5nIjogImpwbitlbmciLA0KICAgICAgICAibW9uaXRvcl9pbmRleCI6IDIsDQogICAgICAgICJwcm9jZXNzX25hbWVzIjogWyJzZWtpcm8uZXhlIl0sDQogICAgfSwNCn0NCg0KDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCiMgRFBJIEFXQVJFTkVTUw0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQpkZWYgZW5hYmxlX2RwaV9hd2FyZW5lc3MoKToNCiAgICB0cnk6DQogICAgICAgIGN0eXBlcy53aW5kbGwuc2hjb3JlLlNldFByb2Nlc3NEcGlBd2FyZW5lc3MoMikNCiAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5TZXRQcm9jZXNzRFBJQXdhcmUoKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgcGFzcw0KDQoNCmRlZiBtb3ZlX2NvbnNvbGVfdG9fdG9wX3JpZ2h0KCk6DQogICAgIiIiTW92ZSBjb25zb2xlIHdpbmRvdyB0byB0b3AgcmlnaHQgY29ybmVyIHNvIGl0IGRvZXNuJ3QgaW50ZXJmZXJlIHdpdGggY2FwdHVyZS4iIiINCiAgICB0cnk6DQogICAgICAgIGltcG9ydCBzeXMNCiAgICAgICAgaWYgc3lzLnBsYXRmb3JtID09ICJ3aW4zMiI6DQogICAgICAgICAgICBpbXBvcnQgb3MNCiAgICAgICAgICAgICMgR2V0IGNvbnNvbGUgd2luZG93IGhhbmRsZQ0KICAgICAgICAgICAga2VybmVsMzIgPSBjdHlwZXMud2luZGxsLmtlcm5lbDMyDQogICAgICAgICAgICB1c2VyMzIgPSBjdHlwZXMud2luZGxsLnVzZXIzMg0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIEdldCBjb25zb2xlIHdpbmRvdw0KICAgICAgICAgICAgaHduZCA9IGtlcm5lbDMyLkdldENvbnNvbGVXaW5kb3coKQ0KICAgICAgICAgICAgaWYgaHduZDoNCiAgICAgICAgICAgICAgICAjIEdldCBzY3JlZW4gZGltZW5zaW9ucw0KICAgICAgICAgICAgICAgIHNjcmVlbl93aWR0aCA9IHVzZXIzMi5HZXRTeXN0ZW1NZXRyaWNzKDApICAjIFNNX0NYU0NSRUVODQogICAgICAgICAgICAgICAgc2NyZWVuX2hlaWdodCA9IHVzZXIzMi5HZXRTeXN0ZW1NZXRyaWNzKDEpICAjIFNNX0NZU0NSRUVODQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBDb25zb2xlIHdpbmRvdyBzaXplIChhcHByb3hpbWF0ZSkNCiAgICAgICAgICAgICAgICB3aW5kb3dfd2lkdGggPSA4MDANCiAgICAgICAgICAgICAgICB3aW5kb3dfaGVpZ2h0ID0gNjAwDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBQb3NpdGlvbiBpbiB0b3AgcmlnaHQgY29ybmVyDQogICAgICAgICAgICAgICAgeCA9IHNjcmVlbl93aWR0aCAtIHdpbmRvd193aWR0aCAtIDIwICAjIDIwcHggbWFyZ2luIGZyb20gcmlnaHQNCiAgICAgICAgICAgICAgICB5ID0gMjAgICMgMjBweCBtYXJnaW4gZnJvbSB0b3ANCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIE1vdmUgd2luZG93DQogICAgICAgICAgICAgICAgdXNlcjMyLlNldFdpbmRvd1Bvcyhod25kLCAwLCB4LCB5LCB3aW5kb3dfd2lkdGgsIHdpbmRvd19oZWlnaHQsIDB4MDA0MCkgICMgU1dQX1NIT1dXSU5ET1cNCiAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICBwYXNzICAjIFNpbGVudGx5IGZhaWwgaWYgd2UgY2FuJ3QgbW92ZSB0aGUgd2luZG93DQoNCg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQojIExPR0dJTkcNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGxvZyhtc2c6IHN0cik6DQogICAgb3MubWFrZWRpcnMoQkFTRV9ESVIsIGV4aXN0X29rPVRydWUpDQogICAgdHMgPSBkYXRldGltZS5ub3coKS5zdHJmdGltZSgiWyVZLSVtLSVkICVIOiVNOiVTXSIpDQogICAgdHJ5Og0KICAgICAgICB3aXRoIG9wZW4oREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIsIGVycm9ycz0ncmVwbGFjZScpIGFzIGY6DQogICAgICAgICAgICBmLndyaXRlKGYie3RzfSB7bXNnfVxuIikNCiAgICAgICAgIyBQcmludCB0byBjb25zb2xlIHdpdGggZXJyb3IgaGFuZGxpbmcgZm9yIFVuaWNvZGUNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcHJpbnQobXNnKQ0KICAgICAgICBleGNlcHQgVW5pY29kZUVuY29kZUVycm9yOg0KICAgICAgICAgICAgIyBJZiBjb25zb2xlIGNhbid0IGhhbmRsZSBVbmljb2RlLCBwcmludCBBU0NJSSB2ZXJzaW9uDQogICAgICAgICAgICBwcmludChtc2cuZW5jb2RlKCdhc2NpaScsIGVycm9ycz0ncmVwbGFjZScpLmRlY29kZSgnYXNjaWknKSkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICMgU2lsZW50bHkgZmFpbCBpZiB3ZSBjYW4ndCB3cml0ZSB0byBsb2cNCiAgICAgICAgcGFzcw0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KIyBDT05GSUdVUkFUSU9OIE1BTkFHRU1FTlQNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGxvYWRfY29uZmlnKCkgLT4gRGljdDoNCiAgICAiIiJMb2FkIGdhbWUgY29uZmlndXJhdGlvbnMgZnJvbSBKU09OIGZpbGUsIG9yIGNyZWF0ZSBkZWZhdWx0LiIiIg0KICAgIG9zLm1ha2VkaXJzKEJBU0VfRElSLCBleGlzdF9vaz1UcnVlKQ0KICAgIA0KICAgIGlmIG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAjIE1lcmdlIHdpdGggZGVmYXVsdHMgdG8gZW5zdXJlIGFsbCBrZXlzIGV4aXN0DQogICAgICAgICAgICBzZXR0aW5ncyA9IHsqKkRFRkFVTFRfU0VUVElOR1MsICoqY29uZmlnLmdldCgic2V0dGluZ3MiLCB7fSl9DQogICAgICAgICAgICBnYW1lcyA9IHsqKkRFRkFVTFRfR0FNRVMsICoqY29uZmlnLmdldCgiZ2FtZXMiLCB7fSl9DQogICAgICAgICAgICByZXR1cm4geyJzZXR0aW5ncyI6IHNldHRpbmdzLCAiZ2FtZXMiOiBnYW1lc30NCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgbG9nKGYiRXJyb3IgbG9hZGluZyBjb25maWc6IHtlfS4gVXNpbmcgZGVmYXVsdHMuIikNCiAgICANCiAgICAjIENyZWF0ZSBkZWZhdWx0IGNvbmZpZyBmaWxlDQogICAgZGVmYXVsdF9jb25maWcgPSB7DQogICAgICAgICJzZXR0aW5ncyI6IERFRkFVTFRfU0VUVElOR1MsDQogICAgICAgICJnYW1lcyI6IERFRkFVTFRfR0FNRVMsDQogICAgICAgICJjdXJyZW50X2dhbWUiOiBsaXN0KERFRkFVTFRfR0FNRVMua2V5cygpKVswXSBpZiBERUZBVUxUX0dBTUVTIGVsc2UgTm9uZQ0KICAgIH0NCiAgICBzYXZlX2NvbmZpZyhkZWZhdWx0X2NvbmZpZykNCiAgICByZXR1cm4gZGVmYXVsdF9jb25maWcNCg0KDQpkZWYgc2F2ZV9jb25maWcoY29uZmlnOiBEaWN0KToNCiAgICAiIiJTYXZlIGNvbmZpZ3VyYXRpb24gdG8gSlNPTiBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9MikNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGxvZyhmIkVycm9yIHNhdmluZyBjb25maWc6IHtlfSIpDQoNCg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQojIExPQ0sgSEFORExJTkcNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGFjcXVpcmVfbG9jaygpIC0+IGJvb2w6DQogICAgIiIiQ3JlYXRlIGxvY2sgZmlsZSBpbW1lZGlhdGVseSAtIHRoaXMgaXMgdGhlIGZpcnN0IHRoaW5nIHdlIGRvLiIiIg0KICAgIG9zLm1ha2VkaXJzKEJBU0VfRElSLCBleGlzdF9vaz1UcnVlKQ0KICAgIGlmIG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHdpdGggb3BlbihMT0NLX0ZJTEUsICJyIikgYXMgZjoNCiAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpDQogICAgICAgICAgICBsb2coZiJMT0NLIEVYSVNUUzogZGFlbW9uLmxvY2sgcHJlc2VudCAoUElEOiB7cGlkfSkuIEV4aXRpbmcgdG8gYXZvaWQgZHVwbGljYXRlcy4iKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBsb2coIkxPQ0sgRVhJU1RTOiBkYWVtb24ubG9jayBwcmVzZW50LiBFeGl0aW5nIHRvIGF2b2lkIGR1cGxpY2F0ZXMuIikNCiAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgdHJ5Og0KICAgICAgICAjIENyZWF0ZSBsb2NrIGZpbGUgaW1tZWRpYXRlbHkgLSBiZWZvcmUgYW55IG90aGVyIGluaXRpYWxpemF0aW9uDQogICAgICAgIHdpdGggb3BlbihMT0NLX0ZJTEUsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoc3RyKG9zLmdldHBpZCgpKSkNCiAgICAgICAgIyBGb3JjZSBmaWxlIHN5c3RlbSBmbHVzaA0KICAgICAgICBpbXBvcnQgc3lzDQogICAgICAgIHN5cy5zdGRvdXQuZmx1c2goKQ0KICAgICAgICBzeXMuc3RkZXJyLmZsdXNoKCkNCiAgICAgICAgbG9nKGYiTE9DSyBDUkVBVEVEOiBkYWVtb24ubG9jayBjcmVhdGVkIHdpdGggUElEIHtvcy5nZXRwaWQoKX0iKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgbG9nKGYiTE9DSyBFUlJPUjoge2V9IikNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCg0KZGVmIHJlbGVhc2VfbG9jaygpOg0KICAgIHRyeToNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoTE9DS19GSUxFKToNCiAgICAgICAgICAgIG9zLnJlbW92ZShMT0NLX0ZJTEUpDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOg0KICAgICAgICAgICAgb3MucmVtb3ZlKFJFQURZX0ZJTEUpDQogICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgcGFzcw0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KIyBTVEFURSBNQU5BR0VNRU5UDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCmRlZiBsb2FkX3N0YXRlKCkgLT4gRGljdDoNCiAgICAiIiJMb2FkIHN0YXRlIGZyb20gSlNPTiBmaWxlLiIiIg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhTVEFURV9KU09OKToNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICJ0b3RhbF9kZWF0aHMiOiAwLA0KICAgICAgICAgICAgImdhbWVfZGVhdGhzIjoge30sDQogICAgICAgICAgICAidGljayI6IDAsDQogICAgICAgICAgICAic3RyZWFrIjogMCwNCiAgICAgICAgICAgICJsYXN0X2RlYXRoX3RzIjogMC4wLA0KICAgICAgICAgICAgImN1cnJlbnRfZ2FtZSI6IE5vbmUsDQogICAgICAgIH0NCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBzdGF0ZSA9IGpzb24ubG9hZChmKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgIHN0YXRlID0ge30NCiAgICANCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJ0b3RhbF9kZWF0aHMiLCAwKQ0KICAgIHN0YXRlLnNldGRlZmF1bHQoImdhbWVfZGVhdGhzIiwge30pDQogICAgc3RhdGUuc2V0ZGVmYXVsdCgidGljayIsIDApDQogICAgc3RhdGUuc2V0ZGVmYXVsdCgic3RyZWFrIiwgMCkNCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJsYXN0X2RlYXRoX3RzIiwgMC4wKQ0KICAgIHN0YXRlLnNldGRlZmF1bHQoImN1cnJlbnRfZ2FtZSIsIE5vbmUpDQogICAgcmV0dXJuIHN0YXRlDQoNCg0KZGVmIHNhdmVfc3RhdGUoc3RhdGU6IERpY3QpOg0KICAgICIiIlNhdmUgc3RhdGUgdG8gSlNPTiBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKFNUQVRFX0pTT04sICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGpzb24uZHVtcChzdGF0ZSwgZiwgaW5kZW50PTIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBsb2coZiJFcnJvciBzYXZpbmcgc3RhdGU6IHtlfSIpDQoNCg0KZGVmIHdyaXRlX3RleHQoZGVhdGhzOiBpbnQsIGdhbWVfbmFtZTogc3RyID0gTm9uZSk6DQogICAgIiIiV3JpdGUgZGVhdGggY291bnQgdG8gdGV4dCBmaWxlIGZvciBPQlMuIiIiDQogICAgdHJ5Og0KICAgICAgICAjIFdyaXRlIHRvdGFsIGRlYXRocw0KICAgICAgICB3aXRoIG9wZW4oREVBVEhfVFhULCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBmLndyaXRlKHN0cihkZWF0aHMpKQ0KICAgICAgICANCiAgICAgICAgIyBBbHNvIHdyaXRlIHBlci1nYW1lIGZpbGUgaWYgZ2FtZSBuYW1lIHByb3ZpZGVkDQogICAgICAgIGlmIGdhbWVfbmFtZToNCiAgICAgICAgICAgIGdhbWVfdHh0ID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCBmImRlYXRoX2NvdW50ZXJfe2dhbWVfbmFtZS5yZXBsYWNlKCcgJywgJ18nKX0udHh0IikNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBzdGF0ZSA9IGxvYWRfc3RhdGUoKQ0KICAgICAgICAgICAgICAgIGdhbWVfZGVhdGhzID0gc3RhdGUuZ2V0KCJnYW1lX2RlYXRocyIsIHt9KS5nZXQoZ2FtZV9uYW1lLCAwKQ0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihnYW1lX3R4dCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKHN0cihnYW1lX2RlYXRocykpDQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAgICAgbG9nKGYiRXJyb3Igd3JpdGluZyBnYW1lIHRleHQgZmlsZToge2V9IikNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGxvZyhmIkVycm9yIHdyaXRpbmcgZGVhdGggdGV4dDoge2V9IikNCg0KDQpkZWYgd3JpdGVfY2hhdF9pbmZvKGdhbWVfbmFtZTogc3RyLCBkZWF0aF9jb3VudDogaW50KToNCiAgICAiIiJXcml0ZSBzaW1wbGUgdGV4dCBmaWxlcyBmb3IgU3RyZWFtZXIuYm90IGNoYXQgY29tbWFuZC4NCiAgICBDcmVhdGVzIHR3byBzZXBhcmF0ZSBmaWxlczoNCiAgICAtIGN1cnJlbnRfZ2FtZS50eHQ6IEp1c3QgdGhlIGdhbWUgbmFtZQ0KICAgIC0gY3VycmVudF9kZWF0aHMudHh0OiBKdXN0IHRoZSBkZWF0aCBjb3VudA0KICAgIFRoaXMgbWFrZXMgaXQgZWFzaWVyIGZvciBTdHJlYW1lci5ib3QgdG8gcmVhZC4NCiAgICAiIiINCiAgICB0cnk6DQogICAgICAgICMgV3JpdGUgZ2FtZSBuYW1lIHRvIHNlcGFyYXRlIGZpbGUNCiAgICAgICAgd2l0aCBvcGVuKENVUlJFTlRfR0FNRV9UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoZ2FtZV9uYW1lKQ0KICAgICAgICANCiAgICAgICAgIyBXcml0ZSBkZWF0aCBjb3VudCB0byBzZXBhcmF0ZSBmaWxlDQogICAgICAgIHdpdGggb3BlbihDVVJSRU5UX0RFQVRIU19UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoc3RyKGRlYXRoX2NvdW50KSkNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGxvZyhmIkVycm9yIHdyaXRpbmcgY2hhdCBpbmZvOiB7ZX0iKQ0KDQoNCmRlZiB3cml0ZV90b3RhbF9kZWF0aHModG90YWxfZGVhdGhzOiBpbnQpOg0KICAgICIiIldyaXRlIHRvdGFsIGRlYXRocyBhY3Jvc3MgYWxsIGdhbWVzIHRvIGEgc2VwYXJhdGUgZmlsZSBmb3IgU3RyZWFtZXIuYm90LiIiIg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKFRPVEFMX0RFQVRIU19UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoc3RyKHRvdGFsX2RlYXRocykpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBsb2coZiJFcnJvciB3cml0aW5nIHRvdGFsIGRlYXRoczoge2V9IikNCg0KDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCiMgR0FNRSBERVRFQ1RJT04NCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGdldF9ydW5uaW5nX3Byb2Nlc3NlcygpIC0+IExpc3Rbc3RyXToNCiAgICAiIiJHZXQgbGlzdCBvZiBhbGwgcnVubmluZyBwcm9jZXNzIG5hbWVzIChsb3dlcmNhc2UsIHdpdGhvdXQgLmV4ZSkuIiIiDQogICAgcHJvY2Vzc2VzID0gW10NCiAgICB0cnk6DQogICAgICAgIGZvciBwcm9jIGluIHBzdXRpbC5wcm9jZXNzX2l0ZXIoWyduYW1lJ10pOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHByb2NfbmFtZSA9IHByb2MuaW5mb1snbmFtZSddLmxvd2VyKCkNCiAgICAgICAgICAgICAgICAjIFJlbW92ZSAuZXhlIGV4dGVuc2lvbiBmb3IgbWF0Y2hpbmcNCiAgICAgICAgICAgICAgICBpZiBwcm9jX25hbWUuZW5kc3dpdGgoJy5leGUnKToNCiAgICAgICAgICAgICAgICAgICAgcHJvY19uYW1lID0gcHJvY19uYW1lWzotNF0NCiAgICAgICAgICAgICAgICBwcm9jZXNzZXMuYXBwZW5kKHByb2NfbmFtZSkNCiAgICAgICAgICAgIGV4Y2VwdCAocHN1dGlsLk5vU3VjaFByb2Nlc3MsIHBzdXRpbC5BY2Nlc3NEZW5pZWQpOg0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGxvZyhmIkVycm9yIGdldHRpbmcgcHJvY2Vzc2VzOiB7ZX0iKQ0KICAgIHJldHVybiBwcm9jZXNzZXMNCg0KDQpkZWYgZ2V0X2dhbWVfcHJvY2VzcyhnYW1lX2NvbmZpZzogRGljdCkgLT4gT3B0aW9uYWxbcHN1dGlsLlByb2Nlc3NdOg0KICAgICIiIkdldCB0aGUgcHJvY2VzcyBvYmplY3QgZm9yIHRoZSBjdXJyZW50IGdhbWUuIiIiDQogICAgcHJvY2Vzc19uYW1lcyA9IGdhbWVfY29uZmlnLmdldCgicHJvY2Vzc19uYW1lcyIsIFtdKQ0KICAgIGlmIG5vdCBwcm9jZXNzX25hbWVzOg0KICAgICAgICByZXR1cm4gTm9uZQ0KICAgIA0KICAgIHRyeToNCiAgICAgICAgZm9yIHByb2MgaW4gcHN1dGlsLnByb2Nlc3NfaXRlcihbJ25hbWUnLCAncGlkJ10pOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHByb2NfbmFtZSA9IHByb2MuaW5mb1snbmFtZSddLmxvd2VyKCkNCiAgICAgICAgICAgICAgICBpZiBwcm9jX25hbWUuZW5kc3dpdGgoJy5leGUnKToNCiAgICAgICAgICAgICAgICAgICAgcHJvY19uYW1lID0gcHJvY19uYW1lWzotNF0NCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBmb3IgZ2FtZV9wcm9jX25hbWUgaW4gcHJvY2Vzc19uYW1lczoNCiAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZCA9IGdhbWVfcHJvY19uYW1lLmxvd2VyKCkNCiAgICAgICAgICAgICAgICAgICAgaWYgbm9ybWFsaXplZC5lbmRzd2l0aCgnLmV4ZScpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZWRbOi00XQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaWYgbm9ybWFsaXplZCA9PSBwcm9jX25hbWU6DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHN1dGlsLlByb2Nlc3MocHJvYy5pbmZvWydwaWQnXSkNCiAgICAgICAgICAgIGV4Y2VwdCAocHN1dGlsLk5vU3VjaFByb2Nlc3MsIHBzdXRpbC5BY2Nlc3NEZW5pZWQpOg0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGxvZyhmIkVycm9yIGZpbmRpbmcgZ2FtZSBwcm9jZXNzOiB7ZX0iKQ0KICAgIHJldHVybiBOb25lDQoNCg0KZGVmIGdldF93aW5kb3dfcmVjdChwcm9jZXNzOiBwc3V0aWwuUHJvY2VzcykgLT4gT3B0aW9uYWxbZGljdF06DQogICAgIiIiR2V0IHRoZSB3aW5kb3cgcmVjdGFuZ2xlIGZvciBhIHByb2Nlc3MgdXNpbmcgV2luZG93cyBBUEkuIiIiDQogICAgdHJ5Og0KICAgICAgICAjIFdpbmRvd3MgQVBJIGNvbnN0YW50cw0KICAgICAgICBHV19PV05FUiA9IDQNCiAgICAgICAgDQogICAgICAgICMgRmluZCB3aW5kb3cgYnkgcHJvY2VzcyBJRA0KICAgICAgICB3aW5kb3dzID0gW10NCiAgICAgICAgDQogICAgICAgIGRlZiBlbnVtX3dpbmRvd3NfY2FsbGJhY2soaHduZCwgbFBhcmFtKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBjdHlwZXMud2luZGxsLnVzZXIzMi5Jc1dpbmRvd1Zpc2libGUoaHduZCk6DQogICAgICAgICAgICAgICAgICAgIHBpZCA9IGN0eXBlcy5jX3Vsb25nKCkNCiAgICAgICAgICAgICAgICAgICAgY3R5cGVzLndpbmRsbC51c2VyMzIuR2V0V2luZG93VGhyZWFkUHJvY2Vzc0lkKGh3bmQsIGN0eXBlcy5ieXJlZihwaWQpKQ0KICAgICAgICAgICAgICAgICAgICBpZiBwaWQudmFsdWUgPT0gcHJvY2Vzcy5waWQ6DQogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIGl0J3Mgbm90IGEgY2hpbGQgd2luZG93DQogICAgICAgICAgICAgICAgICAgICAgICBvd25lciA9IGN0eXBlcy53aW5kbGwudXNlcjMyLkdldFdpbmRvdyhod25kLCBHV19PV05FUikNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG93bmVyID09IDA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93cy5hcHBlbmQoaHduZCkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICANCiAgICAgICAgIyBEZWZpbmUgY2FsbGJhY2sgdHlwZQ0KICAgICAgICBFbnVtV2luZG93c1Byb2MgPSBjdHlwZXMuV0lORlVOQ1RZUEUoY3R5cGVzLmNfYm9vbCwgY3R5cGVzLmNfdm9pZF9wLCBjdHlwZXMuY192b2lkX3ApDQogICAgICAgIGNhbGxiYWNrID0gRW51bVdpbmRvd3NQcm9jKGVudW1fd2luZG93c19jYWxsYmFjaykNCiAgICAgICAgDQogICAgICAgICMgRmluZCBhbGwgd2luZG93cyBmb3IgdGhpcyBwcm9jZXNzDQogICAgICAgIGN0eXBlcy53aW5kbGwudXNlcjMyLkVudW1XaW5kb3dzKGNhbGxiYWNrLCBOb25lKQ0KICAgICAgICANCiAgICAgICAgaWYgbm90IHdpbmRvd3M6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgIyBVc2UgdGhlIGZpcnN0IChtYWluKSB3aW5kb3cNCiAgICAgICAgaHduZCA9IHdpbmRvd3NbMF0NCiAgICAgICAgDQogICAgICAgICMgR2V0IHdpbmRvdyByZWN0YW5nbGUNCiAgICAgICAgY2xhc3MgUkVDVChjdHlwZXMuU3RydWN0dXJlKToNCiAgICAgICAgICAgIF9maWVsZHNfID0gWygibGVmdCIsIGN0eXBlcy5jX2xvbmcpLA0KICAgICAgICAgICAgICAgICAgICAgICAgKCJ0b3AiLCBjdHlwZXMuY19sb25nKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICgicmlnaHQiLCBjdHlwZXMuY19sb25nKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICgiYm90dG9tIiwgY3R5cGVzLmNfbG9uZyldDQogICAgICAgIA0KICAgICAgICByZWN0ID0gUkVDVCgpDQogICAgICAgIGN0eXBlcy53aW5kbGwudXNlcjMyLkdldFdpbmRvd1JlY3QoaHduZCwgY3R5cGVzLmJ5cmVmKHJlY3QpKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICdsZWZ0JzogcmVjdC5sZWZ0LA0KICAgICAgICAgICAgJ3RvcCc6IHJlY3QudG9wLA0KICAgICAgICAgICAgJ3JpZ2h0JzogcmVjdC5yaWdodCwNCiAgICAgICAgICAgICdib3R0b20nOiByZWN0LmJvdHRvbSwNCiAgICAgICAgICAgICd3aWR0aCc6IHJlY3QucmlnaHQgLSByZWN0LmxlZnQsDQogICAgICAgICAgICAnaGVpZ2h0JzogcmVjdC5ib3R0b20gLSByZWN0LnRvcA0KICAgICAgICB9DQogICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgIyBTaWxlbnRseSBmYWlsIC0gd2lsbCBmYWxsIGJhY2sgdG8gY29uZmlndXJlZCBtb25pdG9yDQogICAgICAgIHJldHVybiBOb25lDQoNCg0KZGVmIGZpbmRfbW9uaXRvcl9mb3Jfd2luZG93KHdpbmRvd19yZWN0OiBkaWN0LCBtb25pdG9yczogTGlzdFtkaWN0XSkgLT4gT3B0aW9uYWxbaW50XToNCiAgICAiIiJGaW5kIHdoaWNoIG1vbml0b3IgY29udGFpbnMgdGhlIGNlbnRlciBvZiB0aGUgd2luZG93LiIiIg0KICAgIGlmIG5vdCB3aW5kb3dfcmVjdDoNCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICANCiAgICAjIEdldCB3aW5kb3cgY2VudGVyDQogICAgY2VudGVyX3ggPSB3aW5kb3dfcmVjdFsnbGVmdCddICsgd2luZG93X3JlY3RbJ3dpZHRoJ10gLy8gMg0KICAgIGNlbnRlcl95ID0gd2luZG93X3JlY3RbJ3RvcCddICsgd2luZG93X3JlY3RbJ2hlaWdodCddIC8vIDINCiAgICANCiAgICAjIEZpbmQgbW9uaXRvciB0aGF0IGNvbnRhaW5zIHRoaXMgcG9pbnQNCiAgICBmb3IgaSwgbW9uIGluIGVudW1lcmF0ZShtb25pdG9ycyk6DQogICAgICAgIGlmIChtb25bJ2xlZnQnXSA8PSBjZW50ZXJfeCA8IG1vblsnbGVmdCddICsgbW9uWyd3aWR0aCddIGFuZA0KICAgICAgICAgICAgbW9uWyd0b3AnXSA8PSBjZW50ZXJfeSA8IG1vblsndG9wJ10gKyBtb25bJ2hlaWdodCddKToNCiAgICAgICAgICAgIHJldHVybiBpDQogICAgDQogICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgZGV0ZWN0X2dhbWUoZ2FtZXM6IERpY3QpIC0+IE9wdGlvbmFsW3N0cl06DQogICAgIiIiDQogICAgQXV0by1kZXRlY3Qgd2hpY2ggZ2FtZSBpcyBjdXJyZW50bHkgcnVubmluZyBieSBjaGVja2luZyBwcm9jZXNzIG5hbWVzLg0KICAgIFJldHVybnMgdGhlIGdhbWUgbmFtZSBpZiBkZXRlY3RlZCwgTm9uZSBvdGhlcndpc2UuDQogICAgIiIiDQogICAgcnVubmluZ19wcm9jcyA9IGdldF9ydW5uaW5nX3Byb2Nlc3NlcygpDQogICAgDQogICAgIyBDaGVjayBlYWNoIGdhbWUncyBwcm9jZXNzIG5hbWVzDQogICAgZm9yIGdhbWVfbmFtZSwgZ2FtZV9jb25maWcgaW4gZ2FtZXMuaXRlbXMoKToNCiAgICAgICAgcHJvY2Vzc19uYW1lcyA9IGdhbWVfY29uZmlnLmdldCgicHJvY2Vzc19uYW1lcyIsIFtdKQ0KICAgICAgICBpZiBub3QgcHJvY2Vzc19uYW1lczoNCiAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgIA0KICAgICAgICAjIENoZWNrIGlmIGFueSBvZiB0aGlzIGdhbWUncyBwcm9jZXNzIG5hbWVzIGFyZSBydW5uaW5nDQogICAgICAgIGZvciBwcm9jX25hbWUgaW4gcHJvY2Vzc19uYW1lczoNCiAgICAgICAgICAgICMgTm9ybWFsaXplOiByZW1vdmUgLmV4ZSwgbG93ZXJjYXNlDQogICAgICAgICAgICBub3JtYWxpemVkID0gcHJvY19uYW1lLmxvd2VyKCkNCiAgICAgICAgICAgIGlmIG5vcm1hbGl6ZWQuZW5kc3dpdGgoJy5leGUnKToNCiAgICAgICAgICAgICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplZFs6LTRdDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhpcyBwcm9jZXNzIGlzIHJ1bm5pbmcNCiAgICAgICAgICAgIGlmIG5vcm1hbGl6ZWQgaW4gcnVubmluZ19wcm9jczoNCiAgICAgICAgICAgICAgICBsb2coZiJBdXRvLWRldGVjdGVkIGdhbWU6IHtnYW1lX25hbWV9IChwcm9jZXNzOiB7cHJvY19uYW1lfSkiKQ0KICAgICAgICAgICAgICAgIHJldHVybiBnYW1lX25hbWUNCiAgICANCiAgICByZXR1cm4gTm9uZQ0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KIyBJTUFHRSBQUk9DRVNTSU5HDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCmRlZiBncmFiX3JlZ2lvbihzY3Q6IG1zcywgbW9uaXRvcl9pbmRleDogaW50LCByZWdpb246IGRpY3QsIGdhbWVfY29uZmlnOiBEaWN0ID0gTm9uZSkgLT4gSW1hZ2UuSW1hZ2U6DQogICAgIiIiDQogICAgQ2FwdHVyZSBhIHJlZ2lvbiBmcm9tIHRoZSBzcGVjaWZpZWQgbW9uaXRvci4NCiAgICBTdXBwb3J0cyBib3RoIGFic29sdXRlIHBpeGVsIGNvb3JkaW5hdGVzIGFuZCBwZXJjZW50YWdlLWJhc2VkIGNvb3JkaW5hdGVzIGZvciBtdWx0aS1yZXNvbHV0aW9uIHN1cHBvcnQuDQogICAgTm90ZTogTW9uaXRvciBhdXRvLWRldGVjdGlvbiBpcyBub3cgaGFuZGxlZCBpbiB0aGUgbWFpbiBsb29wIHdpdGggdGhyb3R0bGluZw0KICAgIHRvIHByZXZlbnQgcmFjZSBjb25kaXRpb25zLiBUaGlzIGZ1bmN0aW9uIGp1c3QgdXNlcyB0aGUgcHJvdmlkZWQgbW9uaXRvcl9pbmRleC4NCiAgICAiIiINCiAgICANCiAgICAjIG1zcyB1c2VzIDAtaW5kZXhlZCBtb25pdG9ycyAoMCBpcyBhbGwgbW9uaXRvcnMsIDErIGFyZSBpbmRpdmlkdWFsKQ0KICAgICMgVmFsaWRhdGUgbW9uaXRvciBpbmRleCBiZWZvcmUgdXNpbmcgaXQNCiAgICBudW1fbW9uaXRvcnMgPSBsZW4oc2N0Lm1vbml0b3JzKQ0KICAgIG1heF92YWxpZF9pbmRleCA9IG51bV9tb25pdG9ycyAtIDENCiAgICANCiAgICBpZiBtb25pdG9yX2luZGV4IDwgMCBvciBtb25pdG9yX2luZGV4ID4gbWF4X3ZhbGlkX2luZGV4Og0KICAgICAgICAjIEludmFsaWQgbW9uaXRvciBpbmRleCAtIHVzZSBtb25pdG9yIDEgKHByaW1hcnkpIGFzIGZhbGxiYWNrDQogICAgICAgIGxvZyhmIldBUk5JTkc6IE1vbml0b3Ige21vbml0b3JfaW5kZXh9IGlzIGludmFsaWQgKHZhbGlkIHJhbmdlOiAwLXttYXhfdmFsaWRfaW5kZXh9KS4gVXNpbmcgbW9uaXRvciAxLiIpDQogICAgICAgIGFjdHVhbF9pbmRleCA9IDENCiAgICBlbHNlOg0KICAgICAgICBhY3R1YWxfaW5kZXggPSBtb25pdG9yX2luZGV4DQogICAgDQogICAgbW9uID0gc2N0Lm1vbml0b3JzW2FjdHVhbF9pbmRleF0NCiAgICBtb25fd2lkdGggPSBtb25bIndpZHRoIl0NCiAgICBtb25faGVpZ2h0ID0gbW9uWyJoZWlnaHQiXQ0KICAgIA0KICAgICMgQ2hlY2sgaWYgcmVnaW9uIHVzZXMgcGVyY2VudGFnZS1iYXNlZCBjb29yZGluYXRlcyAoMC4wLTEuMCkgb3IgYWJzb2x1dGUgcGl4ZWxzDQogICAgdXNlX3BlcmNlbnRhZ2VzID0gRmFsc2UNCiAgICBpZiAidXNlX3BlcmNlbnRhZ2VzIiBpbiByZWdpb246DQogICAgICAgIHVzZV9wZXJjZW50YWdlcyA9IGJvb2wocmVnaW9uWyJ1c2VfcGVyY2VudGFnZXMiXSkNCiAgICBlbHNlOg0KICAgICAgICAjIEF1dG8tZGV0ZWN0OiBpZiBsZWZ0L3RvcC93aWR0aC9oZWlnaHQgYXJlIGFsbCA8PSAxLjAsIGFzc3VtZSBwZXJjZW50YWdlcw0KICAgICAgICAjIE90aGVyd2lzZSwgaWYgdGhleSdyZSByZWFzb25hYmxlIHBpeGVsIHZhbHVlcyAoPiAxMCksIHVzZSBhYnNvbHV0ZQ0KICAgICAgICBsZWZ0X3ZhbCA9IHJlZ2lvbi5nZXQoImxlZnQiLCAwKQ0KICAgICAgICB0b3BfdmFsID0gcmVnaW9uLmdldCgidG9wIiwgMCkNCiAgICAgICAgd2lkdGhfdmFsID0gcmVnaW9uLmdldCgid2lkdGgiLCAwKQ0KICAgICAgICBoZWlnaHRfdmFsID0gcmVnaW9uLmdldCgiaGVpZ2h0IiwgMCkNCiAgICAgICAgDQogICAgICAgICMgSWYgYWxsIHZhbHVlcyBhcmUgYmV0d2VlbiAwIGFuZCAxLCB0aGV5J3JlIHBlcmNlbnRhZ2VzDQogICAgICAgICMgQnV0IGV4Y2x1ZGUgMC4wIHZhbHVlcyBhcyB0aGV5IGNvdWxkIGJlIHZhbGlkIHBpeGVsIGNvb3JkaW5hdGVzDQogICAgICAgIGlmICgwIDwgbGVmdF92YWwgPD0gMSBhbmQgMCA8IHRvcF92YWwgPD0gMSBhbmQgDQogICAgICAgICAgICAwIDwgd2lkdGhfdmFsIDw9IDEgYW5kIDAgPCBoZWlnaHRfdmFsIDw9IDEpOg0KICAgICAgICAgICAgdXNlX3BlcmNlbnRhZ2VzID0gVHJ1ZQ0KICAgIA0KICAgIGlmIHVzZV9wZXJjZW50YWdlczoNCiAgICAgICAgIyBDb252ZXJ0IHBlcmNlbnRhZ2UtYmFzZWQgY29vcmRpbmF0ZXMgdG8gYWJzb2x1dGUgcGl4ZWxzDQogICAgICAgICMgUGVyY2VudGFnZXMgYXJlIHJlbGF0aXZlIHRvIG1vbml0b3IgcmVzb2x1dGlvbiAtIHdvcmtzIG9uIEFOWSByZXNvbHV0aW9uIGluY2x1ZGluZyB1bHRyYXdpZGUhDQogICAgICAgIGFic19yZWdpb24gPSB7DQogICAgICAgICAgICAibGVmdCI6IGludChtb25bImxlZnQiXSArIHJlZ2lvblsibGVmdCJdICogbW9uX3dpZHRoKSwNCiAgICAgICAgICAgICJ0b3AiOiBpbnQobW9uWyJ0b3AiXSArIHJlZ2lvblsidG9wIl0gKiBtb25faGVpZ2h0KSwNCiAgICAgICAgICAgICJ3aWR0aCI6IGludChyZWdpb25bIndpZHRoIl0gKiBtb25fd2lkdGgpLA0KICAgICAgICAgICAgImhlaWdodCI6IGludChyZWdpb25bImhlaWdodCJdICogbW9uX2hlaWdodCksDQogICAgICAgIH0NCiAgICAgICAgIyBPbmx5IGxvZyBvbiBmaXJzdCB1c2Ugb3Igd2hlbiBtb25pdG9yIHJlc29sdXRpb24gY2hhbmdlcyAodG8gYXZvaWQgc3BhbSkNCiAgICAgICAgIyBUaGlzIHdpbGwgYmUgbG9nZ2VkIGVsc2V3aGVyZSBpZiBuZWVkZWQgZm9yIGRlYnVnZ2luZw0KICAgIGVsc2U6DQogICAgICAgICMgVXNlIGFic29sdXRlIHBpeGVsIGNvb3JkaW5hdGVzIChsZWdhY3kgbW9kZSkNCiAgICAgICAgIyBTY2FsZSBiYXNlZCBvbiBhIHJlZmVyZW5jZSByZXNvbHV0aW9uICgxOTIweDEwODApIGlmIGJhc2VfcmVzb2x1dGlvbiBpcyBwcm92aWRlZA0KICAgICAgICBiYXNlX3dpZHRoID0gcmVnaW9uLmdldCgiYmFzZV9yZXNvbHV0aW9uX3dpZHRoIiwgTm9uZSkNCiAgICAgICAgYmFzZV9oZWlnaHQgPSByZWdpb24uZ2V0KCJiYXNlX3Jlc29sdXRpb25faGVpZ2h0IiwgTm9uZSkNCiAgICAgICAgDQogICAgICAgIGlmIGJhc2Vfd2lkdGggYW5kIGJhc2VfaGVpZ2h0Og0KICAgICAgICAgICAgIyBTY2FsZSByZWdpb24gcHJvcG9ydGlvbmFsbHkgZnJvbSBiYXNlIHJlc29sdXRpb24gdG8gYWN0dWFsIG1vbml0b3IgcmVzb2x1dGlvbg0KICAgICAgICAgICAgc2NhbGVfeCA9IG1vbl93aWR0aCAvIGJhc2Vfd2lkdGgNCiAgICAgICAgICAgIHNjYWxlX3kgPSBtb25faGVpZ2h0IC8gYmFzZV9oZWlnaHQNCiAgICAgICAgICAgIGFic19yZWdpb24gPSB7DQogICAgICAgICAgICAgICAgImxlZnQiOiBpbnQobW9uWyJsZWZ0Il0gKyByZWdpb25bImxlZnQiXSAqIHNjYWxlX3gpLA0KICAgICAgICAgICAgICAgICJ0b3AiOiBpbnQobW9uWyJ0b3AiXSArIHJlZ2lvblsidG9wIl0gKiBzY2FsZV95KSwNCiAgICAgICAgICAgICAgICAid2lkdGgiOiBpbnQocmVnaW9uWyJ3aWR0aCJdICogc2NhbGVfeCksDQogICAgICAgICAgICAgICAgImhlaWdodCI6IGludChyZWdpb25bImhlaWdodCJdICogc2NhbGVfeSksDQogICAgICAgICAgICB9DQogICAgICAgICAgICBsb2coZiJTY2FsZWQgcmVnaW9uIGZyb20ge2Jhc2Vfd2lkdGh9eHtiYXNlX2hlaWdodH0gdG8ge21vbl93aWR0aH14e21vbl9oZWlnaHR9OiB7cmVnaW9ufSAtPiB7YWJzX3JlZ2lvbn0iKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgIyBObyBzY2FsaW5nIC0gdXNlIGFic29sdXRlIGNvb3JkaW5hdGVzIGFzLWlzIChsZWdhY3kgYmVoYXZpb3IpDQogICAgICAgICAgICBhYnNfcmVnaW9uID0gew0KICAgICAgICAgICAgICAgICJsZWZ0IjogbW9uWyJsZWZ0Il0gKyByZWdpb25bImxlZnQiXSwNCiAgICAgICAgICAgICAgICAidG9wIjogbW9uWyJ0b3AiXSArIHJlZ2lvblsidG9wIl0sDQogICAgICAgICAgICAgICAgIndpZHRoIjogcmVnaW9uWyJ3aWR0aCJdLA0KICAgICAgICAgICAgICAgICJoZWlnaHQiOiByZWdpb25bImhlaWdodCJdLA0KICAgICAgICAgICAgfQ0KICAgIA0KICAgICMgQ2FwdHVyZSBhdCBmdWxsIHF1YWxpdHkgKG1zcyBjYXB0dXJlcyBhdCBuYXRpdmUgcmVzb2x1dGlvbikNCiAgICBncmFiID0gc2N0LmdyYWIoYWJzX3JlZ2lvbikNCiAgICBpbWcgPSBJbWFnZS5mcm9tYnl0ZXMoIlJHQiIsIGdyYWIuc2l6ZSwgZ3JhYi5yZ2IpDQogICAgDQogICAgIyBJZiB0aGUgY2FwdHVyZWQgcmVnaW9uIGlzIHZlcnkgc21hbGwsIHVwc2NhbGUgaXQgaW1tZWRpYXRlbHkgdG8gaW1wcm92ZSBxdWFsaXR5DQogICAgIyBUaGlzIGhlbHBzIHdpdGggcGl4ZWxhdGVkIHRleHQgZnJvbSBzbWFsbCBjYXB0dXJlIHJlZ2lvbnMNCiAgICBpZiBpbWcuc2l6ZVswXSA8IDIwMCBvciBpbWcuc2l6ZVsxXSA8IDEwMDoNCiAgICAgICAgIyBTbWFsbCByZWdpb24gLSB1cHNjYWxlIHVzaW5nIGhpZ2gtcXVhbGl0eSByZXNhbXBsaW5nDQogICAgICAgIG5ld193aWR0aCA9IGltZy5zaXplWzBdICogMg0KICAgICAgICBuZXdfaGVpZ2h0ID0gaW1nLnNpemVbMV0gKiAyDQogICAgICAgIGltZyA9IGltZy5yZXNpemUoKG5ld193aWR0aCwgbmV3X2hlaWdodCksIEltYWdlLlJlc2FtcGxpbmcuTEFOQ1pPUykNCiAgICANCiAgICByZXR1cm4gaW1nDQoNCg0KZGVmIHByZXByb2Nlc3NfZm9yX29jcihpbWdfcmdiOiBJbWFnZS5JbWFnZSkgLT4gVHVwbGVbSW1hZ2UuSW1hZ2UsIERpY3RdOg0KICAgICIiIg0KICAgIFByZXByb2Nlc3MgaW1hZ2UgZm9yIE9DUiB3aXRoIG11bHRpcGxlIGZhbGxiYWNrIHN0cmF0ZWdpZXMuDQogICAgSW1wcm92ZWQgdXBzY2FsaW5nIGFuZCBzaGFycGVuaW5nIGZvciBiZXR0ZXIgT0NSIGFjY3VyYWN5IGFuZCByZWR1Y2VkIHBpeGVsYXRpb24uDQogICAgIiIiDQogICAgIyBDb252ZXJ0IFBJTCB0byBudW1weSBhcnJheQ0KICAgIHJnYiA9IG5wLmFycmF5KGltZ19yZ2IpDQogICAgDQogICAgIyBJZiBpbWFnZSBpcyB2ZXJ5IHNtYWxsLCB1cHNjYWxlIGl0IGZpcnN0IGJlZm9yZSBwcm9jZXNzaW5nDQogICAgaWYgcmdiLnNoYXBlWzBdIDwgMTUwIG9yIHJnYi5zaGFwZVsxXSA8IDMwMDoNCiAgICAgICAgIyBWZXJ5IHNtYWxsIGltYWdlIC0gdXBzY2FsZSB1c2luZyBoaWdoLXF1YWxpdHkgbWV0aG9kDQogICAgICAgIHNjYWxlX2ZhY3RvciA9IG1heCgzMDAgLyByZ2Iuc2hhcGVbMV0sIDE1MCAvIHJnYi5zaGFwZVswXSkNCiAgICAgICAgbmV3X3dpZHRoID0gaW50KHJnYi5zaGFwZVsxXSAqIHNjYWxlX2ZhY3RvcikNCiAgICAgICAgbmV3X2hlaWdodCA9IGludChyZ2Iuc2hhcGVbMF0gKiBzY2FsZV9mYWN0b3IpDQogICAgICAgICMgVXNlIFBJTCdzIExBTkNaT1MgZm9yIGJldHRlciBxdWFsaXR5IHVwc2NhbGluZw0KICAgICAgICBpbWdfcmdiID0gaW1nX3JnYi5yZXNpemUoKG5ld193aWR0aCwgbmV3X2hlaWdodCksIEltYWdlLlJlc2FtcGxpbmcuTEFOQ1pPUykNCiAgICAgICAgcmdiID0gbnAuYXJyYXkoaW1nX3JnYikNCiAgICANCiAgICBiZ3IgPSBjdjIuY3Z0Q29sb3IocmdiLCBjdjIuQ09MT1JfUkdCMkJHUikNCiAgICANCiAgICBkZWYgdXBzY2FsZShpbWdfY3YpOg0KICAgICAgICAiIiJVcHNjYWxlIGltYWdlIDN4IGZvciBiZXR0ZXIgT0NSIHF1YWxpdHkgYW5kIHJlZHVjZWQgcGl4ZWxhdGlvbi4iIiINCiAgICAgICAgIyBVc2UgTEFOQ1pPUyBpbnRlcnBvbGF0aW9uIGZvciBiZXR0ZXIgcXVhbGl0eSAoc2xvd2VyIGJ1dCBtdWNoIGJldHRlciBmb3IgdGV4dCkNCiAgICAgICAgIyAzeCB1cHNjYWxlIGdpdmVzIGJldHRlciByZXN1bHRzIHRoYW4gMnggZm9yIHBpeGVsYXRlZCB0ZXh0DQogICAgICAgIHJldHVybiBjdjIucmVzaXplKGltZ19jdiwgTm9uZSwgZng9My4wLCBmeT0zLjAsIGludGVycG9sYXRpb249Y3YyLklOVEVSX0xBTkNaT1M0KQ0KICAgIA0KICAgICMgU3RyYXRlZ3kgMTogVHJ5IEhTViByZWQgbWFzayAoZm9yICJZT1UgRElFRCIgcmVkIHRleHQpDQogICAgaHN2ID0gY3YyLmN2dENvbG9yKGJnciwgY3YyLkNPTE9SX0JHUjJIU1YpDQogICAgDQogICAgIyBXaWRlIHJlZCB0aHJlc2hvbGRzIChib3RoIGxvdyBhbmQgaGlnaCBodWUgcmFuZ2VzKQ0KICAgIGxvd2VyMSA9IG5wLmFycmF5KFswLCAzMCwgMzBdLCBkdHlwZT1ucC51aW50OCkNCiAgICB1cHBlcjEgPSBucC5hcnJheShbMTUsIDI1NSwgMjU1XSwgZHR5cGU9bnAudWludDgpDQogICAgbG93ZXIyID0gbnAuYXJyYXkoWzE2NSwgMzAsIDMwXSwgZHR5cGU9bnAudWludDgpDQogICAgdXBwZXIyID0gbnAuYXJyYXkoWzE4MCwgMjU1LCAyNTVdLCBkdHlwZT1ucC51aW50OCkNCiAgICANCiAgICBtYXNrMSA9IGN2Mi5pblJhbmdlKGhzdiwgbG93ZXIxLCB1cHBlcjEpDQogICAgbWFzazIgPSBjdjIuaW5SYW5nZShoc3YsIGxvd2VyMiwgdXBwZXIyKQ0KICAgIHJlZF9tYXNrID0gY3YyLmJpdHdpc2Vfb3IobWFzazEsIG1hc2syKQ0KICAgIA0KICAgICMgU3RyYXRlZ3kgMWI6IEFsc28gZGV0ZWN0IHdoaXRlL2JyaWdodCB0ZXh0IChmb3IgU2VraXJvIHdoaXRlIGRlYXRoIG1lc3NhZ2UpDQogICAgIyBXaGl0ZS9icmlnaHQgY29sb3JzIGhhdmUgaGlnaCB2YWx1ZSAoYnJpZ2h0bmVzcykgYW5kIGxvdyBzYXR1cmF0aW9uDQogICAgd2hpdGVfbG93ZXIgPSBucC5hcnJheShbMCwgMCwgMjAwXSwgZHR5cGU9bnAudWludDgpICAjIExvdyBzYXR1cmF0aW9uLCBoaWdoIGJyaWdodG5lc3MNCiAgICB3aGl0ZV91cHBlciA9IG5wLmFycmF5KFsxODAsIDMwLCAyNTVdLCBkdHlwZT1ucC51aW50OCkNCiAgICB3aGl0ZV9tYXNrID0gY3YyLmluUmFuZ2UoaHN2LCB3aGl0ZV9sb3dlciwgd2hpdGVfdXBwZXIpDQogICAgDQogICAgIyBDb21iaW5lIHJlZCBhbmQgd2hpdGUgbWFza3MNCiAgICBtYXNrID0gY3YyLmJpdHdpc2Vfb3IocmVkX21hc2ssIHdoaXRlX21hc2spDQogICAgDQogICAgIyBDbGVhbiBub2lzZSB3aXRoIGJldHRlciBtb3JwaG9sb2d5IG9wZXJhdGlvbnMNCiAgICAjIFVzZSBzbWFsbGVyIGtlcm5lbCBmb3IgbGVzcyBhZ2dyZXNzaXZlIGNsZWFuaW5nIChwcmVzZXJ2ZXMgdGV4dCBiZXR0ZXIpDQogICAga2VybmVsID0gbnAub25lcygoMiwgMiksIG5wLnVpbnQ4KQ0KICAgIG1hc2sgPSBjdjIubW9ycGhvbG9neUV4KG1hc2ssIGN2Mi5NT1JQSF9PUEVOLCBrZXJuZWwsIGl0ZXJhdGlvbnM9MSkNCiAgICBtYXNrID0gY3YyLm1vcnBob2xvZ3lFeChtYXNrLCBjdjIuTU9SUEhfQ0xPU0UsIGtlcm5lbCwgaXRlcmF0aW9ucz0xKQ0KICAgICMgR2VudGxlIGRpbGF0aW9uIHRvIGNvbm5lY3QgdGV4dCBjaGFyYWN0ZXJzDQogICAgbWFzayA9IGN2Mi5kaWxhdGUobWFzaywga2VybmVsLCBpdGVyYXRpb25zPTEpDQogICAgDQogICAgd2hpdGUgPSBpbnQoY3YyLmNvdW50Tm9uWmVybyhtYXNrKSkNCiAgICB0b3RhbCA9IGludChtYXNrLnNoYXBlWzBdICogbWFzay5zaGFwZVsxXSkNCiAgICBjb3ZlcmFnZSA9IHdoaXRlIC8gbWF4KDEsIHRvdGFsKQ0KICAgIA0KICAgIGluZm8gPSB7Im1vZGUiOiAiSFNWX1JFRF9XSElURSIsICJjb3ZlcmFnZSI6IGNvdmVyYWdlfQ0KICAgIA0KICAgICMgVXNlIHJlZC93aGl0ZSBtYXNrIGlmIGNvdmVyYWdlIGlzIHJlYXNvbmFibGUgKGF0IGxlYXN0IDAuMyUgb2YgaW1hZ2UgLSBsb3dlcmVkIHRocmVzaG9sZCkNCiAgICBpZiBjb3ZlcmFnZSA+PSAwLjAwMzoNCiAgICAgICAgIyBJbnZlcnQgbWFzazogd2hpdGUgdGV4dCBvbiBibGFjayBiYWNrZ3JvdW5kIC0+IGJsYWNrIHRleHQgb24gd2hpdGUNCiAgICAgICAgaW52ID0gY3YyLmJpdHdpc2Vfbm90KG1hc2spDQogICAgICAgICMgQXBwbHkgc2xpZ2h0IHNoYXJwZW5pbmcgdG8gaW1wcm92ZSB0ZXh0IGNsYXJpdHkNCiAgICAgICAga2VybmVsX3NoYXJwZW4gPSBucC5hcnJheShbWy0xLCAtMSwgLTFdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbLTEsICA5LCAtMV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFstMSwgLTEsIC0xXV0pDQogICAgICAgIGludiA9IGN2Mi5maWx0ZXIyRChpbnYsIC0xLCBrZXJuZWxfc2hhcnBlbikNCiAgICAgICAgb3V0ID0gdXBzY2FsZShpbnYpDQogICAgICAgIHJldHVybiBJbWFnZS5mcm9tYXJyYXkob3V0KSwgaW5mbw0KICAgIA0KICAgICMgU3RyYXRlZ3kgMjogR3JheXNjYWxlIHdpdGggYWRhcHRpdmUgdGhyZXNob2xkICh3b3JrcyBmb3IgYW55IHRleHQgY29sb3IpDQogICAgIyBUaGlzIGZhbGxiYWNrIGVuc3VyZXMgd2UgTkVWRVIgZ2V0IGEgYmxhY2sgaW1hZ2UgLSBhZGFwdGl2ZSB0aHJlc2hvbGQgYWx3YXlzIHByb2R1Y2VzIG91dHB1dA0KICAgIGdyYXkgPSBjdjIuY3Z0Q29sb3IoYmdyLCBjdjIuQ09MT1JfQkdSMkdSQVkpDQogICAgIyBVc2UgbGVzcyBibHVyIHRvIHByZXNlcnZlIHRleHQgZGV0YWlscw0KICAgIGdyYXlfYmx1ciA9IGN2Mi5HYXVzc2lhbkJsdXIoZ3JheSwgKDMsIDMpLCAwKQ0KICAgICMgQXBwbHkgdW5zaGFycCBtYXNrIGZvciBiZXR0ZXIgdGV4dCBjbGFyaXR5DQogICAgZ2F1c3NpYW4gPSBjdjIuR2F1c3NpYW5CbHVyKGdyYXlfYmx1ciwgKDAsIDApLCAyLjApDQogICAgdW5zaGFycCA9IGN2Mi5hZGRXZWlnaHRlZChncmF5X2JsdXIsIDEuNSwgZ2F1c3NpYW4sIC0wLjUsIDApDQogICAgDQogICAgdGhyX2FkYXB0ID0gY3YyLmFkYXB0aXZlVGhyZXNob2xkKA0KICAgICAgICB1bnNoYXJwLCAyNTUsDQogICAgICAgIGN2Mi5BREFQVElWRV9USFJFU0hfR0FVU1NJQU5fQywNCiAgICAgICAgY3YyLlRIUkVTSF9CSU5BUlksDQogICAgICAgIDMxLCA1DQogICAgKQ0KICAgICMgSW52ZXJ0OiBtYWtlIHRleHQgZGFyayBvbiBsaWdodCBiYWNrZ3JvdW5kIChUZXNzZXJhY3QgcHJlZmVycyBkYXJrIHRleHQgb24gbGlnaHQpDQogICAgdGhyX2FkYXB0X2ludiA9IGN2Mi5iaXR3aXNlX25vdCh0aHJfYWRhcHQpDQogICAgIyBBcHBseSBzbGlnaHQgc2hhcnBlbmluZyB0byBpbXByb3ZlIHRleHQgY2xhcml0eQ0KICAgIGtlcm5lbF9zaGFycGVuID0gbnAuYXJyYXkoW1stMSwgLTEsIC0xXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbLTEsICA5LCAtMV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWy0xLCAtMSwgLTFdXSkNCiAgICB0aHJfYWRhcHRfaW52ID0gY3YyLmZpbHRlcjJEKHRocl9hZGFwdF9pbnYsIC0xLCBrZXJuZWxfc2hhcnBlbikNCiAgICBvdXQgPSB1cHNjYWxlKHRocl9hZGFwdF9pbnYpDQogICAgaW5mb1sibW9kZSJdID0gIkFEQVBUSVZFX1RIUkVTSE9MRCINCiAgICBpbmZvWyJjb3ZlcmFnZSJdID0gMC4wICAjIFNldCBjb3ZlcmFnZSBmb3IgY29uc2lzdGVuY3kNCiAgICByZXR1cm4gSW1hZ2UuZnJvbWFycmF5KG91dCksIGluZm8NCg0KDQpkZWYgb2NyX3RleHQoaW1nX2Zvcl9vY3I6IEltYWdlLkltYWdlLCB0ZXNzZXJhY3RfY29uZmlnOiBzdHIsIHRlc3NlcmFjdF9sYW5nOiBzdHIgPSAiZW5nIikgLT4gc3RyOg0KICAgICIiIkV4dHJhY3QgdGV4dCBmcm9tIGltYWdlIHVzaW5nIE9DUi4gU3VwcG9ydHMgbXVsdGlwbGUgbGFuZ3VhZ2VzIGluY2x1ZGluZyBKYXBhbmVzZS4iIiINCiAgICB0cnk6DQogICAgICAgIHRleHQgPSBweXRlc3NlcmFjdC5pbWFnZV90b19zdHJpbmcoaW1nX2Zvcl9vY3IsIGxhbmc9dGVzc2VyYWN0X2xhbmcsIGNvbmZpZz10ZXNzZXJhY3RfY29uZmlnKQ0KICAgICAgICAjIEZvciBFbmdsaXNoLW9ubHksIHJlbW92ZSBub24tYWxwaGFiZXRpYyBhbmQgdXBwZXJjYXNlDQogICAgICAgICMgRm9yIEphcGFuZXNlL211bHRpLWxhbmd1YWdlLCBrZWVwIGFsbCBjaGFyYWN0ZXJzIChpbmNsdWRpbmcgSmFwYW5lc2UpIGJ1dCByZW1vdmUgc3BhY2VzDQogICAgICAgIGlmIHRlc3NlcmFjdF9sYW5nID09ICJlbmciIG9yICh0ZXNzZXJhY3RfbGFuZy5zdGFydHN3aXRoKCJlbmciKSBhbmQgIisiIG5vdCBpbiB0ZXNzZXJhY3RfbGFuZyk6DQogICAgICAgICAgICBjbGVhbiA9ICIiLmpvaW4oYyBmb3IgYyBpbiB0ZXh0LnVwcGVyKCkgaWYgYy5pc2FscGhhKCkpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICAjIEZvciBKYXBhbmVzZS9tdWx0aS1sYW5ndWFnZToga2VlcCBhbGwgY2hhcmFjdGVycyBpbmNsdWRpbmcgSmFwYW5lc2UsIENoaW5lc2UsIGV0Yy4NCiAgICAgICAgICAgICMgUmVtb3ZlIHNwYWNlcyBhbmQgbmV3bGluZXMsIGJ1dCBrZWVwIGFsbCBvdGhlciBjaGFyYWN0ZXJzDQogICAgICAgICAgICBjbGVhbiA9ICIiLmpvaW4oYyBmb3IgYyBpbiB0ZXh0IGlmIG5vdCBjLmlzc3BhY2UoKSkNCiAgICAgICAgcmV0dXJuIGNsZWFuDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBsb2coZiJPQ1IgZXJyb3I6IHtlfSIpDQogICAgICAgIHJldHVybiAiIg0KDQoNCmRlZiBjb250YWluc19rZXl3b3JkKGNsZWFuX3RleHQ6IHN0ciwga2V5d29yZHM6IExpc3Rbc3RyXSkgLT4gYm9vbDoNCiAgICAiIiJDaGVjayBpZiBjbGVhbmVkIHRleHQgY29udGFpbnMgYW55IGtleXdvcmQuIiIiDQogICAgIyBFeGNsdWRlIGZhbHNlIHBvc2l0aXZlczogZW5lbXkgZmVsbGVkLCB0YXJnZXQgZGVzdHJveWVkLCBldGMuDQogICAgZXhjbHVkZV9rZXl3b3JkcyA9IFsiRU5FTVlGRUxMRUQiLCAiRU5FTVlGRUxMRSIsICJUQVJHRVRERVNUUk9ZRUQiLCAiVEFSR0VUREVTVFJPWUUiXQ0KICAgIGZvciBleGNsdWRlIGluIGV4Y2x1ZGVfa2V5d29yZHM6DQogICAgICAgIGlmIGV4Y2x1ZGUgaW4gY2xlYW5fdGV4dDoNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA0KICAgIHJldHVybiBhbnkoayBpbiBjbGVhbl90ZXh0IGZvciBrIGluIGtleXdvcmRzKQ0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KIyBNQUlOIExPT1ANCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIG1haW5fbG9vcCgpOg0KICAgIG9zLm1ha2VkaXJzKEJBU0VfRElSLCBleGlzdF9vaz1UcnVlKQ0KICAgIGVuYWJsZV9kcGlfYXdhcmVuZXNzKCkNCiAgICBtb3ZlX2NvbnNvbGVfdG9fdG9wX3JpZ2h0KCkgICMgTW92ZSBjb25zb2xlIHdpbmRvdyBvdXQgb2YgY2FwdHVyZSBhcmVhDQogICAgDQogICAgIyBDaGVjayBpZiBUZXNzZXJhY3QgaXMgYXZhaWxhYmxlIChlaXRoZXIgYXMgZmlsZSBwYXRoIG9yIGNvbW1hbmQpDQogICAgdGVzc2VyYWN0X2F2YWlsYWJsZSA9IEZhbHNlDQogICAgaWYgVEVTU0VSQUNUX0VYRSA9PSAndGVzc2VyYWN0JzoNCiAgICAgICAgIyBDaGVjayBpZiBjb21tYW5kIGlzIGF2YWlsYWJsZQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3Rlc3NlcmFjdCcsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTIpDQogICAgICAgICAgICB0ZXNzZXJhY3RfYXZhaWxhYmxlID0gKHJlc3VsdC5yZXR1cm5jb2RlID09IDApDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHRlc3NlcmFjdF9hdmFpbGFibGUgPSBGYWxzZQ0KICAgIGVsc2U6DQogICAgICAgIHRlc3NlcmFjdF9hdmFpbGFibGUgPSBvcy5wYXRoLmV4aXN0cyhURVNTRVJBQ1RfRVhFKQ0KICAgIA0KICAgIGlmIG5vdCB0ZXNzZXJhY3RfYXZhaWxhYmxlOg0KICAgICAgICBsb2coZiJFUlJPUjogVGVzc2VyYWN0IG5vdCBmb3VuZCBhdDoge1RFU1NFUkFDVF9FWEV9IikNCiAgICAgICAgbG9nKCJQbGVhc2UgaW5zdGFsbCBUZXNzZXJhY3QgT0NSIGZyb206IGh0dHBzOi8vZ2l0aHViLmNvbS9VQi1NYW5uaGVpbS90ZXNzZXJhY3Qvd2lraSIpDQogICAgICAgIGxvZygiT3IgZW5zdXJlIFRlc3NlcmFjdCBpcyBpbiB5b3VyIFBBVEguIikNCiAgICAgICAgbG9nKCJEYWVtb24gd2lsbCBleGl0IC0gVGVzc2VyYWN0IGlzIHJlcXVpcmVkLiIpDQogICAgICAgICMgRG9uJ3QgY3JlYXRlIHJlYWR5IGZpbGUgLSBkYWVtb24gaXMgbm90IHJlYWR5DQogICAgICAgIHJldHVybg0KICAgIA0KICAgIGNvbmZpZyA9IGxvYWRfY29uZmlnKCkNCiAgICBzZXR0aW5ncyA9IGNvbmZpZ1sic2V0dGluZ3MiXQ0KICAgIGdhbWVzID0gY29uZmlnWyJnYW1lcyJdDQogICAgDQogICAgaWYgbm90IGdhbWVzOg0KICAgICAgICBsb2coIkVSUk9SOiBObyBnYW1lcyBjb25maWd1cmVkISIpDQogICAgICAgIGxvZygiRGFlbW9uIHdpbGwgZXhpdCAtIGdhbWVzIGNvbmZpZ3VyYXRpb24gaXMgcmVxdWlyZWQuIikNCiAgICAgICAgIyBEb24ndCBjcmVhdGUgcmVhZHkgZmlsZSAtIGRhZW1vbiBpcyBub3QgcmVhZHkNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgIyBDcmVhdGUgcmVhZHkgZmlsZSBFQVJMWSAtIHJpZ2h0IGFmdGVyIGNyaXRpY2FsIGNoZWNrcyBwYXNzDQogICAgIyBUaGlzIGVuc3VyZXMgR1VJIGtub3dzIGRhZW1vbiBpcyByZWFkeSBldmVuIGlmIHNvbWV0aGluZyBsYXRlciBoYW5ncw0KICAgICMgRE8gVEhJUyBCRUZPUkUgQU5ZIExPR0dJTkcgdG8gYXZvaWQgZW5jb2RpbmcgaXNzdWVzDQogICAgcmVhZHlfZmlsZV9jcmVhdGVkID0gRmFsc2UNCiAgICB0cnk6DQogICAgICAgICMgRW5zdXJlIGRpcmVjdG9yeSBleGlzdHMNCiAgICAgICAgb3MubWFrZWRpcnMoQkFTRV9ESVIsIGV4aXN0X29rPVRydWUpDQogICAgICAgICMgQ3JlYXRlIHJlYWR5IGZpbGUNCiAgICAgICAgcmVhZHlfZmlsZV9wYXRoID0gb3MucGF0aC5hYnNwYXRoKFJFQURZX0ZJTEUpICAjIFVzZSBhYnNvbHV0ZSBwYXRoDQogICAgICAgIHdpdGggb3BlbihyZWFkeV9maWxlX3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoc3RyKG9zLmdldHBpZCgpKSkNCiAgICAgICAgICAgIGYuZmx1c2goKSAgIyBGb3JjZSB3cml0ZSB0byBkaXNrDQogICAgICAgICMgRm9yY2UgT1MgdG8gc3luYyBmaWxlIHRvIGRpc2sNCiAgICAgICAgaW1wb3J0IHN5cw0KICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkNCiAgICAgICAgc3lzLnN0ZGVyci5mbHVzaCgpDQogICAgICAgICMgVmVyaWZ5IGl0IHdhcyBjcmVhdGVkDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHJlYWR5X2ZpbGVfcGF0aCk6DQogICAgICAgICAgICByZWFkeV9maWxlX2NyZWF0ZWQgPSBUcnVlDQogICAgICAgICAgICAjIE5vdyBzYWZlIHRvIGxvZyAoZmlsZSBpcyBhbHJlYWR5IGNyZWF0ZWQpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgbG9nKCJSZWFkeSBmaWxlIGNyZWF0ZWQgRUFSTFkgLSBjcml0aWNhbCBjaGVja3MgcGFzc2VkLiIpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcyAgIyBJZiBsb2dnaW5nIGZhaWxzLCB0aGF0J3MgT0sgLSBmaWxlIGlzIGNyZWF0ZWQNCiAgICAgICAgICAgIHByaW50KGYiUmVhZHkgZmlsZSBjcmVhdGVkOiB7cmVhZHlfZmlsZV9wYXRofSIpDQogICAgICAgICAgICBwcmludChmIlJlYWR5IGZpbGUgYWJzb2x1dGUgcGF0aDoge29zLnBhdGguYWJzcGF0aChyZWFkeV9maWxlX3BhdGgpfSIpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludChmIldBUk5JTkc6IFJlYWR5IGZpbGUgd3JpdGUgc3VjY2VlZGVkIGJ1dCBmaWxlIGRvZXNuJ3QgZXhpc3QhIikNCiAgICAgICAgICAgIHByaW50KGYiQXR0ZW1wdGVkIHBhdGg6IHtyZWFkeV9maWxlX3BhdGh9IikNCiAgICAgICAgICAgIHByaW50KGYiQkFTRV9ESVI6IHtCQVNFX0RJUn0iKQ0KICAgICAgICAgICAgcHJpbnQoZiJCQVNFX0RJUiBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhCQVNFX0RJUil9IikNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIGVycm9yX21zZyA9IGYiQ1JJVElDQUw6IENvdWxkIG5vdCBjcmVhdGUgcmVhZHkgZmlsZToge2V9Ig0KICAgICAgICAjIFRyeSB0byBsb2csIGJ1dCBkb24ndCBmYWlsIGlmIGxvZ2dpbmcgZmFpbHMNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgbG9nKGVycm9yX21zZykNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICBwcmludChlcnJvcl9tc2cpDQogICAgICAgICMgV3JpdGUgdG8gc3RhcnR1cCBlcnJvciBmaWxlDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIFNUQVJUVVBfRVJST1JfRklMRSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRhZW1vbl9zdGFydHVwX2Vycm9yLnR4dCIpDQogICAgICAgICAgICB3aXRoIG9wZW4oU1RBUlRVUF9FUlJPUl9GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgZi53cml0ZShmIkZhaWxlZCB0byBjcmVhdGUgcmVhZHkgZmlsZToge2V9XG4iKQ0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJCQVNFX0RJUjoge0JBU0VfRElSfVxuIikNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiUkVBRFlfRklMRToge1JFQURZX0ZJTEV9XG4iKQ0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJCQVNFX0RJUiBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhCQVNFX0RJUil9XG4iKQ0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJCQVNFX0RJUiB3cml0YWJsZToge29zLmFjY2VzcyhCQVNFX0RJUiwgb3MuV19PSyl9XG4iKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgICMgRG9uJ3QgY29udGludWUgLSByZWFkeSBmaWxlIGlzIGNyaXRpY2FsDQogICAgICAgIHJldHVybg0KICAgIA0KICAgIGlmIG5vdCByZWFkeV9maWxlX2NyZWF0ZWQ6DQogICAgICAgIHByaW50KCJFUlJPUjogUmVhZHkgZmlsZSB3YXMgbm90IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5ISIpDQogICAgICAgIHJldHVybg0KICAgIA0KICAgIHN0YXRlID0gbG9hZF9zdGF0ZSgpDQogICAgDQogICAgIyBUcnkgYXV0by1kZXRlY3Rpb24gZmlyc3QNCiAgICBkZXRlY3RlZF9nYW1lID0gZGV0ZWN0X2dhbWUoZ2FtZXMpDQogICAgaWYgZGV0ZWN0ZWRfZ2FtZSBhbmQgZGV0ZWN0ZWRfZ2FtZSBpbiBnYW1lczoNCiAgICAgICAgY3VycmVudF9nYW1lX25hbWUgPSBkZXRlY3RlZF9nYW1lDQogICAgICAgIGxvZyhmIkF1dG8tZGV0ZWN0ZWQgZ2FtZToge2N1cnJlbnRfZ2FtZV9uYW1lfSIpDQogICAgZWxzZToNCiAgICAgICAgIyBGYWxsIGJhY2sgdG8gc2F2ZWQgZ2FtZSBvciBmaXJzdCBnYW1lDQogICAgICAgIGN1cnJlbnRfZ2FtZV9uYW1lID0gc3RhdGUuZ2V0KCJjdXJyZW50X2dhbWUiKSBvciBjb25maWcuZ2V0KCJjdXJyZW50X2dhbWUiKSBvciBsaXN0KGdhbWVzLmtleXMoKSlbMF0NCiAgICAgICAgaWYgZGV0ZWN0ZWRfZ2FtZSBpcyBOb25lOg0KICAgICAgICAgICAgbG9nKGYiTm8gZ2FtZSBkZXRlY3RlZCBydW5uaW5nLiBVc2luZyBzYXZlZCBnYW1lOiB7Y3VycmVudF9nYW1lX25hbWV9IikNCiAgICANCiAgICBpZiBjdXJyZW50X2dhbWVfbmFtZSBub3QgaW4gZ2FtZXM6DQogICAgICAgIGN1cnJlbnRfZ2FtZV9uYW1lID0gbGlzdChnYW1lcy5rZXlzKCkpWzBdDQogICAgDQogICAgZ2FtZV9jb25maWcgPSBnYW1lc1tjdXJyZW50X2dhbWVfbmFtZV0NCiAgICBzdGF0ZVsiY3VycmVudF9nYW1lIl0gPSBjdXJyZW50X2dhbWVfbmFtZQ0KICAgIA0KICAgICMgR2V0IHRoZSBjdXJyZW50IGdhbWUncyBkZWF0aCBjb3VudCAobm90IHRvdGFsKQ0KICAgIGdhbWVfZGVhdGhzID0gc3RhdGUuZ2V0KCJnYW1lX2RlYXRocyIsIHt9KS5nZXQoY3VycmVudF9nYW1lX25hbWUsIDApDQogICAgIyBXcml0ZSBpbml0aWFsIHRleHQgZmlsZSBzbyBPQlMgaGFzIGN1cnJlbnQgZ2FtZSdzIGNvdW50IG9uIHN0YXJ0dXANCiAgICB3cml0ZV90ZXh0KGdhbWVfZGVhdGhzLCBjdXJyZW50X2dhbWVfbmFtZSkNCiAgICAjIFdyaXRlIGluaXRpYWwgY2hhdCBpbmZvIGZpbGUNCiAgICB3cml0ZV9jaGF0X2luZm8oY3VycmVudF9nYW1lX25hbWUsIGdhbWVfZGVhdGhzKQ0KICAgICMgV3JpdGUgaW5pdGlhbCB0b3RhbCBkZWF0aHMgZmlsZQ0KICAgIHdyaXRlX3RvdGFsX2RlYXRocyhzdGF0ZS5nZXQoInRvdGFsX2RlYXRocyIsIDApKQ0KICAgIA0KICAgIGxvZygiPSIgKiA2MCkNCiAgICBsb2coIk11bHRpLUdhbWUgRGVhdGggQ291bnRlciBEYWVtb24gU3RhcnRlZCIpDQogICAgbG9nKGYiQ3VycmVudCBHYW1lOiB7Y3VycmVudF9nYW1lX25hbWV9IikNCiAgICBsb2coZiJNb25pdG9yOiB7Z2FtZV9jb25maWcuZ2V0KCdtb25pdG9yX2luZGV4Jywgc2V0dGluZ3NbJ21vbml0b3JfaW5kZXgnXSl9IikNCiAgICBsb2coZiJSZWdpb246IHtnYW1lX2NvbmZpZy5nZXQoJ3JlZ2lvbicsIHt9KX0iKQ0KICAgIGxvZyhmIktleXdvcmRzOiB7Z2FtZV9jb25maWcuZ2V0KCdrZXl3b3JkcycsIFtdKX0iKQ0KICAgIGxvZyhmIkN1cnJlbnQgRGVhdGhzIC0gVG90YWw6IHtzdGF0ZVsndG90YWxfZGVhdGhzJ119LCB7Y3VycmVudF9nYW1lX25hbWV9OiB7c3RhdGVbJ2dhbWVfZGVhdGhzJ10uZ2V0KGN1cnJlbnRfZ2FtZV9uYW1lLCAwKX0iKQ0KICAgIGxvZygiPSIgKiA2MCkNCiAgICANCiAgICAjIFJlYWR5IGZpbGUgYWxyZWFkeSBjcmVhdGVkIGFib3ZlIC0ganVzdCB2ZXJpZnkgaXQgZXhpc3RzDQogICAgaWYgb3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSk6DQogICAgICAgIGxvZyhmIlJFQURZX0ZJTEUgdmVyaWZpZWQ6IHtSRUFEWV9GSUxFfSIpDQogICAgZWxzZToNCiAgICAgICAgbG9nKGYiV0FSTklORzogUkVBRFlfRklMRSBtaXNzaW5nLCByZWNyZWF0aW5nLi4uIikNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgd2l0aCBvcGVuKFJFQURZX0ZJTEUsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICBmLndyaXRlKHN0cihvcy5nZXRwaWQoKSkpDQogICAgICAgICAgICBsb2coZiJSRUFEWV9GSUxFIHJlY3JlYXRlZDoge1JFQURZX0ZJTEV9IikNCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgbG9nKGYiRVJST1I6IENvdWxkIG5vdCByZWNyZWF0ZSByZWFkeSBmaWxlOiB7ZX0iKQ0KICAgIA0KICAgICMgTm93IGVudGVyIG1zcyBjb250ZXh0IC0gaWYgdGhpcyBoYW5ncywgcmVhZHkgZmlsZSBhbHJlYWR5IGV4aXN0cw0KICAgIHdpdGggbXNzKCkgYXMgc2N0Og0KICAgICAgICBudW1fbW9uaXRvcnMgPSBsZW4oc2N0Lm1vbml0b3JzKQ0KICAgICAgICBsb2coZiJBdmFpbGFibGUgbW9uaXRvcnM6IHtudW1fbW9uaXRvcnN9IikNCiAgICAgICAgZm9yIGksIG1vbiBpbiBlbnVtZXJhdGUoc2N0Lm1vbml0b3JzKToNCiAgICAgICAgICAgIGxvZyhmIiAgTW9uaXRvciB7aX06IHttb25bJ3dpZHRoJ119eHttb25bJ2hlaWdodCddfSBhdCAoe21vblsnbGVmdCddfSwge21vblsndG9wJ119KSIpDQogICAgICAgIA0KICAgICAgICAjIEdldCBjb25maWd1cmVkIG1vbml0b3IgaW5kZXggYW5kIHZhbGlkYXRlIGl0DQogICAgICAgIG1vbml0b3JfaW5kZXggPSBnYW1lX2NvbmZpZy5nZXQoIm1vbml0b3JfaW5kZXgiLCBzZXR0aW5nc1sibW9uaXRvcl9pbmRleCJdKQ0KICAgICAgICANCiAgICAgICAgIyBWYWxpZGF0ZSBtb25pdG9yIGluZGV4IC0gbXNzIHVzZXMgMC1pbmRleGVkIHdoZXJlIDAgaXMgImFsbCBtb25pdG9ycyINCiAgICAgICAgIyBWYWxpZCBpbmRpY2VzIGFyZSAwIChhbGwpIGFuZCAxIHRvIChudW1fbW9uaXRvcnMtMSkgZm9yIGluZGl2aWR1YWwgbW9uaXRvcnMNCiAgICAgICAgbWF4X3ZhbGlkX2luZGV4ID0gbnVtX21vbml0b3JzIC0gMQ0KICAgICAgICBpZiBtb25pdG9yX2luZGV4IDwgMCBvciBtb25pdG9yX2luZGV4ID4gbWF4X3ZhbGlkX2luZGV4Og0KICAgICAgICAgICAgbG9nKGYiV0FSTklORzogQ29uZmlndXJlZCBtb25pdG9yX2luZGV4IHttb25pdG9yX2luZGV4fSBpcyBpbnZhbGlkICh2YWxpZCByYW5nZTogMC17bWF4X3ZhbGlkX2luZGV4fSkuIFVzaW5nIG1vbml0b3IgMS4iKQ0KICAgICAgICAgICAgbW9uaXRvcl9pbmRleCA9IDEgICMgRGVmYXVsdCB0byBtb25pdG9yIDEgKHByaW1hcnkgZGlzcGxheSkNCiAgICAgICAgICAgICMgVXBkYXRlIHRoZSBjb25maWcgdG8gc2F2ZSB0aGUgY29ycmVjdGVkIHZhbHVlDQogICAgICAgICAgICBnYW1lX2NvbmZpZ1sibW9uaXRvcl9pbmRleCJdID0gbW9uaXRvcl9pbmRleA0KICAgICAgICAgICAgY29uZmlnWyJnYW1lcyJdW2N1cnJlbnRfZ2FtZV9uYW1lXSA9IGdhbWVfY29uZmlnDQogICAgICAgICAgICBzYXZlX2NvbmZpZyhjb25maWcpDQogICAgICAgIA0KICAgICAgICByZWdpb24gPSBnYW1lX2NvbmZpZy5nZXQoInJlZ2lvbiIsIHt9KQ0KICAgICAgICBrZXl3b3JkcyA9IGdhbWVfY29uZmlnLmdldCgia2V5d29yZHMiLCBbIllPVURJRUQiXSkNCiAgICAgICAgdGVzc2VyYWN0X2NvbmZpZyA9IGdhbWVfY29uZmlnLmdldCgidGVzc2VyYWN0X2NvbmZpZyIsICItLW9lbSAzIC0tcHNtIDciKQ0KICAgICAgICB0ZXNzZXJhY3RfbGFuZyA9IGdhbWVfY29uZmlnLmdldCgidGVzc2VyYWN0X2xhbmciLCAiZW5nIikNCiAgICAgICAgDQogICAgICAgICMgQXV0by1kZXRlY3Rpb24gY2hlY2sgaW50ZXJ2YWwgKGNoZWNrIGV2ZXJ5IDMwIHRpY2tzID0gfjkgc2Vjb25kcyBhdCAwLjNzIHRpY2spDQogICAgICAgIGF1dG9fZGV0ZWN0X2ludGVydmFsID0gMzANCiAgICAgICAgbGFzdF9hdXRvX2RldGVjdF90aWNrID0gMA0KICAgICAgICBsYXN0X21vbml0b3JfZGV0ZWN0X3RpY2sgPSAwDQogICAgICAgIGNhY2hlZF9tb25pdG9yX2luZGV4ID0gbW9uaXRvcl9pbmRleCAgIyBDYWNoZSB0aGUgZGV0ZWN0ZWQgbW9uaXRvcg0KICAgICAgICANCiAgICAgICAgIyBGbGFnIHRvIHRyYWNrIGlmIGRhZW1vbiBoYXMgZnVsbHkgc3RhcnRlZCAob25seSBydW4gbW9uaXRvciBkZXRlY3Rpb24gYWZ0ZXIgdGhpcykNCiAgICAgICAgZGFlbW9uX3N0YXJ0ZWQgPSBGYWxzZQ0KICAgICAgICBzdGFydHVwX3RpY2tzID0gMTAgICMgV2FpdCAxMCB0aWNrcyAofjMgc2Vjb25kcykgYWZ0ZXIgaW5pdGlhbGl6YXRpb24gYmVmb3JlIHN0YXJ0aW5nIG1vbml0b3IgZGV0ZWN0aW9uDQogICAgICAgIA0KICAgICAgICB3aGlsZSBUcnVlOg0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoU1RPUF9GSUxFKToNCiAgICAgICAgICAgICAgICBsb2coIlNUT1AgZmlsZSBkZXRlY3RlZC4gRXhpdGluZyBjbGVhbmx5LiIpDQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgc3RhdGVbInRpY2siXSArPSAxDQogICAgICAgICAgICBub3cgPSB0aW1lLnRpbWUoKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIE1hcmsgZGFlbW9uIGFzIHN0YXJ0ZWQgYWZ0ZXIgaW5pdGlhbCBzdGFydHVwIHBlcmlvZA0KICAgICAgICAgICAgaWYgbm90IGRhZW1vbl9zdGFydGVkIGFuZCBzdGF0ZVsidGljayJdID49IHN0YXJ0dXBfdGlja3M6DQogICAgICAgICAgICAgICAgZGFlbW9uX3N0YXJ0ZWQgPSBUcnVlDQogICAgICAgICAgICAgICAgbG9nKCJNb25pdG9yIGF1dG8tZGV0ZWN0aW9uIGVuYWJsZWQuIikNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBBdXRvLWRldGVjdCBnYW1lIHBlcmlvZGljYWxseQ0KICAgICAgICAgICAgaWYgc3RhdGVbInRpY2siXSAtIGxhc3RfYXV0b19kZXRlY3RfdGljayA+PSBhdXRvX2RldGVjdF9pbnRlcnZhbDoNCiAgICAgICAgICAgICAgICBkZXRlY3RlZF9nYW1lID0gZGV0ZWN0X2dhbWUoZ2FtZXMpDQogICAgICAgICAgICAgICAgaWYgZGV0ZWN0ZWRfZ2FtZSBhbmQgZGV0ZWN0ZWRfZ2FtZSBpbiBnYW1lcyBhbmQgZGV0ZWN0ZWRfZ2FtZSAhPSBjdXJyZW50X2dhbWVfbmFtZToNCiAgICAgICAgICAgICAgICAgICAgbG9nKGYiR2FtZSBjaGFuZ2VkIGRldGVjdGVkOiB7Y3VycmVudF9nYW1lX25hbWV9IC0+IHtkZXRlY3RlZF9nYW1lfSIpDQogICAgICAgICAgICAgICAgICAgIGN1cnJlbnRfZ2FtZV9uYW1lID0gZGV0ZWN0ZWRfZ2FtZQ0KICAgICAgICAgICAgICAgICAgICBnYW1lX2NvbmZpZyA9IGdhbWVzW2N1cnJlbnRfZ2FtZV9uYW1lXQ0KICAgICAgICAgICAgICAgICAgICBzdGF0ZVsiY3VycmVudF9nYW1lIl0gPSBjdXJyZW50X2dhbWVfbmFtZQ0KICAgICAgICAgICAgICAgICAgICAjIFVwZGF0ZSBjb25maWcgZmlsZQ0KICAgICAgICAgICAgICAgICAgICBjb25maWdbImN1cnJlbnRfZ2FtZSJdID0gY3VycmVudF9nYW1lX25hbWUNCiAgICAgICAgICAgICAgICAgICAgc2F2ZV9jb25maWcoY29uZmlnKQ0KICAgICAgICAgICAgICAgICAgICAjIEdldCB0aGUgbmV3IGdhbWUncyBkZWF0aCBjb3VudA0KICAgICAgICAgICAgICAgICAgICBnYW1lX2RlYXRocyA9IHN0YXRlLmdldCgiZ2FtZV9kZWF0aHMiLCB7fSkuZ2V0KGN1cnJlbnRfZ2FtZV9uYW1lLCAwKQ0KICAgICAgICAgICAgICAgICAgICAjIFdyaXRlIHVwZGF0ZWQgdGV4dCBmaWxlcyB3aXRoIHRoZSBuZXcgZ2FtZSdzIGNvdW50DQogICAgICAgICAgICAgICAgICAgIHdyaXRlX3RleHQoZ2FtZV9kZWF0aHMsIGN1cnJlbnRfZ2FtZV9uYW1lKQ0KICAgICAgICAgICAgICAgICAgICAjIFdyaXRlIHVwZGF0ZWQgY2hhdCBpbmZvDQogICAgICAgICAgICAgICAgICAgIHdyaXRlX2NoYXRfaW5mbyhjdXJyZW50X2dhbWVfbmFtZSwgZ2FtZV9kZWF0aHMpDQogICAgICAgICAgICAgICAgICAgICMgV3JpdGUgdXBkYXRlZCB0b3RhbCBkZWF0aHMNCiAgICAgICAgICAgICAgICAgICAgd3JpdGVfdG90YWxfZGVhdGhzKHN0YXRlLmdldCgidG90YWxfZGVhdGhzIiwgMCkpDQogICAgICAgICAgICAgICAgICAgICMgVXBkYXRlIG1vbml0b3IgYW5kIHJlZ2lvbiBzZXR0aW5ncyAtIHZhbGlkYXRlIG1vbml0b3IgaW5kZXgNCiAgICAgICAgICAgICAgICAgICAgbW9uaXRvcl9pbmRleCA9IGdhbWVfY29uZmlnLmdldCgibW9uaXRvcl9pbmRleCIsIHNldHRpbmdzWyJtb25pdG9yX2luZGV4Il0pDQogICAgICAgICAgICAgICAgICAgIG1heF92YWxpZF9pbmRleCA9IGxlbihzY3QubW9uaXRvcnMpIC0gMQ0KICAgICAgICAgICAgICAgICAgICBpZiBtb25pdG9yX2luZGV4IDwgMCBvciBtb25pdG9yX2luZGV4ID4gbWF4X3ZhbGlkX2luZGV4Og0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGYiV0FSTklORzogTW9uaXRvciB7bW9uaXRvcl9pbmRleH0gaW52YWxpZCBmb3Ige2N1cnJlbnRfZ2FtZV9uYW1lfSAodmFsaWQ6IDAte21heF92YWxpZF9pbmRleH0pLiBVc2luZyBtb25pdG9yIDEuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIG1vbml0b3JfaW5kZXggPSAxDQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lX2NvbmZpZ1sibW9uaXRvcl9pbmRleCJdID0gbW9uaXRvcl9pbmRleA0KICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnWyJnYW1lcyJdW2N1cnJlbnRfZ2FtZV9uYW1lXSA9IGdhbWVfY29uZmlnDQogICAgICAgICAgICAgICAgICAgICAgICBzYXZlX2NvbmZpZyhjb25maWcpDQogICAgICAgICAgICAgICAgICAgIGNhY2hlZF9tb25pdG9yX2luZGV4ID0gbW9uaXRvcl9pbmRleCAgIyBSZXNldCBjYWNoZSB3aGVuIGdhbWUgY2hhbmdlcw0KICAgICAgICAgICAgICAgICAgICByZWdpb24gPSBnYW1lX2NvbmZpZy5nZXQoInJlZ2lvbiIsIHt9KQ0KICAgICAgICAgICAgICAgICAgICBrZXl3b3JkcyA9IGdhbWVfY29uZmlnLmdldCgia2V5d29yZHMiLCBbIllPVURJRUQiXSkNCiAgICAgICAgICAgICAgICAgICAgdGVzc2VyYWN0X2NvbmZpZyA9IGdhbWVfY29uZmlnLmdldCgidGVzc2VyYWN0X2NvbmZpZyIsICItLW9lbSAzIC0tcHNtIDciKQ0KICAgICAgICAgICAgICAgICAgICBsb2coZiJTd2l0Y2hlZCB0bzoge2N1cnJlbnRfZ2FtZV9uYW1lfSB8IE1vbml0b3I6IHttb25pdG9yX2luZGV4fSB8IFJlZ2lvbjoge3JlZ2lvbn0gfCBEZWF0aHM6IHtnYW1lX2RlYXRoc30iKQ0KICAgICAgICAgICAgICAgIGxhc3RfYXV0b19kZXRlY3RfdGljayA9IHN0YXRlWyJ0aWNrIl0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBBdXRvLWRldGVjdCBtb25pdG9yIHBlcmlvZGljYWxseSAodGhyb3R0bGVkIHRvIHByZXZlbnQgcmFjZSBjb25kaXRpb25zKQ0KICAgICAgICAgICAgIyBPbmx5IHJ1biBhZnRlciBkYWVtb24gaGFzIGZ1bGx5IHN0YXJ0ZWQgdG8gYXZvaWQgcmFjZSBjb25kaXRpb25zIGR1cmluZyBpbml0aWFsaXphdGlvbg0KICAgICAgICAgICAgaWYgZGFlbW9uX3N0YXJ0ZWQgYW5kIHN0YXRlWyJ0aWNrIl0gLSBsYXN0X21vbml0b3JfZGV0ZWN0X3RpY2sgPj0gYXV0b19kZXRlY3RfaW50ZXJ2YWw6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBnYW1lX3Byb2Nlc3MgPSBnZXRfZ2FtZV9wcm9jZXNzKGdhbWVfY29uZmlnKQ0KICAgICAgICAgICAgICAgICAgICBpZiBnYW1lX3Byb2Nlc3M6DQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3dfcmVjdCA9IGdldF93aW5kb3dfcmVjdChnYW1lX3Byb2Nlc3MpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiB3aW5kb3dfcmVjdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZF9tb25pdG9yID0gZmluZF9tb25pdG9yX2Zvcl93aW5kb3cod2luZG93X3JlY3QsIHNjdC5tb25pdG9ycykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZXRlY3RlZF9tb25pdG9yIGlzIG5vdCBOb25lIGFuZCBkZXRlY3RlZF9tb25pdG9yICE9IGNhY2hlZF9tb25pdG9yX2luZGV4Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2coZiJBdXRvLWRldGVjdGVkIG1vbml0b3Ige2RldGVjdGVkX21vbml0b3J9IGZvciBnYW1lIHdpbmRvdyAod2FzIHVzaW5nIHtjYWNoZWRfbW9uaXRvcl9pbmRleH0pIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkX21vbml0b3JfaW5kZXggPSBkZXRlY3RlZF9tb25pdG9yDQogICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgIyBGYWxsIGJhY2sgdG8gY29uZmlndXJlZCBtb25pdG9yIGlmIGF1dG8tZGV0ZWN0aW9uIGZhaWxzDQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICBsYXN0X21vbml0b3JfZGV0ZWN0X3RpY2sgPSBzdGF0ZVsidGljayJdDQogICAgICAgICAgICANCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAjIENhcHR1cmUgcmVnaW9uIHVzaW5nIGNhY2hlZCBtb25pdG9yIGluZGV4IChubyBFbnVtV2luZG93cyBjYWxsIGhlcmUpDQogICAgICAgICAgICAgICAgaW1nX3JnYiA9IGdyYWJfcmVnaW9uKHNjdCwgY2FjaGVkX21vbml0b3JfaW5kZXgsIHJlZ2lvbikNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIFNhdmUgZGVidWcgaW1hZ2VzIHBlcmlvZGljYWxseQ0KICAgICAgICAgICAgICAgIHNhdmVfZGVidWcgPSAoc3RhdGVbInRpY2siXSAlIHNldHRpbmdzWyJkZWJ1Z19ldmVyeV90aWNrcyJdID09IDApDQogICAgICAgICAgICAgICAgaWYgc2F2ZV9kZWJ1ZzoNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgaW1nX3JnYi5zYXZlKERFQlVHX1JBVykNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGYiREVCVUcgUkFXIFNBVkUgRVJST1I6IHtlfSIpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBQcmVwcm9jZXNzICsgT0NSDQogICAgICAgICAgICAgICAgb2NyX2ltZywgaW5mbyA9IHByZXByb2Nlc3NfZm9yX29jcihpbWdfcmdiKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIHNhdmVfZGVidWc6DQogICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgIG9jcl9pbWcuc2F2ZShERUJVR19PQ1IpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvZyhmIkRFQlVHIE9DUiBTQVZFIEVSUk9SOiB7ZX0iKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGNsZWFuID0gb2NyX3RleHQob2NyX2ltZywgdGVzc2VyYWN0X2NvbmZpZywgdGVzc2VyYWN0X2xhbmcpDQogICAgICAgICAgICAgICAgZGV0ZWN0ZWQgPSBjb250YWluc19rZXl3b3JkKGNsZWFuLCBrZXl3b3JkcykNCiAgICAgICAgICAgICAgICBzdGF0ZVsic3RyZWFrIl0gPSAoc3RhdGVbInN0cmVhayJdICsgMSkgaWYgZGV0ZWN0ZWQgZWxzZSAwDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBMb2cgcGVyaW9kaWNhbGx5DQogICAgICAgICAgICAgICAgaWYgc3RhdGVbInRpY2siXSAlIDEwID09IDAgb3Igc2F2ZV9kZWJ1ZzoNCiAgICAgICAgICAgICAgICAgICAgY292ZXJhZ2UgPSBpbmZvLmdldCgnY292ZXJhZ2UnLCAwLjApDQogICAgICAgICAgICAgICAgICAgIGxvZyhmIlRpY2s9e3N0YXRlWyd0aWNrJ119IEdhbWU9e2N1cnJlbnRfZ2FtZV9uYW1lfSBNb2RlPXtpbmZvWydtb2RlJ119ICINCiAgICAgICAgICAgICAgICAgICAgICAgIGYiQ292ZXJhZ2U9e2NvdmVyYWdlOi40Zn0gT0NSPSd7Y2xlYW59JyAiDQogICAgICAgICAgICAgICAgICAgICAgICBmIkRldGVjdGVkPXtkZXRlY3RlZH0gU3RyZWFrPXtzdGF0ZVsnc3RyZWFrJ119L3tzZXR0aW5nc1snY29uc2VjdXRpdmVfaGl0cyddfSIpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBDb3VudCBkZWF0aDogc3RhYmxlIGRldGVjdGlvbiArIGNvb2xkb3duDQogICAgICAgICAgICAgICAgY29vbGRvd25fcGFzc2VkID0gKG5vdyAtIGZsb2F0KHN0YXRlWyJsYXN0X2RlYXRoX3RzIl0pKSA+PSBzZXR0aW5nc1siY29vbGRvd25fc2Vjb25kcyJdDQogICAgICAgICAgICAgICAgaWYgc3RhdGVbInN0cmVhayJdID49IHNldHRpbmdzWyJjb25zZWN1dGl2ZV9oaXRzIl0gYW5kIGNvb2xkb3duX3Bhc3NlZDoNCiAgICAgICAgICAgICAgICAgICAgc3RhdGVbInRvdGFsX2RlYXRocyJdID0gaW50KHN0YXRlWyJ0b3RhbF9kZWF0aHMiXSkgKyAxDQogICAgICAgICAgICAgICAgICAgIHN0YXRlWyJnYW1lX2RlYXRocyJdLnNldGRlZmF1bHQoY3VycmVudF9nYW1lX25hbWUsIDApDQogICAgICAgICAgICAgICAgICAgIHN0YXRlWyJnYW1lX2RlYXRocyJdW2N1cnJlbnRfZ2FtZV9uYW1lXSA9IGludChzdGF0ZVsiZ2FtZV9kZWF0aHMiXVtjdXJyZW50X2dhbWVfbmFtZV0pICsgMQ0KICAgICAgICAgICAgICAgICAgICBzdGF0ZVsibGFzdF9kZWF0aF90cyJdID0gbm93DQogICAgICAgICAgICAgICAgICAgIHN0YXRlWyJzdHJlYWsiXSA9IDANCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICMgU2F2ZSBzdGF0ZSBhbmQgd3JpdGUgdGV4dCBmaWxlDQogICAgICAgICAgICAgICAgICAgIHNhdmVfc3RhdGUoc3RhdGUpDQogICAgICAgICAgICAgICAgICAgICMgV3JpdGUgdGhlIGN1cnJlbnQgZ2FtZSdzIGRlYXRoIGNvdW50IChub3QgdG90YWwpDQogICAgICAgICAgICAgICAgICAgIGdhbWVfZGVhdGhzID0gc3RhdGVbImdhbWVfZGVhdGhzIl0uZ2V0KGN1cnJlbnRfZ2FtZV9uYW1lLCAwKQ0KICAgICAgICAgICAgICAgICAgICB3cml0ZV90ZXh0KGdhbWVfZGVhdGhzLCBjdXJyZW50X2dhbWVfbmFtZSkNCiAgICAgICAgICAgICAgICAgICAgIyBXcml0ZSB1cGRhdGVkIGNoYXQgaW5mbw0KICAgICAgICAgICAgICAgICAgICB3cml0ZV9jaGF0X2luZm8oY3VycmVudF9nYW1lX25hbWUsIGdhbWVfZGVhdGhzKQ0KICAgICAgICAgICAgICAgICAgICAjIFdyaXRlIHVwZGF0ZWQgdG90YWwgZGVhdGhzDQogICAgICAgICAgICAgICAgICAgIHdyaXRlX3RvdGFsX2RlYXRocyhzdGF0ZVsidG90YWxfZGVhdGhzIl0pDQogICAgICAgICAgICAgICAgICAgIGxvZyhmIkRFQVRIIENPVU5URUQgLT4gVG90YWw6IHtzdGF0ZVsndG90YWxfZGVhdGhzJ119IHwgIg0KICAgICAgICAgICAgICAgICAgICAgICAgZiJ7Y3VycmVudF9nYW1lX25hbWV9OiB7c3RhdGVbJ2dhbWVfZGVhdGhzJ11bY3VycmVudF9nYW1lX25hbWVdfSIpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBTYXZlIHN0YXRlIHBlcmlvZGljYWxseSAoZXZlcnkgMTAgdGlja3MgdG8gcmVkdWNlIEkvTykNCiAgICAgICAgICAgICAgICBpZiBzdGF0ZVsidGljayJdICUgMTAgPT0gMDoNCiAgICAgICAgICAgICAgICAgICAgc2F2ZV9zdGF0ZShzdGF0ZSkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICBsb2coZiJFcnJvciBpbiBtYWluIGxvb3A6IHtlfSIpDQogICAgICAgICAgICAgICAgbG9nKHRyYWNlYmFjay5mb3JtYXRfZXhjKCkpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHRpbWUuc2xlZXAoc2V0dGluZ3NbInRpY2tfc2Vjb25kcyJdKQ0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KIyBFTlRSWVBPSU5UDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgIyBDcmVhdGUgbG9jayBmaWxlIEZJUlNUIC0gYmVmb3JlIGFueXRoaW5nIGVsc2UNCiAgICBpZiBub3QgYWNxdWlyZV9sb2NrKCk6DQogICAgICAgIHByaW50KCJBbm90aGVyIGluc3RhbmNlIGlzIGFscmVhZHkgcnVubmluZy4gRXhpdGluZy4iKQ0KICAgICAgICByYWlzZSBTeXN0ZW1FeGl0KDApDQogICAgDQogICAgIyBDcmVhdGUgYSBzdGFydHVwIGVycm9yIGZpbGUgdG8gY2FwdHVyZSBhbnkgaW1tZWRpYXRlIGVycm9ycw0KICAgIFNUQVJUVVBfRVJST1JfRklMRSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRhZW1vbl9zdGFydHVwX2Vycm9yLnR4dCIpDQogICAgdHJ5Og0KICAgICAgICB3aXRoIG9wZW4oU1RBUlRVUF9FUlJPUl9GSUxFLCAidyIpIGFzIGY6DQogICAgICAgICAgICBmLndyaXRlKCIiKSAgIyBDbGVhciBhbnkgb2xkIGVycm9ycw0KICAgIGV4Y2VwdDoNCiAgICAgICAgcGFzcw0KICAgIA0KICAgICMgTG9nIHN0YXJ0dXAgaW1tZWRpYXRlbHkgLSB1c2UgYm90aCBsb2coKSBhbmQgcHJpbnQoKSBmb3IgdmlzaWJpbGl0eQ0KICAgIHN0YXJ0dXBfbXNnID0gIj0iICogNzAgKyAiXG5ERUFUSCBDT1VOVEVSIERBRU1PTiBTVEFSVElOR1xuIiArICI9IiAqIDcwDQogICAgcHJpbnQoc3RhcnR1cF9tc2cpDQogICAgbG9nKHN0YXJ0dXBfbXNnKQ0KICAgIGxvZyhmIlBJRDoge29zLmdldHBpZCgpfSIpDQogICAgbG9nKGYiQkFTRV9ESVI6IHtCQVNFX0RJUn0iKQ0KICAgIGxvZyhmIkxPQ0tfRklMRToge0xPQ0tfRklMRX0iKQ0KICAgIGxvZyhmIlJFQURZX0ZJTEU6IHtSRUFEWV9GSUxFfSIpDQogICAgbG9nKGYiUHl0aG9uOiB7c3lzLmV4ZWN1dGFibGV9IikNCiAgICBsb2coZiJTY3JpcHQ6IHtfX2ZpbGVfX30iKQ0KICAgIA0KICAgICMgQWxzbyBwcmludCBjcml0aWNhbCBpbmZvIHRvIHN0ZG91dCAodmlzaWJsZSBpbiBjb25zb2xlKQ0KICAgIHByaW50KGYiUElEOiB7b3MuZ2V0cGlkKCl9IikNCiAgICBwcmludChmIkJBU0VfRElSOiB7QkFTRV9ESVJ9IikNCiAgICBwcmludChmIkxPQ0tfRklMRToge0xPQ0tfRklMRX0iKQ0KICAgIHByaW50KGYiUkVBRFlfRklMRToge1JFQURZX0ZJTEV9IikNCiAgICANCiAgICBpbml0aWFsaXphdGlvbl9jb21wbGV0ZSA9IEZhbHNlDQogICAgdHJ5Og0KICAgICAgICAjIFNtYWxsIGRlbGF5IHRvIGVuc3VyZSBsb2NrIGZpbGUgaXMgd3JpdHRlbiB0byBkaXNrDQogICAgICAgIHRpbWUuc2xlZXAoMC4xKQ0KICAgICAgICBwcmludCgiU3RhcnRpbmcgbWFpbl9sb29wKCkuLi4iKQ0KICAgICAgICBsb2coIlN0YXJ0aW5nIG1haW5fbG9vcCgpLi4uIikNCiAgICAgICAgIyBDYWxsIG1haW5fbG9vcCBhbmQgdHJhY2sgaWYgaXQgY29tcGxldGVzIGluaXRpYWxpemF0aW9uDQogICAgICAgIG1haW5fbG9vcCgpDQogICAgICAgIGluaXRpYWxpemF0aW9uX2NvbXBsZXRlID0gVHJ1ZQ0KICAgICAgICBwcmludCgibWFpbl9sb29wKCkgY29tcGxldGVkIG5vcm1hbGx5IikNCiAgICAgICAgbG9nKCJtYWluX2xvb3AoKSBjb21wbGV0ZWQgbm9ybWFsbHkiKQ0KICAgIGV4Y2VwdCBLZXlib2FyZEludGVycnVwdDoNCiAgICAgICAgcHJpbnQoIkRhZW1vbiBzdG9wcGVkIChLZXlib2FyZEludGVycnVwdCkuIikNCiAgICAgICAgbG9nKCJEYWVtb24gc3RvcHBlZCAoS2V5Ym9hcmRJbnRlcnJ1cHQpLiIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBlcnJvcl9tc2cgPSBmIkZBVEFMIEVSUk9SOiB7c3RyKGUpfVxue3RyYWNlYmFjay5mb3JtYXRfZXhjKCl9Ig0KICAgICAgICBwcmludChlcnJvcl9tc2cpDQogICAgICAgIGxvZyhlcnJvcl9tc2cpDQogICAgICAgICMgV3JpdGUgZXJyb3IgdG8gc3RhcnR1cCBlcnJvciBmaWxlDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHdpdGggb3BlbihTVEFSVFVQX0VSUk9SX0ZJTEUsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICBmLndyaXRlKGVycm9yX21zZykNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICAjIElmIHdlIGdvdCBoZXJlLCBpbml0aWFsaXphdGlvbiBmYWlsZWQgLSByZW1vdmUgcmVhZHkgZmlsZSBpZiBpdCBleGlzdHMNCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSk6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKFJFQURZX0ZJTEUpDQogICAgICAgICAgICAgICAgcHJpbnQoIlJlbW92ZWQgcmVhZHkgZmlsZSBkdWUgdG8gZXJyb3IiKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICBmaW5hbGx5Og0KICAgICAgICBwcmludCgiUmVsZWFzaW5nIGxvY2sgYW5kIHNodXR0aW5nIGRvd24uLi4iKQ0KICAgICAgICByZWxlYXNlX2xvY2soKQ0KICAgICAgICBsb2coIkRhZW1vbiBzaHV0ZG93biBjb21wbGV0ZS4iKQ0KICAgICAgICBwcmludCgiRGFlbW9uIHNodXRkb3duIGNvbXBsZXRlLiIpDQoNCg==",
  "death_counter_gui.py": "IiIiDQpEZWF0aCBDb3VudGVyIEdVSSBBcHBsaWNhdGlvbg0KQSBzaW1wbGUgR1VJIHRvIGNvbnRyb2wgdGhlIGRlYXRoIGNvdW50ZXIgZGFlbW9uIGFuZCB2aWV3IHN0YXRzLg0KDQpUbyBjcmVhdGUgYW4gLmV4ZToNCiAgICBwaXAgaW5zdGFsbCBweWluc3RhbGxlcg0KICAgIHB5aW5zdGFsbGVyIC0tb25lZmlsZSAtLXdpbmRvd2VkIC0tbmFtZSAiRGVhdGhDb3VudGVyIiBkZWF0aF9jb3VudGVyX2d1aS5weQ0KIiIiDQoNCmltcG9ydCBvcw0KaW1wb3J0IHN5cw0KaW1wb3J0IGpzb24NCmltcG9ydCB0aW1lDQppbXBvcnQgc3VicHJvY2Vzcw0KaW1wb3J0IHRocmVhZGluZw0KZnJvbSB0a2ludGVyIGltcG9ydCAqDQpmcm9tIHRraW50ZXIgaW1wb3J0IHR0aywgbWVzc2FnZWJveA0KDQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQgKHdvcmtzIGZvciBib3RoIC5leGUgYW5kIC5weSkNCmRlZiBnZXRfYmFzZV9kaXIoKToNCiAgICAiIiJHZXQgdGhlIGJhc2UgZGlyZWN0b3J5IC0gc2FtZSBmb2xkZXIgYXMgdGhpcyBzY3JpcHQuIiIiDQogICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgICMgUnVubmluZyBhcyBjb21waWxlZCAuZXhlIC0gdXNlIHRoZSBkaXJlY3Rvcnkgd2hlcmUgLmV4ZSBpcyBsb2NhdGVkDQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKHN5cy5leGVjdXRhYmxlKSkNCiAgICBlbHNlOg0KICAgICAgICAjIFJ1bm5pbmcgYXMgc2NyaXB0IC0gdXNlIHRoZSBkaXJlY3Rvcnkgd2hlcmUgdGhlIHNjcmlwdCBpcyBsb2NhdGVkDQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkNCg0KQkFTRV9ESVIgPSBnZXRfYmFzZV9kaXIoKQ0KQ09ORklHX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJnYW1lc19jb25maWcuanNvbiIpDQpTVEFURV9KU09OID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVhdGhfc3RhdGUuanNvbiIpDQpMT0NLX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb24ubG9jayIpDQpSRUFEWV9GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGFlbW9uLnJlYWR5IikgICMgU2lnbmFsIGZpbGUgY3JlYXRlZCBhZnRlciBmdWxsIGluaXRpYWxpemF0aW9uDQpTVE9QX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJTVE9QIikNCkdVSV9ERUJVR19MT0cgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJndWlfZGVidWcubG9nIikgICMgRGVidWcgbG9nIGZvciBHVUkNCiMgUHJpbWFyeSBzY3JpcHQgcGF0aCAobmV3IG5hbWluZykNClNDUklQVF9QQVRIID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAibXVsdGlfZ2FtZV9kZWF0aF9jb3VudGVyLnB5IikNCiMgQmFja3dhcmQgY29tcGF0aWJpbGl0eTogYWxzbyB0cnkgdGhlIG9sZCBuYW1lIGlmIG5lZWRlZA0KaWYgbm90IG9zLnBhdGguZXhpc3RzKFNDUklQVF9QQVRIKToNCiAgICBTQ1JJUFRfUEFUSCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgIm11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weSIpDQpERUFUSF9UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9jb3VudGVyLnR4dCIpDQoNCg0KY2xhc3MgRGVhdGhDb3VudGVyR1VJOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCByb290KToNCiAgICAgICAgc2VsZi5yb290ID0gcm9vdA0KICAgICAgICBzZWxmLnJvb3QudGl0bGUoIkRlYXRoIENvdW50ZXIgQ29udHJvbCIpDQogICAgICAgIHNlbGYucm9vdC5nZW9tZXRyeSgiNDAweDM0MCIpDQogICAgICAgIHNlbGYucm9vdC5yZXNpemFibGUoRmFsc2UsIEZhbHNlKQ0KICAgICAgICANCiAgICAgICAgIyBWYXJpYWJsZXMNCiAgICAgICAgc2VsZi5kYWVtb25fcHJvY2VzcyA9IE5vbmUNCiAgICAgICAgc2VsZi5tb25pdG9yaW5nID0gRmFsc2UNCiAgICAgICAgDQogICAgICAgICMgQ3JlYXRlIFVJDQogICAgICAgIHNlbGYuY3JlYXRlX3VpKCkNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgaW5pdGlhbCBzdGF0ZSAoYWZ0ZXIgVUkgaXMgY3JlYXRlZCkNCiAgICAgICAgc2VsZi51cGRhdGVfc3RhdHVzKCkNCiAgICAgICAgDQogICAgICAgICMgU3RhcnQgbW9uaXRvcmluZyB0aHJlYWQNCiAgICAgICAgc2VsZi5zdGFydF9tb25pdG9yaW5nKCkNCiAgICANCiAgICBkZWYgY3JlYXRlX3VpKHNlbGYpOg0KICAgICAgICAjIE1haW4gZnJhbWUNCiAgICAgICAgbWFpbl9mcmFtZSA9IHR0ay5GcmFtZShzZWxmLnJvb3QsIHBhZGRpbmc9IjEwIikNCiAgICAgICAgbWFpbl9mcmFtZS5ncmlkKHJvdz0wLCBjb2x1bW49MCwgc3RpY2t5PShXLCBFLCBOLCBTKSkNCiAgICAgICAgDQogICAgICAgICMgVGl0bGUNCiAgICAgICAgdGl0bGVfbGFiZWwgPSB0dGsuTGFiZWwobWFpbl9mcmFtZSwgdGV4dD0iRGVhdGggQ291bnRlciIsIGZvbnQ9KCJBcmlhbCIsIDE2LCAiYm9sZCIpKQ0KICAgICAgICB0aXRsZV9sYWJlbC5ncmlkKHJvdz0wLCBjb2x1bW49MCwgY29sdW1uc3Bhbj0yLCBwYWR5PSgwLCAyMCkpDQogICAgICAgIA0KICAgICAgICAjIFN0YXR1cyBmcmFtZQ0KICAgICAgICBzdGF0dXNfZnJhbWUgPSB0dGsuTGFiZWxGcmFtZShtYWluX2ZyYW1lLCB0ZXh0PSJTdGF0dXMiLCBwYWRkaW5nPSIxMCIpDQogICAgICAgIHN0YXR1c19mcmFtZS5ncmlkKHJvdz0xLCBjb2x1bW49MCwgY29sdW1uc3Bhbj0yLCBzdGlja3k9KFcsIEUpLCBwYWR5PSgwLCAxMCkpDQogICAgICAgIA0KICAgICAgICAjIFN0YXR1cyBhbmQgdG90YWwgZGVhdGhzIGluIGEgcm93DQogICAgICAgIHN0YXR1c19yb3cgPSB0dGsuRnJhbWUoc3RhdHVzX2ZyYW1lKQ0KICAgICAgICBzdGF0dXNfcm93LmdyaWQocm93PTAsIGNvbHVtbj0wLCBzdGlja3k9KFcsIEUpKQ0KICAgICAgICBzdGF0dXNfZnJhbWUuY29sdW1uY29uZmlndXJlKDAsIHdlaWdodD0xKQ0KICAgICAgICANCiAgICAgICAgc2VsZi5zdGF0dXNfbGFiZWwgPSB0dGsuTGFiZWwoc3RhdHVzX3JvdywgdGV4dD0iQ2hlY2tpbmcuLi4iLCBmb250PSgiQXJpYWwiLCAxMCkpDQogICAgICAgIHNlbGYuc3RhdHVzX2xhYmVsLmdyaWQocm93PTAsIGNvbHVtbj0wLCBzdGlja3k9VykNCiAgICAgICAgDQogICAgICAgICMgVG90YWwgZGVhdGhzIGxhYmVsDQogICAgICAgIHNlbGYudG90YWxfZGVhdGhzX2xhYmVsID0gdHRrLkxhYmVsKHN0YXR1c19yb3csIHRleHQ9IlRvdGFsIERlYXRoczogMCIsIGZvbnQ9KCJBcmlhbCIsIDEwLCAiYm9sZCIpKQ0KICAgICAgICBzZWxmLnRvdGFsX2RlYXRoc19sYWJlbC5ncmlkKHJvdz0wLCBjb2x1bW49MSwgc3RpY2t5PUUsIHBhZHg9KDIwLCAwKSkNCiAgICAgICAgDQogICAgICAgICMgRGVhdGggY291bnQgZGlzcGxheSAtIExhcmdlIGNsaWNrYWJsZSBidXR0b24NCiAgICAgICAgY291bnRfZnJhbWUgPSB0dGsuRnJhbWUobWFpbl9mcmFtZSkNCiAgICAgICAgY291bnRfZnJhbWUuZ3JpZChyb3c9MiwgY29sdW1uPTAsIGNvbHVtbnNwYW49Miwgc3RpY2t5PShXLCBFKSwgcGFkeT0oMCwgMTApKQ0KICAgICAgICANCiAgICAgICAgIyBDcmVhdGUgYSBsYXJnZSBidXR0b24gdGhhdCBzaG93cyBkZWF0aCBjb3VudCBhbmQgZ2FtZSBuYW1lDQogICAgICAgICMgVXNlIGEgZnJhbWUgd2l0aCBsYWJlbCBmb3IgYmV0dGVyIHRleHQgY29udHJvbA0KICAgICAgICBidXR0b25fY29udGFpbmVyID0gRnJhbWUoY291bnRfZnJhbWUsIGJnPSIjZjBmMGYwIiwgcmVsaWVmPVJBSVNFRCwgYmQ9MykNCiAgICAgICAgYnV0dG9uX2NvbnRhaW5lci5ncmlkKHJvdz0wLCBjb2x1bW49MCwgc3RpY2t5PShXLCBFKSwgaXBhZHg9MTAsIGlwYWR5PTEwKQ0KICAgICAgICBjb3VudF9mcmFtZS5jb2x1bW5jb25maWd1cmUoMCwgd2VpZ2h0PTEpDQogICAgICAgIA0KICAgICAgICAjIERlYXRoIGNvdW50IGxhYmVsIChsYXJnZSkNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbCA9IExhYmVsKA0KICAgICAgICAgICAgYnV0dG9uX2NvbnRhaW5lciwNCiAgICAgICAgICAgIHRleHQ9IjAiLA0KICAgICAgICAgICAgZm9udD0oIkFyaWFsIiwgMjQsICJib2xkIiksDQogICAgICAgICAgICBiZz0iI2YwZjBmMCIsDQogICAgICAgICAgICBmZz0iYmxhY2siDQogICAgICAgICkNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbC5wYWNrKHBhZHk9KDEwLCA1KSkNCiAgICAgICAgDQogICAgICAgICMgR2FtZSBuYW1lIGxhYmVsIChzbWFsbGVyLCB3cmFwcykNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwgPSBMYWJlbCgNCiAgICAgICAgICAgIGJ1dHRvbl9jb250YWluZXIsDQogICAgICAgICAgICB0ZXh0PSJObyBnYW1lIHNlbGVjdGVkIiwNCiAgICAgICAgICAgIGZvbnQ9KCJBcmlhbCIsIDEwKSwNCiAgICAgICAgICAgIGJnPSIjZjBmMGYwIiwNCiAgICAgICAgICAgIGZnPSJibGFjayIsDQogICAgICAgICAgICB3cmFwbGVuZ3RoPTMyMCwNCiAgICAgICAgICAgIGp1c3RpZnk9Q0VOVEVSDQogICAgICAgICkNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwucGFjayhwYWR5PSgwLCAxMCkpDQogICAgICAgIA0KICAgICAgICAjIE1ha2UgdGhlIHdob2xlIGNvbnRhaW5lciBjbGlja2FibGUNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9idXR0b24gPSBidXR0b25fY29udGFpbmVyDQogICAgICAgICMgVXNlIEJ1dHRvblJlbGVhc2UtMSBmb3IgYmV0dGVyIGNsaWNrIGRldGVjdGlvbg0KICAgICAgICBidXR0b25fY29udGFpbmVyLmJpbmQoIjxCdXR0b25SZWxlYXNlLTE+IiwgbGFtYmRhIGU6IHNlbGYuY3ljbGVfZ2FtZSgpKQ0KICAgICAgICBidXR0b25fY29udGFpbmVyLmJpbmQoIjxFbnRlcj4iLCBsYW1iZGEgZTogc2VsZi5vbl9idXR0b25fZW50ZXIoYnV0dG9uX2NvbnRhaW5lcikpDQogICAgICAgIGJ1dHRvbl9jb250YWluZXIuYmluZCgiPExlYXZlPiIsIGxhbWJkYSBlOiBzZWxmLm9uX2J1dHRvbl9sZWF2ZShidXR0b25fY29udGFpbmVyKSkNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbC5iaW5kKCI8QnV0dG9uUmVsZWFzZS0xPiIsIGxhbWJkYSBlOiBzZWxmLmN5Y2xlX2dhbWUoKSkNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwuYmluZCgiPEJ1dHRvblJlbGVhc2UtMT4iLCBsYW1iZGEgZTogc2VsZi5jeWNsZV9nYW1lKCkpDQogICAgICAgIGJ1dHRvbl9jb250YWluZXIuY29uZmlnKGN1cnNvcj0iaGFuZDIiKQ0KICAgICAgICBzZWxmLmRlYXRoX2NvdW50X2xhYmVsLmNvbmZpZyhjdXJzb3I9ImhhbmQyIikNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwuY29uZmlnKGN1cnNvcj0iaGFuZDIiKQ0KICAgICAgICANCiAgICAgICAgIyBDb250cm9sIGJ1dHRvbnMgZnJhbWUNCiAgICAgICAgY29udHJvbF9mcmFtZSA9IHR0ay5MYWJlbEZyYW1lKG1haW5fZnJhbWUsIHRleHQ9IkNvbnRyb2wiLCBwYWRkaW5nPSIxMCIpDQogICAgICAgIGNvbnRyb2xfZnJhbWUuZ3JpZChyb3c9MywgY29sdW1uPTAsIGNvbHVtbnNwYW49Miwgc3RpY2t5PShXLCBFKSwgcGFkeT0oMCwgMCkpDQogICAgICAgIA0KICAgICAgICBzZWxmLnN0YXJ0X2J1dHRvbiA9IHR0ay5CdXR0b24oY29udHJvbF9mcmFtZSwgdGV4dD0iU3RhcnQgRGFlbW9uIiwgY29tbWFuZD1zZWxmLnN0YXJ0X2RhZW1vbiwgd2lkdGg9MTgpDQogICAgICAgIHNlbGYuc3RhcnRfYnV0dG9uLmdyaWQocm93PTAsIGNvbHVtbj0wLCBwYWR4PSgwLCA1KSkNCiAgICAgICAgDQogICAgICAgIHNlbGYuc3RvcF9idXR0b24gPSB0dGsuQnV0dG9uKGNvbnRyb2xfZnJhbWUsIHRleHQ9IlN0b3AgRGFlbW9uIiwgY29tbWFuZD1zZWxmLnN0b3BfZGFlbW9uLCB3aWR0aD0xOCwgc3RhdGU9RElTQUJMRUQpDQogICAgICAgIHNlbGYuc3RvcF9idXR0b24uZ3JpZChyb3c9MCwgY29sdW1uPTEsIHBhZHg9KDUsIDApKQ0KICAgICAgICANCiAgICAgICAgIyBMb2FkIGF2YWlsYWJsZSBnYW1lcw0KICAgICAgICBzZWxmLmxvYWRfZ2FtZXMoKQ0KICAgIA0KICAgIGRlZiBvbl9idXR0b25fZW50ZXIoc2VsZiwgY29udGFpbmVyKToNCiAgICAgICAgIiIiQ2hhbmdlIGJhY2tncm91bmQgb24gaG92ZXIuIiIiDQogICAgICAgIGNvbnRhaW5lci5jb25maWcoYmc9IiNlMGUwZTAiKQ0KICAgICAgICBzZWxmLmRlYXRoX2NvdW50X2xhYmVsLmNvbmZpZyhiZz0iI2UwZTBlMCIpDQogICAgICAgIHNlbGYuZ2FtZV9uYW1lX2xhYmVsLmNvbmZpZyhiZz0iI2UwZTBlMCIpDQogICAgDQogICAgZGVmIG9uX2J1dHRvbl9sZWF2ZShzZWxmLCBjb250YWluZXIpOg0KICAgICAgICAiIiJSZXN0b3JlIGJhY2tncm91bmQgb24gbGVhdmUuIiIiDQogICAgICAgIGNvbnRhaW5lci5jb25maWcoYmc9IiNmMGYwZjAiKQ0KICAgICAgICBzZWxmLmRlYXRoX2NvdW50X2xhYmVsLmNvbmZpZyhiZz0iI2YwZjBmMCIpDQogICAgICAgIHNlbGYuZ2FtZV9uYW1lX2xhYmVsLmNvbmZpZyhiZz0iI2YwZjBmMCIpDQogICAgDQogICAgZGVmIGxvYWRfZ2FtZXMoc2VsZik6DQogICAgICAgICIiIkxvYWQgYXZhaWxhYmxlIGdhbWVzIGZyb20gY29uZmlnLiIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhDT05GSUdfRklMRSk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgICAgIHNlbGYuYXZhaWxhYmxlX2dhbWVzID0gbGlzdChjb25maWcuZ2V0KCJnYW1lcyIsIHt9KS5rZXlzKCkpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHNlbGYuYXZhaWxhYmxlX2dhbWVzID0gWyJFbGRlbiBSaW5nIiwgIkRhcmsgU291bHMgMyIsICJEYXJrIFNvdWxzIFJlbWFzdGVyZWQiLCAiU2VraXJvIl0NCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgc2VsZi5hdmFpbGFibGVfZ2FtZXMgPSBbIkVsZGVuIFJpbmciLCAiRGFyayBTb3VscyAzIiwgIkRhcmsgU291bHMgUmVtYXN0ZXJlZCIsICJTZWtpcm8iXQ0KICAgICAgICANCiAgICAgICAgaWYgbm90IHNlbGYuYXZhaWxhYmxlX2dhbWVzOg0KICAgICAgICAgICAgc2VsZi5hdmFpbGFibGVfZ2FtZXMgPSBbIk5vIGdhbWVzIGNvbmZpZ3VyZWQiXQ0KICAgIA0KICAgIGRlZiBnZXRfY3VycmVudF9nYW1lKHNlbGYpOg0KICAgICAgICAiIiJHZXQgY3VycmVudCBnYW1lIGZyb20gc3RhdGUgb3IgY29uZmlnLiIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjIFRyeSBzdGF0ZSBmaWxlIGZpcnN0DQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhTVEFURV9KU09OKToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oU1RBVEVfSlNPTiwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgICAgIGdhbWUgPSBzdGF0ZS5nZXQoImN1cnJlbnRfZ2FtZSIpDQogICAgICAgICAgICAgICAgaWYgZ2FtZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdhbWUNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBGYWxsIGJhY2sgdG8gY29uZmlnDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhDT05GSUdfRklMRSk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcuZ2V0KCJjdXJyZW50X2dhbWUiLCBzZWxmLmF2YWlsYWJsZV9nYW1lc1swXSBpZiBzZWxmLmF2YWlsYWJsZV9nYW1lcyBlbHNlICJVbmtub3duIikNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNlbGYuYXZhaWxhYmxlX2dhbWVzWzBdIGlmIHNlbGYuYXZhaWxhYmxlX2dhbWVzIGVsc2UgIlVua25vd24iDQogICAgDQogICAgZGVmIGdldF9kZWF0aF9jb3VudChzZWxmLCBnYW1lX25hbWUpOg0KICAgICAgICAiIiJHZXQgZGVhdGggY291bnQgZm9yIGEgc3BlY2lmaWMgZ2FtZS4iIiINCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoU1RBVEVfSlNPTik6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKFNUQVRFX0pTT04sICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBqc29uLmxvYWQoZikNCiAgICAgICAgICAgICAgICBnYW1lX2RlYXRocyA9IHN0YXRlLmdldCgiZ2FtZV9kZWF0aHMiLCB7fSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZ2FtZV9kZWF0aHMuZ2V0KGdhbWVfbmFtZSwgMCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICByZXR1cm4gMA0KICAgIA0KICAgIGRlZiBnZXRfdG90YWxfZGVhdGhzKHNlbGYpOg0KICAgICAgICAiIiJHZXQgdG90YWwgZGVhdGhzIGFjcm9zcyBhbGwgZ2FtZXMuIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFNUQVRFX0pTT04pOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmdldCgidG90YWxfZGVhdGhzIiwgMCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICByZXR1cm4gMA0KICAgIA0KICAgIGRlZiBjeWNsZV9nYW1lKHNlbGYsIGV2ZW50PU5vbmUpOg0KICAgICAgICAiIiJDeWNsZSB0byB0aGUgbmV4dCBnYW1lIGluIHRoZSBsaXN0LiIiIg0KICAgICAgICBpZiBub3Qgc2VsZi5hdmFpbGFibGVfZ2FtZXMgb3IgbGVuKHNlbGYuYXZhaWxhYmxlX2dhbWVzKSA9PSAwOg0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93d2FybmluZygiTm8gR2FtZXMiLCAiTm8gZ2FtZXMgY29uZmlndXJlZC4iKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICBjdXJyZW50X2dhbWUgPSBzZWxmLmdldF9jdXJyZW50X2dhbWUoKQ0KICAgICAgICANCiAgICAgICAgIyBGaW5kIGN1cnJlbnQgaW5kZXgNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgY3VycmVudF9pbmRleCA9IHNlbGYuYXZhaWxhYmxlX2dhbWVzLmluZGV4KGN1cnJlbnRfZ2FtZSkNCiAgICAgICAgICAgIG5leHRfaW5kZXggPSAoY3VycmVudF9pbmRleCArIDEpICUgbGVuKHNlbGYuYXZhaWxhYmxlX2dhbWVzKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBuZXh0X2luZGV4ID0gMA0KICAgICAgICANCiAgICAgICAgbmV3X2dhbWUgPSBzZWxmLmF2YWlsYWJsZV9nYW1lc1tuZXh0X2luZGV4XQ0KICAgICAgICANCiAgICAgICAgIyBTd2l0Y2ggZ2FtZSB1c2luZyB0aGUgbWFudWFsIHN3aXRjaCBzY3JpcHQNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgc3dpdGNoX3NjcmlwdCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgInN3aXRjaF9nYW1lX21hbnVhbC5weSIpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzd2l0Y2hfc2NyaXB0KToNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigNCiAgICAgICAgICAgICAgICAgICAgW3N5cy5leGVjdXRhYmxlLCBzd2l0Y2hfc2NyaXB0LCBuZXdfZ2FtZV0sDQogICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsDQogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgY3dkPUJBU0VfRElSDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlX3N0YXR1cygpDQogICAgICAgICAgICAgICAgICAgICMgU2lsZW50bHkgc3dpdGNoIC0gbm8gcG9wdXANCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHRvIGRpcmVjdCBzd2l0Y2ggaWYgc2NyaXB0IGZhaWxzDQogICAgICAgICAgICAgICAgICAgIHNlbGYuc3dpdGNoX2dhbWVfZGlyZWN0KG5ld19nYW1lKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiBkaXJlY3RseSB1cGRhdGUgY29uZmlnDQogICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hfZ2FtZV9kaXJlY3QobmV3X2dhbWUpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gZGlyZWN0IHN3aXRjaCBvbiBhbnkgZXJyb3INCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBzZWxmLnN3aXRjaF9nYW1lX2RpcmVjdChuZXdfZ2FtZSkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgDQogICAgZGVmIHN3aXRjaF9nYW1lX2RpcmVjdChzZWxmLCBnYW1lX25hbWUpOg0KICAgICAgICAiIiJEaXJlY3RseSBzd2l0Y2ggZ2FtZSBieSB1cGRhdGluZyBjb25maWcgYW5kIHN0YXRlLiIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjIFVwZGF0ZSBjb25maWcNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oQ09ORklHX0ZJTEUsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgY29uZmlnWyJjdXJyZW50X2dhbWUiXSA9IGdhbWVfbmFtZQ0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihDT05GSUdfRklMRSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBVcGRhdGUgc3RhdGUNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFNUQVRFX0pTT04pOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgc3RhdGVbImN1cnJlbnRfZ2FtZSJdID0gZ2FtZV9uYW1lDQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKFNUQVRFX0pTT04sICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wKHN0YXRlLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBVcGRhdGUgdGV4dCBmaWxlDQogICAgICAgICAgICBnYW1lX2RlYXRocyA9IHNlbGYuZ2V0X2RlYXRoX2NvdW50KGdhbWVfbmFtZSkNCiAgICAgICAgICAgIHdpdGggb3BlbihERUFUSF9UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICBmLndyaXRlKHN0cihnYW1lX2RlYXRocykpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYudXBkYXRlX3N0YXR1cygpDQogICAgICAgICAgICAjIFNpbGVudGx5IHN3aXRjaCAtIG5vIHBvcHVwDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRmFpbGVkIHRvIHN3aXRjaCBnYW1lOiB7ZX0iKQ0KICAgIA0KICAgIGRlZiBpc19kYWVtb25fcnVubmluZyhzZWxmKToNCiAgICAgICAgIiIiQ2hlY2sgaWYgZGFlbW9uIGlzIHJ1bm5pbmcgLSBjaGVjayBib3RoIGxvY2sgZmlsZSBhbmQgcHJvY2Vzcy4iIiINCiAgICAgICAgIyBDaGVjayBsb2NrIGZpbGUNCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICAgICMgVmVyaWZ5IHRoZSBwcm9jZXNzIGluIHRoZSBsb2NrIGZpbGUgaXMgYWN0dWFsbHkgcnVubmluZw0KICAgICAgICB0cnk6DQogICAgICAgICAgICB3aXRoIG9wZW4oTE9DS19GSUxFLCAiciIpIGFzIGY6DQogICAgICAgICAgICAgICAgcGlkX3N0ciA9IGYucmVhZCgpLnN0cmlwKCkNCiAgICAgICAgICAgIGlmIHBpZF9zdHI6DQogICAgICAgICAgICAgICAgcGlkID0gaW50KHBpZF9zdHIpDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiBwcm9jZXNzIGV4aXN0cw0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0IHBzdXRpbA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHN1dGlsLnBpZF9leGlzdHMocGlkKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjazogdXNlIHRhc2tsaXN0IG9uIFdpbmRvd3MNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWyJ0YXNrbGlzdCIsICIvRkkiLCBmIlBJRCBlcSB7cGlkfSJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9Mg0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYie3BpZH0iIGluIHJlc3VsdC5zdGRvdXQNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiB3ZSBjYW4ndCBjaGVjaywgYXNzdW1lIGl0J3MgcnVubmluZyBpZiBsb2NrIGZpbGUgZXhpc3RzDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAjIElmIHdlIGNhbid0IHJlYWQgdGhlIGxvY2sgZmlsZSwgYXNzdW1lIGl0J3Mgbm90IHJ1bm5pbmcNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIFRydWUNCiAgICANCiAgICBkZWYgZmluZF9weXRob25fZXhlY3V0YWJsZShzZWxmKToNCiAgICAgICAgIiIiRmluZCBQeXRob24gZXhlY3V0YWJsZSwgY2hlY2tpbmcgUEFUSCBhbmQgY29tbW9uIGluc3RhbGxhdGlvbiBsb2NhdGlvbnMuDQogICAgICAgIENvbXByZWhlbnNpdmUgc2VhcmNoIGZvciBnZW5lcmFsIHB1YmxpYyB1c2UuIiIiDQogICAgICAgICMgSWYgcnVubmluZyBhcyBhIHNjcmlwdCAobm90IGZyb3plbiksIHVzZSBzeXMuZXhlY3V0YWJsZQ0KICAgICAgICBpZiBub3QgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgICAgICByZXR1cm4gc3lzLmV4ZWN1dGFibGUNCiAgICAgICAgDQogICAgICAgICMgSWYgcnVubmluZyBhcyBQeUluc3RhbGxlciBleGUsIHdlIG5lZWQgdG8gZmluZCBQeXRob24NCiAgICAgICAgIyBNZXRob2QgMTogVHJ5ICdweXRob24nIGNvbW1hbmQgKGlmIGluIFBBVEgpIC0gbW9zdCByZWxpYWJsZQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3B5dGhvbicsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTIpDQogICAgICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSA9PSAwOg0KICAgICAgICAgICAgICAgIHJldHVybiAncHl0aG9uJw0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIE1ldGhvZCAyOiBUcnkgJ3B5JyBsYXVuY2hlciAoV2luZG93cyBQeXRob24gbGF1bmNoZXIpIC0gYWxzbyByZWxpYWJsZQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3B5JywgJy0tdmVyc2lvbiddLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MikNCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgcmV0dXJuICdweScNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBNZXRob2QgMzogU2VhcmNoIFdpbmRvd3MgUmVnaXN0cnkgZm9yIFB5dGhvbiBpbnN0YWxsYXRpb25zDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGltcG9ydCB3aW5yZWcNCiAgICAgICAgICAgICMgQ2hlY2sgYm90aCAzMi1iaXQgYW5kIDY0LWJpdCByZWdpc3RyeQ0KICAgICAgICAgICAgZm9yIGFyY2ggaW4gW3dpbnJlZy5LRVlfV09XNjRfNjRLRVksIHdpbnJlZy5LRVlfV09XNjRfMzJLRVldOg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBIS0VZX0xPQ0FMX01BQ0hJTkUNCiAgICAgICAgICAgICAgICAgICAga2V5ID0gd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfTE9DQUxfTUFDSElORSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTT0ZUV0FSRVxQeXRob25cUHl0aG9uQ29yZSIsIDAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lucmVnLktFWV9SRUFEIHwgYXJjaCkNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgIyBHZXQgYWxsIGluc3RhbGxlZCBQeXRob24gdmVyc2lvbnMNCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAwDQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9IHdpbnJlZy5FbnVtS2V5KGtleSwgaSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbF9wYXRoX2tleSA9IHdpbnJlZy5PcGVuS2V5KGtleSwgZiJ7dmVyc2lvbn1cXEluc3RhbGxQYXRoIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbF9wYXRoID0gd2lucmVnLlF1ZXJ5VmFsdWVFeChpbnN0YWxsX3BhdGhfa2V5LCAiIilbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl9leGUgPSBvcy5wYXRoLmpvaW4oaW5zdGFsbF9wYXRoLCAicHl0aG9uLmV4ZSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoaW5zdGFsbF9wYXRoX2tleSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoa2V5KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBweXRob25fZXhlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoaW5zdGFsbF9wYXRoX2tleSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbnJlZy5DbG9zZUtleShrZXkpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoa2V5KQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBNZXRob2QgNDogU2VhcmNoIGNvbW1vbiBpbnN0YWxsYXRpb24gbG9jYXRpb25zDQogICAgICAgIHVzZXJwcm9maWxlID0gb3MuZ2V0ZW52KCdVU0VSUFJPRklMRScsICcnKQ0KICAgICAgICBwcm9ncmFtZmlsZXMgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcycsIHInQzpcUHJvZ3JhbSBGaWxlcycpDQogICAgICAgIHByb2dyYW1maWxlc194ODYgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcyh4ODYpJywgcidDOlxQcm9ncmFtIEZpbGVzICh4ODYpJykNCiAgICAgICAgDQogICAgICAgIHNlYXJjaF9wYXRocyA9IFtdDQogICAgICAgIA0KICAgICAgICAjIFVzZXIgQXBwRGF0YSBsb2NhdGlvbnMgKG1vc3QgY29tbW9uIGZvciBQeXRob24gMy44KykNCiAgICAgICAgaWYgdXNlcnByb2ZpbGU6DQogICAgICAgICAgICBhcHBkYXRhX2xvY2FsID0gb3MucGF0aC5qb2luKHVzZXJwcm9maWxlLCByIkFwcERhdGFcTG9jYWxcUHJvZ3JhbXNcUHl0aG9uIikNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGFwcGRhdGFfbG9jYWwpOg0KICAgICAgICAgICAgICAgICMgU2VhcmNoIGFsbCBQeXRob24gdmVyc2lvbnMgaW4gdGhpcyBkaXJlY3RvcnkNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIG9zLmxpc3RkaXIoYXBwZGF0YV9sb2NhbCk6DQogICAgICAgICAgICAgICAgICAgICAgICBweXRob25fZGlyID0gb3MucGF0aC5qb2luKGFwcGRhdGFfbG9jYWwsIGl0ZW0pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHB5dGhvbl9kaXIpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl9leGUgPSBvcy5wYXRoLmpvaW4ocHl0aG9uX2RpciwgInB5dGhvbi5leGUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hfcGF0aHMuYXBwZW5kKHB5dGhvbl9leGUpDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIENvbW1vbiByb290LWxldmVsIFB5dGhvbiBpbnN0YWxsYXRpb25zDQogICAgICAgIGZvciB2ZXJzaW9uIGluIFsnMzEyJywgJzMxMScsICczMTAnLCAnMzknLCAnMzgnXToNCiAgICAgICAgICAgIHNlYXJjaF9wYXRocy5leHRlbmQoWw0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihyIkM6XFB5dGhvbiIgKyB2ZXJzaW9uLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihwcm9ncmFtZmlsZXMsIGYiUHl0aG9ue3ZlcnNpb259IiwgInB5dGhvbi5leGUiKSwNCiAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4ocHJvZ3JhbWZpbGVzX3g4NiwgZiJQeXRob257dmVyc2lvbn0iLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgXSkNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgYWxsIGNvbGxlY3RlZCBwYXRocw0KICAgICAgICBmb3IgcGF0aCBpbiBzZWFyY2hfcGF0aHM6DQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhwYXRoKToNCiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aA0KICAgICAgICANCiAgICAgICAgIyBNZXRob2QgNTogUmVjdXJzaXZlIHNlYXJjaCBpbiBQcm9ncmFtIEZpbGVzIChsYXN0IHJlc29ydCwgc2xvd2VyKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBmb3Igcm9vdF9kaXIgaW4gW3Byb2dyYW1maWxlcywgcHJvZ3JhbWZpbGVzX3g4Nl06DQogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocm9vdF9kaXIpOg0KICAgICAgICAgICAgICAgICAgICBmb3Igcm9vdCwgZGlycywgZmlsZXMgaW4gb3Mud2Fsayhyb290X2Rpcik6DQogICAgICAgICAgICAgICAgICAgICAgICAjIExpbWl0IGRlcHRoIHRvIGF2b2lkIHNsb3cgc2VhcmNoZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcHRoID0gcm9vdFtsZW4ocm9vdF9kaXIpOl0uY291bnQob3Muc2VwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVwdGggPiAyOiAgIyBNYXggMiBsZXZlbHMgZGVlcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcnNbOl0gPSBbXSAgIyBEb24ndCByZWN1cnNlIGRlZXBlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdweXRob24uZXhlJyBpbiBmaWxlczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fZXhlID0gb3MucGF0aC5qb2luKHJvb3QsICdweXRob24uZXhlJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFZlcmlmeSBpdCdzIGFjdHVhbGx5IFB5dGhvbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oW3B5dGhvbl9leGUsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0aW1lb3V0PTEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHl0aG9uX2V4ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICByZXR1cm4gTm9uZQ0KICAgIA0KICAgIGRlZiBpc19weXRob25fdmVyc2lvbl9jb21wYXRpYmxlKHNlbGYsIHB5dGhvbl9leGUpOg0KICAgICAgICAiIiJDaGVjayBpZiBQeXRob24gdmVyc2lvbiBpcyBjb21wYXRpYmxlICgzLjgtMy4xMykuIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgVHJ5IHRvIGdldCB2ZXJzaW9uIHdpdGhvdXQgaGFuZ2luZyAtIHVzZSBhIHZlcnkgc2hvcnQgdGltZW91dA0KICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgW3B5dGhvbl9leGUsICctLXZlcnNpb24nXSwNCiAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLA0KICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICB0aW1lb3V0PTENCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgdmVyc2lvbl9zdHIgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgcmVzdWx0LnN0ZGVyci5zdHJpcCgpDQogICAgICAgICAgICAgICAgIyBQYXJzZSB2ZXJzaW9uIChlLmcuLCAiUHl0aG9uIDMuMTIuMCIgLT4gKDMsIDEyKSkNCiAgICAgICAgICAgICAgICBpbXBvcnQgcmUNCiAgICAgICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChyJyhcZCspXC4oXGQrKScsIHZlcnNpb25fc3RyKQ0KICAgICAgICAgICAgICAgIGlmIG1hdGNoOg0KICAgICAgICAgICAgICAgICAgICBtYWpvciA9IGludChtYXRjaC5ncm91cCgxKSkNCiAgICAgICAgICAgICAgICAgICAgbWlub3IgPSBpbnQobWF0Y2guZ3JvdXAoMikpDQogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdmVyc2lvbiBpcyAzLjgtMy4xMw0KICAgICAgICAgICAgICAgICAgICBpZiBtYWpvciA9PSAzIGFuZCA4IDw9IG1pbm9yIDw9IDEzOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICBkZWYgZmluZF9weXRob25fZXhlY3V0YWJsZV9kYWVtb24oc2VsZik6DQogICAgICAgICIiIkZpbmQgcHl0aG9uLmV4ZSBzcGVjaWZpY2FsbHkgKG5vdCBweXRob253LmV4ZSkgZm9yIGRhZW1vbi4NCiAgICAgICAgT25seSByZXR1cm5zIFB5dGhvbiB2ZXJzaW9ucyAzLjgtMy4xMyAoY29tcGF0aWJsZSB3aXRoIGRlcGVuZGVuY2llcykuIiIiDQogICAgICAgICMgVHJ5ICdweXRob24nIGNvbW1hbmQgZmlyc3QgKHNob3VsZCBiZSBweXRob24uZXhlKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3B5dGhvbicsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTEpDQogICAgICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSA9PSAwOg0KICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfcHl0aG9uX3ZlcnNpb25fY29tcGF0aWJsZSgncHl0aG9uJyk6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAncHl0aG9uJw0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIFNlYXJjaCBmb3IgcHl0aG9uLmV4ZSBpbiBjb21tb24gbG9jYXRpb25zDQogICAgICAgIHVzZXJwcm9maWxlID0gb3MuZ2V0ZW52KCdVU0VSUFJPRklMRScsICcnKQ0KICAgICAgICBwcm9ncmFtZmlsZXMgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcycsIHInQzpcUHJvZ3JhbSBGaWxlcycpDQogICAgICAgIHByb2dyYW1maWxlc194ODYgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcyh4ODYpJywgcidDOlxQcm9ncmFtIEZpbGVzICh4ODYpJykNCiAgICAgICAgDQogICAgICAgIHB5dGhvbl92ZXJzaW9ucyA9IFtdICAjIExpc3Qgb2YgKHZlcnNpb25fdHVwbGUsIHBhdGgpIGZvciBzb3J0aW5nDQogICAgICAgIA0KICAgICAgICAjIFVzZXIgQXBwRGF0YSBsb2NhdGlvbnMgLSBjb2xsZWN0IGFsbCB2ZXJzaW9ucyBhbmQgY2hlY2sgY29tcGF0aWJpbGl0eQ0KICAgICAgICBpZiB1c2VycHJvZmlsZToNCiAgICAgICAgICAgIGFwcGRhdGFfbG9jYWwgPSBvcy5wYXRoLmpvaW4odXNlcnByb2ZpbGUsIHIiQXBwRGF0YVxMb2NhbFxQcm9ncmFtc1xQeXRob24iKQ0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoYXBwZGF0YV9sb2NhbCk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiBvcy5saXN0ZGlyKGFwcGRhdGFfbG9jYWwpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2RpciA9IG9zLnBhdGguam9pbihhcHBkYXRhX2xvY2FsLCBpdGVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2RpcihweXRob25fZGlyKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fZXhlID0gb3MucGF0aC5qb2luKHB5dGhvbl9kaXIsICJweXRob24uZXhlIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiB2ZXJzaW9uIGlzIGNvbXBhdGlibGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19weXRob25fdmVyc2lvbl9jb21wYXRpYmxlKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBFeHRyYWN0IHZlcnNpb24gbnVtYmVyIGZyb20gZGlyZWN0b3J5IG5hbWUgKGUuZy4sICJQeXRob24zMTIiIC0+ICgzLCAxMikpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbl9zdHIgPSBpdGVtLnJlcGxhY2UoIlB5dGhvbiIsICIiKS5yZXBsYWNlKCJweXRob24iLCAiIikucmVwbGFjZSgiLiIsICIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZlcnNpb25fc3RyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEhhbmRsZSBmb3JtYXRzIGxpa2UgIjMxMiIsICIzOSIsICIzMTAiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbih2ZXJzaW9uX3N0cikgPj0gMjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ham9yID0gMw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHZlcnNpb25fc3RyKSA9PSAyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbm9yID0gaW50KHZlcnNpb25fc3RyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5vciA9IGludCh2ZXJzaW9uX3N0cls6Ml0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fdmVyc2lvbnMuYXBwZW5kKCgobWFqb3IsIG1pbm9yKSwgcHl0aG9uX2V4ZSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiB3ZSBjYW4ndCBwYXJzZSwgY2hlY2sgYnkgcnVubmluZyBQeXRob24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fdmVyc2lvbnMuYXBwZW5kKCgoMCwgMCksIHB5dGhvbl9leGUpKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBDb21tb24gcm9vdC1sZXZlbCBQeXRob24gaW5zdGFsbGF0aW9ucyAoMy44LTMuMTMpDQogICAgICAgIGZvciBtYWpvcl9taW5vciBpbiBbKDMsIDEzKSwgKDMsIDEyKSwgKDMsIDExKSwgKDMsIDEwKSwgKDMsIDkpLCAoMywgOCldOg0KICAgICAgICAgICAgdmVyc2lvbl9zdHIgPSBmInttYWpvcl9taW5vclswXX17bWFqb3JfbWlub3JbMV06MDJkfSIgICMgZS5nLiwgIjMxMiIsICIzOSINCiAgICAgICAgICAgIGZvciBiYXNlX3BhdGggaW4gWw0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihyZiJDOlxQeXRob257dmVyc2lvbl9zdHJ9IiwgInB5dGhvbi5leGUiKSwNCiAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4ocHJvZ3JhbWZpbGVzLCBmIlB5dGhvbnt2ZXJzaW9uX3N0cn0iLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihwcm9ncmFtZmlsZXNfeDg2LCBmIlB5dGhvbnt2ZXJzaW9uX3N0cn0iLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgXToNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhiYXNlX3BhdGgpOg0KICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX3B5dGhvbl92ZXJzaW9uX2NvbXBhdGlibGUoYmFzZV9wYXRoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl92ZXJzaW9ucy5hcHBlbmQoKG1ham9yX21pbm9yLCBiYXNlX3BhdGgpKQ0KICAgICAgICANCiAgICAgICAgIyBTb3J0IGJ5IHZlcnNpb24gKG5ld2VzdCBmaXJzdCkgLSAoMywgMTMpID4gKDMsIDEyKSA+IC4uLiA+ICgzLCA4KQ0KICAgICAgICBweXRob25fdmVyc2lvbnMuc29ydChyZXZlcnNlPVRydWUsIGtleT1sYW1iZGEgeDogeFswXSkNCiAgICAgICAgDQogICAgICAgICMgUmV0dXJuIHRoZSBuZXdlc3QgY29tcGF0aWJsZSB2ZXJzaW9uDQogICAgICAgIGZvciAobWFqb3IsIG1pbm9yKSwgcGF0aCBpbiBweXRob25fdmVyc2lvbnM6DQogICAgICAgICAgICByZXR1cm4gcGF0aA0KICAgICAgICANCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICANCiAgICBkZWYgc3RhcnRfZGFlbW9uKHNlbGYpOg0KICAgICAgICAiIiJTdGFydCB0aGUgZGVhdGggY291bnRlciBkYWVtb24uIiIiDQogICAgICAgICMgSW5pdGlhbGl6ZSBkZWJ1ZyBsb2cgYXQgdGhlIHZlcnkgc3RhcnQgLSBNVVNUIGJlIGZpcnN0IHRoaW5nDQogICAgICAgIGRlYnVnX2xvZ19jcmVhdGVkID0gRmFsc2UNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgb3MubWFrZWRpcnMoQkFTRV9ESVIsIGV4aXN0X29rPVRydWUpICAjIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzDQogICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7Jz0nKjcwfVxuIikNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBzdGFydF9kYWVtb24oKSBjYWxsZWQgYXQge3RpbWUuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyl9XG4iKQ0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEJBU0VfRElSID0ge0JBU0VfRElSfVxuIikNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMT0NLX0ZJTEUgPSB7TE9DS19GSUxFfVxuIikNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBSRUFEWV9GSUxFID0ge1JFQURZX0ZJTEV9XG4iKQ0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEJBU0VfRElSIGV4aXN0czoge29zLnBhdGguZXhpc3RzKEJBU0VfRElSKX1cbiIpDQogICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogQkFTRV9ESVIgd3JpdGFibGU6IHtvcy5hY2Nlc3MoQkFTRV9ESVIsIG9zLldfT0spfVxuIikNCiAgICAgICAgICAgICAgICBmLmZsdXNoKCkgICMgRm9yY2Ugd3JpdGUNCiAgICAgICAgICAgIGRlYnVnX2xvZ19jcmVhdGVkID0gVHJ1ZQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAjIElmIHdlIGNhbid0IHdyaXRlIGRlYnVnIGxvZywgdHJ5IHRvIHNob3cgZXJyb3IgaW4gbWVzc2FnZWJveA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJEZWJ1ZyBMb2cgRXJyb3IiLCBmIkNvdWxkIG5vdCBjcmVhdGUgZGVidWcgbG9nOiB7ZX1cblxuQkFTRV9ESVI6IHtCQVNFX0RJUn0iKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgaWYgZGFlbW9uIGlzIHJ1bm5pbmcNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiR1VJOiBDYWxsaW5nIGlzX2RhZW1vbl9ydW5uaW5nKCkuLi5cbiIpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgDQogICAgICAgIGRhZW1vbl9ydW5uaW5nX2NoZWNrID0gc2VsZi5pc19kYWVtb25fcnVubmluZygpDQogICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBpc19kYWVtb25fcnVubmluZygpIHJldHVybmVkOiB7ZGFlbW9uX3J1bm5pbmdfY2hlY2t9XG4iKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICBpZiBkYWVtb25fcnVubmluZ19jaGVjazoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIkdVSTogRGFlbW9uIGFwcGVhcnMgdG8gYmUgcnVubmluZyAtIGNoZWNraW5nIHByb2Nlc3MuLi5cbiIpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgcHJvY2VzcyBpcyBhY3R1YWxseSBydW5uaW5nDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKExPQ0tfRklMRSwgInIiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBwaWRfc3RyID0gZi5yZWFkKCkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgIGlmIHBpZF9zdHI6DQogICAgICAgICAgICAgICAgICAgIHBpZCA9IGludChwaWRfc3RyKQ0KICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgZXhpc3RzDQogICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBwc3V0aWwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBzdXRpbC5waWRfZXhpc3RzKHBpZCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiSW5mbyIsIGYiRGFlbW9uIGlzIGFscmVhZHkgcnVubmluZyAoUElEOiB7cGlkfSkuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTdGFsZSBsb2NrIGZpbGUgLSBwcm9jZXNzIGRvZXNuJ3QgZXhpc3QNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoTE9DS19GSUxFKQ0KICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAjIHBzdXRpbCBub3QgYXZhaWxhYmxlIG9yIG90aGVyIGVycm9yIC0gdHJ5IHRhc2tsaXN0DQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsidGFza2xpc3QiLCAiL0ZJIiwgZiJQSUQgZXEge3BpZH0iXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZiJ7cGlkfSIgaW4gcmVzdWx0LnN0ZG91dDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiSW5mbyIsIGYiRGFlbW9uIGlzIGFscmVhZHkgcnVubmluZyAoUElEOiB7cGlkfSkuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTdGFsZSBsb2NrIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKExPQ0tfRklMRSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENhbid0IGNoZWNrIC0gcmVtb3ZlIGxvY2sgZmlsZSB0byBiZSBzYWZlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoTE9DS19GSUxFKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICMgQ2FuJ3QgcmVhZCBsb2NrIGZpbGUgLSByZW1vdmUgaXQNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShMT0NLX0ZJTEUpDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIENoZWNrIGlmIHNjcmlwdCBleGlzdHMgKHRyeSBib3RoIHBvc3NpYmxlIG5hbWVzKQ0KICAgICAgICBzY3JpcHRfcGF0aCA9IFNDUklQVF9QQVRIDQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhzY3JpcHRfcGF0aCk6DQogICAgICAgICAgICBhbHRfcGF0aCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgIm11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weSIpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhhbHRfcGF0aCk6DQogICAgICAgICAgICAgICAgc2NyaXB0X3BhdGggPSBhbHRfcGF0aA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBtZXNzYWdlYm94LnNob3dlcnJvcigiRXJyb3IiLCBmIkRlYXRoIGNvdW50ZXIgc2NyaXB0IG5vdCBmb3VuZC5cblxuTG9va2luZyBmb3I6XG57U0NSSVBUX1BBVEh9XG5vclxue2FsdF9wYXRofSIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJHVUk6IEZpbmRpbmcgUHl0aG9uIGV4ZWN1dGFibGUuLi5cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IHN5cy5mcm96ZW4gPSB7Z2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSl9XG4iKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIEZpbmQgUHl0aG9uIGV4ZWN1dGFibGUgKHVzZSBweXRob24uZXhlLCBub3QgcHl0aG9udy5leGUgZm9yIGRhZW1vbikNCiAgICAgICAgcHl0aG9uX2NtZCA9IE5vbmUNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiR1VJOiBBYm91dCB0byBjaGVjayBzeXMuZnJvemVuLi4uXG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgICAgICAgICAgIyBSdW5uaW5nIGFzIGNvbXBpbGVkIGV4ZSAtIG5lZWQgdG8gZmluZCBQeXRob24NCiAgICAgICAgICAgICAgICAjIEZpcnN0IHRyeSB0byBmaW5kIHB5dGhvbi5leGUgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICBweXRob25fY21kID0gc2VsZi5maW5kX3B5dGhvbl9leGVjdXRhYmxlX2RhZW1vbigpDQogICAgICAgICAgICAgICAgaWYgbm90IHB5dGhvbl9jbWQ6DQogICAgICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gcmVndWxhciBmaW5kZXINCiAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2NtZCA9IHNlbGYuZmluZF9weXRob25fZXhlY3V0YWJsZSgpDQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBweXRob25fY21kOg0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgIlB5dGhvbiBub3QgZm91bmQuIFBsZWFzZSBpbnN0YWxsIFB5dGhvbiBhbmQgYWRkIGl0IHRvIFBBVEgsIG9yIHJlc3RhcnQgdGhlIGluc3RhbGxlciBhZnRlciBpbnN0YWxsaW5nIFB5dGhvbi4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBFbnN1cmUgd2UncmUgdXNpbmcgcHl0aG9uLmV4ZSwgbm90IHB5dGhvbncuZXhlDQogICAgICAgICAgICAgICAgaWYgcHl0aG9uX2NtZC5lbmRzd2l0aCgncHl0aG9udy5leGUnKSBvciAncHl0aG9udycgaW4gcHl0aG9uX2NtZC5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byBmaW5kIHB5dGhvbi5leGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5DQogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9jbWQpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2RpciA9IG9zLnBhdGguZGlybmFtZShweXRob25fY21kKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2V4ZSA9IG9zLnBhdGguam9pbihweXRob25fZGlyLCAicHl0aG9uLmV4ZSIpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fY21kID0gcHl0aG9uX2V4ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRyeSByZXBsYWNpbmcgcHl0aG9udyB3aXRoIHB5dGhvbiBpbiB0aGUgcGF0aA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl9jbWQgPSBweXRob25fY21kLnJlcGxhY2UoJ3B5dGhvbncuZXhlJywgJ3B5dGhvbi5leGUnKS5yZXBsYWNlKCdweXRob253JywgJ3B5dGhvbicpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICMgUnVubmluZyBhcyBzY3JpcHQgLSB1c2Ugc3lzLmV4ZWN1dGFibGUNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBSdW5uaW5nIGFzIHNjcmlwdCwgdXNpbmcgc3lzLmV4ZWN1dGFibGVcbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogc3lzLmV4ZWN1dGFibGUgPSB7c3lzLmV4ZWN1dGFibGV9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgIHB5dGhvbl9jbWQgPSBzeXMuZXhlY3V0YWJsZQ0KICAgICAgICAgICAgICAgICMgSWYgaXQncyBweXRob253LCB0cnkgdG8gZmluZCBweXRob24uZXhlDQogICAgICAgICAgICAgICAgaWYgcHl0aG9uX2NtZC5lbmRzd2l0aCgncHl0aG9udy5leGUnKToNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogc3lzLmV4ZWN1dGFibGUgaXMgcHl0aG9udy5leGUsIGxvb2tpbmcgZm9yIHB5dGhvbi5leGVcbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgIHB5dGhvbl9kaXIgPSBvcy5wYXRoLmRpcm5hbWUocHl0aG9uX2NtZCkNCiAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2V4ZSA9IG9zLnBhdGguam9pbihweXRob25fZGlyLCAicHl0aG9uLmV4ZSIpDQogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2NtZCA9IHB5dGhvbl9leGUNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEZvdW5kIHB5dGhvbi5leGU6IHtweXRob25fZXhlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IHB5dGhvbi5leGUgbm90IGZvdW5kIGluIHtweXRob25fZGlyfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBVc2luZyBzeXMuZXhlY3V0YWJsZSBhcy1pczoge3B5dGhvbl9jbWR9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAjIElmIHRoZXJlJ3MgYW4gZXJyb3IgZmluZGluZyBQeXRob24sIGxvZyBpdA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogRVJST1IgaW4gUHl0aG9uIGZpbmRpbmcgbG9naWM6IHtlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCB0cmFjZWJhY2sNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUodHJhY2ViYWNrLmZvcm1hdF9leGMoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRXJyb3IgZmluZGluZyBQeXRob24gZXhlY3V0YWJsZToge2V9IikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogRmluYWwgUHl0aG9uIGNvbW1hbmQ6IHtweXRob25fY21kfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUHl0aG9uIGV4aXN0czoge29zLnBhdGguZXhpc3RzKHB5dGhvbl9jbWQpIGlmIHB5dGhvbl9jbWQgZWxzZSBGYWxzZX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICBpZiBub3QgcHl0aG9uX2NtZDoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIkdVSTogRVJST1IgLSBweXRob25fY21kIGlzIE5vbmUhXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZi5mbHVzaCgpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgIkNvdWxkIG5vdCBkZXRlcm1pbmUgUHl0aG9uIGV4ZWN1dGFibGUuIikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgIyBTa2lwIFB5dGhvbiB0ZXN0IC0gd2UgYWxyZWFkeSB2ZXJpZmllZCB0aGUgZXhlY3V0YWJsZSBleGlzdHMNCiAgICAgICAgIyBUaGUgdGVzdCB3YXMgdGltaW5nIG91dCBvbiBzb21lIHN5c3RlbXMgKGVzcGVjaWFsbHkgd2l0aCBtdWx0aXBsZSBQeXRob24gdmVyc2lvbnMpLA0KICAgICAgICAjIGFuZCB3ZSdsbCBnZXQgYmV0dGVyIGVycm9yIG1lc3NhZ2VzIGZyb20gdGhlIGRhZW1vbiBpdHNlbGYgaWYgUHl0aG9uIGRvZXNuJ3Qgd29yaw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJHVUk6IFNraXBwaW5nIFB5dGhvbiB0ZXN0IChhbHJlYWR5IHZlcmlmaWVkIGV4ZWN1dGFibGUgZXhpc3RzKVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogVXNpbmcgUHl0aG9uOiB7cHl0aG9uX2NtZH1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIkdVSTogUHJvY2VlZGluZyBkaXJlY3RseSB0byBzdGFydCBkYWVtb25cbiIpDQogICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIFN0YXJ0IGRhZW1vbiBpbiBiYWNrZ3JvdW5kDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEFib3V0IHRvIHN0YXJ0IGRhZW1vbiBwcm9jZXNzIHdpdGggc3VicHJvY2Vzcy5Qb3BlblxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUHl0aG9uOiB7cHl0aG9uX2NtZH1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFNjcmlwdDoge3NjcmlwdF9wYXRofVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogV29ya2luZyBkaXI6IHtCQVNFX0RJUn1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFNjcmlwdCBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhzY3JpcHRfcGF0aCl9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgIyBVc2Ugc3VicHJvY2Vzcy5QSVBFIGJ1dCBhbHNvIGFsbG93IHNlZWluZyBvdXRwdXQgZm9yIGRlYnVnZ2luZw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiR1VJOiBDYWxsaW5nIHN1YnByb2Nlc3MuUG9wZW4oKSBub3cuLi5cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICANCiAgICAgICAgICAgIENSRUFURV9OT19XSU5ET1cgPSAweDA4MDAwMDAwIGlmIGhhc2F0dHIoc3VicHJvY2VzcywgJ0NSRUFURV9OT19XSU5ET1cnKSBlbHNlIDANCiAgICAgICAgICAgIGlmIHN5cy5wbGF0Zm9ybSA9PSAid2luMzIiOg0KICAgICAgICAgICAgICAgIHNlbGYuZGFlbW9uX3Byb2Nlc3MgPSBzdWJwcm9jZXNzLlBvcGVuKA0KICAgICAgICAgICAgICAgICAgICBbcHl0aG9uX2NtZCwgc2NyaXB0X3BhdGhdLA0KICAgICAgICAgICAgICAgICAgICBjd2Q9QkFTRV9ESVIsDQogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsDQogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlNURE9VVCwgICMgTWVyZ2Ugc3RkZXJyIGludG8gc3Rkb3V0DQogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgYnVmc2l6ZT0xLCAgIyBMaW5lIGJ1ZmZlcmVkDQogICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uZmxhZ3M9Q1JFQVRFX05PX1dJTkRPVw0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5kYWVtb25fcHJvY2VzcyA9IHN1YnByb2Nlc3MuUG9wZW4oDQogICAgICAgICAgICAgICAgICAgIFtweXRob25fY21kLCBzY3JpcHRfcGF0aF0sDQogICAgICAgICAgICAgICAgICAgIGN3ZD1CQVNFX0RJUiwNCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwNCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuU1RET1VULA0KICAgICAgICAgICAgICAgICAgICB0ZXh0PVRydWUsDQogICAgICAgICAgICAgICAgICAgIGJ1ZnNpemU9MQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogc3VicHJvY2Vzcy5Qb3BlbigpIGNvbXBsZXRlZFxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IERhZW1vbiBwcm9jZXNzIFBJRDoge3NlbGYuZGFlbW9uX3Byb2Nlc3MucGlkfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFByb2Nlc3MgcG9sbCByZXN1bHQ6IHtzZWxmLmRhZW1vbl9wcm9jZXNzLnBvbGwoKX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBFUlJPUiBsb2dnaW5nIHByb2Nlc3MgaW5mbzoge2V9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBFUlJPUiAtIEV4Y2VwdGlvbiBkdXJpbmcgc3VicHJvY2Vzcy5Qb3BlbigpOiB7ZX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgdHJhY2ViYWNrDQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKHRyYWNlYmFjay5mb3JtYXRfZXhjKCkpDQogICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICBtZXNzYWdlYm94LnNob3dlcnJvcigiRXJyb3IiLCBmIkVycm9yIHN0YXJ0aW5nIGRhZW1vbjoge2V9XG5cblB5dGhvbjoge3B5dGhvbl9jbWR9XG5TY3JpcHQ6IHtzY3JpcHRfcGF0aH0iKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICAjIFdhaXQgZm9yIGRhZW1vbiB0byBzdGFydCAtIHBvbGwgYm90aCBwcm9jZXNzIGFuZCBsb2NrIGZpbGUNCiAgICAgICAgbWF4X3dhaXRfdGltZSA9IDE1ICAjIFdhaXQgdXAgdG8gMTUgc2Vjb25kcyAoaW5jcmVhc2VkIGZvciBzYWZldHkpDQogICAgICAgIGNoZWNrX2ludGVydmFsID0gMC4yICAjIENoZWNrIGV2ZXJ5IDAuMiBzZWNvbmRzIChtb3JlIGZyZXF1ZW50KQ0KICAgICAgICB3YWl0ZWQgPSAwDQogICAgICAgIHByb2Nlc3NfZXhpdGVkID0gRmFsc2UNCiAgICAgICAgbG9ja19maWxlX2NyZWF0ZWQgPSBGYWxzZQ0KICAgICAgICANCiAgICAgICAgIyBEZWJ1ZzogTG9nIHBhdGhzIGJlaW5nIGNoZWNrZWQgdG8gZmlsZQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiXG57Jz0nKjcwfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogU3RhcnRpbmcgZGFlbW9uIGF0IHt0aW1lLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogQ2hlY2tpbmcgZm9yIExPQ0tfRklMRSBhdDoge0xPQ0tfRklMRX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IENoZWNraW5nIGZvciBSRUFEWV9GSUxFIGF0OiB7UkVBRFlfRklMRX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEJBU0VfRElSIGlzOiB7QkFTRV9ESVJ9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBTY3JpcHQgcGF0aDoge3NjcmlwdF9wYXRofVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUHl0aG9uIGNtZDoge3B5dGhvbl9jbWR9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMT0NLX0ZJTEUgZXhpc3RzOiB7b3MucGF0aC5leGlzdHMoTE9DS19GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFJFQURZX0ZJTEUgZXhpc3RzOiB7b3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSl9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgd2hpbGUgd2FpdGVkIDwgbWF4X3dhaXRfdGltZToNCiAgICAgICAgICAgICMgTG9nIGV2ZXJ5IDIgc2Vjb25kcyB3aGF0IHdlJ3JlIGNoZWNraW5nDQogICAgICAgICAgICBpZiB3YWl0ZWQgPiAwIGFuZCBpbnQod2FpdGVkICogMTApICUgMTAgPT0gMDogICMgRXZlcnkgMSBzZWNvbmQNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogV2FpdCBsb29wIC0gd2FpdGVkIHt3YWl0ZWQ6LjFmfXMsIGNoZWNraW5nIGZpbGVzLi4uXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiAgIExPQ0tfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogICBSRUFEWV9GSUxFIGV4aXN0czoge29zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogICBQcm9jZXNzIHJ1bm5pbmc6IHtzZWxmLmRhZW1vbl9wcm9jZXNzLnBvbGwoKSBpcyBOb25lfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgZXhpdGVkIChlcnJvcikNCiAgICAgICAgICAgIGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgICAgICAgICBwcm9jZXNzX2V4aXRlZCA9IFRydWUNCiAgICAgICAgICAgICAgICAgICAgIyBQcm9jZXNzIGV4aXRlZCAtIHRoZXJlIHdhcyBhbiBlcnJvcg0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQsIF8gPSBzZWxmLmRhZW1vbl9wcm9jZXNzLmNvbW11bmljYXRlKHRpbWVvdXQ9MSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICIiDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdGRvdXQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gc3Rkb3V0LnN0cmlwKCkgaWYgaXNpbnN0YW5jZShzdGRvdXQsIHN0cikgZWxzZSBzdGRvdXQuZGVjb2RlKCd1dGYtOCcsIGVycm9ycz0naWdub3JlJykuc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGVycm9yX21zZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIlByb2Nlc3MgZXhpdGVkIHdpdGggY29kZSB7c2VsZi5kYWVtb25fcHJvY2Vzcy5yZXR1cm5jb2RlfSINCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBkZWJ1Zy5sb2cgZm9yIG1vcmUgZGV0YWlscw0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMobG9nX2ZpbGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGluZXM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9saW5lcyA9ICcnLmpvaW4obGluZXNbLTU6XSkgICMgTGFzdCA1IGxpbmVzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGFzdF9saW5lcy5zdHJpcCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gZiJcblxuTGFzdCBsb2cgZW50cmllczpcbntsYXN0X2xpbmVzWzo0MDBdfSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gZ2V0IG1vcmUgaW5mbyBieSBydW5uaW5nIHRoZSBzY3JpcHQgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdF90ZXN0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3B5dGhvbl9jbWQsIHNjcmlwdF9wYXRoXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3dkPUJBU0VfRElSDQogICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXJlY3RfdGVzdC5zdGRlcnI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZGlyZWN0X3Rlc3Quc3RkZXJyWzo1MDBdDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGRpcmVjdF90ZXN0LnN0ZG91dDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBkaXJlY3RfdGVzdC5zdGRvdXRbOjUwMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJGYWlsZWQgdG8gc3RhcnQgZGFlbW9uLlxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cbkVycm9yOiB7ZXJyb3JfbXNnWzo1MDBdfSIpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRmFpbGVkIHRvIHN0YXJ0IGRhZW1vbi5cblxuUHl0aG9uOiB7cHl0aG9uX2NtZH1cblNjcmlwdDoge3NjcmlwdF9wYXRofVxuXG5Qcm9jZXNzIGV4aXRlZCBpbW1lZGlhdGVseS4gQ2hlY2sgaWYgYWxsIGRlcGVuZGVuY2llcyBhcmUgaW5zdGFsbGVkLlxuXG5FeGNlcHRpb246IHtlfSIpDQogICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENoZWNrIGlmIGxvY2sgZmlsZSBleGlzdHMgKGV2ZW4gaWYgcHJvY2VzcyBjaGVjayBmYWlscykNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6DQogICAgICAgICAgICAgICAgICAgIGxvY2tfZmlsZV9jcmVhdGVkID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBpZiB3YWl0ZWQgPCAwLjU6ICAjIE9ubHkgbG9nIG9uY2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMb2NrIGZpbGUgZm91bmQgYXQ6IHtMT0NLX0ZJTEV9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgZm9yIHJlYWR5IGZpbGUgKGRhZW1vbiBmdWxseSBpbml0aWFsaXplZCkNCiAgICAgICAgICAgICAgICAgICAgIyBBbHNvIHZlcmlmeSB0aGUgZmlsZSBhY3R1YWxseSBoYXMgY29udGVudCAobm90IGp1c3QgY3JlYXRlZCkNCiAgICAgICAgICAgICAgICAgICAgIyBUcnkgbXVsdGlwbGUgdGltZXMgd2l0aCBzbWFsbCBkZWxheSB0byBoYW5kbGUgZmlsZXN5c3RlbSBkZWxheXMNCiAgICAgICAgICAgICAgICAgICAgcmVhZHlfZmlsZV9mb3VuZCA9IEZhbHNlDQogICAgICAgICAgICAgICAgICAgIGZvciBjaGVja19hdHRlbXB0IGluIHJhbmdlKDUpOiAgIyBJbmNyZWFzZWQgcmV0cmllcw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFZlcmlmeSBmaWxlIGhhcyBjb250ZW50IGFuZCBpcyByZWNlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdCA9IG9zLnN0YXQoUkVBRFlfRklMRSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RhdC5zdF9zaXplID4gMDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRG91YmxlLWNoZWNrIHRoZSBwcm9jZXNzIGlzIHN0aWxsIHJ1bm5pbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBEYWVtb24gaXMgZnVsbHkgcmVhZHkhDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUmVhZHkgZmlsZSBmb3VuZCBhbmQgdmVyaWZpZWQhIFNpemU6IHtzdGF0LnN0X3NpemV9IGJ5dGVzXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogRGFlbW9uIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5IVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZV9zdGF0dXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2luZm8oIlN1Y2Nlc3MiLCAiRGVhdGggY291bnRlciBkYWVtb24gc3RhcnRlZCBzdWNjZXNzZnVsbHkhIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBQcm9jZXNzIGRpZWQgLSBicmVhayBvdXQgYW5kIHNob3cgZXJyb3INCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBSZWFkeSBmaWxlIGV4aXN0cyBidXQgcHJvY2VzcyBleGl0ZWQgKGNvZGU6IHtzZWxmLmRhZW1vbl9wcm9jZXNzLnJldHVybmNvZGV9KVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFJlYWR5IGZpbGUgZXhpc3RzIGJ1dCBpcyBlbXB0eSAoYXR0ZW1wdCB7Y2hlY2tfYXR0ZW1wdCArIDF9KVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEVycm9yIGNoZWNraW5nIHJlYWR5IGZpbGU6IHtlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGVja19hdHRlbXB0ID09IDAgYW5kIHdhaXRlZCA+IDE6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUmVhZHkgZmlsZSBub3QgZm91bmQgeWV0IChhdHRlbXB0IHtjaGVja19hdHRlbXB0ICsgMX0pLCB3YWl0ZWQge3dhaXRlZDouMWZ9c1xuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMT0NLX0ZJTEUgZXhpc3RzOiB7b3MucGF0aC5leGlzdHMoTE9DS19GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUkVBRFlfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhSRUFEWV9GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICMgU21hbGwgZGVsYXkgYmVmb3JlIHJldHJ5IChmaWxlc3lzdGVtIG1pZ2h0IG5lZWQgdGltZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrX2F0dGVtcHQgPCA0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4yKQ0KICAgICAgICAgICAgICAgICAgICAjIExvY2sgZmlsZSBleGlzdHMgYnV0IG5vdCByZWFkeSB5ZXQgLSBjaGVjayBkZWJ1Zy5sb2cgdG8gc2VlIHdoYXQncyBoYXBwZW5pbmcNCiAgICAgICAgICAgICAgICAgICAgbG9nX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSkgYW5kIHdhaXRlZCA+IDI6ICAjIE9ubHkgY2hlY2sgbG9nIGFmdGVyIDIgc2Vjb25kcw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsaW5lczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbGluZSA9IGxpbmVzWy0xXS5zdHJpcCgpIGlmIGxpbmVzIGVsc2UgIiINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgd2Ugc2VlICJSZWFkeSBmaWxlIGNyZWF0ZWQiIGJ1dCBmaWxlIGRvZXNuJ3QgZXhpc3QsIHRoZXJlJ3MgYSBmaWxlc3lzdGVtIGlzc3VlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiUmVhZHkgZmlsZSBjcmVhdGVkIiBpbiBsYXN0X2xpbmUgb3IgIlJFQURZX0ZJTEUgY3JlYXRlZCIgaW4gbGFzdF9saW5lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRmlsZSBzaG91bGQgZXhpc3QgLSBtYXliZSBmaWxlc3lzdGVtIGRlbGF5LCB3YWl0IGEgYml0IG1vcmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhSRUFEWV9GSUxFKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGVfc3RhdHVzKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiU3VjY2VzcyIsICJEZWF0aCBjb3VudGVyIGRhZW1vbiBzdGFydGVkIHN1Y2Nlc3NmdWxseSEiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICMgTG9jayBmaWxlIGV4aXN0cyBidXQgbm90IHJlYWR5IHlldCAtIGdpdmUgaXQgbW9yZSB0aW1lDQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4yKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgIyBBbHNvIGNoZWNrIGlmIHByb2Nlc3MgaXMgc3RpbGwgcnVubmluZyAoZXZlbiB3aXRob3V0IGxvY2sgZmlsZSB5ZXQpDQogICAgICAgICAgICBlbGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgIyBQcm9jZXNzIGlzIHJ1bm5pbmcsIG1pZ2h0IHN0aWxsIGJlIGluaXRpYWxpemluZw0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgV2FpdCBhIGJpdCBiZWZvcmUgY2hlY2tpbmcgYWdhaW4NCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpDQogICAgICAgICAgICB3YWl0ZWQgKz0gY2hlY2tfaW50ZXJ2YWwNCiAgICAgICAgDQogICAgICAgICMgVGltZW91dCAtIGNoZWNrIHdoYXQgaGFwcGVuZWQNCiAgICAgICAgIyBMb2cgdGltZW91dCB0byBkZWJ1ZyBmaWxlDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFRJTUVPVVQgYWZ0ZXIge3dhaXRlZDouMWZ9IHNlY29uZHNcbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IExPQ0tfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUkVBRFlfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhSRUFEWV9GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFByb2Nlc3MgcnVubmluZzoge3NlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmV9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBGaXJzdCwgY2hlY2sgZm9yIHN0YXJ0dXAgZXJyb3IgZmlsZQ0KICAgICAgICBzdGFydHVwX2Vycm9yX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb25fc3RhcnR1cF9lcnJvci50eHQiKQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzdGFydHVwX2Vycm9yX2ZpbGUpOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihzdGFydHVwX2Vycm9yX2ZpbGUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBlcnJvcl9jb250ZW50ID0gZi5yZWFkKCkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgIGlmIGVycm9yX2NvbnRlbnQ6DQogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJEYWVtb24gU3RhcnR1cCBFcnJvciIsIA0KICAgICAgICAgICAgICAgICAgICAgICAgZiJEYWVtb24gZW5jb3VudGVyZWQgYW4gZXJyb3IgZHVyaW5nIHN0YXJ0dXA6XG5cbntlcnJvcl9jb250ZW50WzoxMDAwXX1cblxuIg0KICAgICAgICAgICAgICAgICAgICAgICAgZiJQeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9IikNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgaWYgcHJvY2Vzc19leGl0ZWQ6DQogICAgICAgICAgICAjIEFscmVhZHkgaGFuZGxlZCBhYm92ZQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGVsaWYgbG9ja19maWxlX2NyZWF0ZWQgYW5kIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOg0KICAgICAgICAgICAgIyBCb3RoIGZpbGVzIGV4aXN0IC0gZGFlbW9uIHNob3VsZCBiZSBydW5uaW5nDQogICAgICAgICAgICBpZiBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCk6DQogICAgICAgICAgICAgICAgc2VsZi51cGRhdGVfc3RhdHVzKCkNCiAgICAgICAgICAgICAgICBtZXNzYWdlYm94LnNob3dpbmZvKCJTdWNjZXNzIiwgIkRlYXRoIGNvdW50ZXIgZGFlbW9uIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5ISIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICJSZWFkeSBmaWxlIGV4aXN0cyBidXQgcHJvY2VzcyBpcyBub3QgcnVubmluZy4iDQogICAgICAgIGVsaWYgbG9ja19maWxlX2NyZWF0ZWQ6DQogICAgICAgICAgICAjIExvY2sgZmlsZSBleGlzdHMgYnV0IHJlYWR5IGZpbGUgZG9lc24ndCAtIGRhZW1vbiBtYXkgYmUgc3R1Y2sgaW5pdGlhbGl6aW5nDQogICAgICAgICAgICBlcnJvcl9tc2cgPSAiTG9jayBmaWxlIGV4aXN0cyBidXQgZGFlbW9uIGRpZCBub3QgZmluaXNoIGluaXRpYWxpemluZyAocmVhZHkgZmlsZSBtaXNzaW5nKS4iDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKExPQ0tfRklMRSwgInIiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBwaWRfc3RyID0gZi5yZWFkKCkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTG9jayBmaWxlIGV4aXN0cyAoUElEOiB7cGlkX3N0cn0pIGJ1dCBkYWVtb24gZGlkIG5vdCBmaW5pc2ggaW5pdGlhbGl6aW5nIChyZWFkeSBmaWxlIG1pc3NpbmcpLiINCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgaXMgc3RpbGwgcnVubmluZw0KICAgICAgICAgICAgICAgIHByb2Nlc3NfcnVubmluZyA9IEZhbHNlDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBpbXBvcnQgcHN1dGlsDQogICAgICAgICAgICAgICAgICAgIGlmIHBpZF9zdHI6DQogICAgICAgICAgICAgICAgICAgICAgICBwaWQgPSBpbnQocGlkX3N0cikNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBzdXRpbC5waWRfZXhpc3RzKHBpZCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc19ydW5uaW5nID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyArPSBmIlxuXG5Qcm9jZXNzIHtwaWR9IGlzIHN0aWxsIHJ1bm5pbmcuIg0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gZiJcblxuUHJvY2VzcyB7cGlkfSBpcyBOT1QgcnVubmluZyAoc3RhbGUgbG9jayBmaWxlKS4iDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiBjaGVjayBpZiBkYWVtb24gcHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzX3J1bm5pbmcgPSBUcnVlDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gIlxuXG5EYWVtb24gcHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nLiINCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIElmIHByb2Nlc3MgaXMgcnVubmluZyBidXQgcmVhZHkgZmlsZSBtaXNzaW5nLCBjaGVjayBpZiBpdCdzIGp1c3Qgc2xvdw0KICAgICAgICAgICAgICAgIGlmIHByb2Nlc3NfcnVubmluZzoNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9ICJcblxuVGhpcyBtaWdodCBiZSBhIGZpbGVzeXN0ZW0gZGVsYXkuIFRoZSBkYWVtb24gbWF5IHN0aWxsIGJlIHN0YXJ0aW5nLiINCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9ICJcbkNoZWNrIGRlYnVnLmxvZyB0byBzZWUgaWYgJ1JlYWR5IGZpbGUgY3JlYXRlZCcgYXBwZWFycy4iDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENoZWNrIGRlYnVnLmxvZw0KICAgICAgICAgICAgbG9nX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMobG9nX2ZpbGUpOg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGluZXM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9saW5lcyA9ICcnLmpvaW4obGluZXNbLTE1Ol0pICAjIExhc3QgMTUgbGluZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gZiJcblxuTGFzdCBsb2cgZW50cmllczpcbntsYXN0X2xpbmVzWzo1MDBdfSINCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJ7ZXJyb3JfbXNnfVxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cblRyeSBzdG9wcGluZyBhbnkgZXhpc3RpbmcgZGFlbW9uIGZpcnN0LCB0aGVuIHN0YXJ0IGFnYWluLiIpDQogICAgICAgIGVsaWYgc2VsZi5kYWVtb25fcHJvY2Vzcy5wb2xsKCkgaXMgTm9uZToNCiAgICAgICAgICAgICMgUHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nIGJ1dCBubyBsb2NrIGZpbGUNCiAgICAgICAgICAgIGVycm9yX21zZyA9ICJEYWVtb24gcHJvY2VzcyBpcyBydW5uaW5nIGJ1dCBmYWlsZWQgdG8gY3JlYXRlIGxvY2sgZmlsZS4iDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgIyBDaGVjayBkZWJ1Zy5sb2cgZm9yIGVycm9ycw0KICAgICAgICAgICAgICAgIGxvZ19maWxlID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVidWcubG9nIikNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSk6DQogICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICBsaW5lcyA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxpbmVzOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbGluZXMgPSAnJy5qb2luKGxpbmVzWy0xNTpdKSAgIyBMYXN0IDE1IGxpbmVzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9IGYiXG5cbkxhc3QgbG9nIGVudHJpZXM6XG57bGFzdF9saW5lc1s6NTAwXX0iDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9ICJcblxuTm8gZGVidWcubG9nIGZvdW5kIC0gZGFlbW9uIG1heSBub3QgaGF2ZSBpbml0aWFsaXplZC4iDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJ7ZXJyb3JfbXNnfVxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cbkNoZWNrIGlmIGFsbCBkZXBlbmRlbmNpZXMgYXJlIGluc3RhbGxlZCBhbmQgVGVzc2VyYWN0IE9DUiBpcyBpbnN0YWxsZWQuIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgICMgUHJvY2VzcyBleGl0ZWQgZHVyaW5nIHdhaXQNCiAgICAgICAgICAgIGVycm9yX21zZyA9ICJQcm9jZXNzIGV4aXRlZCBiZWZvcmUgY3JlYXRpbmcgbG9jayBmaWxlLiINCiAgICAgICAgICAgICMgQ2hlY2sgZGVidWcubG9nDQogICAgICAgICAgICBsb2dfZmlsZSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYnVnLmxvZyIpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4obG9nX2ZpbGUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMgPSBmLnJlYWRsaW5lcygpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsaW5lczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2xpbmVzID0gJycuam9pbihsaW5lc1stMTU6XSkgICMgTGFzdCAxNSBsaW5lcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyArPSBmIlxuXG5MYXN0IGxvZyBlbnRyaWVzOlxue2xhc3RfbGluZXNbOjUwMF19Ig0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJ7ZXJyb3JfbXNnfVxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cbkNoZWNrIGRlYnVnLmxvZyBmb3IgZGV0YWlscy4iKQ0KICAgIA0KICAgIGRlZiBzdG9wX2RhZW1vbihzZWxmKToNCiAgICAgICAgIiIiU3RvcCB0aGUgZGVhdGggY291bnRlciBkYWVtb24uIiIiDQogICAgICAgIGlmIG5vdCBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCk6DQogICAgICAgICAgICAjIFNpbGVudGx5IHJldHVybiAtIG5vIHBvcHVwDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgQ3JlYXRlIFNUT1AgZmlsZQ0KICAgICAgICAgICAgd2l0aCBvcGVuKFNUT1BfRklMRSwgInciKSBhcyBmOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoIiIpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgV2FpdCBmb3IgZGFlbW9uIHRvIHN0b3ANCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEwKToNCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpDQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuaXNfZGFlbW9uX3J1bm5pbmcoKToNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBJZiBzdGlsbCBydW5uaW5nLCB0cnkgdG8ga2lsbCBwcm9jZXNzDQogICAgICAgICAgICBpZiBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oTE9DS19GSUxFLCAiciIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpDQogICAgICAgICAgICAgICAgICAgIGlmIHBpZDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsidGFza2tpbGwiLCAiL0YiLCAiL1BJRCIsIHBpZF0sIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIGNoZWNrPUZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKExPQ0tfRklMRSkNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBDbGVhbiB1cA0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoU1RPUF9GSUxFKToNCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoU1RPUF9GSUxFKQ0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSk6DQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKFJFQURZX0ZJTEUpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYudXBkYXRlX3N0YXR1cygpDQogICAgICAgICAgICAjIFNpbGVudGx5IHN0b3AgLSBubyBwb3B1cA0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAjIFNpbGVudGx5IGZhaWwgLSBubyBwb3B1cA0KICAgICAgICAgICAgcGFzcw0KICAgIA0KICAgIGRlZiB1cGRhdGVfc3RhdHVzKHNlbGYpOg0KICAgICAgICAiIiJVcGRhdGUgdGhlIFVJIHdpdGggY3VycmVudCBzdGF0dXMuIiIiDQogICAgICAgICMgQ2hlY2sgaWYgVUkgZWxlbWVudHMgZXhpc3QgKHRoZXkgbWlnaHQgbm90IGR1cmluZyBpbml0aWFsaXphdGlvbikNCiAgICAgICAgaWYgbm90IGhhc2F0dHIoc2VsZiwgJ3N0YXR1c19sYWJlbCcpOg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICAjIFVwZGF0ZSBkYWVtb24gc3RhdHVzDQogICAgICAgIHJ1bm5pbmcgPSBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCkNCiAgICAgICAgaWYgcnVubmluZzoNCiAgICAgICAgICAgIHNlbGYuc3RhdHVzX2xhYmVsLmNvbmZpZyh0ZXh0PSJTdGF0dXM6IFJ1bm5pbmciLCBmb3JlZ3JvdW5kPSJncmVlbiIpDQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdzdGFydF9idXR0b24nKToNCiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0X2J1dHRvbi5jb25maWcoc3RhdGU9RElTQUJMRUQpDQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdzdG9wX2J1dHRvbicpOg0KICAgICAgICAgICAgICAgIHNlbGYuc3RvcF9idXR0b24uY29uZmlnKHN0YXRlPU5PUk1BTCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNlbGYuc3RhdHVzX2xhYmVsLmNvbmZpZyh0ZXh0PSJTdGF0dXM6IFN0b3BwZWQiLCBmb3JlZ3JvdW5kPSJyZWQiKQ0KICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAnc3RhcnRfYnV0dG9uJyk6DQogICAgICAgICAgICAgICAgc2VsZi5zdGFydF9idXR0b24uY29uZmlnKHN0YXRlPU5PUk1BTCkNCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ3N0b3BfYnV0dG9uJyk6DQogICAgICAgICAgICAgICAgc2VsZi5zdG9wX2J1dHRvbi5jb25maWcoc3RhdGU9RElTQUJMRUQpDQogICAgICAgIA0KICAgICAgICAjIFVwZGF0ZSBnYW1lIGFuZCBkZWF0aCBjb3VudCBvbiB0aGUgYnV0dG9uDQogICAgICAgIGN1cnJlbnRfZ2FtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfZ2FtZSgpDQogICAgICAgIGRlYXRoX2NvdW50ID0gc2VsZi5nZXRfZGVhdGhfY291bnQoY3VycmVudF9nYW1lKQ0KICAgICAgICB0b3RhbF9kZWF0aHMgPSBzZWxmLmdldF90b3RhbF9kZWF0aHMoKQ0KICAgICAgICANCiAgICAgICAgIyBVcGRhdGUgdGhlIGxhYmVscyBzZXBhcmF0ZWx5DQogICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ2RlYXRoX2NvdW50X2xhYmVsJykgYW5kIGhhc2F0dHIoc2VsZiwgJ2dhbWVfbmFtZV9sYWJlbCcpOg0KICAgICAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbC5jb25maWcodGV4dD1zdHIoZGVhdGhfY291bnQpKQ0KICAgICAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwuY29uZmlnKHRleHQ9Y3VycmVudF9nYW1lKQ0KICAgICAgICANCiAgICAgICAgIyBVcGRhdGUgdG90YWwgZGVhdGhzIGRpc3BsYXkNCiAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAndG90YWxfZGVhdGhzX2xhYmVsJyk6DQogICAgICAgICAgICBzZWxmLnRvdGFsX2RlYXRoc19sYWJlbC5jb25maWcodGV4dD1mIlRvdGFsIERlYXRoczoge3RvdGFsX2RlYXRoc30iKQ0KICAgIA0KICAgIGRlZiBzdGFydF9tb25pdG9yaW5nKHNlbGYpOg0KICAgICAgICAiIiJTdGFydCBiYWNrZ3JvdW5kIHRocmVhZCB0byBtb25pdG9yIHN0YXR1cy4iIiINCiAgICAgICAgc2VsZi5tb25pdG9yaW5nID0gVHJ1ZQ0KICAgICAgICANCiAgICAgICAgZGVmIG1vbml0b3IoKToNCiAgICAgICAgICAgIHdoaWxlIHNlbGYubW9uaXRvcmluZzoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHNlbGYucm9vdC5hZnRlcigwLCBzZWxmLnVwZGF0ZV9zdGF0dXMpDQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikgICMgVXBkYXRlIGV2ZXJ5IDIgc2Vjb25kcw0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgDQogICAgICAgIHRocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PW1vbml0b3IsIGRhZW1vbj1UcnVlKQ0KICAgICAgICB0aHJlYWQuc3RhcnQoKQ0KICAgIA0KICAgIGRlZiBvbl9jbG9zaW5nKHNlbGYpOg0KICAgICAgICAiIiJIYW5kbGUgd2luZG93IGNsb3NpbmcuIiIiDQogICAgICAgIHNlbGYubW9uaXRvcmluZyA9IEZhbHNlDQogICAgICAgIHNlbGYucm9vdC5kZXN0cm95KCkNCg0KDQpkZWYgbWFpbigpOg0KICAgICMgUHJldmVudCBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgdGhlIEdVSSB1c2luZyBXaW5kb3dzIG11dGV4DQogICAgIyBDaGVjayBtdXRleCBCRUZPUkUgY3JlYXRpbmcgYW55IEdVSSBlbGVtZW50cw0KICAgIG11dGV4ID0gTm9uZQ0KICAgIGtlcm5lbDMyID0gTm9uZQ0KICAgIHRyeToNCiAgICAgICAgaW1wb3J0IGN0eXBlcw0KICAgICAgICBtdXRleF9uYW1lID0gIkdsb2JhbFxcRGVhdGhDb3VudGVyR1VJTXV0ZXgiDQogICAgICAgIGtlcm5lbDMyID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMg0KICAgICAgICBtdXRleCA9IGtlcm5lbDMyLkNyZWF0ZU11dGV4VyhOb25lLCBGYWxzZSwgbXV0ZXhfbmFtZSkNCiAgICAgICAgbGFzdF9lcnJvciA9IGtlcm5lbDMyLkdldExhc3RFcnJvcigpDQogICAgICAgIA0KICAgICAgICAjIElmIEVSUk9SX0FMUkVBRFlfRVhJU1RTLCBhbm90aGVyIEdVSSBpbnN0YW5jZSBpcyBydW5uaW5nDQogICAgICAgIGlmIGxhc3RfZXJyb3IgPT0gMTgzOiAgIyBFUlJPUl9BTFJFQURZX0VYSVNUUw0KICAgICAgICAgICAgaWYgbXV0ZXg6DQogICAgICAgICAgICAgICAga2VybmVsMzIuQ2xvc2VIYW5kbGUobXV0ZXgpDQogICAgICAgICAgICAjIEV4aXQgaW1tZWRpYXRlbHkgLSBHVUkgYWxyZWFkeSBydW5uaW5nDQogICAgICAgICAgICBzeXMuZXhpdCgwKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICMgSWYgbXV0ZXggZmFpbHMsIGNvbnRpbnVlIGFueXdheQ0KICAgICAgICBwYXNzDQogICAgDQogICAgcm9vdCA9IFRrKCkNCiAgICBhcHAgPSBEZWF0aENvdW50ZXJHVUkocm9vdCkNCiAgICANCiAgICBkZWYgY2xlYW51cCgpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBtdXRleCBhbmQga2VybmVsMzI6DQogICAgICAgICAgICAgICAga2VybmVsMzIuQ2xvc2VIYW5kbGUobXV0ZXgpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgaWYgaGFzYXR0cihhcHAsICdvbl9jbG9zaW5nJyk6DQogICAgICAgICAgICBhcHAub25fY2xvc2luZygpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByb290LmRlc3Ryb3koKQ0KICAgIA0KICAgIHJvb3QucHJvdG9jb2woIldNX0RFTEVURV9XSU5ET1ciLCBjbGVhbnVwKQ0KICAgIA0KICAgIHRyeToNCiAgICAgICAgcm9vdC5tYWlubG9vcCgpDQogICAgZmluYWxseToNCiAgICAgICAgY2xlYW51cCgpDQoNCg0KaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoNCiAgICBtYWluKCkNCg0K",
  "switch_game_manual.py": "IiIiDQpNYW51YWxseSBTd2l0Y2ggR2FtZQ0KU3dpdGNoIHRoZSBkZWF0aCBjb3VudGVyIHRvIGEgc3BlY2lmaWMgZ2FtZSBtYW51YWxseS4NCg0KVXNhZ2U6DQogICAgcHl0aG9uIHN3aXRjaF9nYW1lX21hbnVhbC5weSAiRWxkZW4gUmluZyINCiAgICBweXRob24gc3dpdGNoX2dhbWVfbWFudWFsLnB5ICJEYXJrIFNvdWxzIDMiDQoiIiINCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQganNvbg0KDQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQNCmRlZiBnZXRfYmFzZV9kaXIoKToNCiAgICAiIiJHZXQgdGhlIGJhc2UgZGlyZWN0b3J5IC0gc2FtZSBmb2xkZXIgYXMgdGhpcyBzY3JpcHQuIiIiDQogICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KDQpCQVNFX0RJUiA9IGdldF9iYXNlX2RpcigpDQpDT05GSUdfRklMRSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImdhbWVzX2NvbmZpZy5qc29uIikNClNUQVRFX0pTT04gPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9zdGF0ZS5qc29uIikNCkRFQVRIX1RYVCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYXRoX2NvdW50ZXIudHh0IikNCg0KDQpkZWYgbG9hZF9jb25maWcoKToNCiAgICAiIiJMb2FkIGdhbWUgY29uZmlndXJhdGlvbnMgZnJvbSBKU09OIGZpbGUuIiIiDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToNCiAgICAgICAgcHJpbnQoZiJbRVJST1JdIENvbmZpZyBmaWxlIG5vdCBmb3VuZDoge0NPTkZJR19GSUxFfSIpDQogICAgICAgIHJldHVybiBOb25lDQogICAgDQogICAgdHJ5Og0KICAgICAgICB3aXRoIG9wZW4oQ09ORklHX0ZJTEUsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWQoZikNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiW0VSUk9SXSBGYWlsZWQgdG8gbG9hZCBjb25maWc6IHtlfSIpDQogICAgICAgIHJldHVybiBOb25lDQoNCg0KZGVmIGxvYWRfc3RhdGUoKToNCiAgICAiIiJMb2FkIHN0YXRlIGZyb20gSlNPTiBmaWxlLiIiIg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhTVEFURV9KU09OKToNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICJ0b3RhbF9kZWF0aHMiOiAwLA0KICAgICAgICAgICAgImdhbWVfZGVhdGhzIjoge30sDQogICAgICAgICAgICAidGljayI6IDAsDQogICAgICAgICAgICAic3RyZWFrIjogMCwNCiAgICAgICAgICAgICJsYXN0X2RlYXRoX3RzIjogMC4wLA0KICAgICAgICAgICAgImN1cnJlbnRfZ2FtZSI6IE5vbmUsDQogICAgICAgIH0NCiAgICANCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBzdGF0ZSA9IGpzb24ubG9hZChmKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgc3RhdGUgPSB7fQ0KICAgIA0KICAgIHN0YXRlLnNldGRlZmF1bHQoInRvdGFsX2RlYXRocyIsIDApDQogICAgc3RhdGUuc2V0ZGVmYXVsdCgiZ2FtZV9kZWF0aHMiLCB7fSkNCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJ0aWNrIiwgMCkNCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJzdHJlYWsiLCAwKQ0KICAgIHN0YXRlLnNldGRlZmF1bHQoImxhc3RfZGVhdGhfdHMiLCAwLjApDQogICAgc3RhdGUuc2V0ZGVmYXVsdCgiY3VycmVudF9nYW1lIiwgTm9uZSkNCiAgICByZXR1cm4gc3RhdGUNCg0KDQpkZWYgc2F2ZV9jb25maWcoY29uZmlnKToNCiAgICAiIiJTYXZlIGNvbmZpZ3VyYXRpb24gdG8gSlNPTiBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgcmV0dXJuIFRydWUNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiW0VSUk9SXSBGYWlsZWQgdG8gc2F2ZSBjb25maWc6IHtlfSIpDQogICAgICAgIHJldHVybiBGYWxzZQ0KDQoNCmRlZiBzYXZlX3N0YXRlKHN0YXRlKToNCiAgICAiIiJTYXZlIHN0YXRlIHRvIEpTT04gZmlsZS4iIiINCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBqc29uLmR1bXAoc3RhdGUsIGYsIGluZGVudD0yKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJbRVJST1JdIEZhaWxlZCB0byBzYXZlIHN0YXRlOiB7ZX0iKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KDQpkZWYgd3JpdGVfdGV4dChkZWF0aHMsIGdhbWVfbmFtZSk6DQogICAgIiIiV3JpdGUgZGVhdGggY291bnQgdG8gdGV4dCBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgIyBXcml0ZSBtYWluIGZpbGUNCiAgICAgICAgd2l0aCBvcGVuKERFQVRIX1RYVCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgZi53cml0ZShzdHIoZGVhdGhzKSkNCiAgICAgICAgDQogICAgICAgICMgV3JpdGUgcGVyLWdhbWUgZmlsZQ0KICAgICAgICBpZiBnYW1lX25hbWU6DQogICAgICAgICAgICBnYW1lX3R4dCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgZiJkZWF0aF9jb3VudGVyX3tnYW1lX25hbWUucmVwbGFjZSgnICcsICdfJyl9LnR4dCIpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgc3RhdGUgPSBsb2FkX3N0YXRlKCkNCiAgICAgICAgICAgICAgICBnYW1lX2RlYXRocyA9IHN0YXRlLmdldCgiZ2FtZV9kZWF0aHMiLCB7fSkuZ2V0KGdhbWVfbmFtZSwgMCkNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZ2FtZV90eHQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShzdHIoZ2FtZV9kZWF0aHMpKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIHByaW50KGYiW1dBUk5JTkddIENvdWxkIG5vdCB3cml0ZSBwZXItZ2FtZSBmaWxlOiB7ZX0iKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJbRVJST1JdIEZhaWxlZCB0byB3cml0ZSB0ZXh0IGZpbGU6IHtlfSIpDQogICAgICAgIHJldHVybiBGYWxzZQ0KDQoNCmRlZiBzd2l0Y2hfZ2FtZShnYW1lX25hbWUpOg0KICAgICIiIlN3aXRjaCB0byB0aGUgc3BlY2lmaWVkIGdhbWUuIiIiDQogICAgcHJpbnQoIj0iICogNzApDQogICAgcHJpbnQoIk1BTlVBTCBHQU1FIFNXSVRDSCIpDQogICAgcHJpbnQoIj0iICogNzApDQogICAgDQogICAgIyBMb2FkIGNvbmZpZw0KICAgIGNvbmZpZyA9IGxvYWRfY29uZmlnKCkNCiAgICBpZiBub3QgY29uZmlnOg0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICBnYW1lcyA9IGNvbmZpZy5nZXQoImdhbWVzIiwge30pDQogICAgaWYgbm90IGdhbWVzOg0KICAgICAgICBwcmludCgiW0VSUk9SXSBObyBnYW1lcyBjb25maWd1cmVkIikNCiAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQogICAgIyBDaGVjayBpZiBnYW1lIGV4aXN0cw0KICAgIGlmIGdhbWVfbmFtZSBub3QgaW4gZ2FtZXM6DQogICAgICAgIHByaW50KGYiW0VSUk9SXSBHYW1lICd7Z2FtZV9uYW1lfScgbm90IGZvdW5kIGluIGNvbmZpZ3VyYXRpb24uIikNCiAgICAgICAgcHJpbnQoZiJcbkF2YWlsYWJsZSBnYW1lczoiKQ0KICAgICAgICBmb3IgbmFtZSBpbiBnYW1lcy5rZXlzKCk6DQogICAgICAgICAgICBwcmludChmIiAgLSB7bmFtZX0iKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICAjIExvYWQgc3RhdGUNCiAgICBzdGF0ZSA9IGxvYWRfc3RhdGUoKQ0KICAgIG9sZF9nYW1lID0gc3RhdGUuZ2V0KCJjdXJyZW50X2dhbWUiLCAiVW5rbm93biIpDQogICAgDQogICAgIyBVcGRhdGUgc3RhdGUNCiAgICBzdGF0ZVsiY3VycmVudF9nYW1lIl0gPSBnYW1lX25hbWUNCiAgICANCiAgICAjIFVwZGF0ZSBjb25maWcNCiAgICBjb25maWdbImN1cnJlbnRfZ2FtZSJdID0gZ2FtZV9uYW1lDQogICAgDQogICAgIyBHZXQgdGhlIGdhbWUncyBkZWF0aCBjb3VudA0KICAgIGdhbWVfZGVhdGhzID0gc3RhdGUuZ2V0KCJnYW1lX2RlYXRocyIsIHt9KS5nZXQoZ2FtZV9uYW1lLCAwKQ0KICAgIA0KICAgICMgU2F2ZSBmaWxlcw0KICAgIGlmIG5vdCBzYXZlX3N0YXRlKHN0YXRlKToNCiAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQogICAgaWYgbm90IHNhdmVfY29uZmlnKGNvbmZpZyk6DQogICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA0KICAgICMgVXBkYXRlIHRleHQgZmlsZXMNCiAgICB3cml0ZV90ZXh0KGdhbWVfZGVhdGhzLCBnYW1lX25hbWUpDQogICAgDQogICAgIyBTaG93IGluZm8NCiAgICBnYW1lX2NvbmZpZyA9IGdhbWVzW2dhbWVfbmFtZV0NCiAgICBwcmludChmIlxuW09LXSBTd2l0Y2hlZCBmcm9tICd7b2xkX2dhbWV9JyB0byAne2dhbWVfbmFtZX0nIikNCiAgICBwcmludChmIlxuR2FtZSBJbmZvOiIpDQogICAgcHJpbnQoZiIgIERlYXRoczoge2dhbWVfZGVhdGhzfSIpDQogICAgcHJpbnQoZiIgIE1vbml0b3I6IHtnYW1lX2NvbmZpZy5nZXQoJ21vbml0b3JfaW5kZXgnLCAnZGVmYXVsdCcpfSIpDQogICAgcHJpbnQoZiIgIFJlZ2lvbjoge2dhbWVfY29uZmlnLmdldCgncmVnaW9uJywge30pfSIpDQogICAgcHJpbnQoZiIgIEtleXdvcmRzOiB7Z2FtZV9jb25maWcuZ2V0KCdrZXl3b3JkcycsIFtdKX0iKQ0KICAgIA0KICAgIHByaW50KGYiXG5bT0tdIFRleHQgZmlsZXMgdXBkYXRlZDoiKQ0KICAgIHByaW50KGYiICAtIHtERUFUSF9UWFR9IC0+IHtnYW1lX2RlYXRoc30iKQ0KICAgIHByaW50KGYiICAtIGRlYXRoX2NvdW50ZXJfe2dhbWVfbmFtZS5yZXBsYWNlKCcgJywgJ18nKX0udHh0IC0+IHtnYW1lX2RlYXRoc30iKQ0KICAgIA0KICAgIHByaW50KCJcbiIgKyAiPSIgKiA3MCkNCiAgICBwcmludCgiW05PVEVdIFRoZSBkYWVtb24gd2lsbCBjb250aW51ZSBydW5uaW5nIHdpdGggdGhlIG5ldyBnYW1lLiIpDQogICAgcHJpbnQoIiAgICAgICBBdXRvLWRldGVjdGlvbiB3aWxsIG92ZXJyaWRlIHRoaXMgaWYgaXQgZGV0ZWN0cyBhIGRpZmZlcmVudCBnYW1lLiIpDQogICAgcHJpbnQoIj0iICogNzApDQogICAgDQogICAgcmV0dXJuIFRydWUNCg0KDQpkZWYgbWFpbigpOg0KICAgIGlmIGxlbihzeXMuYXJndikgPCAyOg0KICAgICAgICBwcmludCgiVXNhZ2U6IHB5dGhvbiBzd2l0Y2hfZ2FtZV9tYW51YWwucHkgXCJHYW1lIE5hbWVcIiIpDQogICAgICAgIHByaW50KCJcbkV4YW1wbGVzOiIpDQogICAgICAgIHByaW50KCcgIHB5dGhvbiBzd2l0Y2hfZ2FtZV9tYW51YWwucHkgIkVsZGVuIFJpbmciJykNCiAgICAgICAgcHJpbnQoJyAgcHl0aG9uIHN3aXRjaF9nYW1lX21hbnVhbC5weSAiRGFyayBTb3VscyAzIicpDQogICAgICAgIHByaW50KCcgIHB5dGhvbiBzd2l0Y2hfZ2FtZV9tYW51YWwucHkgIkRhcmsgU291bHMgUmVtYXN0ZXJlZCInKQ0KICAgICAgICBwcmludCgnICBweXRob24gc3dpdGNoX2dhbWVfbWFudWFsLnB5ICJTZWtpcm8iJykNCiAgICAgICAgcmV0dXJuIDENCiAgICANCiAgICBnYW1lX25hbWUgPSBzeXMuYXJndlsxXQ0KICAgIA0KICAgIGlmIHN3aXRjaF9nYW1lKGdhbWVfbmFtZSk6DQogICAgICAgIHJldHVybiAwDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIDENCg0KDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIHN5cy5leGl0KG1haW4oKSkNCg0K",
  "games_config.json": "ew0KICAic2V0dGluZ3MiOiB7DQogICAgInRpY2tfc2Vjb25kcyI6IDAuMywNCiAgICAiZGVidWdfZXZlcnlfdGlja3MiOiAzMCwNCiAgICAiY29uc2VjdXRpdmVfaGl0cyI6IDIsDQogICAgImNvb2xkb3duX3NlY29uZHMiOiA1LjAsDQogICAgIm1vbml0b3JfaW5kZXgiOiAxDQogIH0sDQogICJnYW1lcyI6IHsNCiAgICAiRWxkZW4gUmluZyI6IHsNCiAgICAgICJyZWdpb24iOiB7DQogICAgICAgICJsZWZ0IjogNTIwLA0KICAgICAgICAidG9wIjogNDcwLA0KICAgICAgICAid2lkdGgiOiA4ODAsDQogICAgICAgICJoZWlnaHQiOiAyMDANCiAgICAgIH0sDQogICAgICAia2V5d29yZHMiOiBbDQogICAgICAgICJZT1VESUVEIiwNCiAgICAgICAgIllPVURJRSIsDQogICAgICAgICJZT1VERUQiLA0KICAgICAgICAiRElFRCINCiAgICAgIF0sDQogICAgICAidGVzc2VyYWN0X2NvbmZpZyI6ICItLW9lbSAzIC0tcHNtIDcgLWMgdGVzc2VkaXRfY2hhcl93aGl0ZWxpc3Q9WU9VRElFQURGVCIsDQogICAgICAibW9uaXRvcl9pbmRleCI6IDIsDQogICAgICAicHJvY2Vzc19uYW1lcyI6IFsNCiAgICAgICAgImVsZGVucmluZy5leGUiLA0KICAgICAgICAiZWxkZW4gcmluZy5leGUiDQogICAgICBdDQogICAgfSwNCiAgICAiRGFyayBTb3VscyAzIjogew0KICAgICAgInJlZ2lvbiI6IHsNCiAgICAgICAgImxlZnQiOiA1MjAsDQogICAgICAgICJ0b3AiOiA0NzAsDQogICAgICAgICJ3aWR0aCI6IDg4MCwNCiAgICAgICAgImhlaWdodCI6IDIwMA0KICAgICAgfSwNCiAgICAgICJrZXl3b3JkcyI6IFsNCiAgICAgICAgIllPVURJRUQiLA0KICAgICAgICAiWU9VRElFIiwNCiAgICAgICAgIllPVUQxRUQiLA0KICAgICAgICAiWU9VRGxFRCIsDQogICAgICAgICJZT1VESSIsDQogICAgICAgICJPVURJRUQiLA0KICAgICAgICAiWU9VRElFMCINCiAgICAgIF0sDQogICAgICAidGVzc2VyYWN0X2NvbmZpZyI6ICItLW9lbSAzIC0tcHNtIDcgLWMgdGVzc2VkaXRfY2hhcl93aGl0ZWxpc3Q9WU9VRElFQURGVCIsDQogICAgICAibW9uaXRvcl9pbmRleCI6IDIsDQogICAgICAicHJvY2Vzc19uYW1lcyI6IFsNCiAgICAgICAgImRhcmtzb3Vsc2lpaS5leGUiLA0KICAgICAgICAiZGFyayBzb3VscyBpaWkuZXhlIg0KICAgICAgXQ0KICAgIH0sDQogICAgIkRhcmsgU291bHMgUmVtYXN0ZXJlZCI6IHsNCiAgICAgICJyZWdpb24iOiB7DQogICAgICAgICJsZWZ0IjogNTIwLA0KICAgICAgICAidG9wIjogNDcwLA0KICAgICAgICAid2lkdGgiOiA4ODAsDQogICAgICAgICJoZWlnaHQiOiAyMDANCiAgICAgIH0sDQogICAgICAia2V5d29yZHMiOiBbDQogICAgICAgICJZT1VESUVEIiwNCiAgICAgICAgIllPVURJRSIsDQogICAgICAgICJZT1VEMUVEIiwNCiAgICAgICAgIllPVURsRUQiLA0KICAgICAgICAiWU9VREkiLA0KICAgICAgICAiT1VESUVEIiwNCiAgICAgICAgIllPVURJRTAiDQogICAgICBdLA0KICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IC1jIHRlc3NlZGl0X2NoYXJfd2hpdGVsaXN0PVlPVURJRUFERlQiLA0KICAgICAgIm1vbml0b3JfaW5kZXgiOiAyLA0KICAgICAgInByb2Nlc3NfbmFtZXMiOiBbDQogICAgICAgICJkYXJrc291bHNyZW1hc3RlcmVkLmV4ZSIsDQogICAgICAgICJkYXJrIHNvdWxzIHJlbWFzdGVyZWQuZXhlIg0KICAgICAgXQ0KICAgIH0sDQogICAgIkRhcmsgU291bHMgSUk6IFNjaG9sYXIgb2YgdGhlIEZpcnN0IFNpbiI6IHsNCiAgICAgICJyZWdpb24iOiB7DQogICAgICAgICJsZWZ0IjogNTIwLA0KICAgICAgICAidG9wIjogNDcwLA0KICAgICAgICAid2lkdGgiOiA4ODAsDQogICAgICAgICJoZWlnaHQiOiAyMDANCiAgICAgIH0sDQogICAgICAia2V5d29yZHMiOiBbDQogICAgICAgICJZT1VESUVEIiwNCiAgICAgICAgIllPVURJRSIsDQogICAgICAgICJZT1VEMUVEIiwNCiAgICAgICAgIllPVURsRUQiLA0KICAgICAgICAiWU9VREkiLA0KICAgICAgICAiT1VESUVEIiwNCiAgICAgICAgIllPVURJRTAiDQogICAgICBdLA0KICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IC1jIHRlc3NlZGl0X2NoYXJfd2hpdGVsaXN0PVlPVURJRUFERlQiLA0KICAgICAgIm1vbml0b3JfaW5kZXgiOiAyLA0KICAgICAgInByb2Nlc3NfbmFtZXMiOiBbDQogICAgICAgICJkYXJrc291bHNpaS5leGUiLA0KICAgICAgICAiZGFyayBzb3VscyBpaS5leGUiLA0KICAgICAgICAiZGFya3NvdWxzMi5leGUiDQogICAgICBdDQogICAgfSwNCiAgICAiU2VraXJvIjogew0KICAgICAgInJlZ2lvbiI6IHsNCiAgICAgICAgImxlZnQiOiA1MjAsDQogICAgICAgICJ0b3AiOiA0NzAsDQogICAgICAgICJ3aWR0aCI6IDg4MCwNCiAgICAgICAgImhlaWdodCI6IDIwMA0KICAgICAgfSwNCiAgICAgICJrZXl3b3JkcyI6IFsNCiAgICAgICAgIllPVURJRUQiLA0KICAgICAgICAiWU9VRElFIiwNCiAgICAgICAgIkRFQVRIIg0KICAgICAgXSwNCiAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyAtYyB0ZXNzZWRpdF9jaGFyX3doaXRlbGlzdD1ZT1VESUVBREZUIiwNCiAgICAgICJtb25pdG9yX2luZGV4IjogMiwNCiAgICAgICJwcm9jZXNzX25hbWVzIjogWw0KICAgICAgICAic2VraXJvLmV4ZSINCiAgICAgIF0NCiAgICB9DQogIH0sDQogICJjdXJyZW50X2dhbWUiOiAiRGFyayBTb3VscyBSZW1hc3RlcmVkIg0KfQ==",
  "START_DEATH_COUNTER.bat": "QGVjaG8gb2ZmDQpSRU0gU3RhcnQgRGVhdGggQ291bnRlciBEYWVtb24NClJFTSBUaGlzIGJhdGNoIGZpbGUgc3RhcnRzIHRoZSBkZWF0aCBjb3VudGVyIGRhZW1vbg0KUkVNIFdpbmRvdyB3aWxsIGJlIHBvc2l0aW9uZWQgaW4gdG9wIHJpZ2h0IGNvcm5lcg0KDQpjZCAvZCAiJX5kcDAiDQoNClJFTSBQb3NpdGlvbiB0aGlzIGNvbnNvbGUgd2luZG93IHRvIHRvcCByaWdodCBiZWZvcmUgc3RhcnRpbmcNCnBvd2Vyc2hlbGwgLUNvbW1hbmQgIiRob3N0LlVJLlJhd1VJLldpbmRvd1Bvc2l0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLkhvc3QuQ29vcmRpbmF0ZXMgKChHZXQtSG9zdCkuVUkuUmF3VUkuQnVmZmVyU2l6ZS5XaWR0aCAtIDgwMCksIDAiDQoNCnB5dGhvbiBtdWx0aV9nYW1lX2RlYXRoX2NvdW50ZXIucHkNCg0KcGF1c2UNCg0K",
  "STOP_DEATH_COUNTER.bat": "QGVjaG8gb2ZmDQpSRU0gU3RvcCBEZWF0aCBDb3VudGVyIERhZW1vbg0KUkVNIFRoaXMgYmF0Y2ggZmlsZSBzdG9wcyB0aGUgZGVhdGggY291bnRlciBkYWVtb24gYnkgY3JlYXRpbmcgYSBTVE9QIGZpbGUNCg0KY2QgL2QgIiV+ZHAwIg0KZWNoby4gPiBTVE9QDQplY2hvIFNUT1AgZmlsZSBjcmVhdGVkLiBEYWVtb24gc2hvdWxkIHN0b3Agd2l0aGluIGEgZmV3IHNlY29uZHMuDQp0aW1lb3V0IC90IDIgL25vYnJlYWsgPm51bA0KDQppZiBleGlzdCBkYWVtb24ubG9jayAoDQogICAgZWNobyBEYWVtb24gbWF5IHN0aWxsIGJlIHJ1bm5pbmcuIENoZWNraW5nIGxvY2sgZmlsZS4uLg0KICAgIGZvciAvZiAidG9rZW5zPSoiICUlaSBpbiAoZGFlbW9uLmxvY2spIGRvICgNCiAgICAgICAgZWNobyBBdHRlbXB0aW5nIHRvIGtpbGwgcHJvY2VzcyAlJWkuLi4NCiAgICAgICAgdGFza2tpbGwgL0YgL1BJRCAlJWkgPm51bCAyPiYxDQogICAgKQ0KICAgIGRlbCBkYWVtb24ubG9jayA+bnVsIDI+JjENCiAgICBlY2hvIERhZW1vbiBzdG9wcGVkLg0KKSBlbHNlICgNCiAgICBlY2hvIERhZW1vbiBpcyBub3QgcnVubmluZy4NCikNCg0KaWYgZXhpc3QgU1RPUCBkZWwgU1RPUCA+bnVsIDI+JjENCnBhdXNlDQoNCg==",
  "install_dependencies.bat": "QGVjaG8gb2ZmDQpSRU0gSW5zdGFsbCBQeXRob24gRGVwZW5kZW5jaWVzIGZvciBEZWF0aCBDb3VudGVyDQpSRU0gVGhpcyBiYXRjaCBmaWxlIGluc3RhbGxzIGFsbCByZXF1aXJlZCBQeXRob24gcGFja2FnZXMNCg0KZWNobyBJbnN0YWxsaW5nIGRlcGVuZGVuY2llcyBmb3IgRGVhdGggQ291bnRlci4uLg0KZWNoby4NCg0KY2QgL2QgIiV+ZHAwIg0KDQpweXRob24gLW0gcGlwIGluc3RhbGwgLS11cGdyYWRlIHBpcA0KcHl0aG9uIC1tIHBpcCBpbnN0YWxsIG1zcyBwaWxsb3cgcHl0ZXNzZXJhY3Qgb3BlbmN2LXB5dGhvbiBudW1weSBwc3V0aWwNCg0KZWNoby4NCmVjaG8gSW5zdGFsbGF0aW9uIGNvbXBsZXRlIQ0KZWNoby4NCmVjaG8gTm90ZTogWW91IGFsc28gbmVlZCB0byBpbnN0YWxsIFRlc3NlcmFjdCBPQ1Igc2VwYXJhdGVseToNCmVjaG8gRG93bmxvYWQgZnJvbTogaHR0cHM6Ly9naXRodWIuY29tL1VCLU1hbm5oZWltL3Rlc3NlcmFjdC93aWtpDQplY2hvIERlZmF1bHQgcGF0aDogQzpcUHJvZ3JhbSBGaWxlc1xUZXNzZXJhY3QtT0NSXHRlc3NlcmFjdC5leGUNCmVjaG8uDQpwYXVzZQ0KDQo=",
  "README.md": "IyBEZWF0aCBDb3VudGVyIC0gTXVsdGktR2FtZSBEZWF0aCBDb3VudGVyIEluc3RhbGxlcg0KDQojIyBMYXRlc3QgVmVyc2lvbjogdjEuNQ0KDQoqKkRlYXRoQ291bnRlckluc3RhbGxlci5leGUqKiAtIENvbXBsZXRlIHN0YW5kYWxvbmUgV2luZG93cyBpbnN0YWxsZXIgd2l0aCBhdXRvbWF0aWMgSmFwYW5lc2UgbGFuZ3VhZ2UgcGFjayBkb3dubG9hZCBmb3IgU2VraXJvIHN1cHBvcnQuDQoNCiMjIFF1aWNrIFN0YXJ0DQoNCjEuIERvd25sb2FkICoqRGVhdGhDb3VudGVySW5zdGFsbGVyLmV4ZSoqDQoyLiBSdW4gdGhlIGluc3RhbGxlciAoZG91YmxlLWNsaWNrKQ0KMy4gRm9sbG93IHRoZSBvbi1zY3JlZW4gaW5zdHJ1Y3Rpb25zIHRvIGNvbXBsZXRlIHNldHVwDQo0LiBMYXVuY2ggdGhlIERlYXRoIENvdW50ZXIgR1VJDQoNCiMjIEZlYXR1cmVzDQoNCi0gKipBdXRvbWF0aWMgU2V0dXAqKjogRXh0cmFjdHMgYWxsIG5lY2Vzc2FyeSBmaWxlcyBhbmQgZGVwZW5kZW5jaWVzDQotICoqU3lzdGVtIENoZWNrcyoqOiBWZXJpZmllcyBQeXRob24sIFRlc3NlcmFjdCBPQ1IsIGFuZCBkZXBlbmRlbmNpZXMNCi0gKipBdXRvLURvd25sb2FkKio6IEF1dG9tYXRpY2FsbHkgZG93bmxvYWRzIEphcGFuZXNlIGxhbmd1YWdlIHBhY2tzIGZvciBTZWtpcm8gc3VwcG9ydA0KLSAqKlN0cmVhbWVyLmJvdCBJbnRlZ3JhdGlvbioqOiBFYXN5IGltcG9ydCBvZiBTdHJlYW1lci5ib3QgYWN0aW9ucw0KLSAqKk11bHRpLUdhbWUgU3VwcG9ydCoqOiBXb3JrcyB3aXRoIEVsZGVuIFJpbmcsIERhcmsgU291bHMgc2VyaWVzLCBTZWtpcm8sIGFuZCBtb3JlDQotICoqTXVsdGktUmVzb2x1dGlvbiBTdXBwb3J0Kio6IFdvcmtzIG9uIGFueSBzY3JlZW4gcmVzb2x1dGlvbiAoNzIwcCwgMTA4MHAsIDE0NDBwLCA0SywgdWx0cmF3aWRlKQ0KDQojIyBJbnN0YWxsYXRpb24gU3RlcHMNCg0KMS4gQ2xpY2sgKioiSW5zdGFsbC9VcGRhdGUgRmlsZXMiKiog4oaSIEV4dHJhY3RzIGFsbCBhcHBsaWNhdGlvbiBmaWxlcw0KMi4gQ2xpY2sgKioiSW5zdGFsbCBQeXRob24iKiogKGlmIG5lZWRlZCkg4oaSIE9wZW5zIFB5dGhvbiBkb3dubG9hZCBwYWdlDQozLiBDbGljayAqKiJJbnN0YWxsIFRlc3NlcmFjdCIqKiAoaWYgbmVlZGVkKSDihpIgT3BlbnMgVGVzc2VyYWN0IGRvd25sb2FkIHBhZ2UgIA0KNC4gQ2xpY2sgKioiSW5zdGFsbCBEZXBlbmRlbmNpZXMiKiog4oaSIEluc3RhbGxzIGFsbCByZXF1aXJlZCBQeXRob24gcGFja2FnZXMNCjUuIENsaWNrICoqIlN0cmVhbWVyLmJvdCBEb3dubG9hZCIqKiAoaWYgbmVlZGVkKSDihpIgT3BlbnMgU3RyZWFtZXIuYm90IGRvd25sb2FkIHBhZ2UNCjYuIENsaWNrICoqIkltcG9ydCB0byBTdHJlYW1lci5ib3QiKiog4oaSIE9wZW5zIFN0cmVhbWVyLmJvdCBpbXBvcnQgZGlhbG9nDQo3LiBDbGljayAqKiLinJMgQ29uZmlybSBJbXBvcnQiKiog4oaSIEVuYWJsZXMgdGhlIGxhdW5jaCBidXR0b24NCjguIENsaWNrICoqIkxhdW5jaCBEZWF0aCBDb3VudGVyIioqIOKGkiBTdGFydHMgdGhlIERlYXRoIENvdW50ZXIgR1VJIGFwcGxpY2F0aW9uDQoNCiMjIFJlcG9zaXRvcnkgU3RydWN0dXJlDQoNCiMjIyBNYWluIEJyYW5jaCAoQ3VycmVudCkNCi0gKipEZWF0aENvdW50ZXJJbnN0YWxsZXIuZXhlKiogLSBMYXRlc3QgaW5zdGFsbGVyICh2MS41KQ0KLSAqKlJFQURNRS5tZCoqIC0gVGhpcyBmaWxlDQotICoqZGVhdGggY291bnRlciBzb3VyY2UvKiogLSBBbGwgc291cmNlIGNvZGUgYW5kIHNjcmlwdHMNCg0KIyMjIFNvdXJjZSBGaWxlcw0KQWxsIHNvdXJjZSBjb2RlLCBzY3JpcHRzLCBhbmQgY29uZmlndXJhdGlvbiBmaWxlcyBhcmUgbG9jYXRlZCBpbiB0aGUgKipgZGVhdGggY291bnRlciBzb3VyY2UvYCoqIGZvbGRlcjoNCi0gYG11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weWAgLSBNYWluIGRhZW1vbiBzY3JpcHQNCi0gYGRlYXRoX2NvdW50ZXJfZ3VpLnB5YCAtIEdVSSBhcHBsaWNhdGlvbg0KLSBgZ2FtZXNfY29uZmlnLmpzb25gIC0gR2FtZSBjb25maWd1cmF0aW9uDQotIGBEZWF0aENvdW50ZXJfSW5zdGFsbGVyX1N0YW5kYWxvbmUucHlgIC0gSW5zdGFsbGVyIHNvdXJjZSBjb2RlDQotIGBidWlsZF9zaW5nbGVfZmlsZS5weWAgLSBCdWlsZCBzY3JpcHQNCi0gYHJlc2V0X2RlYXRoX2NvdW50ZXIucHlgIC0gUmVzZXQgc2NyaXB0DQotIGB0ZXN0X2RhZW1vbl9zdGFydC5weWAgLSBUZXN0IHNjcmlwdA0KLSBTdHJlYW1lci5ib3QgYWN0aW9uIGZpbGVzIChgLmNzYCBmaWxlcykNCi0gQmF0Y2ggZmlsZXMgYW5kIHV0aWxpdGllcw0KDQojIyMgT2xkIFZlcnNpb25zDQpQcmV2aW91cyBpbnN0YWxsZXIgdmVyc2lvbnMgKHYxLjEgLSB2MS42KSBhcmUgYXZhaWxhYmxlIGluIHRoZSAqKmBvbGQtdmVyc2lvbnNgKiogYnJhbmNoLg0KDQojIyBTeXN0ZW0gUmVxdWlyZW1lbnRzDQoNCi0gV2luZG93cyAxMC8xMQ0KLSBQeXRob24gMy44LTMuMTMgKGF1dG8tZGV0ZWN0ZWQgb3IgaW5zdGFsbGFibGUgdmlhIGluc3RhbGxlcikNCi0gVGVzc2VyYWN0IE9DUiAoYXV0by1kb3dubG9hZGFibGUgdmlhIGluc3RhbGxlcikNCi0gSW50ZXJuZXQgY29ubmVjdGlvbiAoZm9yIGluaXRpYWwgc2V0dXAgYW5kIEphcGFuZXNlIHBhY2sgZG93bmxvYWQpDQoNCiMjIFN1cHBvcnRlZCBHYW1lcw0KDQotIEVsZGVuIFJpbmcNCi0gRGFyayBTb3VscyBSZW1hc3RlcmVkDQotIERhcmsgU291bHMgSUkNCi0gRGFyayBTb3VscyBJSUkNCi0gU2VraXJvOiBTaGFkb3dzIERpZSBUd2ljZSAod2l0aCBKYXBhbmVzZSBjaGFyYWN0ZXIgc3VwcG9ydCkNCg0KIyMgVHJvdWJsZXNob290aW5nDQoNCklmIHlvdSBlbmNvdW50ZXIgaXNzdWVzOg0KMS4gRW5zdXJlIHlvdSdyZSBydW5uaW5nIHRoZSBpbnN0YWxsZXIgYXMgQWRtaW5pc3RyYXRvcg0KMi4gQ2hlY2sgdGhhdCBQeXRob24gYW5kIFRlc3NlcmFjdCBPQ1IgYXJlIHByb3Blcmx5IGluc3RhbGxlZA0KMy4gVmVyaWZ5IGludGVybmV0IGNvbm5lY3Rpb24gZm9yIEphcGFuZXNlIHBhY2sgYXV0by1kb3dubG9hZA0KNC4gQ2hlY2sgdGhlIGxvZyBvdXRwdXQgaW4gdGhlIGluc3RhbGxlciBmb3Igc3BlY2lmaWMgZXJyb3IgbWVzc2FnZXMNCg0KIyMgTGljZW5zZQ0KDQpTZWUgcmVwb3NpdG9yeSBmb3IgbGljZW5zZSBpbmZvcm1hdGlvbi4NCg==",
  "change_monitor_id.py": "IiIiDQpTY3JpcHQgdG8gZWFzaWx5IGNoYW5nZSB0aGUgbW9uaXRvciBJRCBmb3IgZ2FtZXMgaW4gdGhlIGNvbmZpZy4NCkhlbHBzIHdoZW4gYXV0by1kZXRlY3Rpb24gaXNuJ3Qgd29ya2luZyBvciB5b3Ugd2FudCB0byBtYW51YWxseSBzZXQgaXQuDQoiIiINCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQganNvbg0KDQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQNCmRlZiBnZXRfYmFzZV9kaXIoKToNCiAgICAiIiJHZXQgdGhlIGJhc2UgZGlyZWN0b3J5IC0gc2FtZSBmb2xkZXIgYXMgdGhpcyBzY3JpcHQuIiIiDQogICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKHN5cy5leGVjdXRhYmxlKSkNCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykpDQoNCkJBU0VfRElSID0gZ2V0X2Jhc2VfZGlyKCkNCkNPTkZJR19GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZ2FtZXNfY29uZmlnLmpzb24iKQ0KDQoNCmRlZiBsb2FkX2NvbmZpZygpOg0KICAgICIiIkxvYWQgZ2FtZSBjb25maWd1cmF0aW9ucyBmcm9tIEpTT04gZmlsZS4iIiINCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoQ09ORklHX0ZJTEUpOg0KICAgICAgICBwcmludChmIkVSUk9SOiBDb25maWcgZmlsZSBub3QgZm91bmQ6IHtDT05GSUdfRklMRX0iKQ0KICAgICAgICByZXR1cm4gTm9uZQ0KICAgIA0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBjb25maWcgPSBqc29uLmxvYWQoZikNCiAgICAgICAgcmV0dXJuIGNvbmZpZw0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJFcnJvciBsb2FkaW5nIGNvbmZpZzoge2V9IikNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgc2F2ZV9jb25maWcoY29uZmlnKToNCiAgICAiIiJTYXZlIGNvbmZpZ3VyYXRpb24gdG8gSlNPTiBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgcmV0dXJuIFRydWUNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRXJyb3Igc2F2aW5nIGNvbmZpZzoge2V9IikNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCg0KZGVmIGxpc3RfbW9uaXRvcnMoKToNCiAgICAiIiJMaXN0IGF2YWlsYWJsZSBtb25pdG9ycy4iIiINCiAgICB0cnk6DQogICAgICAgIGZyb20gbXNzIGltcG9ydCBtc3MNCiAgICAgICAgd2l0aCBtc3MoKSBhcyBzY3Q6DQogICAgICAgICAgICBwcmludCgiXG5BdmFpbGFibGUgbW9uaXRvcnM6IikNCiAgICAgICAgICAgIGZvciBpLCBtb24gaW4gZW51bWVyYXRlKHNjdC5tb25pdG9ycyk6DQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIE1vbml0b3Ige2l9OiB7bW9uWyd3aWR0aCddfXh7bW9uWydoZWlnaHQnXX0gYXQgKHttb25bJ2xlZnQnXX0sIHttb25bJ3RvcCddfSkiKQ0KICAgICAgICAgICAgcmV0dXJuIGxlbihzY3QubW9uaXRvcnMpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIkVycm9yIGxpc3RpbmcgbW9uaXRvcnM6IHtlfSIpDQogICAgICAgIHJldHVybiAwDQoNCg0KZGVmIG1haW4oKToNCiAgICBjb25maWcgPSBsb2FkX2NvbmZpZygpDQogICAgaWYgbm90IGNvbmZpZzoNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgZ2FtZXMgPSBjb25maWcuZ2V0KCJnYW1lcyIsIHt9KQ0KICAgIGlmIG5vdCBnYW1lczoNCiAgICAgICAgcHJpbnQoIk5vIGdhbWVzIGNvbmZpZ3VyZWQhIikNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgcHJpbnQoIj0iICogNjApDQogICAgcHJpbnQoIk1vbml0b3IgSUQgQ2hhbmdlciIpDQogICAgcHJpbnQoIj0iICogNjApDQogICAgDQogICAgIyBMaXN0IGF2YWlsYWJsZSBtb25pdG9ycw0KICAgIG51bV9tb25pdG9ycyA9IGxpc3RfbW9uaXRvcnMoKQ0KICAgIA0KICAgICMgTGlzdCBnYW1lcw0KICAgIHByaW50KCJcbkNvbmZpZ3VyZWQgZ2FtZXM6IikNCiAgICBnYW1lX2xpc3QgPSBsaXN0KGdhbWVzLmtleXMoKSkNCiAgICBmb3IgaSwgZ2FtZV9uYW1lIGluIGVudW1lcmF0ZShnYW1lX2xpc3QsIDEpOg0KICAgICAgICBjdXJyZW50X21vbml0b3IgPSBnYW1lc1tnYW1lX25hbWVdLmdldCgibW9uaXRvcl9pbmRleCIsIGNvbmZpZy5nZXQoInNldHRpbmdzIiwge30pLmdldCgibW9uaXRvcl9pbmRleCIsIDEpKQ0KICAgICAgICBwcmludChmIiAge2l9LiB7Z2FtZV9uYW1lfSAoTW9uaXRvcjoge2N1cnJlbnRfbW9uaXRvcn0pIikNCiAgICANCiAgICAjIEdldCBnYW1lIHNlbGVjdGlvbg0KICAgIHByaW50KCkNCiAgICB0cnk6DQogICAgICAgIGNob2ljZSA9IGlucHV0KCJFbnRlciBnYW1lIG51bWJlciB0byBjaGFuZ2UgKG9yICdhbGwnIGZvciBhbGwgZ2FtZXMpOiAiKS5zdHJpcCgpLmxvd2VyKCkNCiAgICAgICAgDQogICAgICAgIGlmIGNob2ljZSA9PSAnYWxsJzoNCiAgICAgICAgICAgIHNlbGVjdGVkX2dhbWVzID0gZ2FtZV9saXN0DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBnYW1lX2lkeCA9IGludChjaG9pY2UpIC0gMQ0KICAgICAgICAgICAgaWYgMCA8PSBnYW1lX2lkeCA8IGxlbihnYW1lX2xpc3QpOg0KICAgICAgICAgICAgICAgIHNlbGVjdGVkX2dhbWVzID0gW2dhbWVfbGlzdFtnYW1lX2lkeF1dDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIHNlbGVjdGlvbiEiKQ0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgIGV4Y2VwdCAoVmFsdWVFcnJvciwgS2V5Ym9hcmRJbnRlcnJ1cHQpOg0KICAgICAgICBwcmludCgiXG5DYW5jZWxsZWQuIikNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgIyBHZXQgbW9uaXRvciBJRA0KICAgIHByaW50KCkNCiAgICB0cnk6DQogICAgICAgIG1vbml0b3JfaWQgPSBpbnB1dChmIkVudGVyIG1vbml0b3IgSUQgKDAte251bV9tb25pdG9ycy0xfSk6ICIpLnN0cmlwKCkNCiAgICAgICAgbW9uaXRvcl9pZCA9IGludChtb25pdG9yX2lkKQ0KICAgICAgICANCiAgICAgICAgaWYgbW9uaXRvcl9pZCA8IDAgb3IgbW9uaXRvcl9pZCA+PSBudW1fbW9uaXRvcnM6DQogICAgICAgICAgICBwcmludChmIkludmFsaWQgbW9uaXRvciBJRCEgTXVzdCBiZSBiZXR3ZWVuIDAgYW5kIHtudW1fbW9uaXRvcnMtMX0iKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgZXhjZXB0IChWYWx1ZUVycm9yLCBLZXlib2FyZEludGVycnVwdCk6DQogICAgICAgIHByaW50KCJcbkNhbmNlbGxlZC4iKQ0KICAgICAgICByZXR1cm4NCiAgICANCiAgICAjIFVwZGF0ZSBtb25pdG9yIElEcw0KICAgIHByaW50KCkNCiAgICBmb3IgZ2FtZV9uYW1lIGluIHNlbGVjdGVkX2dhbWVzOg0KICAgICAgICBnYW1lc1tnYW1lX25hbWVdWyJtb25pdG9yX2luZGV4Il0gPSBtb25pdG9yX2lkDQogICAgICAgIHByaW50KGYi4pyTIFNldCB7Z2FtZV9uYW1lfSB0byBtb25pdG9yIHttb25pdG9yX2lkfSIpDQogICAgDQogICAgIyBTYXZlIGNvbmZpZw0KICAgIGlmIHNhdmVfY29uZmlnKGNvbmZpZyk6DQogICAgICAgIHByaW50KGYiXG7inJMgQ29uZmlnIHNhdmVkIHRvIHtDT05GSUdfRklMRX0iKQ0KICAgICAgICBwcmludCgiXG5Ob3RlOiBUaGUgZGFlbW9uIHdpbGwgYXV0by1kZXRlY3QgdGhlIG1vbml0b3IsIGJ1dCB0aGlzIHNldHRpbmciKQ0KICAgICAgICBwcmludCgid2lsbCBiZSB1c2VkIGFzIGEgZmFsbGJhY2sgaWYgYXV0by1kZXRlY3Rpb24gZmFpbHMuIikNCiAgICBlbHNlOg0KICAgICAgICBwcmludCgiXG7inJcgRmFpbGVkIHRvIHNhdmUgY29uZmlnISIpDQoNCg0KaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoNCiAgICBtYWluKCkNCg0K",
  "capture_debug_once.py": "IiIiDQpPbmUtdGltZSBkZWJ1ZyBpbWFnZSBjYXB0dXJlIHNjcmlwdC4NCkNhcHR1cmVzIHRoZSBjdXJyZW50IGdhbWUncyByZWdpb24gYW5kIHNhdmVzIGJvdGggcmF3IGFuZCBwcmVwcm9jZXNzZWQgaW1hZ2VzLg0KUnVuIHRoaXMgYW55dGltZSB0byBzZWUgd2hhdCB0aGUgT0NSIGlzIHNlZWluZy4NCiIiIg0KDQppbXBvcnQgb3MNCmltcG9ydCBzeXMNCmltcG9ydCBzdWJwcm9jZXNzDQppbXBvcnQgY3R5cGVzDQppbXBvcnQganNvbg0KZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIFR1cGxlDQoNCmltcG9ydCBjdjINCmltcG9ydCBudW1weSBhcyBucA0KZnJvbSBQSUwgaW1wb3J0IEltYWdlDQpmcm9tIG1zcyBpbXBvcnQgbXNzDQppbXBvcnQgcHl0ZXNzZXJhY3QNCg0KIyBHZXQgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGlzIHNjcmlwdCBpcyBsb2NhdGVkDQpkZWYgZ2V0X2Jhc2VfZGlyKCk6DQogICAgIiIiR2V0IHRoZSBiYXNlIGRpcmVjdG9yeSAtIHNhbWUgZm9sZGVyIGFzIHRoaXMgc2NyaXB0LiIiIg0KICAgIGlmIGdldGF0dHIoc3lzLCAnZnJvemVuJywgRmFsc2UpOg0KICAgICAgICByZXR1cm4gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChzeXMuZXhlY3V0YWJsZSkpDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KDQpCQVNFX0RJUiA9IGdldF9iYXNlX2RpcigpDQpDT05GSUdfRklMRSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImdhbWVzX2NvbmZpZy5qc29uIikNCg0KIyBUcnkgdG8gZmluZCBUZXNzZXJhY3QgLSBjaGVjayBjb21tb24gbG9jYXRpb25zIGFuZCBQQVRIDQpkZWYgZmluZF90ZXNzZXJhY3QoKToNCiAgICAiIiJGaW5kIFRlc3NlcmFjdCBPQ1IgZXhlY3V0YWJsZS4iIiINCiAgICAjIENoZWNrIGlmIHRlc3NlcmFjdCBpcyBpbiBQQVRIDQogICAgdHJ5Og0KICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3Rlc3NlcmFjdCcsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MikNCiAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgPT0gMDoNCiAgICAgICAgICAgIHJldHVybiAndGVzc2VyYWN0JyAgIyBVc2UgY29tbWFuZCBuYW1lIGlmIGluIFBBVEgNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICANCiAgICAjIENoZWNrIGNvbW1vbiBpbnN0YWxsYXRpb24gcGF0aHMNCiAgICBjb21tb25fcGF0aHMgPSBbDQogICAgICAgIHIiQzpcUHJvZ3JhbSBGaWxlc1xUZXNzZXJhY3QtT0NSXHRlc3NlcmFjdC5leGUiLA0KICAgICAgICByIkM6XFByb2dyYW0gRmlsZXMgKHg4NilcVGVzc2VyYWN0LU9DUlx0ZXNzZXJhY3QuZXhlIiwNCiAgICAgICAgb3MucGF0aC5qb2luKG9zLmdldGVudignUHJvZ3JhbUZpbGVzJywgcidDOlxQcm9ncmFtIEZpbGVzJyksICdUZXNzZXJhY3QtT0NSJywgJ3Rlc3NlcmFjdC5leGUnKSwNCiAgICAgICAgb3MucGF0aC5qb2luKG9zLmdldGVudignUHJvZ3JhbUZpbGVzKHg4NiknLCByJ0M6XFByb2dyYW0gRmlsZXMgKHg4NiknKSwgJ1Rlc3NlcmFjdC1PQ1InLCAndGVzc2VyYWN0LmV4ZScpLA0KICAgIF0NCiAgICANCiAgICBmb3IgcGF0aCBpbiBjb21tb25fcGF0aHM6DQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOg0KICAgICAgICAgICAgcmV0dXJuIHBhdGgNCiAgICANCiAgICAjIERlZmF1bHQgZmFsbGJhY2sNCiAgICByZXR1cm4gciJDOlxQcm9ncmFtIEZpbGVzXFRlc3NlcmFjdC1PQ1JcdGVzc2VyYWN0LmV4ZSINCg0KdGVzc2VyYWN0X3BhdGggPSBmaW5kX3Rlc3NlcmFjdCgpDQpweXRlc3NlcmFjdC5weXRlc3NlcmFjdC50ZXNzZXJhY3RfY21kID0gdGVzc2VyYWN0X3BhdGgNCg0KREVCVUdfUkFXID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVidWdfY2FwdHVyZV9yYXcucG5nIikNCkRFQlVHX09DUiA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYnVnX2NhcHR1cmUucG5nIikNCg0KDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCiMgRFBJIEFXQVJFTkVTUw0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQpkZWYgZW5hYmxlX2RwaV9hd2FyZW5lc3MoKToNCiAgICB0cnk6DQogICAgICAgIGN0eXBlcy53aW5kbGwuc2hjb3JlLlNldFByb2Nlc3NEcGlBd2FyZW5lc3MoMikNCiAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5TZXRQcm9jZXNzRFBJQXdhcmUoKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgcGFzcw0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KIyBDT05GSUdVUkFUSU9OIE1BTkFHRU1FTlQNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGxvYWRfY29uZmlnKCkgLT4gRGljdDoNCiAgICAiIiJMb2FkIGdhbWUgY29uZmlndXJhdGlvbnMgZnJvbSBKU09OIGZpbGUuIiIiDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToNCiAgICAgICAgcHJpbnQoZiJFUlJPUjogQ29uZmlnIGZpbGUgbm90IGZvdW5kOiB7Q09ORklHX0ZJTEV9IikNCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICANCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihDT05GSUdfRklMRSwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQogICAgICAgIHJldHVybiBjb25maWcNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyBjb25maWc6IHtlfSIpDQogICAgICAgIHJldHVybiBOb25lDQoNCg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQojIElNQUdFIFBST0NFU1NJTkcNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGdyYWJfcmVnaW9uKHNjdDogbXNzLCBtb25pdG9yX2luZGV4OiBpbnQsIHJlZ2lvbjogZGljdCkgLT4gSW1hZ2UuSW1hZ2U6DQogICAgIiIiQ2FwdHVyZSBhIHJlZ2lvbiBmcm9tIHRoZSBzcGVjaWZpZWQgbW9uaXRvci4iIiINCiAgICBhY3R1YWxfaW5kZXggPSBtb25pdG9yX2luZGV4IGlmIG1vbml0b3JfaW5kZXggPT0gMCBlbHNlIG1vbml0b3JfaW5kZXgNCiAgICANCiAgICBpZiBhY3R1YWxfaW5kZXggPj0gbGVuKHNjdC5tb25pdG9ycyk6DQogICAgICAgIHByaW50KGYiV0FSTklORzogTW9uaXRvciB7bW9uaXRvcl9pbmRleH0gbm90IGZvdW5kLiBVc2luZyBtb25pdG9yIDEuIikNCiAgICAgICAgYWN0dWFsX2luZGV4ID0gMQ0KICAgIA0KICAgIG1vbiA9IHNjdC5tb25pdG9yc1thY3R1YWxfaW5kZXhdDQogICAgYWJzX3JlZ2lvbiA9IHsNCiAgICAgICAgImxlZnQiOiBtb25bImxlZnQiXSArIHJlZ2lvblsibGVmdCJdLA0KICAgICAgICAidG9wIjogbW9uWyJ0b3AiXSArIHJlZ2lvblsidG9wIl0sDQogICAgICAgICJ3aWR0aCI6IHJlZ2lvblsid2lkdGgiXSwNCiAgICAgICAgImhlaWdodCI6IHJlZ2lvblsiaGVpZ2h0Il0sDQogICAgfQ0KICAgIGdyYWIgPSBzY3QuZ3JhYihhYnNfcmVnaW9uKQ0KICAgIHJldHVybiBJbWFnZS5mcm9tYnl0ZXMoIlJHQiIsIGdyYWIuc2l6ZSwgZ3JhYi5yZ2IpDQoNCg0KZGVmIHByZXByb2Nlc3NfZm9yX29jcihpbWdfcmdiOiBJbWFnZS5JbWFnZSkgLT4gVHVwbGVbSW1hZ2UuSW1hZ2UsIERpY3RdOg0KICAgICIiIg0KICAgIFByZXByb2Nlc3MgaW1hZ2UgZm9yIE9DUiB3aXRoIG11bHRpcGxlIGZhbGxiYWNrIHN0cmF0ZWdpZXMuDQogICAgU2FtZSBhcyB0aGUgbWFpbiBkYWVtb24gc2NyaXB0Lg0KICAgICIiIg0KICAgIHJnYiA9IG5wLmFycmF5KGltZ19yZ2IpDQogICAgYmdyID0gY3YyLmN2dENvbG9yKHJnYiwgY3YyLkNPTE9SX1JHQjJCR1IpDQogICAgDQogICAgZGVmIHVwc2NhbGUoaW1nX2N2KToNCiAgICAgICAgIiIiVXBzY2FsZSBpbWFnZSAyeCBmb3IgYmV0dGVyIE9DUi4iIiINCiAgICAgICAgcmV0dXJuIGN2Mi5yZXNpemUoaW1nX2N2LCBOb25lLCBmeD0yLjAsIGZ5PTIuMCwgaW50ZXJwb2xhdGlvbj1jdjIuSU5URVJfQ1VCSUMpDQogICAgDQogICAgIyBTdHJhdGVneSAxOiBUcnkgSFNWIHJlZCBtYXNrIChmb3IgIllPVSBESUVEIiByZWQgdGV4dCkNCiAgICBoc3YgPSBjdjIuY3Z0Q29sb3IoYmdyLCBjdjIuQ09MT1JfQkdSMkhTVikNCiAgICANCiAgICAjIFdpZGUgcmVkIHRocmVzaG9sZHMgKGJvdGggbG93IGFuZCBoaWdoIGh1ZSByYW5nZXMpDQogICAgbG93ZXIxID0gbnAuYXJyYXkoWzAsIDMwLCAzMF0sIGR0eXBlPW5wLnVpbnQ4KQ0KICAgIHVwcGVyMSA9IG5wLmFycmF5KFsxNSwgMjU1LCAyNTVdLCBkdHlwZT1ucC51aW50OCkNCiAgICBsb3dlcjIgPSBucC5hcnJheShbMTY1LCAzMCwgMzBdLCBkdHlwZT1ucC51aW50OCkNCiAgICB1cHBlcjIgPSBucC5hcnJheShbMTgwLCAyNTUsIDI1NV0sIGR0eXBlPW5wLnVpbnQ4KQ0KICAgIA0KICAgIG1hc2sxID0gY3YyLmluUmFuZ2UoaHN2LCBsb3dlcjEsIHVwcGVyMSkNCiAgICBtYXNrMiA9IGN2Mi5pblJhbmdlKGhzdiwgbG93ZXIyLCB1cHBlcjIpDQogICAgbWFzayA9IGN2Mi5iaXR3aXNlX29yKG1hc2sxLCBtYXNrMikNCiAgICANCiAgICAjIENsZWFuIG5vaXNlDQogICAga2VybmVsID0gbnAub25lcygoMywgMyksIG5wLnVpbnQ4KQ0KICAgIG1hc2sgPSBjdjIubW9ycGhvbG9neUV4KG1hc2ssIGN2Mi5NT1JQSF9PUEVOLCBrZXJuZWwsIGl0ZXJhdGlvbnM9MSkNCiAgICBtYXNrID0gY3YyLm1vcnBob2xvZ3lFeChtYXNrLCBjdjIuTU9SUEhfQ0xPU0UsIGtlcm5lbCwgaXRlcmF0aW9ucz0yKQ0KICAgIG1hc2sgPSBjdjIuZGlsYXRlKG1hc2ssIGtlcm5lbCwgaXRlcmF0aW9ucz0xKQ0KICAgIA0KICAgIHdoaXRlID0gaW50KGN2Mi5jb3VudE5vblplcm8obWFzaykpDQogICAgdG90YWwgPSBpbnQobWFzay5zaGFwZVswXSAqIG1hc2suc2hhcGVbMV0pDQogICAgY292ZXJhZ2UgPSB3aGl0ZSAvIG1heCgxLCB0b3RhbCkNCiAgICANCiAgICBpbmZvID0geyJtb2RlIjogIkhTVl9SRUQiLCAiY292ZXJhZ2UiOiBjb3ZlcmFnZX0NCiAgICANCiAgICAjIFVzZSByZWQgbWFzayBpZiBjb3ZlcmFnZSBpcyByZWFzb25hYmxlIChhdCBsZWFzdCAwLjUlIG9mIGltYWdlKQ0KICAgIGlmIGNvdmVyYWdlID49IDAuMDA1Og0KICAgICAgICAjIEludmVydCBtYXNrOiB3aGl0ZSB0ZXh0IG9uIGJsYWNrIGJhY2tncm91bmQgLT4gYmxhY2sgdGV4dCBvbiB3aGl0ZQ0KICAgICAgICBpbnYgPSBjdjIuYml0d2lzZV9ub3QobWFzaykNCiAgICAgICAgb3V0ID0gdXBzY2FsZShpbnYpDQogICAgICAgIHJldHVybiBJbWFnZS5mcm9tYXJyYXkob3V0KSwgaW5mbw0KICAgIA0KICAgICMgU3RyYXRlZ3kgMjogR3JheXNjYWxlIHdpdGggYWRhcHRpdmUgdGhyZXNob2xkICh3b3JrcyBmb3IgYW55IHRleHQgY29sb3IpDQogICAgZ3JheSA9IGN2Mi5jdnRDb2xvcihiZ3IsIGN2Mi5DT0xPUl9CR1IyR1JBWSkNCiAgICBncmF5X2JsdXIgPSBjdjIuR2F1c3NpYW5CbHVyKGdyYXksICgzLCAzKSwgMCkNCiAgICB0aHJfYWRhcHQgPSBjdjIuYWRhcHRpdmVUaHJlc2hvbGQoDQogICAgICAgIGdyYXlfYmx1ciwgMjU1LA0KICAgICAgICBjdjIuQURBUFRJVkVfVEhSRVNIX0dBVVNTSUFOX0MsDQogICAgICAgIGN2Mi5USFJFU0hfQklOQVJZLA0KICAgICAgICAzMSwgNQ0KICAgICkNCiAgICAjIEludmVydDogbWFrZSB0ZXh0IGRhcmsgb24gbGlnaHQgYmFja2dyb3VuZCAoVGVzc2VyYWN0IHByZWZlcnMgZGFyayB0ZXh0IG9uIGxpZ2h0KQ0KICAgIHRocl9hZGFwdF9pbnYgPSBjdjIuYml0d2lzZV9ub3QodGhyX2FkYXB0KQ0KICAgIG91dCA9IHVwc2NhbGUodGhyX2FkYXB0X2ludikNCiAgICBpbmZvWyJtb2RlIl0gPSAiQURBUFRJVkVfVEhSRVNIT0xEIg0KICAgIGluZm9bImNvdmVyYWdlIl0gPSAwLjANCiAgICByZXR1cm4gSW1hZ2UuZnJvbWFycmF5KG91dCksIGluZm8NCg0KDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCiMgTUFJTg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQpkZWYgbWFpbigpOg0KICAgIGVuYWJsZV9kcGlfYXdhcmVuZXNzKCkNCiAgICANCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocHl0ZXNzZXJhY3QucHl0ZXNzZXJhY3QudGVzc2VyYWN0X2NtZCk6DQogICAgICAgIHByaW50KGYiV0FSTklORzogVGVzc2VyYWN0IG5vdCBmb3VuZCBhdDoge3B5dGVzc2VyYWN0LnB5dGVzc2VyYWN0LnRlc3NlcmFjdF9jbWR9IikNCiAgICAgICAgcHJpbnQoIk9DUiB3b24ndCB3b3JrLCBidXQgaW1hZ2VzIHdpbGwgc3RpbGwgYmUgY2FwdHVyZWQuIikNCiAgICANCiAgICBjb25maWcgPSBsb2FkX2NvbmZpZygpDQogICAgaWYgbm90IGNvbmZpZzoNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgZ2FtZXMgPSBjb25maWcuZ2V0KCJnYW1lcyIsIHt9KQ0KICAgIGN1cnJlbnRfZ2FtZSA9IGNvbmZpZy5nZXQoImN1cnJlbnRfZ2FtZSIpDQogICAgDQogICAgaWYgbm90IGN1cnJlbnRfZ2FtZSBvciBjdXJyZW50X2dhbWUgbm90IGluIGdhbWVzOg0KICAgICAgICBwcmludChmIkVSUk9SOiBDdXJyZW50IGdhbWUgJ3tjdXJyZW50X2dhbWV9JyBub3QgZm91bmQgaW4gY29uZmlnLiIpDQogICAgICAgIHByaW50KGYiQXZhaWxhYmxlIGdhbWVzOiB7bGlzdChnYW1lcy5rZXlzKCkpfSIpDQogICAgICAgIHJldHVybg0KICAgIA0KICAgIGdhbWVfY29uZmlnID0gZ2FtZXNbY3VycmVudF9nYW1lXQ0KICAgIHJlZ2lvbiA9IGdhbWVfY29uZmlnLmdldCgicmVnaW9uIiwge30pDQogICAgbW9uaXRvcl9pbmRleCA9IGdhbWVfY29uZmlnLmdldCgibW9uaXRvcl9pbmRleCIsIGNvbmZpZy5nZXQoInNldHRpbmdzIiwge30pLmdldCgibW9uaXRvcl9pbmRleCIsIDEpKQ0KICAgIA0KICAgIHByaW50KCI9IiAqIDYwKQ0KICAgIHByaW50KCJEZWJ1ZyBJbWFnZSBDYXB0dXJlIikNCiAgICBwcmludCgiPSIgKiA2MCkNCiAgICBwcmludChmIkdhbWU6IHtjdXJyZW50X2dhbWV9IikNCiAgICBwcmludChmIk1vbml0b3I6IHttb25pdG9yX2luZGV4fSIpDQogICAgcHJpbnQoZiJSZWdpb246IHtyZWdpb259IikNCiAgICBwcmludCgpDQogICAgDQogICAgd2l0aCBtc3MoKSBhcyBzY3Q6DQogICAgICAgIHByaW50KGYiQXZhaWxhYmxlIG1vbml0b3JzOiB7bGVuKHNjdC5tb25pdG9ycyl9IikNCiAgICAgICAgZm9yIGksIG1vbiBpbiBlbnVtZXJhdGUoc2N0Lm1vbml0b3JzKToNCiAgICAgICAgICAgIHByaW50KGYiICBNb25pdG9yIHtpfToge21vblsnd2lkdGgnXX14e21vblsnaGVpZ2h0J119IGF0ICh7bW9uWydsZWZ0J119LCB7bW9uWyd0b3AnXX0pIikNCiAgICAgICAgcHJpbnQoKQ0KICAgICAgICANCiAgICAgICAgIyBDYXB0dXJlIHJlZ2lvbg0KICAgICAgICBwcmludCgiQ2FwdHVyaW5nIHJlZ2lvbi4uLiIpDQogICAgICAgIGltZ19yZ2IgPSBncmFiX3JlZ2lvbihzY3QsIG1vbml0b3JfaW5kZXgsIHJlZ2lvbikNCiAgICAgICAgDQogICAgICAgICMgU2F2ZSByYXcgaW1hZ2UNCiAgICAgICAgaW1nX3JnYi5zYXZlKERFQlVHX1JBVykNCiAgICAgICAgcHJpbnQoZiLinJMgUmF3IGltYWdlIHNhdmVkOiB7REVCVUdfUkFXfSIpDQogICAgICAgIHByaW50KGYiICBTaXplOiB7aW1nX3JnYi5zaXplWzBdfXh7aW1nX3JnYi5zaXplWzFdfSIpDQogICAgICAgIA0KICAgICAgICAjIFByZXByb2Nlc3MNCiAgICAgICAgcHJpbnQoIlByZXByb2Nlc3NpbmcgZm9yIE9DUi4uLiIpDQogICAgICAgIG9jcl9pbWcsIGluZm8gPSBwcmVwcm9jZXNzX2Zvcl9vY3IoaW1nX3JnYikNCiAgICAgICAgDQogICAgICAgICMgU2F2ZSBwcm9jZXNzZWQgaW1hZ2UNCiAgICAgICAgb2NyX2ltZy5zYXZlKERFQlVHX09DUikNCiAgICAgICAgcHJpbnQoZiLinJMgUHJvY2Vzc2VkIGltYWdlIHNhdmVkOiB7REVCVUdfT0NSfSIpDQogICAgICAgIHByaW50KGYiICBTaXplOiB7b2NyX2ltZy5zaXplWzBdfXh7b2NyX2ltZy5zaXplWzFdfSIpDQogICAgICAgIHByaW50KGYiICBNb2RlOiB7aW5mb1snbW9kZSddfSIpDQogICAgICAgIGlmICdjb3ZlcmFnZScgaW4gaW5mbzoNCiAgICAgICAgICAgIHByaW50KGYiICBDb3ZlcmFnZToge2luZm9bJ2NvdmVyYWdlJ106LjRmfSIpDQogICAgICAgIA0KICAgICAgICBwcmludCgpDQogICAgICAgIHByaW50KCJEb25lISBPcGVuIHRoZSBpbWFnZXMgdG8gc2VlIHdoYXQgT0NSIGlzIHByb2Nlc3NpbmcuIikNCg0KDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIG1haW4oKQ0KDQo=",
  "CHANGE_MONITOR_ID.bat": "QGVjaG8gb2ZmDQpSRU0gU2NyaXB0IHRvIGVhc2lseSBjaGFuZ2UgbW9uaXRvciBJRCBmb3IgZ2FtZXMNCmNkIC9kICIlfmRwMCINCnB5dGhvbiBjaGFuZ2VfbW9uaXRvcl9pZC5weQ0KaWYgZXJyb3JsZXZlbCAxICgNCiAgICBlY2hvLg0KICAgIGVjaG8gUHJlc3MgYW55IGtleSB0byBleGl0Li4uDQogICAgcGF1c2UgPm51bA0KKQ0KDQo=",
  "CAPTURE_DEBUG.bat": "QGVjaG8gb2ZmDQpSRU0gU2NyaXB0IHRvIGNhcHR1cmUgZGVidWcgaW1hZ2VzDQpjZCAvZCAiJX5kcDAiDQpweXRob24gY2FwdHVyZV9kZWJ1Z19vbmNlLnB5DQppZiBlcnJvcmxldmVsIDEgKA0KICAgIGVjaG8uDQogICAgZWNobyBQcmVzcyBhbnkga2V5IHRvIGV4aXQuLi4NCiAgICBwYXVzZSA+bnVsDQopDQoNCg==",
  "deathcounteraction.cs": "VTBKQlJSK0xDQUFBQUFBQUJBQ1ZXRmx6MmtnUWZ0K3EvUStzbnlPWERvUlJxdllCWkZzSWJCTEFYRnJ5TUJmU2hOR3hPb3h4S3Y5OVp5VEFDTWJlSkZXS2E2WjcrdnEra2JyNThlY2ZqY1pWU0hKdzlibnhReXo0TWdJaDRjdXJXd0x5b0dISFJaU1R0UEVYRnN1TXI4TVFSUGpxMDE0YkZIa1FwMEwvTVk0MlpQY0VJditMY3hRL2t6U2pjU1RrMnJWNnJSNEZtR1FvcFVtK0Z4N00wNmlSYjJtT2dnWUtRTjVZeDJtalNERElTWGJkS0RLU05UcEZIamZxb2ZHTlN1ZjZOS3A0WEVRZHRMY2ZGWXdkWkNHTmFGaUVzMk5rUWloa1AwdU5LMjdwdEJ5Z3RKSHhuWCtxbmNaQlZJb3BGdUZqb0xkeEcyTEYxQUZTbW9hS0ZVZ1FWQ3hrcmVFTndFYkxPcGFzUFBadlFZcXl5cnFtRVYwMWlhSmlxNlUwc1dZcWx0YTZVVEJzYVcyZHRGcXFpbW9uU1FRZ0k4SnJuaGFrSm5sQnJNRGtQbzNESHMzeU9OMXhwVFZnMlh0YVgwbUVhZVRMdEE0a2VLckFzQVVZZHBHbUpNb2JmNVhsejJwUitXbGNKR2NIYWdxQWJjRXU0NWpJdktXY1VYRjRST3RDanVJSVZjNWwwanlsdnMvUlBJWG9ES2E5bFpLNmJvbVlpamhraG1VcTY3YlZWSnJXMmxEYWJRMG9TTWN0anFhdVFsTS9UZUFFYkJPMmtXNjBPTVRHRFZhYWFxdXRXT1RHVUpxbXFwdm16ZHJTNFByaWFMNUxSRUdicW5ZdWVSZlFON2l5QXdPL25VcC92aTIrbmRZaksyRG5rclN5aXV4UlBya2RSMUg5ZnNvMFVySW1IQkpFTHR5VVl2dnphalduSE5kdHRsbzlVcFRHV2J6T3I0ZDNUNnZWZmNvZGIrTjAwMnF1VnM5Ti9tSXdWRU96VnFzd1EzSEtLTHpHakYzVlRYNDc5dzkzT2JGalhOSVVMNFlKREpFL05kZ3JkbWI1bDYwNk9OOTcyTEN2WXY5MmxHenh2SitCK2FPLzFGOENaRHo2STYzclR1WW0zek1abDkvY2ptTGZ0VHMrNnMwb2ROaDMxK2svUTMzcmp4Y0JXeG96MVp2NHlVR0hjSnZpYi9WMFZSUnRoalk5ck0vbDFZT004WTc3aXJqZEFPbXpPN0J3L2ErVGJzZmRQTFlXenBndEYrTjRxWE1pUldPR3FIdU01OFRQSys3MXkvdzgvVDczcGw0Q25hbXdNUkpuSHpiRFp6Z1g4bW04RE85ZnZlazRRWFRydStGUVExR2ZjYnZyOHR6RVZFbHZSQWRQV1MzbTh1a05WUlN5d3R0MU45NzhYZ1c5b1FQbUw4eTlWZjJwdzllMmVRdDFqWXFhRGQ3eXlGeTcveDB2K2p0dmJxb0x2Y29GN1Q3dzA3bXN6OE91N1UvRFdlRFozV2c1MTVqcm1BR2NUeitLOGVoelhPYlZzWGdjTXhqbUJUUnc0WDZYK0hWWTZOcEJtZFBEWnRZRUMyNXJGNVQreGlITHZNa21rZFJkZ2tYMWNGN3NVRGdyOEIwV3NRb3NLdHVzejViemNSYzZMMU52RWFnRFI4aG5wV3d3TWFjOC9ueGdiMlFZV3hKZmwzblk3V2YzWHZnWStaNHpDN0RqK3hWM1JyOVdyL0pNOENwd2RiOTM2QmNKWDhGODZRL3VTbzRWL0E0a25MK3ZnejFQa1ZydUo0UFI1VGtaOTZ2YUgzbDRWM0hyOFlONjFmMDhNSEYzMUZqT1dmV1grVFdLWnR6ZXlPZFl2Q0w5UHZJazhiL2RVNDBoWXhoNHVzQzFzM0UzaC9oSC9yRitkbkJUNThETUdnZ2U5dktMV3E4bnNqdjlIclpEQnNPVE9DZGRGZTY2VTZ3emRha0xySU1BUzNJVTc3UUhKczZPaDk1aStMcWNZMzVQajNra01wd2xITHlkM3ZuRmsyTkYvUDBZd3AyL2NZWE42Q1NlcDlnbitzSHV6SEtwak11UzNIcDlobnV6SGFUaW5UbGo5WGpPdU84TWVkMkdNYS94UFhHR0RQWEdDZFNidnJmdzYzZTBKK0hFM1hBMHNjMUhxT1BGY3RFdkJ2YUlqamtlMEhCYkhCdEdiUE5ZSDQ2THRDNGNVNVZqV0xpT0Y4RGU4TjFZMTV4RDY5SGZmMTk4L3BPVThQWWpvWXhJT3BqOUI1ZUIzU1FIcWF6SHFiN3I0Sm1NU1Zhdy9DbWVnWlNLdHVFajNacVc3QXRldFRPb1JUUkxOWnBLVzhXQWQwTHRsZ0xXcmJWaUdoaW9hOHovZzgyTGZMYUUrb0dJbFBmMDc3UTZsdmgzVVFjZ3VyaXlCWk5GOUhFdnhMc0o4aUo4L2tvWGhHTEdRSklSN0lqV3RONDk3YzhjOUt0dS9IOWEvTjl1MUNHTDBlYlgyK3VyOTRMYnQ2M3ZocGVRTktSNVR2QTAyemZCdFRvY3hTZDErSFNSM2UrMnc4Y01Ea09CWkNaNEEvTWlmeHFWUTRoa2lBbXJqazZ0UTFuTm5HOXpZczFQU256eWN2ZVNNSXBvYm9Na0wxTFp2YmppZUlCOVA2dlZndkdqT0NYZE9POGdKRVpLYWNDbGppdm16UWd3U2R4WlhLUlZLNnlkVlQvanM5aCtWSlZaM21zSThEN1FRaUFqRXhKbE5LZlAwdVI4RmtQQTdEaG12T09Peml0WWxOYmxzdVBvZGpiUWdTaC9xbTZ5K2g0MXR3Um1uT1FrbjVEMCtZeDhiMEtiVWM2UXVqQ240VUgvWlBSKys3VkFONm9kOHBMRUtTZXZHRmNQUHlKb1ZhQ1hnM3oxRTRNQ1dCSUFydlhuSHovL0ExV240T3JoRUFBQQ==",
  "test_daemon_start.py": "IiIiDQpUZXN0IHNjcmlwdCB0byB2ZXJpZnkgZGFlbW9uIGNhbiBzdGFydCBwcm9wZXJseS4NClJ1biB0aGlzIGRpcmVjdGx5IHRvIHNlZSB3aGF0IGVycm9ycyBvY2N1ci4NCiIiIg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQgc3VicHJvY2Vzcw0KaW1wb3J0IHRpbWUNCg0KIyBHZXQgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGlzIHNjcmlwdCBpcyBsb2NhdGVkDQpCQVNFX0RJUiA9IG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KREFFTU9OX1NDUklQVCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgIm11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weSIpDQpMT0NLX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb24ubG9jayIpDQpSRUFEWV9GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGFlbW9uLnJlYWR5IikNCg0KZGVmIGZpbmRfcHl0aG9uKCk6DQogICAgIiIiRmluZCBQeXRob24gZXhlY3V0YWJsZS4iIiINCiAgICAjIFRyeSBzeXMuZXhlY3V0YWJsZSBmaXJzdA0KICAgIGlmIHN5cy5leGVjdXRhYmxlIGFuZCBzeXMuZXhlY3V0YWJsZS5lbmRzd2l0aCgncHl0aG9uLmV4ZScpOg0KICAgICAgICByZXR1cm4gc3lzLmV4ZWN1dGFibGUNCiAgICANCiAgICAjIFRyeSBjb21tb24gbG9jYXRpb25zDQogICAgaW1wb3J0IHdpbnJlZw0KICAgIHRyeToNCiAgICAgICAga2V5ID0gd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfTE9DQUxfTUFDSElORSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTT0ZUV0FSRVxQeXRob25cUHl0aG9uQ29yZSIsIDAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lucmVnLktFWV9SRUFEIHwgd2lucmVnLktFWV9XT1c2NF82NEtFWSkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgdmVyc2lvbiA9IHdpbnJlZy5FbnVtS2V5KGtleSwgMCkNCiAgICAgICAgICAgIGluc3RhbGxfcGF0aF9rZXkgPSB3aW5yZWcuT3BlbktleShrZXksIGYie3ZlcnNpb259XFxJbnN0YWxsUGF0aCIpDQogICAgICAgICAgICBpbnN0YWxsX3BhdGggPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KGluc3RhbGxfcGF0aF9rZXksICIiKVswXQ0KICAgICAgICAgICAgcHl0aG9uX2V4ZSA9IG9zLnBhdGguam9pbihpbnN0YWxsX3BhdGgsICJweXRob24uZXhlIikNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBweXRob25fZXhlDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICANCiAgICAjIFRyeSBQQVRIDQogICAgdHJ5Og0KICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3doZXJlJywgJ3B5dGhvbiddLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MikNCiAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgPT0gMCBhbmQgcmVzdWx0LnN0ZG91dC5zdHJpcCgpOg0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5zdGRvdXQuc3RyaXAoKS5zcGxpdCgnXG4nKVswXQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcGFzcw0KICAgIA0KICAgIHJldHVybiBOb25lDQoNCmRlZiBtYWluKCk6DQogICAgcHJpbnQoIj0iICogNzApDQogICAgcHJpbnQoIkRBRU1PTiBTVEFSVFVQIFRFU1QiKQ0KICAgIHByaW50KCI9IiAqIDcwKQ0KICAgIHByaW50KGYiQmFzZSBkaXJlY3Rvcnk6IHtCQVNFX0RJUn0iKQ0KICAgIHByaW50KGYiRGFlbW9uIHNjcmlwdDoge0RBRU1PTl9TQ1JJUFR9IikNCiAgICBwcmludChmIlNjcmlwdCBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhEQUVNT05fU0NSSVBUKX0iKQ0KICAgIHByaW50KCkNCiAgICANCiAgICAjIENsZWFuIHVwIG9sZCBmaWxlcw0KICAgIGlmIG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6DQogICAgICAgIHByaW50KGYiUmVtb3Zpbmcgb2xkIGxvY2sgZmlsZToge0xPQ0tfRklMRX0iKQ0KICAgICAgICBvcy5yZW1vdmUoTE9DS19GSUxFKQ0KICAgIGlmIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOg0KICAgICAgICBwcmludChmIlJlbW92aW5nIG9sZCByZWFkeSBmaWxlOiB7UkVBRFlfRklMRX0iKQ0KICAgICAgICBvcy5yZW1vdmUoUkVBRFlfRklMRSkNCiAgICBwcmludCgpDQogICAgDQogICAgIyBGaW5kIFB5dGhvbg0KICAgIHB5dGhvbl9leGUgPSBmaW5kX3B5dGhvbigpDQogICAgaWYgbm90IHB5dGhvbl9leGU6DQogICAgICAgIHByaW50KCJFUlJPUjogQ291bGQgbm90IGZpbmQgUHl0aG9uIGV4ZWN1dGFibGUhIikNCiAgICAgICAgcmV0dXJuDQogICAgcHJpbnQoZiJQeXRob24gZXhlY3V0YWJsZToge3B5dGhvbl9leGV9IikNCiAgICBwcmludChmIlB5dGhvbiBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKX0iKQ0KICAgIHByaW50KCkNCiAgICANCiAgICAjIENoZWNrIGlmIHNjcmlwdCBleGlzdHMNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoREFFTU9OX1NDUklQVCk6DQogICAgICAgIHByaW50KGYiRVJST1I6IERhZW1vbiBzY3JpcHQgbm90IGZvdW5kOiB7REFFTU9OX1NDUklQVH0iKQ0KICAgICAgICByZXR1cm4NCiAgICANCiAgICAjIFRlc3QgUHl0aG9uIGNhbiBpbXBvcnQgcmVxdWlyZWQgbW9kdWxlcw0KICAgIHByaW50KCJUZXN0aW5nIFB5dGhvbiBpbXBvcnRzLi4uIikNCiAgICB0ZXN0X2ltcG9ydHMgPSBbDQogICAgICAgICJpbXBvcnQgc3lzIiwNCiAgICAgICAgImltcG9ydCBvcyIsDQogICAgICAgICJpbXBvcnQganNvbiIsDQogICAgICAgICJpbXBvcnQgdGltZSIsDQogICAgICAgICJpbXBvcnQgc3VicHJvY2VzcyIsDQogICAgICAgICJpbXBvcnQgcHN1dGlsIiwNCiAgICAgICAgImltcG9ydCBjdjIiLA0KICAgICAgICAiaW1wb3J0IG51bXB5IiwNCiAgICAgICAgImZyb20gUElMIGltcG9ydCBJbWFnZSIsDQogICAgICAgICJmcm9tIG1zcyBpbXBvcnQgbXNzIiwNCiAgICAgICAgImltcG9ydCBweXRlc3NlcmFjdCINCiAgICBdDQogICAgDQogICAgZm9yIGltcG9ydF9zdG10IGluIHRlc3RfaW1wb3J0czoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgW3B5dGhvbl9leGUsICItYyIsIGltcG9ydF9zdG10XSwNCiAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLA0KICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICB0aW1lb3V0PTUNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIOKckyB7aW1wb3J0X3N0bXR9IikNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIOKclyB7aW1wb3J0X3N0bXR9IC0gRXJyb3I6IHtyZXN1bHQuc3RkZXJyWzoxMDBdfSIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHByaW50KGYiICDinJcge2ltcG9ydF9zdG10fSAtIEV4Y2VwdGlvbjoge2V9IikNCiAgICBwcmludCgpDQogICAgDQogICAgIyBUcnkgdG8gcnVuIGRhZW1vbiBzY3JpcHQgZGlyZWN0bHkgKHdpbGwgc2hvdyBlcnJvcnMpDQogICAgcHJpbnQoIkF0dGVtcHRpbmcgdG8gc3RhcnQgZGFlbW9uICh3aWxsIHNob3cgYW55IGVycm9ycykuLi4iKQ0KICAgIHByaW50KCI9IiAqIDcwKQ0KICAgIHRyeToNCiAgICAgICAgcHJvY2VzcyA9IHN1YnByb2Nlc3MuUG9wZW4oDQogICAgICAgICAgICBbcHl0aG9uX2V4ZSwgREFFTU9OX1NDUklQVF0sDQogICAgICAgICAgICBjd2Q9QkFTRV9ESVIsDQogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLA0KICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuU1RET1VULA0KICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgYnVmc2l6ZT0xDQogICAgICAgICkNCiAgICAgICAgDQogICAgICAgICMgV2FpdCBhIGJpdCBhbmQgY2hlY2sgc3RhdHVzDQogICAgICAgIHRpbWUuc2xlZXAoMykNCiAgICAgICAgDQogICAgICAgIGlmIHByb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludCgi4pyTIERhZW1vbiBwcm9jZXNzIGlzIHJ1bm5pbmciKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoZiLinJcgRGFlbW9uIHByb2Nlc3MgZXhpdGVkIHdpdGggY29kZToge3Byb2Nlc3MucmV0dXJuY29kZX0iKQ0KICAgICAgICAgICAgc3Rkb3V0LCBfID0gcHJvY2Vzcy5jb21tdW5pY2F0ZSh0aW1lb3V0PTEpDQogICAgICAgICAgICBpZiBzdGRvdXQ6DQogICAgICAgICAgICAgICAgcHJpbnQoIlxuT3V0cHV0OiIpDQogICAgICAgICAgICAgICAgcHJpbnQoc3Rkb3V0WzoxMDAwXSkNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgZm9yIGxvY2sgZmlsZQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpOg0KICAgICAgICAgICAgcHJpbnQoZiLinJMgTG9jayBmaWxlIGNyZWF0ZWQ6IHtMT0NLX0ZJTEV9IikNCiAgICAgICAgICAgIHdpdGggb3BlbihMT0NLX0ZJTEUsICdyJykgYXMgZjoNCiAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpDQogICAgICAgICAgICBwcmludChmIiAgUElEIGluIGxvY2sgZmlsZToge3BpZH0iKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoZiLinJcgTG9jayBmaWxlIE5PVCBjcmVhdGVkOiB7TE9DS19GSUxFfSIpDQogICAgICAgIA0KICAgICAgICAjIENoZWNrIGZvciByZWFkeSBmaWxlDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOg0KICAgICAgICAgICAgcHJpbnQoZiLinJMgUmVhZHkgZmlsZSBjcmVhdGVkOiB7UkVBRFlfRklMRX0iKQ0KICAgICAgICAgICAgd2l0aCBvcGVuKFJFQURZX0ZJTEUsICdyJykgYXMgZjoNCiAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpDQogICAgICAgICAgICBwcmludChmIiAgUElEIGluIHJlYWR5IGZpbGU6IHtwaWR9IikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50KGYi4pyXIFJlYWR5IGZpbGUgTk9UIGNyZWF0ZWQ6IHtSRUFEWV9GSUxFfSIpDQogICAgICAgIA0KICAgICAgICAjIENoZWNrIGRlYnVnLmxvZw0KICAgICAgICBkZWJ1Z19sb2cgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhkZWJ1Z19sb2cpOg0KICAgICAgICAgICAgcHJpbnQoZiJcbuKckyBEZWJ1ZyBsb2cgZXhpc3RzOiB7ZGVidWdfbG9nfSIpDQogICAgICAgICAgICB3aXRoIG9wZW4oZGVidWdfbG9nLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoNCiAgICAgICAgICAgICAgICBsaW5lcyA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgICAgICAgICBwcmludChmIiAgTGFzdCAxMCBsaW5lczoiKQ0KICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIGxpbmVzWy0xMDpdOg0KICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICB7bGluZS5yc3RyaXAoKX0iKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoZiJcbuKclyBEZWJ1ZyBsb2cgTk9UIGNyZWF0ZWQ6IHtkZWJ1Z19sb2d9IikNCiAgICAgICAgDQogICAgICAgICMgU3RvcCB0aGUgZGFlbW9uDQogICAgICAgIGlmIHByb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludCgiXG5TdG9wcGluZyBkYWVtb24uLi4iKQ0KICAgICAgICAgICAgc3RvcF9maWxlID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiU1RPUCIpDQogICAgICAgICAgICB3aXRoIG9wZW4oc3RvcF9maWxlLCAndycpIGFzIGY6DQogICAgICAgICAgICAgICAgZi53cml0ZSgiIikNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkNCiAgICAgICAgICAgIGlmIHByb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgcHJvY2Vzcy50ZXJtaW5hdGUoKQ0KICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkNCiAgICAgICAgICAgICAgICBpZiBwcm9jZXNzLnBvbGwoKSBpcyBOb25lOg0KICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmtpbGwoKQ0KICAgICAgICANCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRVJST1IgcnVubmluZyBkYWVtb246IHtlfSIpDQogICAgICAgIGltcG9ydCB0cmFjZWJhY2sNCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgDQogICAgcHJpbnQoIlxuIiArICI9IiAqIDcwKQ0KICAgIHByaW50KCJURVNUIENPTVBMRVRFIikNCiAgICBwcmludCgiPSIgKiA3MCkNCg0KaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoNCiAgICBtYWluKCkNCg0K",
  "reset_death_counter.py": "IiIiDQpSZXNldCBEZWF0aCBDb3VudGVyDQpTaW1wbGUgc2NyaXB0IHRvIHJlc2V0IGFsbCBkZWF0aCBjb3VudHMgdG8gMC4NCldvcmtzIHdpdGggYW55IGluc3RhbGxhdGlvbiBsb2NhdGlvbi4NCiIiIg0KDQppbXBvcnQgb3MNCmltcG9ydCBzeXMNCmltcG9ydCBqc29uDQoNCiMgR2V0IHRoZSBkaXJlY3Rvcnkgd2hlcmUgdGhpcyBzY3JpcHQgaXMgbG9jYXRlZCAod29ya3MgZm9yIGJvdGggLmV4ZSBhbmQgLnB5KQ0KZGVmIGdldF9iYXNlX2RpcigpOg0KICAgICIiIkdldCB0aGUgYmFzZSBkaXJlY3RvcnkgLSBzYW1lIGZvbGRlciBhcyB0aGlzIHNjcmlwdC4iIiINCiAgICBpZiBnZXRhdHRyKHN5cywgJ2Zyb3plbicsIEZhbHNlKToNCiAgICAgICAgIyBSdW5uaW5nIGFzIGNvbXBpbGVkIC5leGUgLSB1c2UgdGhlIGRpcmVjdG9yeSB3aGVyZSAuZXhlIGlzIGxvY2F0ZWQNCiAgICAgICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoc3lzLmV4ZWN1dGFibGUpKQ0KICAgIGVsc2U6DQogICAgICAgICMgUnVubmluZyBhcyBzY3JpcHQgLSB1c2UgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGUgc2NyaXB0IGlzIGxvY2F0ZWQNCiAgICAgICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KDQpCQVNFX0RJUiA9IGdldF9iYXNlX2RpcigpDQpTVEFURV9KU09OID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVhdGhfc3RhdGUuanNvbiIpDQpERUFUSF9UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9jb3VudGVyLnR4dCIpDQoNCg0KZGVmIHJlc2V0X2RlYXRocygpOg0KICAgICIiIlJlc2V0IGFsbCBkZWF0aCBjb3VudHMgdG8gMC4iIiINCiAgICBwcmludCgiPSIgKiA2MCkNCiAgICBwcmludCgiUkVTRVQgREVBVEggQ09VTlRFUiIpDQogICAgcHJpbnQoIj0iICogNjApDQogICAgcHJpbnQoZiJJbnN0YWxsYXRpb24gZm9sZGVyOiB7QkFTRV9ESVJ9IikNCiAgICBwcmludCgpDQogICAgDQogICAgIyBSZXNldCBzdGF0ZSBKU09ODQogICAgaWYgb3MucGF0aC5leGlzdHMoU1RBVEVfSlNPTik6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgTG9hZCBleGlzdGluZyBzdGF0ZSB0byBwcmVzZXJ2ZSBnYW1lIGxpc3Qgc3RydWN0dXJlDQogICAgICAgICAgICB3aXRoIG9wZW4oU1RBVEVfSlNPTiwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgIG9sZF9zdGF0ZSA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENyZWF0ZSBuZXcgc3RhdGUgd2l0aCB6ZXJvcyBidXQgcHJlc2VydmUgZ2FtZSBzdHJ1Y3R1cmUNCiAgICAgICAgICAgIG5ld19zdGF0ZSA9IHsNCiAgICAgICAgICAgICAgICAidG90YWxfZGVhdGhzIjogMCwNCiAgICAgICAgICAgICAgICAiZ2FtZV9kZWF0aHMiOiB7fSwNCiAgICAgICAgICAgICAgICAidGljayI6IG9sZF9zdGF0ZS5nZXQoInRpY2siLCAwKSwgICMgS2VlcCB0aWNrIGNvdW50DQogICAgICAgICAgICAgICAgInN0cmVhayI6IDAsDQogICAgICAgICAgICAgICAgImxhc3RfZGVhdGhfdHMiOiAwLjAsDQogICAgICAgICAgICAgICAgImN1cnJlbnRfZ2FtZSI6IG9sZF9zdGF0ZS5nZXQoImN1cnJlbnRfZ2FtZSIsIE5vbmUpLA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFByZXNlcnZlIGdhbWUgbmFtZXMgZnJvbSBvbGQgc3RhdGUsIHNldCBhbGwgdG8gMA0KICAgICAgICAgICAgaWYgImdhbWVfZGVhdGhzIiBpbiBvbGRfc3RhdGU6DQogICAgICAgICAgICAgICAgZm9yIGdhbWVfbmFtZSBpbiBvbGRfc3RhdGVbImdhbWVfZGVhdGhzIl0ua2V5cygpOg0KICAgICAgICAgICAgICAgICAgICBuZXdfc3RhdGVbImdhbWVfZGVhdGhzIl1bZ2FtZV9uYW1lXSA9IDANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBXcml0ZSBuZXcgc3RhdGUNCiAgICAgICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAganNvbi5kdW1wKG5ld19zdGF0ZSwgZiwgaW5kZW50PTIpDQogICAgICAgICAgICBwcmludChmIuKckyBSZXNldCBzdGF0ZSBmaWxlOiB7bGVuKG5ld19zdGF0ZVsnZ2FtZV9kZWF0aHMnXSl9IGdhbWVzIHJlc2V0IHRvIDAiKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBwcmludChmIuKclyBFcnJvciByZXNldHRpbmcgc3RhdGUgZmlsZToge2V9IikNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgIGVsc2U6DQogICAgICAgIHByaW50KCLihLkgTm8gc3RhdGUgZmlsZSBmb3VuZCAod2lsbCBiZSBjcmVhdGVkIG9uIGZpcnN0IHJ1bikiKQ0KICAgIA0KICAgICMgUmVzZXQgbWFpbiB0ZXh0IGZpbGUNCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihERUFUSF9UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoIjAiKQ0KICAgICAgICBwcmludCgi4pyTIFJlc2V0IG1haW4gdGV4dCBmaWxlIHRvIDAiKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiLinJcgRXJyb3IgcmVzZXR0aW5nIG1haW4gdGV4dCBmaWxlOiB7ZX0iKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICAjIERlbGV0ZSBwZXItZ2FtZSB0ZXh0IGZpbGVzDQogICAgdHJ5Og0KICAgICAgICBkZWxldGVkX2NvdW50ID0gMA0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhCQVNFX0RJUik6DQogICAgICAgICAgICBmb3IgZmlsZW5hbWUgaW4gb3MubGlzdGRpcihCQVNFX0RJUik6DQogICAgICAgICAgICAgICAgaWYgZmlsZW5hbWUuc3RhcnRzd2l0aCgiZGVhdGhfY291bnRlcl8iKSBhbmQgZmlsZW5hbWUuZW5kc3dpdGgoIi50eHQiKSBhbmQgZmlsZW5hbWUgIT0gImRlYXRoX2NvdW50ZXIudHh0IjoNCiAgICAgICAgICAgICAgICAgICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsIGZpbGVuYW1lKQ0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoZmlsZXBhdGgpDQogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkX2NvdW50ICs9IDENCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBpZiBkZWxldGVkX2NvdW50ID4gMDoNCiAgICAgICAgICAgIHByaW50KGYi4pyTIERlbGV0ZWQge2RlbGV0ZWRfY291bnR9IHBlci1nYW1lIHRleHQgZmlsZShzKSIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIuKaoCBDb3VsZCBub3QgY2xlYW4gdXAgcGVyLWdhbWUgZmlsZXM6IHtlfSIpDQogICAgDQogICAgcHJpbnQoKQ0KICAgIHByaW50KCI9IiAqIDYwKQ0KICAgIHByaW50KCJTVUNDRVNTISBBbGwgZGVhdGggY291bnRzIHJlc2V0IHRvIDAuIikNCiAgICBwcmludCgiPSIgKiA2MCkNCiAgICBwcmludCgpDQogICAgcHJpbnQoIk5vdGU6IFRoZSBkYWVtb24gd2lsbCBhdXRvbWF0aWNhbGx5IHBpY2sgdXAgdGhlIGNoYW5nZXMuIikNCiAgICBwcmludCgiICAgICAgTm8gbmVlZCB0byByZXN0YXJ0IHRoZSBkYWVtb24uIikNCiAgICANCiAgICByZXR1cm4gVHJ1ZQ0KDQoNCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgdHJ5Og0KICAgICAgICBzdWNjZXNzID0gcmVzZXRfZGVhdGhzKCkNCiAgICAgICAgaWYgbm90IHN1Y2Nlc3M6DQogICAgICAgICAgICBwcmludCgiXG5QcmVzcyBFbnRlciB0byBleGl0Li4uIikNCiAgICAgICAgICAgIGlucHV0KCkNCiAgICAgICAgICAgIHN5cy5leGl0KDEpDQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0Og0KICAgICAgICBwcmludCgiXG5cblJlc2V0IGNhbmNlbGxlZC4iKQ0KICAgICAgICBzeXMuZXhpdCgxKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJcbuKclyBVbmV4cGVjdGVkIGVycm9yOiB7ZX0iKQ0KICAgICAgICBwcmludCgiXG5QcmVzcyBFbnRlciB0byBleGl0Li4uIikNCiAgICAgICAgaW5wdXQoKQ0KICAgICAgICBzeXMuZXhpdCgxKQ0KDQo=",
  "RESET_DEATH_COUNTER.bat": "QGVjaG8gb2ZmDQpSRU0gUmVzZXQgRGVhdGggQ291bnRlcg0KUkVNIFRoaXMgYmF0Y2ggZmlsZSByZXNldHMgYWxsIGRlYXRoIGNvdW50cyB0byAwDQoNCmNkIC9kICIlfmRwMCINCnB5dGhvbiByZXNldF9kZWF0aF9jb3VudGVyLnB5DQppZiBlcnJvcmxldmVsIDEgKA0KICAgIGVjaG8uDQogICAgZWNobyBQcmVzcyBhbnkga2V5IHRvIGV4aXQuLi4NCiAgICBwYXVzZSA+bnVsDQopDQoNCg=="
}

# Get the directory where the installer is located (works for both .exe and .py)
def get_install_dir():
    """Get the installation directory - same folder as the installer executable."""
    if getattr(sys, 'frozen', False):
        # Running as compiled .exe - use the directory where .exe is located
        return os.path.dirname(os.path.abspath(sys.executable))
    else:
        # Running as script - use the directory where the script is located
        return os.path.dirname(os.path.abspath(__file__))

INSTALL_DIR = get_install_dir()

def extract_files():
    """Extract all embedded files."""
    extracted = []
    os.makedirs(INSTALL_DIR, exist_ok=True)
    
    for filename, content_b64 in EMBEDDED_FILES.items():
        try:
            content = base64.b64decode(content_b64)
            filepath = os.path.join(INSTALL_DIR, filename)
            
            # Write file
            with open(filepath, 'wb') as f:
                f.write(content)
            
            extracted.append(filepath)
            print(f"Extracted: {filename}")
        except Exception as e:
            print(f"Error extracting {filename}: {e}")
    
    return extracted

def find_python_executable(use_pythonw=False):
    """Find the actual Python executable (not the installer exe).
    Comprehensive search for general public use.
    If use_pythonw=True, searches for pythonw.exe (no console window)."""
    # If running as a script (not frozen), use sys.executable
    if not getattr(sys, 'frozen', False):
        if use_pythonw:
            # Try to find pythonw.exe in the same directory as python.exe
            python_dir = os.path.dirname(sys.executable)
            pythonw_exe = os.path.join(python_dir, "pythonw.exe")
            if os.path.exists(pythonw_exe):
                return pythonw_exe
            return sys.executable  # Fallback to python.exe
        return sys.executable
    
    exe_name = "pythonw.exe" if use_pythonw else "python.exe"
    command_name = "pythonw" if use_pythonw else "python"
    
    # If running as PyInstaller exe, we need to find Python
    # Method 1: Try command (if in PATH) - most reliable
    if not use_pythonw:  # pythonw is rarely in PATH
        try:
            result = subprocess.run([command_name, '--version'], 
                                  capture_output=True, text=True, timeout=2)
            if result.returncode == 0:
                return command_name
        except:
            pass
    
    # Method 2: Try 'py' launcher (Windows Python launcher) - also reliable
    if not use_pythonw:  # py launcher doesn't support pythonw directly
        try:
            result = subprocess.run(['py', '--version'], 
                                  capture_output=True, text=True, timeout=2)
            if result.returncode == 0:
                return 'py'
        except:
            pass
    
    # Method 3: Search Windows Registry for Python installations
    try:
        import winreg
        # Check both 32-bit and 64-bit registry
        for arch in [winreg.KEY_WOW64_64KEY, winreg.KEY_WOW64_32KEY]:
            try:
                # Check HKEY_LOCAL_MACHINE
                key = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, 
                                    r"SOFTWARE\Python\PythonCore", 0,
                                    winreg.KEY_READ | arch)
                try:
                    # Get all installed Python versions
                    i = 0
                    while True:
                        try:
                            version = winreg.EnumKey(key, i)
                            install_path_key = winreg.OpenKey(key, rf"{version}\InstallPath")
                            try:
                                install_path = winreg.QueryValueEx(install_path_key, "")[0]
                                python_exe = os.path.join(install_path, exe_name)
                                if os.path.exists(python_exe):
                                    winreg.CloseKey(install_path_key)
                                    winreg.CloseKey(key)
                                    return python_exe
                                # If pythonw.exe not found, try python.exe as fallback
                                if use_pythonw:
                                    python_exe = os.path.join(install_path, "python.exe")
                                    if os.path.exists(python_exe):
                                        winreg.CloseKey(install_path_key)
                                        winreg.CloseKey(key)
                                        return python_exe
                                winreg.CloseKey(install_path_key)
                            except:
                                pass
                            i += 1
                        except OSError:
                            break
                    winreg.CloseKey(key)
                except:
                    try:
                        winreg.CloseKey(key)
                    except:
                        pass
            except:
                pass
    except:
        pass
    
    # Method 4: Search common installation locations
    userprofile = os.getenv('USERPROFILE', '')
    programfiles = os.getenv('ProgramFiles', r'C:\Program Files')
    programfiles_x86 = os.getenv('ProgramFiles(x86)', r'C:\Program Files (x86)')
    
    search_paths = []
    
    # User AppData locations (most common for Python 3.8+)
    if userprofile:
        appdata_local = os.path.join(userprofile, r"AppData\Local\Programs\Python")
        if os.path.exists(appdata_local):
            # Search all Python versions in this directory
            try:
                for item in os.listdir(appdata_local):
                    python_dir = os.path.join(appdata_local, item)
                    if os.path.isdir(python_dir):
                        python_exe = os.path.join(python_dir, exe_name)
                        if os.path.exists(python_exe):
                            search_paths.append(python_exe)
                        # If pythonw.exe not found, try python.exe as fallback
                        elif use_pythonw:
                            python_exe = os.path.join(python_dir, "python.exe")
                            if os.path.exists(python_exe):
                                search_paths.append(python_exe)
            except:
                pass
    
    # Common root-level Python installations
    for version in ['312', '311', '310', '39', '38']:
        search_paths.extend([
            os.path.join(r"C:\Python" + version, exe_name),
            os.path.join(programfiles, f"Python{version}", exe_name),
            os.path.join(programfiles_x86, f"Python{version}", exe_name),
        ])
        # If pythonw.exe not found, add python.exe as fallback
        if use_pythonw:
            search_paths.extend([
                os.path.join(r"C:\Python" + version, "python.exe"),
                os.path.join(programfiles, f"Python{version}", "python.exe"),
                os.path.join(programfiles_x86, f"Python{version}", "python.exe"),
            ])
    
    # Check all collected paths
    for path in search_paths:
        if os.path.exists(path):
            return path
    
    # Method 5: Recursive search in Program Files (last resort, slower)
    try:
        for root_dir in [programfiles, programfiles_x86]:
            if os.path.exists(root_dir):
                for root, dirs, files in os.walk(root_dir):
                    # Limit depth to avoid slow searches
                    depth = root[len(root_dir):].count(os.sep)
                    if depth > 2:  # Max 2 levels deep
                        dirs[:] = []  # Don't recurse deeper
                        continue
                    
                    if exe_name in files or (use_pythonw and 'python.exe' in files):
                        python_exe = os.path.join(root, exe_name if exe_name in files else 'python.exe')
                        # Verify it's actually Python
                        try:
                            result = subprocess.run([python_exe, '--version'], 
                                                  capture_output=True, timeout=1)
                            if result.returncode == 0:
                                return python_exe
                        except:
                            pass
    except:
        pass
    
    return None

def check_python():
    """Check if Python is installed."""
    python_exe = find_python_executable()
    if not python_exe:
        return False, None
    
    try:
        result = subprocess.run([python_exe, '--version'], 
                              capture_output=True, text=True, timeout=5)
        return True, result.stdout.strip()
    except:
        return False, None

def check_tesseract():
    """Check if Tesseract OCR is installed."""
    default_path = r"C:\Program Files\Tesseract-OCR\tesseract.exe"
    if os.path.exists(default_path):
        return True, default_path
    try:
        result = subprocess.run(['tesseract', '--version'], 
                              capture_output=True, text=True, timeout=5)
        if result.returncode == 0:
            return True, "tesseract"
    except:
        pass
    return False, None

def find_tesseract_tessdata():
    """Find the Tesseract tessdata directory."""
    tesseract_paths = [
        r"C:\Program Files\Tesseract-OCR\tessdata",
        r"C:\Program Files (x86)\Tesseract-OCR\tessdata",
    ]
    for path in tesseract_paths:
        if os.path.exists(path):
            return path
    return None

def check_japanese_lang_pack():
    """Check if Japanese language pack is installed."""
    tessdata_dir = find_tesseract_tessdata()
    if not tessdata_dir:
        return False
    jpn_file = os.path.join(tessdata_dir, "jpn.traineddata")
    jpn_vert_file = os.path.join(tessdata_dir, "jpn_vert.traineddata")
    return os.path.exists(jpn_file) and os.path.exists(jpn_vert_file)

def download_japanese_lang_pack(log_callback=None):
    """Download Japanese language pack for Tesseract with multiple fallbacks.
    
    Args:
        log_callback: Optional function to call for logging messages (takes a string)
    
    Returns:
        tuple: (success: bool, message: str)
    """
    def log(msg):
        if log_callback:
            log_callback(msg)
    
    tessdata_dir = find_tesseract_tessdata()
    if not tessdata_dir:
        return False, "Tesseract tessdata directory not found"
    
    urls = {
        "jpn.traineddata": "https://github.com/tesseract-ocr/tessdata/raw/main/jpn.traineddata",
        "jpn_vert.traineddata": "https://github.com/tesseract-ocr/tessdata/raw/main/jpn_vert.traineddata",
    }
    
    import ssl
    import shutil
    
    log("Downloading Japanese language packs for Tesseract...")
    log("Note: Japanese packs are required for reliable Sekiro detection (Japanese '' character)")
    
    temp_dir = tempfile.mkdtemp()
    
    try:
        # Download files to temp directory first (no admin needed)
        files_to_download = []
        for filename, url in urls.items():
            target_file = os.path.join(tessdata_dir, filename)
            if not os.path.exists(target_file):
                files_to_download.append((filename, url))
        
        if not files_to_download:
            log("Japanese language packs already installed.")
            return True, "Japanese pack already installed"
        
        # Attempt 1: Standard urllib with SSL verification
        log("Attempt 1: Downloading to temp with standard SSL verification...")
        attempt1_success = {}
        for filename, url in files_to_download:
            temp_file = os.path.join(temp_dir, filename)
            try:
                import urllib.request
                # Use urlopen for better compatibility
                with urllib.request.urlopen(url) as response:
                    with open(temp_file, 'wb') as out_file:
                        shutil.copyfileobj(response, out_file)
                attempt1_success[filename] = True
            except Exception as e1:
                attempt1_success[filename] = False
                log(f"Attempt 1 failed for {filename}: {e1}")
        
        # If attempt 1 failed for any files, try attempt 2
        failed_files = [f for f, success in attempt1_success.items() if not success]
        if failed_files:
            attempt_num = 2
            log(f"Attempt {attempt_num}: Downloading to temp with relaxed SSL (ignoring certificate validation)...")
            attempt2_success = {}
            for filename, url in files_to_download:
                if filename in failed_files:
                    temp_file = os.path.join(temp_dir, filename)
                    try:
                        # Use urlopen with context instead of urlretrieve (more compatible)
                        ssl_context = ssl.create_default_context()
                        ssl_context.check_hostname = False
                        ssl_context.verify_mode = ssl.CERT_NONE
                        with urllib.request.urlopen(url, context=ssl_context) as response:
                            with open(temp_file, 'wb') as out_file:
                                shutil.copyfileobj(response, out_file)
                        attempt2_success[filename] = True
                    except Exception as e2:
                        attempt2_success[filename] = False
                        log(f"Attempt {attempt_num} failed for {filename}: {e2}")
                        # Attempt 3: PowerShell Invoke-WebRequest with -SkipCertificateCheck (non-elevated)
                        attempt_num = 3
                        log(f"Attempt {attempt_num}: Downloading with PowerShell (bypassing certificate check)...")
                        try:
                            ps_cmd = f'Invoke-WebRequest -Uri "{url}" -OutFile "{temp_file}" -SkipCertificateCheck'
                            result = subprocess.run(
                                ['powershell', '-Command', ps_cmd],
                                capture_output=True,
                                timeout=60
                            )
                            if result.returncode == 0 and os.path.exists(temp_file):
                                attempt2_success[filename] = True
                            else:
                                attempt2_success[filename] = False
                                log(f"Attempt {attempt_num} failed for {filename}: PowerShell returned code {result.returncode}")
                                # Attempt 4: Elevated PowerShell download (downloads to temp, then copies)
                                attempt_num = 4
                                log(f"Attempt {attempt_num}: Downloading with elevated PowerShell (staged download)...")
                                try:
                                    # Download to temp with elevated PowerShell
                                    ps_cmd = f'Start-Process powershell -ArgumentList "-Command", "Invoke-WebRequest -Uri \'{url}\' -OutFile \'{temp_file}\' -SkipCertificateCheck" -Verb RunAs -Wait'
                                    result = subprocess.run(
                                        ['powershell', '-Command', ps_cmd],
                                        capture_output=True,
                                        timeout=90
                                    )
                                    if result.returncode == 0 and os.path.exists(temp_file):
                                        attempt2_success[filename] = True
                                    else:
                                        attempt2_success[filename] = False
                                        log(f"Attempt {attempt_num} failed for {filename}: Elevated PowerShell returned code {result.returncode}")
                                except Exception as e4:
                                    attempt2_success[filename] = False
                                    log(f"Attempt {attempt_num} failed for {filename}: {e4}")
                        except Exception as e3:
                            attempt2_success[filename] = False
                            log(f"Attempt {attempt_num} failed for {filename}: {e3}")
                else:
                    attempt2_success[filename] = True  # Already downloaded in attempt 1
            
            # Check if all files downloaded successfully
            all_success = all(attempt2_success.get(f, False) for f, _ in files_to_download)
            if all_success:
                log(f"Downloaded to temp successfully (Attempt 2 - unverified SSL)")
            else:
                failed = [f for f, success in attempt2_success.items() if not success]
                return False, f"Failed to download: {', '.join(failed)}"
        else:
            # All files downloaded in attempt 1
            log("Downloaded to temp successfully (Attempt 1 - standard SSL)")
        
        # Copy files from temp to tessdata (may need elevation)
        log("Attempting elevated copy (UAC prompt) to install Japanese packs...")
        elevation_used = False
        for filename in urls.keys():
            temp_file = os.path.join(temp_dir, filename)
            target_file = os.path.join(tessdata_dir, filename)
            
            if not os.path.exists(temp_file):
                continue
            
            try:
                shutil.copy2(temp_file, target_file)
            except PermissionError:
                # Attempt elevated PowerShell copy
                elevation_used = True
                try:
                    ps_cmd = f'Start-Process powershell -ArgumentList "-Command", "Copy-Item -Path \'{temp_file}\' -Destination \'{target_file}\' -Force" -Verb RunAs -Wait'
                    result = subprocess.run(
                        ['powershell', '-Command', ps_cmd],
                        capture_output=True,
                        timeout=30
                    )
                    if not os.path.exists(target_file):
                        return False, f"Permission denied copying {filename}"
                except Exception as e:
                    return False, f"Permission denied copying {filename}: {e}"
        
        if elevation_used:
            log("Japanese language packs installed via elevated copy. Sekiro detection is now fully supported!")
        
        log("Japanese pack downloaded successfully! Sekiro detection is now fully supported!")
        return True, "Japanese pack downloaded successfully"
    
    except Exception as e:
        log(f"Error during download: {e}")
        return False, str(e)
    finally:
        # Clean up temp directory
        try:
            shutil.rmtree(temp_dir, ignore_errors=True)
        except:
            pass

def install_dependencies():
    """Install Python dependencies."""
    python_exe = find_python_executable()
    if not python_exe:
        return False
    
    try:
        packages = ['mss', 'pillow', 'pytesseract', 'opencv-python', 'numpy', 'psutil']
        subprocess.run([python_exe, '-m', 'pip', 'install', '--upgrade', 'pip'], 
                      check=False, capture_output=True)
        subprocess.run([python_exe, '-m', 'pip', 'install'] + packages, 
                      check=True, capture_output=True)
        return True
    except subprocess.CalledProcessError as e:
        return False

class InstallerGUI:
    def __init__(self, root):
        self.root = root
        self.root.title("Death Counter - Installer & Launcher")
        self.root.geometry("850x650")
        self.root.resizable(False, False)
        
        self.setup_complete = False
        self.streamerbot_imported = False
        self.create_ui()
        self.check_system()
    
    def create_ui(self):
        main_frame = ttk.Frame(self.root, padding="20")
        main_frame.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))
        
        title = ttk.Label(main_frame, text="Death Counter", 
                         font=("Arial", 18, "bold"))
        title.grid(row=0, column=0, columnspan=2, pady=(0, 20))
        
        status_frame = ttk.LabelFrame(main_frame, text="System Check", padding="10")
        status_frame.grid(row=1, column=0, columnspan=2, sticky=(tk.W, tk.E), pady=(0, 10))
        
        self.python_status = ttk.Label(status_frame, text="Checking Python...")
        self.python_status.grid(row=0, column=0, sticky=tk.W, pady=2)
        
        self.tesseract_status = ttk.Label(status_frame, text="Checking Tesseract OCR...")
        self.tesseract_status.grid(row=1, column=0, sticky=tk.W, pady=2)
        
        self.deps_status = ttk.Label(status_frame, text="Checking dependencies...")
        self.deps_status.grid(row=2, column=0, sticky=tk.W, pady=2)
        
        self.japanese_pack_status = ttk.Label(status_frame, text="Checking Japanese pack...")
        self.japanese_pack_status.grid(row=3, column=0, sticky=tk.W, pady=2)
        
        log_frame = ttk.LabelFrame(main_frame, text="Log", padding="10")
        log_frame.grid(row=2, column=0, columnspan=2, sticky=(tk.W, tk.E, tk.N, tk.S), pady=(0, 10))
        main_frame.rowconfigure(2, weight=1)
        
        self.log_text = scrolledtext.ScrolledText(log_frame, height=10, width=80)
        self.log_text.pack(fill=tk.BOTH, expand=True)
        
        # First row of buttons
        button_frame1 = ttk.Frame(main_frame)
        button_frame1.grid(row=3, column=0, columnspan=2, pady=(0, 5))
        
        self.install_button = ttk.Button(button_frame1, text="Install/Update Files", 
                                         command=self.install_files, width=22)
        self.install_button.pack(side=tk.LEFT, padx=3)
        
        self.install_python_button = ttk.Button(button_frame1, text="Install Python", 
                                               command=self.install_python, width=22)
        self.install_python_button.pack(side=tk.LEFT, padx=3)
        
        self.install_tesseract_button = ttk.Button(button_frame1, text="Install Tesseract", 
                                                   command=self.install_tesseract, width=22)
        self.install_tesseract_button.pack(side=tk.LEFT, padx=3)
        
        self.install_deps_button = ttk.Button(button_frame1, text="Install Dependencies", 
                                              command=self.install_deps, width=22)
        self.install_deps_button.pack(side=tk.LEFT, padx=3)
        
        # Second row of buttons
        button_frame2 = ttk.Frame(main_frame)
        button_frame2.grid(row=4, column=0, columnspan=2, pady=(0, 10))
        
        self.streamerbot_download_button = ttk.Button(button_frame2, text="Streamer.bot Download", 
                                                      command=self.download_streamerbot, width=22)
        self.streamerbot_download_button.pack(side=tk.LEFT, padx=3)
        
        self.streamerbot_import_button = ttk.Button(button_frame2, text="Import to Streamer.bot", 
                                                    command=self.import_streamerbot, width=22)
        self.streamerbot_import_button.pack(side=tk.LEFT, padx=3)
        
        self.confirm_import_button = ttk.Button(button_frame2, text=" Confirm Import", 
                                                command=self.confirm_import, width=22, state=tk.DISABLED)
        self.confirm_import_button.pack(side=tk.LEFT, padx=3)
        
        self.launch_button = ttk.Button(button_frame2, text="Launch Death Counter", 
                                       command=self.launch_app, width=22, state=tk.DISABLED)
        self.launch_button.pack(side=tk.LEFT, padx=3)
        
        info_text = ("1. Click 'Install/Update Files' to extract all files (auto-downloads Japanese pack for Sekiro)\n"
                    "2. Click 'Install Dependencies' to install Python packages\n"
                    "3. Install Tesseract OCR from: https://github.com/UB-Mannheim/tesseract/wiki\n"
                    "4. Click 'Streamer.bot Download' to download and install Streamer.bot (optional)\n"
                    "5. Click 'Import to Streamer.bot' and import the action file, then click 'Confirm Import' (optional)\n"
                    "6. Click 'Launch Death Counter' to start")
        info_label = ttk.Label(main_frame, text=info_text, justify=tk.LEFT)
        info_label.grid(row=5, column=0, columnspan=2, sticky=tk.W)
    
    def log(self, message):
        self.log_text.insert(tk.END, message + "\n")
        self.log_text.see(tk.END)
        self.root.update()
    
    def check_system(self):
        python_ok, python_version = check_python()
        if python_ok:
            self.python_status.config(text=f" Python: {python_version}", foreground="green")
        else:
            self.python_status.config(text=" Python not found", foreground="red")
        
        tesseract_ok, tesseract_path = check_tesseract()
        if tesseract_ok:
            self.tesseract_status.config(text=" Tesseract OCR: Found", foreground="green")
            # Check Japanese pack if Tesseract is found
            try:
                if check_japanese_lang_pack():
                    self.japanese_pack_status.config(text=" Japanese Pack: Installed (Sekiro support)", foreground="green")
                else:
                    self.japanese_pack_status.config(text=" Japanese Pack: Not found (auto-download on install)", foreground="orange")
            except Exception as e:
                self.japanese_pack_status.config(text=" Japanese Pack: Error checking status", foreground="orange")
                self.log(f"Error checking Japanese pack: {e}")
        else:
            self.tesseract_status.config(text=" Tesseract OCR: Not found (install from link below)", foreground="orange")
            self.japanese_pack_status.config(text=" Japanese Pack: Tesseract required", foreground="gray")
        
        try:
            import mss
            import cv2
            import pytesseract
            import psutil
            self.deps_status.config(text=" Dependencies: Installed", foreground="green")
        except ImportError:
            self.deps_status.config(text=" Dependencies: Not installed", foreground="red")
        
        gui_path = os.path.join(INSTALL_DIR, "death_counter_gui.py")
        cs_file_path = os.path.join(INSTALL_DIR, "deathcounteraction.cs")
        if os.path.exists(gui_path):
            self.setup_complete = True
            if os.path.exists(cs_file_path):
                self.log("Files already installed. Import to Streamer.bot to enable launch button.")
                # Enable Confirm Import button if action file exists
                self.confirm_import_button.config(state=tk.NORMAL)
            else:
                self.log("Files already installed. Ready to launch!")
                self.update_launch_button_state()
        else:
            self.log("Files not yet installed. Click 'Install/Update Files' first.")
    
    def update_launch_button_state(self):
        """Update launch button state based on setup completion and Streamer.bot import status."""
        if self.setup_complete:
            if self.streamerbot_imported:
                self.launch_button.config(state=tk.NORMAL)
            else:
                cs_file_path = os.path.join(INSTALL_DIR, "deathcounteraction.cs")
                if not os.path.exists(cs_file_path):
                    # If no Streamer.bot action file, allow launch without import
                    self.launch_button.config(state=tk.NORMAL)
                else:
                    # Action file exists, require import confirmation
                    self.launch_button.config(state=tk.DISABLED)
    
    def install_python(self):
        """Open Python download page."""
        self.log("Opening Python download page...")
        webbrowser.open("https://www.python.org/downloads/")
        self.log("Python download page opened. After installing, restart this installer.")
        messagebox.showinfo("Python Installation", 
                          "After installing Python, please:\n"
                          "1. Check 'Add Python to PATH' during installation\n"
                          "2. Restart this installer")
    
    def install_tesseract(self):
        """Open Tesseract OCR download page."""
        self.log("Opening Tesseract OCR download page...")
        webbrowser.open("https://github.com/UB-Mannheim/tesseract/wiki")
        self.log("Tesseract OCR download page opened.")
        messagebox.showinfo("Tesseract OCR Installation", 
                          "Default install path: C:\\Program Files\\Tesseract-OCR\\\n"
                          "After installing, restart this installer.")
    
    def download_streamerbot(self):
        """Open Streamer.bot download page."""
        self.log("Opening Streamer.bot download page...")
        webbrowser.open("https://streamer.bot/")
        self.log("Streamer.bot download page opened.")
    
    def import_streamerbot(self):
        """Open file location for Streamer.bot action file."""
        cs_file_path = os.path.join(INSTALL_DIR, "deathcounteraction.cs")
        if not os.path.exists(cs_file_path):
            self.log("Action file not found. Please install files first.")
            messagebox.showerror("Error", 
                               "The action file has not been extracted yet.\n\n"
                               "Please click 'Install/Update Files' first to extract all files.")
            return
        
        # Open the file location in Explorer
        try:
            subprocess.Popen(f'explorer /select,"{cs_file_path}"')
            self.log("Opened file location: {cs_file_path}")
            self.log("Streamer.bot import instructions displayed.")
            # Enable the Confirm Import button after showing instructions
            self.confirm_import_button.config(state=tk.NORMAL)
            messagebox.showinfo("Import to Streamer.bot", 
                              "1. In Streamer.bot, go to Actions\n"
                              "2. Click 'Import'\n"
                              "3. Select the deathcounteraction.cs file\n"
                              "4. After importing, click 'Confirm Import' button")
        except Exception as e:
            self.log(f"Error opening file location: {e}")
            messagebox.showerror("Error", f"Could not open file location: {e}")
    
    def confirm_import(self):
        """Confirm that Streamer.bot action has been imported."""
        self.streamerbot_imported = True
        self.confirm_import_button.config(state=tk.DISABLED)
        self.update_launch_button_state()
        self.log("Streamer.bot import confirmed! Launch button enabled.")
        messagebox.showinfo("Import Confirmed", "Streamer.bot import confirmed. You can now launch the Death Counter!")
    
    def install_files(self):
        self.log("Installing files...")
        self.install_button.config(state=tk.DISABLED)
        
        def do_install():
            try:
                extracted = extract_files()
                self.log(f"Extracted {len(extracted)} files successfully!")
                
                # Auto-download Japanese pack if Tesseract is found and pack is missing
                tesseract_ok, _ = check_tesseract()
                if tesseract_ok:
                    if not check_japanese_lang_pack():
                        self.log("Japanese language pack not found. Attempting auto-download...")
                        self.log("Note: Japanese pack is required for reliable Sekiro detection (Japanese '' character)")
                        success, message = download_japanese_lang_pack(log_callback=self.log)
                        if success:
                            self.japanese_pack_status.config(text=" Japanese Pack: Installed (Sekiro support)", foreground="green")
                        else:
                            self.log(f"Japanese pack auto-download failed. Manual download recommended for Sekiro.")
                            self.log("Download from:")
                            self.log("  https://github.com/tesseract-ocr/tessdata/raw/main/jpn.traineddata")
                            self.log("  https://github.com/tesseract-ocr/tessdata/raw/main/jpn_vert.traineddata")
                            self.log(f"Save to: {find_tesseract_tessdata() or 'Tesseract tessdata directory'}")
                            self.japanese_pack_status.config(text=" Japanese Pack: Auto-download failed", foreground="orange")
                    else:
                        self.log("Japanese language pack already installed.")
                
                self.setup_complete = True
                self.update_launch_button_state()
            except Exception as e:
                self.log(f"Error installing files: {e}")
                messagebox.showerror("Error", f"Failed to install files: {e}")
            finally:
                self.install_button.config(state=tk.NORMAL)
        
        threading.Thread(target=do_install, daemon=True).start()
    
    def install_deps(self):
        self.log("Installing dependencies...")
        self.install_deps_button.config(state=tk.DISABLED)
        
        def do_install():
            try:
                if install_dependencies():
                    self.log("Dependencies installed successfully!")
                    self.check_system()
                else:
                    self.log("Failed to install dependencies.")
                    messagebox.showerror("Error", "Failed to install dependencies.")
            except Exception as e:
                self.log(f"Error: {e}")
                messagebox.showerror("Error", f"Failed to install dependencies: {e}")
            finally:
                self.install_deps_button.config(state=tk.NORMAL)
        
        threading.Thread(target=do_install, daemon=True).start()
    
    def launch_app(self):
        gui_path = os.path.join(INSTALL_DIR, "death_counter_gui.py")
        if not os.path.exists(gui_path):
            messagebox.showerror("Error", "Death Counter GUI not found. Please install files first.")
            return
        
        try:
            # Find pythonw.exe (no console window) for GUI applications
            python_exe = find_python_executable(use_pythonw=True)
            if not python_exe:
                error_msg = "Python executable not found. Please install Python and ensure it's in PATH."
                self.log(error_msg)
                messagebox.showerror("Error", error_msg)
                return
            
            self.log(f"Launching: {python_exe} {gui_path}")
            self.log(f"Working directory: {INSTALL_DIR}")
            
            # Launch with CREATE_NO_WINDOW to hide console window
            # Use pythonw.exe which doesn't create a console window
            CREATE_NO_WINDOW = 0x08000000 if hasattr(subprocess, 'CREATE_NO_WINDOW') else 0
            process = subprocess.Popen(
                [python_exe, gui_path], 
                cwd=INSTALL_DIR,
                stdout=subprocess.PIPE,
                stderr=subprocess.PIPE,
                creationflags=CREATE_NO_WINDOW  # Hide console window
            )
            
            # Give it a moment to start, then check if it's still running
            import time
            time.sleep(0.5)
            
            if process.poll() is None:
                # Process is still running (good)
                self.log("Death Counter launched successfully!")
                messagebox.showinfo("Success", "Death Counter GUI launched!")
            else:
                # Process exited immediately (error)
                stdout, stderr = process.communicate()
                error_msg = stderr.decode('utf-8', errors='ignore') if stderr else "Unknown error"
                self.log(f"Process exited immediately. Error: {error_msg}")
                messagebox.showerror("Error", f"Death Counter failed to start:\n{error_msg}")
                
        except Exception as e:
            import traceback
            error_details = traceback.format_exc()
            self.log(f"Error launching: {e}")
            self.log(f"Details: {error_details}")
            messagebox.showerror("Error", f"Failed to launch: {e}")

def main():
    root = tk.Tk()
    app = InstallerGUI(root)
    root.mainloop()

if __name__ == "__main__":
    main()
