"""
Death Counter - Single File Installer
This is a self-extracting installer that contains all necessary files.
"""

# CRITICAL: Single instance check BEFORE any imports
# This must be the absolute first thing that happens
import sys
if sys.platform == 'win32':
    import ctypes
    from ctypes import wintypes
    
    # Try to create a named mutex
    mutex_name = "DeathCounterInstaller_SingleInstance_Mutex"
    mutex = ctypes.windll.kernel32.CreateMutexW(None, False, mutex_name)
    last_error = ctypes.windll.kernel32.GetLastError()
    
    # If mutex already exists, another instance is running
    if last_error == 183:  # ERROR_ALREADY_EXISTS
        import ctypes.wintypes
        user32 = ctypes.windll.user32
        kernel32 = ctypes.windll.kernel32
        
        # Try to find and bring existing window to front
        def enum_windows_callback(hwnd, lParam):
            if user32.IsWindowVisible(hwnd):
                length = user32.GetWindowTextLengthW(hwnd)
                if length > 0:
                    buffer = ctypes.create_unicode_buffer(length + 1)
                    user32.GetWindowTextW(hwnd, buffer, length + 1)
                    if "Death Counter" in buffer.value:
                        user32.SetForegroundWindow(hwnd)
                        user32.ShowWindow(hwnd, 9)  # SW_RESTORE
                        return False  # Stop enumeration
            return True
        
        EnumWindowsProc = ctypes.WINFUNCTYPE(ctypes.c_bool, ctypes.POINTER(ctypes.c_int), ctypes.POINTER(ctypes.c_int))
        callback = EnumWindowsProc(enum_windows_callback)
        user32.EnumWindows(callback, None)
        
        sys.exit(0)

import os
import base64
import subprocess
import shutil
import tempfile
from pathlib import Path
import tkinter as tk
from tkinter import ttk, messagebox, scrolledtext
import threading
import webbrowser

# Embedded files (base64 encoded)
EMBEDDED_FILES = {
  "multi_game_death_counter.py": "IiIiCk11bHRpLUdhbWUgRGVhdGggQ291bnRlciBEYWVtb24KU3VwcG9ydHMgbXVsdGlwbGUgZ2FtZXMgd2l0aCBjb25maWd1cmFibGUgZGV0ZWN0aW9uIHJlZ2lvbnMgYW5kIGtleXdvcmRzLgpBdXRvbWF0aWNhbGx5IHRyYWNrcyBkZWF0aHMgYWNyb3NzIGRpZmZlcmVudCBnYW1lcy4KQXV0by1kZXRlY3RzIHdoaWNoIGdhbWUgaXMgcnVubmluZyBieSBjaGVja2luZyBwcm9jZXNzIG5hbWVzLgoKUmVxdWlyZW1lbnRzOgogICAgcGlwIGluc3RhbGwgbXNzIHBpbGxvdyBweXRlc3NlcmFjdCBvcGVuY3YtcHl0aG9uIG51bXB5IHBzdXRpbAoiIiIKCmltcG9ydCBvcwppbXBvcnQgc3lzCmltcG9ydCB0aW1lCmltcG9ydCBjdHlwZXMKaW1wb3J0IGpzb24KaW1wb3J0IHRyYWNlYmFjawppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgcHN1dGlsCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBMaXN0LCBUdXBsZSwgT3B0aW9uYWwKCiMgV2luZG93cyBBUEkgdHlwZXMgZm9yIHdpbmRvdyBkZXRlY3Rpb24KdHJ5OgogICAgZnJvbSBjdHlwZXMgaW1wb3J0IHdpbnR5cGVzCmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIHdpbnR5cGVzID0gTm9uZQoKaW1wb3J0IGN2MgppbXBvcnQgbnVtcHkgYXMgbnAKZnJvbSBQSUwgaW1wb3J0IEltYWdlCmZyb20gbXNzIGltcG9ydCBtc3MKaW1wb3J0IHB5dGVzc2VyYWN0CgojID09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDT05GSUdVUkFUSU9OCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQgKHdvcmtzIGZvciBib3RoIC5leGUgYW5kIC5weSkKZGVmIGdldF9iYXNlX2RpcigpOgogICAgIiIiR2V0IHRoZSBiYXNlIGRpcmVjdG9yeSAtIHNhbWUgZm9sZGVyIGFzIHRoaXMgc2NyaXB0LiIiIgogICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6CiAgICAgICAgIyBSdW5uaW5nIGFzIGNvbXBpbGVkIC5leGUgLSB1c2UgdGhlIGRpcmVjdG9yeSB3aGVyZSAuZXhlIGlzIGxvY2F0ZWQKICAgICAgICByZXR1cm4gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChzeXMuZXhlY3V0YWJsZSkpCiAgICBlbHNlOgogICAgICAgICMgUnVubmluZyBhcyBzY3JpcHQgLSB1c2UgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGUgc2NyaXB0IGlzIGxvY2F0ZWQKICAgICAgICByZXR1cm4gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykpCgpCQVNFX0RJUiA9IGdldF9iYXNlX2RpcigpCkNPTkZJR19GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZ2FtZXNfY29uZmlnLmpzb24iKQpMT0NLX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb24ubG9jayIpClJFQURZX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb24ucmVhZHkiKSAgIyBTaWduYWwgZmlsZSBjcmVhdGVkIGFmdGVyIGZ1bGwgaW5pdGlhbGl6YXRpb24KU1RPUF9GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiU1RPUCIpCgpERUJVR19SQVcgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Z19jYXB0dXJlX3Jhdy5wbmciKQpERUJVR19PQ1IgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Z19jYXB0dXJlLnBuZyIpCkRFQlVHX0xPRyA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYnVnLmxvZyIpCgpERUFUSF9UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9jb3VudGVyLnR4dCIpClNUQVRFX0pTT04gPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9zdGF0ZS5qc29uIikKQ1VSUkVOVF9HQU1FX1RYVCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImN1cnJlbnRfZ2FtZS50eHQiKSAgIyBDdXJyZW50IGdhbWUgbmFtZSBmb3IgU3RyZWFtZXIuYm90CkNVUlJFTlRfREVBVEhTX1RYVCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImN1cnJlbnRfZGVhdGhzLnR4dCIpICAjIEN1cnJlbnQgZ2FtZSBkZWF0aCBjb3VudCBmb3IgU3RyZWFtZXIuYm90ClRPVEFMX0RFQVRIU19UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJ0b3RhbF9kZWF0aHMudHh0IikgICMgVG90YWwgZGVhdGhzIGFjcm9zcyBhbGwgZ2FtZXMgZm9yIFN0cmVhbWVyLmJvdAoKIyBGaW5kIFRlc3NlcmFjdCBleGVjdXRhYmxlIC0gY2hlY2sgY29tbW9uIGxvY2F0aW9ucwpkZWYgZmluZF90ZXNzZXJhY3RfZXhlY3V0YWJsZSgpOgogICAgIiIiRmluZCBUZXNzZXJhY3QgT0NSIGV4ZWN1dGFibGUgaW4gY29tbW9uIGluc3RhbGxhdGlvbiBsb2NhdGlvbnMuIiIiCiAgICAjIENvbW1vbiBUZXNzZXJhY3QgaW5zdGFsbGF0aW9uIHBhdGhzCiAgICBjb21tb25fcGF0aHMgPSBbCiAgICAgICAgciJDOlxQcm9ncmFtIEZpbGVzXFRlc3NlcmFjdC1PQ1JcdGVzc2VyYWN0LmV4ZSIsCiAgICAgICAgciJDOlxQcm9ncmFtIEZpbGVzICh4ODYpXFRlc3NlcmFjdC1PQ1JcdGVzc2VyYWN0LmV4ZSIsCiAgICAgICAgb3MucGF0aC5qb2luKG9zLmdldGVudignUHJvZ3JhbUZpbGVzJywgcidDOlxQcm9ncmFtIEZpbGVzJyksICdUZXNzZXJhY3QtT0NSJywgJ3Rlc3NlcmFjdC5leGUnKSwKICAgICAgICBvcy5wYXRoLmpvaW4ob3MuZ2V0ZW52KCdQcm9ncmFtRmlsZXMoeDg2KScsIHInQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KScpLCAnVGVzc2VyYWN0LU9DUicsICd0ZXNzZXJhY3QuZXhlJyksCiAgICBdCiAgICAKICAgICMgQ2hlY2sgaWYgdGVzc2VyYWN0IGlzIGluIFBBVEgKICAgIHRyeToKICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3Rlc3NlcmFjdCcsICctLXZlcnNpb24nXSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0yKQogICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6CiAgICAgICAgICAgIHJldHVybiAndGVzc2VyYWN0JyAgIyBVc2UgY29tbWFuZCBuYW1lIGlmIGluIFBBVEgKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICAKICAgICMgQ2hlY2sgY29tbW9uIHBhdGhzCiAgICBmb3IgcGF0aCBpbiBjb21tb25fcGF0aHM6CiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocGF0aCk6CiAgICAgICAgICAgIHJldHVybiBwYXRoCiAgICAKICAgICMgRGVmYXVsdCBmYWxsYmFjawogICAgcmV0dXJuIHIiQzpcUHJvZ3JhbSBGaWxlc1xUZXNzZXJhY3QtT0NSXHRlc3NlcmFjdC5leGUiCgpURVNTRVJBQ1RfRVhFID0gZmluZF90ZXNzZXJhY3RfZXhlY3V0YWJsZSgpCnB5dGVzc2VyYWN0LnB5dGVzc2VyYWN0LnRlc3NlcmFjdF9jbWQgPSBURVNTRVJBQ1RfRVhFCgojIERlZmF1bHQgc2V0dGluZ3MKREVGQVVMVF9TRVRUSU5HUyA9IHsKICAgICJ0aWNrX3NlY29uZHMiOiAwLjMwLAogICAgImRlYnVnX2V2ZXJ5X3RpY2tzIjogMzAsCiAgICAiY29uc2VjdXRpdmVfaGl0cyI6IDIsCiAgICAiY29vbGRvd25fc2Vjb25kcyI6IDguMCwKICAgICJtb25pdG9yX2luZGV4IjogMSwgICMgMS1pbmRleGVkIChtb25pdG9yIDEgaXMgcHJpbWFyeSkKfQoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CiMgREVGQVVMVCBHQU1FIENPTkZJR1MKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CkRFRkFVTFRfR0FNRVMgPSB7CiAgICAiRWxkZW4gUmluZyI6IHsKICAgICAgICAicmVnaW9uIjogeyJ1c2VfcGVyY2VudGFnZXMiOiBUcnVlLCAibGVmdCI6IDAuMjcwOCwgInRvcCI6IDAuNDM1MiwgIndpZHRoIjogMC40NTgzLCAiaGVpZ2h0IjogMC4xODUyfSwKICAgICAgICAia2V5d29yZHMiOiBbIllPVURJRUQiLCAiWU9VRElFIiwgIkRJRUQiXSwKICAgICAgICAidGVzc2VyYWN0X2NvbmZpZyI6ICItLW9lbSAzIC0tcHNtIDcgLWMgdGVzc2VkaXRfY2hhcl93aGl0ZWxpc3Q9WU9VRElFQURGVCIsCiAgICAgICAgIm1vbml0b3JfaW5kZXgiOiAyLAogICAgICAgICJwcm9jZXNzX25hbWVzIjogWyJlbGRlbnJpbmcuZXhlIiwgImVsZGVuIHJpbmcuZXhlIl0sICAjIFByb2Nlc3MgbmFtZXMgdG8gZGV0ZWN0CiAgICB9LAogICAgIkRhcmsgU291bHMgMyI6IHsKICAgICAgICAicmVnaW9uIjogeyJ1c2VfcGVyY2VudGFnZXMiOiBUcnVlLCAibGVmdCI6IDAuMjcwOCwgInRvcCI6IDAuNDM1MiwgIndpZHRoIjogMC40NTgzLCAiaGVpZ2h0IjogMC4xODUyfSwKICAgICAgICAia2V5d29yZHMiOiBbIllPVURJRUQiLCAiWU9VRElFIiwgIllPVUQxRUQiLCAiWU9VRGxFRCIsICJZT1VESSIsICJPVURJRUQiLCAiWU9VRElFMCJdLAogICAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyAtYyB0ZXNzZWRpdF9jaGFyX3doaXRlbGlzdD1ZT1VESUVBREZUIiwKICAgICAgICAibW9uaXRvcl9pbmRleCI6IDIsCiAgICAgICAgInByb2Nlc3NfbmFtZXMiOiBbImRhcmtzb3Vsc2lpaS5leGUiLCAiZGFyayBzb3VscyBpaWkuZXhlIl0sCiAgICB9LAogICAgIkRhcmsgU291bHMgUmVtYXN0ZXJlZCI6IHsKICAgICAgICAicmVnaW9uIjogeyJ1c2VfcGVyY2VudGFnZXMiOiBUcnVlLCAibGVmdCI6IDAuMjcwOCwgInRvcCI6IDAuNDM1MiwgIndpZHRoIjogMC40NTgzLCAiaGVpZ2h0IjogMC4xODUyfSwKICAgICAgICAia2V5d29yZHMiOiBbIllPVURJRUQiLCAiWU9VRElFIiwgIllPVUQxRUQiLCAiWU9VRGxFRCIsICJZT1VESSIsICJPVURJRUQiLCAiWU9VRElFMCJdLAogICAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyAtYyB0ZXNzZWRpdF9jaGFyX3doaXRlbGlzdD1ZT1VESUVBREZUIiwKICAgICAgICAibW9uaXRvcl9pbmRleCI6IDIsCiAgICAgICAgInByb2Nlc3NfbmFtZXMiOiBbImRhcmtzb3Vsc3JlbWFzdGVyZWQuZXhlIiwgImRhcmsgc291bHMgcmVtYXN0ZXJlZC5leGUiXSwKICAgIH0sCiAgICAiRGFyayBTb3VscyBJSTogU2Nob2xhciBvZiB0aGUgRmlyc3QgU2luIjogewogICAgICAgICJyZWdpb24iOiB7InVzZV9wZXJjZW50YWdlcyI6IFRydWUsICJsZWZ0IjogMC4yNzA4LCAidG9wIjogMC40MzUyLCAid2lkdGgiOiAwLjQ1ODMsICJoZWlnaHQiOiAwLjE4NTJ9LAogICAgICAgICJrZXl3b3JkcyI6IFsiWU9VRElFRCIsICJZT1VESUUiLCAiWU9VRDFFRCIsICJZT1VEbEVEIiwgIllPVURJIiwgIk9VRElFRCIsICJZT1VESUUwIl0sCiAgICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IC1jIHRlc3NlZGl0X2NoYXJfd2hpdGVsaXN0PVlPVURJRUFERlQiLAogICAgICAgICJtb25pdG9yX2luZGV4IjogMiwKICAgICAgICAicHJvY2Vzc19uYW1lcyI6IFsiZGFya3NvdWxzaWkuZXhlIiwgImRhcmsgc291bHMgaWkuZXhlIiwgImRhcmtzb3VsczIuZXhlIl0sCiAgICB9LAogICAgIlNla2lybyI6IHsKICAgICAgICAicmVnaW9uIjogeyJ1c2VfcGVyY2VudGFnZXMiOiBUcnVlLCAibGVmdCI6IDAuMzgwMiwgInRvcCI6IDAuMjY4NSwgIndpZHRoIjogMC4yMjQwLCAiaGVpZ2h0IjogMC40MDc0fSwKICAgICAgICAia2V5d29yZHMiOiBbIkRFQVRIIiwgIuatuyJdLAogICAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyIsCiAgICAgICAgInRlc3NlcmFjdF9sYW5nIjogImpwbitlbmciLAogICAgICAgICJtb25pdG9yX2luZGV4IjogMiwKICAgICAgICAicHJvY2Vzc19uYW1lcyI6IFsic2VraXJvLmV4ZSJdLAogICAgfSwKfQoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQojIERQSSBBV0FSRU5FU1MKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CmRlZiBlbmFibGVfZHBpX2F3YXJlbmVzcygpOgogICAgdHJ5OgogICAgICAgIGN0eXBlcy53aW5kbGwuc2hjb3JlLlNldFByb2Nlc3NEcGlBd2FyZW5lc3MoMikKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5TZXRQcm9jZXNzRFBJQXdhcmUoKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgICAgIHBhc3MKCgpkZWYgbW92ZV9jb25zb2xlX3RvX3RvcF9yaWdodCgpOgogICAgIiIiTW92ZSBjb25zb2xlIHdpbmRvdyB0byB0b3AgcmlnaHQgY29ybmVyIHNvIGl0IGRvZXNuJ3QgaW50ZXJmZXJlIHdpdGggY2FwdHVyZS4iIiIKICAgIHRyeToKICAgICAgICBpbXBvcnQgc3lzCiAgICAgICAgaWYgc3lzLnBsYXRmb3JtID09ICJ3aW4zMiI6CiAgICAgICAgICAgIGltcG9ydCBvcwogICAgICAgICAgICAjIEdldCBjb25zb2xlIHdpbmRvdyBoYW5kbGUKICAgICAgICAgICAga2VybmVsMzIgPSBjdHlwZXMud2luZGxsLmtlcm5lbDMyCiAgICAgICAgICAgIHVzZXIzMiA9IGN0eXBlcy53aW5kbGwudXNlcjMyCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEdldCBjb25zb2xlIHdpbmRvdwogICAgICAgICAgICBod25kID0ga2VybmVsMzIuR2V0Q29uc29sZVdpbmRvdygpCiAgICAgICAgICAgIGlmIGh3bmQ6CiAgICAgICAgICAgICAgICAjIEdldCBzY3JlZW4gZGltZW5zaW9ucwogICAgICAgICAgICAgICAgc2NyZWVuX3dpZHRoID0gdXNlcjMyLkdldFN5c3RlbU1ldHJpY3MoMCkgICMgU01fQ1hTQ1JFRU4KICAgICAgICAgICAgICAgIHNjcmVlbl9oZWlnaHQgPSB1c2VyMzIuR2V0U3lzdGVtTWV0cmljcygxKSAgIyBTTV9DWVNDUkVFTgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIENvbnNvbGUgd2luZG93IHNpemUgKGFwcHJveGltYXRlKQogICAgICAgICAgICAgICAgd2luZG93X3dpZHRoID0gODAwCiAgICAgICAgICAgICAgICB3aW5kb3dfaGVpZ2h0ID0gNjAwCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgUG9zaXRpb24gaW4gdG9wIHJpZ2h0IGNvcm5lcgogICAgICAgICAgICAgICAgeCA9IHNjcmVlbl93aWR0aCAtIHdpbmRvd193aWR0aCAtIDIwICAjIDIwcHggbWFyZ2luIGZyb20gcmlnaHQKICAgICAgICAgICAgICAgIHkgPSAyMCAgIyAyMHB4IG1hcmdpbiBmcm9tIHRvcAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIE1vdmUgd2luZG93CiAgICAgICAgICAgICAgICB1c2VyMzIuU2V0V2luZG93UG9zKGh3bmQsIDAsIHgsIHksIHdpbmRvd193aWR0aCwgd2luZG93X2hlaWdodCwgMHgwMDQwKSAgIyBTV1BfU0hPV1dJTkRPVwogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICBwYXNzICAjIFNpbGVudGx5IGZhaWwgaWYgd2UgY2FuJ3QgbW92ZSB0aGUgd2luZG93CgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CiMgTE9HR0lORwojID09PT09PT09PT09PT09PT09PT09PT09PT0KZGVmIGxvZyhtc2c6IHN0cik6CiAgICBvcy5tYWtlZGlycyhCQVNFX0RJUiwgZXhpc3Rfb2s9VHJ1ZSkKICAgIHRzID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIlslWS0lbS0lZCAlSDolTTolU10iKQogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IiwgZXJyb3JzPSdyZXBsYWNlJykgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShmInt0c30ge21zZ31cbiIpCiAgICAgICAgIyBQcmludCB0byBjb25zb2xlIHdpdGggZXJyb3IgaGFuZGxpbmcgZm9yIFVuaWNvZGUKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KG1zZykKICAgICAgICBleGNlcHQgVW5pY29kZUVuY29kZUVycm9yOgogICAgICAgICAgICAjIElmIGNvbnNvbGUgY2FuJ3QgaGFuZGxlIFVuaWNvZGUsIHByaW50IEFTQ0lJIHZlcnNpb24KICAgICAgICAgICAgcHJpbnQobXNnLmVuY29kZSgnYXNjaWknLCBlcnJvcnM9J3JlcGxhY2UnKS5kZWNvZGUoJ2FzY2lpJykpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgIyBTaWxlbnRseSBmYWlsIGlmIHdlIGNhbid0IHdyaXRlIHRvIGxvZwogICAgICAgIHBhc3MKCgojID09PT09PT09PT09PT09PT09PT09PT09PT0KIyBDT05GSUdVUkFUSU9OIE1BTkFHRU1FTlQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CmRlZiBsb2FkX2NvbmZpZygpIC0+IERpY3Q6CiAgICAiIiJMb2FkIGdhbWUgY29uZmlndXJhdGlvbnMgZnJvbSBKU09OIGZpbGUsIG9yIGNyZWF0ZSBkZWZhdWx0LiIiIgogICAgb3MubWFrZWRpcnMoQkFTRV9ESVIsIGV4aXN0X29rPVRydWUpCiAgICAKICAgIGlmIG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdpdGggb3BlbihDT05GSUdfRklMRSwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpCiAgICAgICAgICAgICMgTWVyZ2Ugd2l0aCBkZWZhdWx0cyB0byBlbnN1cmUgYWxsIGtleXMgZXhpc3QKICAgICAgICAgICAgc2V0dGluZ3MgPSB7KipERUZBVUxUX1NFVFRJTkdTLCAqKmNvbmZpZy5nZXQoInNldHRpbmdzIiwge30pfQogICAgICAgICAgICBnYW1lcyA9IHsqKkRFRkFVTFRfR0FNRVMsICoqY29uZmlnLmdldCgiZ2FtZXMiLCB7fSl9CiAgICAgICAgICAgIHJldHVybiB7InNldHRpbmdzIjogc2V0dGluZ3MsICJnYW1lcyI6IGdhbWVzfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nKGYiRXJyb3IgbG9hZGluZyBjb25maWc6IHtlfS4gVXNpbmcgZGVmYXVsdHMuIikKICAgIAogICAgIyBDcmVhdGUgZGVmYXVsdCBjb25maWcgZmlsZQogICAgZGVmYXVsdF9jb25maWcgPSB7CiAgICAgICAgInNldHRpbmdzIjogREVGQVVMVF9TRVRUSU5HUywKICAgICAgICAiZ2FtZXMiOiBERUZBVUxUX0dBTUVTLAogICAgICAgICJjdXJyZW50X2dhbWUiOiBsaXN0KERFRkFVTFRfR0FNRVMua2V5cygpKVswXSBpZiBERUZBVUxUX0dBTUVTIGVsc2UgTm9uZQogICAgfQogICAgc2F2ZV9jb25maWcoZGVmYXVsdF9jb25maWcpCiAgICByZXR1cm4gZGVmYXVsdF9jb25maWcKCgpkZWYgc2F2ZV9jb25maWcoY29uZmlnOiBEaWN0KToKICAgICIiIlNhdmUgY29uZmlndXJhdGlvbiB0byBKU09OIGZpbGUuIiIiCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGpzb24uZHVtcChjb25maWcsIGYsIGluZGVudD0yKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZyhmIkVycm9yIHNhdmluZyBjb25maWc6IHtlfSIpCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CiMgTE9DSyBIQU5ETElORwojID09PT09PT09PT09PT09PT09PT09PT09PT0KZGVmIGFjcXVpcmVfbG9jaygpIC0+IGJvb2w6CiAgICAiIiJDcmVhdGUgbG9jayBmaWxlIGltbWVkaWF0ZWx5IC0gdGhpcyBpcyB0aGUgZmlyc3QgdGhpbmcgd2UgZG8uIiIiCiAgICBvcy5tYWtlZGlycyhCQVNFX0RJUiwgZXhpc3Rfb2s9VHJ1ZSkKICAgIGlmIG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oTE9DS19GSUxFLCAiciIpIGFzIGY6CiAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpCiAgICAgICAgICAgIGxvZyhmIkxPQ0sgRVhJU1RTOiBkYWVtb24ubG9jayBwcmVzZW50IChQSUQ6IHtwaWR9KS4gRXhpdGluZyB0byBhdm9pZCBkdXBsaWNhdGVzLiIpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBsb2coIkxPQ0sgRVhJU1RTOiBkYWVtb24ubG9jayBwcmVzZW50LiBFeGl0aW5nIHRvIGF2b2lkIGR1cGxpY2F0ZXMuIikKICAgICAgICByZXR1cm4gRmFsc2UKICAgIHRyeToKICAgICAgICAjIENyZWF0ZSBsb2NrIGZpbGUgaW1tZWRpYXRlbHkgLSBiZWZvcmUgYW55IG90aGVyIGluaXRpYWxpemF0aW9uCiAgICAgICAgd2l0aCBvcGVuKExPQ0tfRklMRSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKHN0cihvcy5nZXRwaWQoKSkpCiAgICAgICAgIyBGb3JjZSBmaWxlIHN5c3RlbSBmbHVzaAogICAgICAgIGltcG9ydCBzeXMKICAgICAgICBzeXMuc3Rkb3V0LmZsdXNoKCkKICAgICAgICBzeXMuc3RkZXJyLmZsdXNoKCkKICAgICAgICBsb2coZiJMT0NLIENSRUFURUQ6IGRhZW1vbi5sb2NrIGNyZWF0ZWQgd2l0aCBQSUQge29zLmdldHBpZCgpfSIpCiAgICAgICAgcmV0dXJuIFRydWUKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2coZiJMT0NLIEVSUk9SOiB7ZX0iKQogICAgICAgIHJldHVybiBGYWxzZQoKCmRlZiByZWxlYXNlX2xvY2soKToKICAgIHRyeToKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpOgogICAgICAgICAgICBvcy5yZW1vdmUoTE9DS19GSUxFKQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOgogICAgICAgICAgICBvcy5yZW1vdmUoUkVBRFlfRklMRSkKICAgIGV4Y2VwdCBFeGNlcHRpb246CiAgICAgICAgcGFzcwoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQojIFNUQVRFIE1BTkFHRU1FTlQKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CmRlZiBsb2FkX3N0YXRlKCkgLT4gRGljdDoKICAgICIiIkxvYWQgc3RhdGUgZnJvbSBKU09OIGZpbGUuIiIiCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoU1RBVEVfSlNPTik6CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInRvdGFsX2RlYXRocyI6IDAsCiAgICAgICAgICAgICJnYW1lX2RlYXRocyI6IHt9LAogICAgICAgICAgICAidGljayI6IDAsCiAgICAgICAgICAgICJzdHJlYWsiOiAwLAogICAgICAgICAgICAibGFzdF9kZWF0aF90cyI6IDAuMCwKICAgICAgICAgICAgImN1cnJlbnRfZ2FtZSI6IE5vbmUsCiAgICAgICAgfQogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIHN0YXRlID0ganNvbi5sb2FkKGYpCiAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgIHN0YXRlID0ge30KICAgIAogICAgc3RhdGUuc2V0ZGVmYXVsdCgidG90YWxfZGVhdGhzIiwgMCkKICAgIHN0YXRlLnNldGRlZmF1bHQoImdhbWVfZGVhdGhzIiwge30pCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJ0aWNrIiwgMCkKICAgIHN0YXRlLnNldGRlZmF1bHQoInN0cmVhayIsIDApCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJsYXN0X2RlYXRoX3RzIiwgMC4wKQogICAgc3RhdGUuc2V0ZGVmYXVsdCgiY3VycmVudF9nYW1lIiwgTm9uZSkKICAgIHJldHVybiBzdGF0ZQoKCmRlZiBzYXZlX3N0YXRlKHN0YXRlOiBEaWN0KToKICAgICIiIlNhdmUgc3RhdGUgdG8gSlNPTiBmaWxlLiIiIgogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGpzb24uZHVtcChzdGF0ZSwgZiwgaW5kZW50PTIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgbG9nKGYiRXJyb3Igc2F2aW5nIHN0YXRlOiB7ZX0iKQoKCmRlZiB3cml0ZV90ZXh0KGRlYXRoczogaW50LCBnYW1lX25hbWU6IHN0ciA9IE5vbmUpOgogICAgIiIiV3JpdGUgZGVhdGggY291bnQgdG8gdGV4dCBmaWxlIGZvciBPQlMuIiIiCiAgICB0cnk6CiAgICAgICAgIyBXcml0ZSB0b3RhbCBkZWF0aHMKICAgICAgICB3aXRoIG9wZW4oREVBVEhfVFhULCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoc3RyKGRlYXRocykpCiAgICAgICAgCiAgICAgICAgIyBBbHNvIHdyaXRlIHBlci1nYW1lIGZpbGUgaWYgZ2FtZSBuYW1lIHByb3ZpZGVkCiAgICAgICAgaWYgZ2FtZV9uYW1lOgogICAgICAgICAgICBnYW1lX3R4dCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgZiJkZWF0aF9jb3VudGVyX3tnYW1lX25hbWUucmVwbGFjZSgnICcsICdfJyl9LnR4dCIpCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHN0YXRlID0gbG9hZF9zdGF0ZSgpCiAgICAgICAgICAgICAgICBnYW1lX2RlYXRocyA9IHN0YXRlLmdldCgiZ2FtZV9kZWF0aHMiLCB7fSkuZ2V0KGdhbWVfbmFtZSwgMCkKICAgICAgICAgICAgICAgIHdpdGggb3BlbihnYW1lX3R4dCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoc3RyKGdhbWVfZGVhdGhzKSkKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nKGYiRXJyb3Igd3JpdGluZyBnYW1lIHRleHQgZmlsZToge2V9IikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2coZiJFcnJvciB3cml0aW5nIGRlYXRoIHRleHQ6IHtlfSIpCgoKZGVmIHdyaXRlX2NoYXRfaW5mbyhnYW1lX25hbWU6IHN0ciwgZGVhdGhfY291bnQ6IGludCk6CiAgICAiIiJXcml0ZSBzaW1wbGUgdGV4dCBmaWxlcyBmb3IgU3RyZWFtZXIuYm90IGNoYXQgY29tbWFuZC4KICAgIENyZWF0ZXMgdHdvIHNlcGFyYXRlIGZpbGVzOgogICAgLSBjdXJyZW50X2dhbWUudHh0OiBKdXN0IHRoZSBnYW1lIG5hbWUKICAgIC0gY3VycmVudF9kZWF0aHMudHh0OiBKdXN0IHRoZSBkZWF0aCBjb3VudAogICAgVGhpcyBtYWtlcyBpdCBlYXNpZXIgZm9yIFN0cmVhbWVyLmJvdCB0byByZWFkLgogICAgIiIiCiAgICB0cnk6CiAgICAgICAgIyBXcml0ZSBnYW1lIG5hbWUgdG8gc2VwYXJhdGUgZmlsZQogICAgICAgIHdpdGggb3BlbihDVVJSRU5UX0dBTUVfVFhULCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoZ2FtZV9uYW1lKQogICAgICAgIAogICAgICAgICMgV3JpdGUgZGVhdGggY291bnQgdG8gc2VwYXJhdGUgZmlsZQogICAgICAgIHdpdGggb3BlbihDVVJSRU5UX0RFQVRIU19UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShzdHIoZGVhdGhfY291bnQpKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIGxvZyhmIkVycm9yIHdyaXRpbmcgY2hhdCBpbmZvOiB7ZX0iKQoKCmRlZiB3cml0ZV90b3RhbF9kZWF0aHModG90YWxfZGVhdGhzOiBpbnQpOgogICAgIiIiV3JpdGUgdG90YWwgZGVhdGhzIGFjcm9zcyBhbGwgZ2FtZXMgdG8gYSBzZXBhcmF0ZSBmaWxlIGZvciBTdHJlYW1lci5ib3QuIiIiCiAgICB0cnk6CiAgICAgICAgd2l0aCBvcGVuKFRPVEFMX0RFQVRIU19UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShzdHIodG90YWxfZGVhdGhzKSkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2coZiJFcnJvciB3cml0aW5nIHRvdGFsIGRlYXRoczoge2V9IikKCgojID09PT09PT09PT09PT09PT09PT09PT09PT0KIyBHQU1FIERFVEVDVElPTgojID09PT09PT09PT09PT09PT09PT09PT09PT0KZGVmIGdldF9ydW5uaW5nX3Byb2Nlc3NlcygpIC0+IExpc3Rbc3RyXToKICAgICIiIkdldCBsaXN0IG9mIGFsbCBydW5uaW5nIHByb2Nlc3MgbmFtZXMgKGxvd2VyY2FzZSwgd2l0aG91dCAuZXhlKS4iIiIKICAgIHByb2Nlc3NlcyA9IFtdCiAgICB0cnk6CiAgICAgICAgZm9yIHByb2MgaW4gcHN1dGlsLnByb2Nlc3NfaXRlcihbJ25hbWUnXSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHByb2NfbmFtZSA9IHByb2MuaW5mb1snbmFtZSddLmxvd2VyKCkKICAgICAgICAgICAgICAgICMgUmVtb3ZlIC5leGUgZXh0ZW5zaW9uIGZvciBtYXRjaGluZwogICAgICAgICAgICAgICAgaWYgcHJvY19uYW1lLmVuZHN3aXRoKCcuZXhlJyk6CiAgICAgICAgICAgICAgICAgICAgcHJvY19uYW1lID0gcHJvY19uYW1lWzotNF0KICAgICAgICAgICAgICAgIHByb2Nlc3Nlcy5hcHBlbmQocHJvY19uYW1lKQogICAgICAgICAgICBleGNlcHQgKHBzdXRpbC5Ob1N1Y2hQcm9jZXNzLCBwc3V0aWwuQWNjZXNzRGVuaWVkKToKICAgICAgICAgICAgICAgIHBhc3MKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2coZiJFcnJvciBnZXR0aW5nIHByb2Nlc3Nlczoge2V9IikKICAgIHJldHVybiBwcm9jZXNzZXMKCgpkZWYgZ2V0X2dhbWVfcHJvY2VzcyhnYW1lX2NvbmZpZzogRGljdCkgLT4gT3B0aW9uYWxbcHN1dGlsLlByb2Nlc3NdOgogICAgIiIiR2V0IHRoZSBwcm9jZXNzIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgZ2FtZS4iIiIKICAgIHByb2Nlc3NfbmFtZXMgPSBnYW1lX2NvbmZpZy5nZXQoInByb2Nlc3NfbmFtZXMiLCBbXSkKICAgIGlmIG5vdCBwcm9jZXNzX25hbWVzOgogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIHRyeToKICAgICAgICBmb3IgcHJvYyBpbiBwc3V0aWwucHJvY2Vzc19pdGVyKFsnbmFtZScsICdwaWQnXSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHByb2NfbmFtZSA9IHByb2MuaW5mb1snbmFtZSddLmxvd2VyKCkKICAgICAgICAgICAgICAgIGlmIHByb2NfbmFtZS5lbmRzd2l0aCgnLmV4ZScpOgogICAgICAgICAgICAgICAgICAgIHByb2NfbmFtZSA9IHByb2NfbmFtZVs6LTRdCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGZvciBnYW1lX3Byb2NfbmFtZSBpbiBwcm9jZXNzX25hbWVzOgogICAgICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWQgPSBnYW1lX3Byb2NfbmFtZS5sb3dlcigpCiAgICAgICAgICAgICAgICAgICAgaWYgbm9ybWFsaXplZC5lbmRzd2l0aCgnLmV4ZScpOgogICAgICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVkID0gbm9ybWFsaXplZFs6LTRdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm9ybWFsaXplZCA9PSBwcm9jX25hbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBwc3V0aWwuUHJvY2Vzcyhwcm9jLmluZm9bJ3BpZCddKQogICAgICAgICAgICBleGNlcHQgKHBzdXRpbC5Ob1N1Y2hQcm9jZXNzLCBwc3V0aWwuQWNjZXNzRGVuaWVkKToKICAgICAgICAgICAgICAgIHBhc3MKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2coZiJFcnJvciBmaW5kaW5nIGdhbWUgcHJvY2Vzczoge2V9IikKICAgIHJldHVybiBOb25lCgoKZGVmIGdldF93aW5kb3dfcmVjdChwcm9jZXNzOiBwc3V0aWwuUHJvY2VzcykgLT4gT3B0aW9uYWxbZGljdF06CiAgICAiIiJHZXQgdGhlIHdpbmRvdyByZWN0YW5nbGUgZm9yIGEgcHJvY2VzcyB1c2luZyBXaW5kb3dzIEFQSS4iIiIKICAgIHRyeToKICAgICAgICAjIFdpbmRvd3MgQVBJIGNvbnN0YW50cwogICAgICAgIEdXX09XTkVSID0gNAogICAgICAgIAogICAgICAgICMgRmluZCB3aW5kb3cgYnkgcHJvY2VzcyBJRAogICAgICAgIHdpbmRvd3MgPSBbXQogICAgICAgIAogICAgICAgIGRlZiBlbnVtX3dpbmRvd3NfY2FsbGJhY2soaHduZCwgbFBhcmFtKToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgaWYgY3R5cGVzLndpbmRsbC51c2VyMzIuSXNXaW5kb3dWaXNpYmxlKGh3bmQpOgogICAgICAgICAgICAgICAgICAgIHBpZCA9IGN0eXBlcy5jX3Vsb25nKCkKICAgICAgICAgICAgICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5HZXRXaW5kb3dUaHJlYWRQcm9jZXNzSWQoaHduZCwgY3R5cGVzLmJ5cmVmKHBpZCkpCiAgICAgICAgICAgICAgICAgICAgaWYgcGlkLnZhbHVlID09IHByb2Nlc3MucGlkOgogICAgICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIGl0J3Mgbm90IGEgY2hpbGQgd2luZG93CiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyID0gY3R5cGVzLndpbmRsbC51c2VyMzIuR2V0V2luZG93KGh3bmQsIEdXX09XTkVSKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvd25lciA9PSAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93cy5hcHBlbmQoaHduZCkKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcGFzcwogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIAogICAgICAgICMgRGVmaW5lIGNhbGxiYWNrIHR5cGUKICAgICAgICBFbnVtV2luZG93c1Byb2MgPSBjdHlwZXMuV0lORlVOQ1RZUEUoY3R5cGVzLmNfYm9vbCwgY3R5cGVzLmNfdm9pZF9wLCBjdHlwZXMuY192b2lkX3ApCiAgICAgICAgY2FsbGJhY2sgPSBFbnVtV2luZG93c1Byb2MoZW51bV93aW5kb3dzX2NhbGxiYWNrKQogICAgICAgIAogICAgICAgICMgRmluZCBhbGwgd2luZG93cyBmb3IgdGhpcyBwcm9jZXNzCiAgICAgICAgY3R5cGVzLndpbmRsbC51c2VyMzIuRW51bVdpbmRvd3MoY2FsbGJhY2ssIE5vbmUpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHdpbmRvd3M6CiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgCiAgICAgICAgIyBVc2UgdGhlIGZpcnN0IChtYWluKSB3aW5kb3cKICAgICAgICBod25kID0gd2luZG93c1swXQogICAgICAgIAogICAgICAgICMgR2V0IHdpbmRvdyByZWN0YW5nbGUKICAgICAgICBjbGFzcyBSRUNUKGN0eXBlcy5TdHJ1Y3R1cmUpOgogICAgICAgICAgICBfZmllbGRzXyA9IFsoImxlZnQiLCBjdHlwZXMuY19sb25nKSwKICAgICAgICAgICAgICAgICAgICAgICAgKCJ0b3AiLCBjdHlwZXMuY19sb25nKSwKICAgICAgICAgICAgICAgICAgICAgICAgKCJyaWdodCIsIGN0eXBlcy5jX2xvbmcpLAogICAgICAgICAgICAgICAgICAgICAgICAoImJvdHRvbSIsIGN0eXBlcy5jX2xvbmcpXQogICAgICAgIAogICAgICAgIHJlY3QgPSBSRUNUKCkKICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5HZXRXaW5kb3dSZWN0KGh3bmQsIGN0eXBlcy5ieXJlZihyZWN0KSkKICAgICAgICAKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAnbGVmdCc6IHJlY3QubGVmdCwKICAgICAgICAgICAgJ3RvcCc6IHJlY3QudG9wLAogICAgICAgICAgICAncmlnaHQnOiByZWN0LnJpZ2h0LAogICAgICAgICAgICAnYm90dG9tJzogcmVjdC5ib3R0b20sCiAgICAgICAgICAgICd3aWR0aCc6IHJlY3QucmlnaHQgLSByZWN0LmxlZnQsCiAgICAgICAgICAgICdoZWlnaHQnOiByZWN0LmJvdHRvbSAtIHJlY3QudG9wCiAgICAgICAgfQogICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAjIFNpbGVudGx5IGZhaWwgLSB3aWxsIGZhbGwgYmFjayB0byBjb25maWd1cmVkIG1vbml0b3IKICAgICAgICByZXR1cm4gTm9uZQoKCmRlZiBmaW5kX21vbml0b3JfZm9yX3dpbmRvdyh3aW5kb3dfcmVjdDogZGljdCwgbW9uaXRvcnM6IExpc3RbZGljdF0pIC0+IE9wdGlvbmFsW2ludF06CiAgICAiIiJGaW5kIHdoaWNoIG1vbml0b3IgY29udGFpbnMgdGhlIGNlbnRlciBvZiB0aGUgd2luZG93LiIiIgogICAgaWYgbm90IHdpbmRvd19yZWN0OgogICAgICAgIHJldHVybiBOb25lCiAgICAKICAgICMgR2V0IHdpbmRvdyBjZW50ZXIKICAgIGNlbnRlcl94ID0gd2luZG93X3JlY3RbJ2xlZnQnXSArIHdpbmRvd19yZWN0Wyd3aWR0aCddIC8vIDIKICAgIGNlbnRlcl95ID0gd2luZG93X3JlY3RbJ3RvcCddICsgd2luZG93X3JlY3RbJ2hlaWdodCddIC8vIDIKICAgIAogICAgIyBGaW5kIG1vbml0b3IgdGhhdCBjb250YWlucyB0aGlzIHBvaW50CiAgICBmb3IgaSwgbW9uIGluIGVudW1lcmF0ZShtb25pdG9ycyk6CiAgICAgICAgaWYgKG1vblsnbGVmdCddIDw9IGNlbnRlcl94IDwgbW9uWydsZWZ0J10gKyBtb25bJ3dpZHRoJ10gYW5kCiAgICAgICAgICAgIG1vblsndG9wJ10gPD0gY2VudGVyX3kgPCBtb25bJ3RvcCddICsgbW9uWydoZWlnaHQnXSk6CiAgICAgICAgICAgIHJldHVybiBpCiAgICAKICAgIHJldHVybiBOb25lCgoKZGVmIGRldGVjdF9nYW1lKGdhbWVzOiBEaWN0KSAtPiBPcHRpb25hbFtzdHJdOgogICAgIiIiCiAgICBBdXRvLWRldGVjdCB3aGljaCBnYW1lIGlzIGN1cnJlbnRseSBydW5uaW5nIGJ5IGNoZWNraW5nIHByb2Nlc3MgbmFtZXMuCiAgICBSZXR1cm5zIHRoZSBnYW1lIG5hbWUgaWYgZGV0ZWN0ZWQsIE5vbmUgb3RoZXJ3aXNlLgogICAgIiIiCiAgICBydW5uaW5nX3Byb2NzID0gZ2V0X3J1bm5pbmdfcHJvY2Vzc2VzKCkKICAgIAogICAgIyBDaGVjayBlYWNoIGdhbWUncyBwcm9jZXNzIG5hbWVzCiAgICBmb3IgZ2FtZV9uYW1lLCBnYW1lX2NvbmZpZyBpbiBnYW1lcy5pdGVtcygpOgogICAgICAgIHByb2Nlc3NfbmFtZXMgPSBnYW1lX2NvbmZpZy5nZXQoInByb2Nlc3NfbmFtZXMiLCBbXSkKICAgICAgICBpZiBub3QgcHJvY2Vzc19uYW1lczoKICAgICAgICAgICAgY29udGludWUKICAgICAgICAKICAgICAgICAjIENoZWNrIGlmIGFueSBvZiB0aGlzIGdhbWUncyBwcm9jZXNzIG5hbWVzIGFyZSBydW5uaW5nCiAgICAgICAgZm9yIHByb2NfbmFtZSBpbiBwcm9jZXNzX25hbWVzOgogICAgICAgICAgICAjIE5vcm1hbGl6ZTogcmVtb3ZlIC5leGUsIGxvd2VyY2FzZQogICAgICAgICAgICBub3JtYWxpemVkID0gcHJvY19uYW1lLmxvd2VyKCkKICAgICAgICAgICAgaWYgbm9ybWFsaXplZC5lbmRzd2l0aCgnLmV4ZScpOgogICAgICAgICAgICAgICAgbm9ybWFsaXplZCA9IG5vcm1hbGl6ZWRbOi00XQogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaGVjayBpZiB0aGlzIHByb2Nlc3MgaXMgcnVubmluZwogICAgICAgICAgICBpZiBub3JtYWxpemVkIGluIHJ1bm5pbmdfcHJvY3M6CiAgICAgICAgICAgICAgICBsb2coZiJBdXRvLWRldGVjdGVkIGdhbWU6IHtnYW1lX25hbWV9IChwcm9jZXNzOiB7cHJvY19uYW1lfSkiKQogICAgICAgICAgICAgICAgcmV0dXJuIGdhbWVfbmFtZQogICAgCiAgICByZXR1cm4gTm9uZQoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQojIElNQUdFIFBST0NFU1NJTkcKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CmRlZiBncmFiX3JlZ2lvbihzY3Q6IG1zcywgbW9uaXRvcl9pbmRleDogaW50LCByZWdpb246IGRpY3QsIGdhbWVfY29uZmlnOiBEaWN0ID0gTm9uZSkgLT4gSW1hZ2UuSW1hZ2U6CiAgICAiIiIKICAgIENhcHR1cmUgYSByZWdpb24gZnJvbSB0aGUgc3BlY2lmaWVkIG1vbml0b3IuCiAgICBTdXBwb3J0cyBib3RoIGFic29sdXRlIHBpeGVsIGNvb3JkaW5hdGVzIGFuZCBwZXJjZW50YWdlLWJhc2VkIGNvb3JkaW5hdGVzIGZvciBtdWx0aS1yZXNvbHV0aW9uIHN1cHBvcnQuCiAgICBOb3RlOiBNb25pdG9yIGF1dG8tZGV0ZWN0aW9uIGlzIG5vdyBoYW5kbGVkIGluIHRoZSBtYWluIGxvb3Agd2l0aCB0aHJvdHRsaW5nCiAgICB0byBwcmV2ZW50IHJhY2UgY29uZGl0aW9ucy4gVGhpcyBmdW5jdGlvbiBqdXN0IHVzZXMgdGhlIHByb3ZpZGVkIG1vbml0b3JfaW5kZXguCiAgICAiIiIKICAgIAogICAgIyBtc3MgdXNlcyAwLWluZGV4ZWQgbW9uaXRvcnMgKDAgaXMgYWxsIG1vbml0b3JzLCAxKyBhcmUgaW5kaXZpZHVhbCkKICAgICMgVmFsaWRhdGUgbW9uaXRvciBpbmRleCBiZWZvcmUgdXNpbmcgaXQKICAgIG51bV9tb25pdG9ycyA9IGxlbihzY3QubW9uaXRvcnMpCiAgICBtYXhfdmFsaWRfaW5kZXggPSBudW1fbW9uaXRvcnMgLSAxCiAgICAKICAgIGlmIG1vbml0b3JfaW5kZXggPCAwIG9yIG1vbml0b3JfaW5kZXggPiBtYXhfdmFsaWRfaW5kZXg6CiAgICAgICAgIyBJbnZhbGlkIG1vbml0b3IgaW5kZXggLSB1c2UgbW9uaXRvciAxIChwcmltYXJ5KSBhcyBmYWxsYmFjawogICAgICAgIGxvZyhmIldBUk5JTkc6IE1vbml0b3Ige21vbml0b3JfaW5kZXh9IGlzIGludmFsaWQgKHZhbGlkIHJhbmdlOiAwLXttYXhfdmFsaWRfaW5kZXh9KS4gVXNpbmcgbW9uaXRvciAxLiIpCiAgICAgICAgYWN0dWFsX2luZGV4ID0gMQogICAgZWxzZToKICAgICAgICBhY3R1YWxfaW5kZXggPSBtb25pdG9yX2luZGV4CiAgICAKICAgIG1vbiA9IHNjdC5tb25pdG9yc1thY3R1YWxfaW5kZXhdCiAgICBtb25fd2lkdGggPSBtb25bIndpZHRoIl0KICAgIG1vbl9oZWlnaHQgPSBtb25bImhlaWdodCJdCiAgICAKICAgICMgQ2hlY2sgaWYgcmVnaW9uIHVzZXMgcGVyY2VudGFnZS1iYXNlZCBjb29yZGluYXRlcyAoMC4wLTEuMCkgb3IgYWJzb2x1dGUgcGl4ZWxzCiAgICB1c2VfcGVyY2VudGFnZXMgPSBGYWxzZQogICAgaWYgInVzZV9wZXJjZW50YWdlcyIgaW4gcmVnaW9uOgogICAgICAgIHVzZV9wZXJjZW50YWdlcyA9IGJvb2wocmVnaW9uWyJ1c2VfcGVyY2VudGFnZXMiXSkKICAgIGVsc2U6CiAgICAgICAgIyBBdXRvLWRldGVjdDogaWYgbGVmdC90b3Avd2lkdGgvaGVpZ2h0IGFyZSBhbGwgPD0gMS4wLCBhc3N1bWUgcGVyY2VudGFnZXMKICAgICAgICAjIE90aGVyd2lzZSwgaWYgdGhleSdyZSByZWFzb25hYmxlIHBpeGVsIHZhbHVlcyAoPiAxMCksIHVzZSBhYnNvbHV0ZQogICAgICAgIGxlZnRfdmFsID0gcmVnaW9uLmdldCgibGVmdCIsIDApCiAgICAgICAgdG9wX3ZhbCA9IHJlZ2lvbi5nZXQoInRvcCIsIDApCiAgICAgICAgd2lkdGhfdmFsID0gcmVnaW9uLmdldCgid2lkdGgiLCAwKQogICAgICAgIGhlaWdodF92YWwgPSByZWdpb24uZ2V0KCJoZWlnaHQiLCAwKQogICAgICAgIAogICAgICAgICMgSWYgYWxsIHZhbHVlcyBhcmUgYmV0d2VlbiAwIGFuZCAxLCB0aGV5J3JlIHBlcmNlbnRhZ2VzCiAgICAgICAgIyBCdXQgZXhjbHVkZSAwLjAgdmFsdWVzIGFzIHRoZXkgY291bGQgYmUgdmFsaWQgcGl4ZWwgY29vcmRpbmF0ZXMKICAgICAgICBpZiAoMCA8IGxlZnRfdmFsIDw9IDEgYW5kIDAgPCB0b3BfdmFsIDw9IDEgYW5kIAogICAgICAgICAgICAwIDwgd2lkdGhfdmFsIDw9IDEgYW5kIDAgPCBoZWlnaHRfdmFsIDw9IDEpOgogICAgICAgICAgICB1c2VfcGVyY2VudGFnZXMgPSBUcnVlCiAgICAKICAgIGlmIHVzZV9wZXJjZW50YWdlczoKICAgICAgICAjIENvbnZlcnQgcGVyY2VudGFnZS1iYXNlZCBjb29yZGluYXRlcyB0byBhYnNvbHV0ZSBwaXhlbHMKICAgICAgICAjIFBlcmNlbnRhZ2VzIGFyZSByZWxhdGl2ZSB0byBtb25pdG9yIHJlc29sdXRpb24gLSB3b3JrcyBvbiBBTlkgcmVzb2x1dGlvbiBpbmNsdWRpbmcgdWx0cmF3aWRlIQogICAgICAgIGFic19yZWdpb24gPSB7CiAgICAgICAgICAgICJsZWZ0IjogaW50KG1vblsibGVmdCJdICsgcmVnaW9uWyJsZWZ0Il0gKiBtb25fd2lkdGgpLAogICAgICAgICAgICAidG9wIjogaW50KG1vblsidG9wIl0gKyByZWdpb25bInRvcCJdICogbW9uX2hlaWdodCksCiAgICAgICAgICAgICJ3aWR0aCI6IGludChyZWdpb25bIndpZHRoIl0gKiBtb25fd2lkdGgpLAogICAgICAgICAgICAiaGVpZ2h0IjogaW50KHJlZ2lvblsiaGVpZ2h0Il0gKiBtb25faGVpZ2h0KSwKICAgICAgICB9CiAgICAgICAgIyBPbmx5IGxvZyBvbiBmaXJzdCB1c2Ugb3Igd2hlbiBtb25pdG9yIHJlc29sdXRpb24gY2hhbmdlcyAodG8gYXZvaWQgc3BhbSkKICAgICAgICAjIFRoaXMgd2lsbCBiZSBsb2dnZWQgZWxzZXdoZXJlIGlmIG5lZWRlZCBmb3IgZGVidWdnaW5nCiAgICBlbHNlOgogICAgICAgICMgVXNlIGFic29sdXRlIHBpeGVsIGNvb3JkaW5hdGVzIChsZWdhY3kgbW9kZSkKICAgICAgICAjIFNjYWxlIGJhc2VkIG9uIGEgcmVmZXJlbmNlIHJlc29sdXRpb24gKDE5MjB4MTA4MCkgaWYgYmFzZV9yZXNvbHV0aW9uIGlzIHByb3ZpZGVkCiAgICAgICAgYmFzZV93aWR0aCA9IHJlZ2lvbi5nZXQoImJhc2VfcmVzb2x1dGlvbl93aWR0aCIsIE5vbmUpCiAgICAgICAgYmFzZV9oZWlnaHQgPSByZWdpb24uZ2V0KCJiYXNlX3Jlc29sdXRpb25faGVpZ2h0IiwgTm9uZSkKICAgICAgICAKICAgICAgICBpZiBiYXNlX3dpZHRoIGFuZCBiYXNlX2hlaWdodDoKICAgICAgICAgICAgIyBTY2FsZSByZWdpb24gcHJvcG9ydGlvbmFsbHkgZnJvbSBiYXNlIHJlc29sdXRpb24gdG8gYWN0dWFsIG1vbml0b3IgcmVzb2x1dGlvbgogICAgICAgICAgICBzY2FsZV94ID0gbW9uX3dpZHRoIC8gYmFzZV93aWR0aAogICAgICAgICAgICBzY2FsZV95ID0gbW9uX2hlaWdodCAvIGJhc2VfaGVpZ2h0CiAgICAgICAgICAgIGFic19yZWdpb24gPSB7CiAgICAgICAgICAgICAgICAibGVmdCI6IGludChtb25bImxlZnQiXSArIHJlZ2lvblsibGVmdCJdICogc2NhbGVfeCksCiAgICAgICAgICAgICAgICAidG9wIjogaW50KG1vblsidG9wIl0gKyByZWdpb25bInRvcCJdICogc2NhbGVfeSksCiAgICAgICAgICAgICAgICAid2lkdGgiOiBpbnQocmVnaW9uWyJ3aWR0aCJdICogc2NhbGVfeCksCiAgICAgICAgICAgICAgICAiaGVpZ2h0IjogaW50KHJlZ2lvblsiaGVpZ2h0Il0gKiBzY2FsZV95KSwKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2coZiJTY2FsZWQgcmVnaW9uIGZyb20ge2Jhc2Vfd2lkdGh9eHtiYXNlX2hlaWdodH0gdG8ge21vbl93aWR0aH14e21vbl9oZWlnaHR9OiB7cmVnaW9ufSAtPiB7YWJzX3JlZ2lvbn0iKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgTm8gc2NhbGluZyAtIHVzZSBhYnNvbHV0ZSBjb29yZGluYXRlcyBhcy1pcyAobGVnYWN5IGJlaGF2aW9yKQogICAgICAgICAgICBhYnNfcmVnaW9uID0gewogICAgICAgICAgICAgICAgImxlZnQiOiBtb25bImxlZnQiXSArIHJlZ2lvblsibGVmdCJdLAogICAgICAgICAgICAgICAgInRvcCI6IG1vblsidG9wIl0gKyByZWdpb25bInRvcCJdLAogICAgICAgICAgICAgICAgIndpZHRoIjogcmVnaW9uWyJ3aWR0aCJdLAogICAgICAgICAgICAgICAgImhlaWdodCI6IHJlZ2lvblsiaGVpZ2h0Il0sCiAgICAgICAgICAgIH0KICAgIAogICAgIyBDYXB0dXJlIGF0IGZ1bGwgcXVhbGl0eSAobXNzIGNhcHR1cmVzIGF0IG5hdGl2ZSByZXNvbHV0aW9uKQogICAgZ3JhYiA9IHNjdC5ncmFiKGFic19yZWdpb24pCiAgICBpbWcgPSBJbWFnZS5mcm9tYnl0ZXMoIlJHQiIsIGdyYWIuc2l6ZSwgZ3JhYi5yZ2IpCiAgICAKICAgICMgSWYgdGhlIGNhcHR1cmVkIHJlZ2lvbiBpcyB2ZXJ5IHNtYWxsLCB1cHNjYWxlIGl0IGltbWVkaWF0ZWx5IHRvIGltcHJvdmUgcXVhbGl0eQogICAgIyBUaGlzIGhlbHBzIHdpdGggcGl4ZWxhdGVkIHRleHQgZnJvbSBzbWFsbCBjYXB0dXJlIHJlZ2lvbnMKICAgIGlmIGltZy5zaXplWzBdIDwgMjAwIG9yIGltZy5zaXplWzFdIDwgMTAwOgogICAgICAgICMgU21hbGwgcmVnaW9uIC0gdXBzY2FsZSB1c2luZyBoaWdoLXF1YWxpdHkgcmVzYW1wbGluZwogICAgICAgIG5ld193aWR0aCA9IGltZy5zaXplWzBdICogMgogICAgICAgIG5ld19oZWlnaHQgPSBpbWcuc2l6ZVsxXSAqIDIKICAgICAgICBpbWcgPSBpbWcucmVzaXplKChuZXdfd2lkdGgsIG5ld19oZWlnaHQpLCBJbWFnZS5SZXNhbXBsaW5nLkxBTkNaT1MpCiAgICAKICAgIHJldHVybiBpbWcKCgpkZWYgcHJlcHJvY2Vzc19mb3Jfb2NyKGltZ19yZ2I6IEltYWdlLkltYWdlKSAtPiBUdXBsZVtJbWFnZS5JbWFnZSwgRGljdF06CiAgICAiIiIKICAgIFByZXByb2Nlc3MgaW1hZ2UgZm9yIE9DUiB3aXRoIG11bHRpcGxlIGZhbGxiYWNrIHN0cmF0ZWdpZXMuCiAgICBJbXByb3ZlZCB1cHNjYWxpbmcgYW5kIHNoYXJwZW5pbmcgZm9yIGJldHRlciBPQ1IgYWNjdXJhY3kgYW5kIHJlZHVjZWQgcGl4ZWxhdGlvbi4KICAgICIiIgogICAgIyBDb252ZXJ0IFBJTCB0byBudW1weSBhcnJheQogICAgcmdiID0gbnAuYXJyYXkoaW1nX3JnYikKICAgIAogICAgIyBJZiBpbWFnZSBpcyB2ZXJ5IHNtYWxsLCB1cHNjYWxlIGl0IGZpcnN0IGJlZm9yZSBwcm9jZXNzaW5nCiAgICBpZiByZ2Iuc2hhcGVbMF0gPCAxNTAgb3IgcmdiLnNoYXBlWzFdIDwgMzAwOgogICAgICAgICMgVmVyeSBzbWFsbCBpbWFnZSAtIHVwc2NhbGUgdXNpbmcgaGlnaC1xdWFsaXR5IG1ldGhvZAogICAgICAgIHNjYWxlX2ZhY3RvciA9IG1heCgzMDAgLyByZ2Iuc2hhcGVbMV0sIDE1MCAvIHJnYi5zaGFwZVswXSkKICAgICAgICBuZXdfd2lkdGggPSBpbnQocmdiLnNoYXBlWzFdICogc2NhbGVfZmFjdG9yKQogICAgICAgIG5ld19oZWlnaHQgPSBpbnQocmdiLnNoYXBlWzBdICogc2NhbGVfZmFjdG9yKQogICAgICAgICMgVXNlIFBJTCdzIExBTkNaT1MgZm9yIGJldHRlciBxdWFsaXR5IHVwc2NhbGluZwogICAgICAgIGltZ19yZ2IgPSBpbWdfcmdiLnJlc2l6ZSgobmV3X3dpZHRoLCBuZXdfaGVpZ2h0KSwgSW1hZ2UuUmVzYW1wbGluZy5MQU5DWk9TKQogICAgICAgIHJnYiA9IG5wLmFycmF5KGltZ19yZ2IpCiAgICAKICAgIGJnciA9IGN2Mi5jdnRDb2xvcihyZ2IsIGN2Mi5DT0xPUl9SR0IyQkdSKQogICAgCiAgICBkZWYgdXBzY2FsZShpbWdfY3YpOgogICAgICAgICIiIlVwc2NhbGUgaW1hZ2UgM3ggZm9yIGJldHRlciBPQ1IgcXVhbGl0eSBhbmQgcmVkdWNlZCBwaXhlbGF0aW9uLiIiIgogICAgICAgICMgVXNlIExBTkNaT1MgaW50ZXJwb2xhdGlvbiBmb3IgYmV0dGVyIHF1YWxpdHkgKHNsb3dlciBidXQgbXVjaCBiZXR0ZXIgZm9yIHRleHQpCiAgICAgICAgIyAzeCB1cHNjYWxlIGdpdmVzIGJldHRlciByZXN1bHRzIHRoYW4gMnggZm9yIHBpeGVsYXRlZCB0ZXh0CiAgICAgICAgcmV0dXJuIGN2Mi5yZXNpemUoaW1nX2N2LCBOb25lLCBmeD0zLjAsIGZ5PTMuMCwgaW50ZXJwb2xhdGlvbj1jdjIuSU5URVJfTEFOQ1pPUzQpCiAgICAKICAgICMgU3RyYXRlZ3kgMTogVHJ5IEhTViByZWQgbWFzayAoZm9yICJZT1UgRElFRCIgcmVkIHRleHQpCiAgICBoc3YgPSBjdjIuY3Z0Q29sb3IoYmdyLCBjdjIuQ09MT1JfQkdSMkhTVikKICAgIAogICAgIyBXaWRlIHJlZCB0aHJlc2hvbGRzIChib3RoIGxvdyBhbmQgaGlnaCBodWUgcmFuZ2VzKQogICAgbG93ZXIxID0gbnAuYXJyYXkoWzAsIDMwLCAzMF0sIGR0eXBlPW5wLnVpbnQ4KQogICAgdXBwZXIxID0gbnAuYXJyYXkoWzE1LCAyNTUsIDI1NV0sIGR0eXBlPW5wLnVpbnQ4KQogICAgbG93ZXIyID0gbnAuYXJyYXkoWzE2NSwgMzAsIDMwXSwgZHR5cGU9bnAudWludDgpCiAgICB1cHBlcjIgPSBucC5hcnJheShbMTgwLCAyNTUsIDI1NV0sIGR0eXBlPW5wLnVpbnQ4KQogICAgCiAgICBtYXNrMSA9IGN2Mi5pblJhbmdlKGhzdiwgbG93ZXIxLCB1cHBlcjEpCiAgICBtYXNrMiA9IGN2Mi5pblJhbmdlKGhzdiwgbG93ZXIyLCB1cHBlcjIpCiAgICByZWRfbWFzayA9IGN2Mi5iaXR3aXNlX29yKG1hc2sxLCBtYXNrMikKICAgIAogICAgIyBTdHJhdGVneSAxYjogQWxzbyBkZXRlY3Qgd2hpdGUvYnJpZ2h0IHRleHQgKGZvciBTZWtpcm8gd2hpdGUgZGVhdGggbWVzc2FnZSkKICAgICMgV2hpdGUvYnJpZ2h0IGNvbG9ycyBoYXZlIGhpZ2ggdmFsdWUgKGJyaWdodG5lc3MpIGFuZCBsb3cgc2F0dXJhdGlvbgogICAgd2hpdGVfbG93ZXIgPSBucC5hcnJheShbMCwgMCwgMjAwXSwgZHR5cGU9bnAudWludDgpICAjIExvdyBzYXR1cmF0aW9uLCBoaWdoIGJyaWdodG5lc3MKICAgIHdoaXRlX3VwcGVyID0gbnAuYXJyYXkoWzE4MCwgMzAsIDI1NV0sIGR0eXBlPW5wLnVpbnQ4KQogICAgd2hpdGVfbWFzayA9IGN2Mi5pblJhbmdlKGhzdiwgd2hpdGVfbG93ZXIsIHdoaXRlX3VwcGVyKQogICAgCiAgICAjIENvbWJpbmUgcmVkIGFuZCB3aGl0ZSBtYXNrcwogICAgbWFzayA9IGN2Mi5iaXR3aXNlX29yKHJlZF9tYXNrLCB3aGl0ZV9tYXNrKQogICAgCiAgICAjIENsZWFuIG5vaXNlIHdpdGggYmV0dGVyIG1vcnBob2xvZ3kgb3BlcmF0aW9ucwogICAgIyBVc2Ugc21hbGxlciBrZXJuZWwgZm9yIGxlc3MgYWdncmVzc2l2ZSBjbGVhbmluZyAocHJlc2VydmVzIHRleHQgYmV0dGVyKQogICAga2VybmVsID0gbnAub25lcygoMiwgMiksIG5wLnVpbnQ4KQogICAgbWFzayA9IGN2Mi5tb3JwaG9sb2d5RXgobWFzaywgY3YyLk1PUlBIX09QRU4sIGtlcm5lbCwgaXRlcmF0aW9ucz0xKQogICAgbWFzayA9IGN2Mi5tb3JwaG9sb2d5RXgobWFzaywgY3YyLk1PUlBIX0NMT1NFLCBrZXJuZWwsIGl0ZXJhdGlvbnM9MSkKICAgICMgR2VudGxlIGRpbGF0aW9uIHRvIGNvbm5lY3QgdGV4dCBjaGFyYWN0ZXJzCiAgICBtYXNrID0gY3YyLmRpbGF0ZShtYXNrLCBrZXJuZWwsIGl0ZXJhdGlvbnM9MSkKICAgIAogICAgd2hpdGUgPSBpbnQoY3YyLmNvdW50Tm9uWmVybyhtYXNrKSkKICAgIHRvdGFsID0gaW50KG1hc2suc2hhcGVbMF0gKiBtYXNrLnNoYXBlWzFdKQogICAgY292ZXJhZ2UgPSB3aGl0ZSAvIG1heCgxLCB0b3RhbCkKICAgIAogICAgaW5mbyA9IHsibW9kZSI6ICJIU1ZfUkVEX1dISVRFIiwgImNvdmVyYWdlIjogY292ZXJhZ2V9CiAgICAKICAgICMgVXNlIHJlZC93aGl0ZSBtYXNrIGlmIGNvdmVyYWdlIGlzIHJlYXNvbmFibGUgKGF0IGxlYXN0IDAuMyUgb2YgaW1hZ2UgLSBsb3dlcmVkIHRocmVzaG9sZCkKICAgIGlmIGNvdmVyYWdlID49IDAuMDAzOgogICAgICAgICMgSW52ZXJ0IG1hc2s6IHdoaXRlIHRleHQgb24gYmxhY2sgYmFja2dyb3VuZCAtPiBibGFjayB0ZXh0IG9uIHdoaXRlCiAgICAgICAgaW52ID0gY3YyLmJpdHdpc2Vfbm90KG1hc2spCiAgICAgICAgIyBBcHBseSBzbGlnaHQgc2hhcnBlbmluZyB0byBpbXByb3ZlIHRleHQgY2xhcml0eQogICAgICAgIGtlcm5lbF9zaGFycGVuID0gbnAuYXJyYXkoW1stMSwgLTEsIC0xXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbLTEsICA5LCAtMV0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgWy0xLCAtMSwgLTFdXSkKICAgICAgICBpbnYgPSBjdjIuZmlsdGVyMkQoaW52LCAtMSwga2VybmVsX3NoYXJwZW4pCiAgICAgICAgb3V0ID0gdXBzY2FsZShpbnYpCiAgICAgICAgcmV0dXJuIEltYWdlLmZyb21hcnJheShvdXQpLCBpbmZvCiAgICAKICAgICMgU3RyYXRlZ3kgMjogR3JheXNjYWxlIHdpdGggYWRhcHRpdmUgdGhyZXNob2xkICh3b3JrcyBmb3IgYW55IHRleHQgY29sb3IpCiAgICAjIFRoaXMgZmFsbGJhY2sgZW5zdXJlcyB3ZSBORVZFUiBnZXQgYSBibGFjayBpbWFnZSAtIGFkYXB0aXZlIHRocmVzaG9sZCBhbHdheXMgcHJvZHVjZXMgb3V0cHV0CiAgICBncmF5ID0gY3YyLmN2dENvbG9yKGJnciwgY3YyLkNPTE9SX0JHUjJHUkFZKQogICAgIyBVc2UgbGVzcyBibHVyIHRvIHByZXNlcnZlIHRleHQgZGV0YWlscwogICAgZ3JheV9ibHVyID0gY3YyLkdhdXNzaWFuQmx1cihncmF5LCAoMywgMyksIDApCiAgICAjIEFwcGx5IHVuc2hhcnAgbWFzayBmb3IgYmV0dGVyIHRleHQgY2xhcml0eQogICAgZ2F1c3NpYW4gPSBjdjIuR2F1c3NpYW5CbHVyKGdyYXlfYmx1ciwgKDAsIDApLCAyLjApCiAgICB1bnNoYXJwID0gY3YyLmFkZFdlaWdodGVkKGdyYXlfYmx1ciwgMS41LCBnYXVzc2lhbiwgLTAuNSwgMCkKICAgIAogICAgdGhyX2FkYXB0ID0gY3YyLmFkYXB0aXZlVGhyZXNob2xkKAogICAgICAgIHVuc2hhcnAsIDI1NSwKICAgICAgICBjdjIuQURBUFRJVkVfVEhSRVNIX0dBVVNTSUFOX0MsCiAgICAgICAgY3YyLlRIUkVTSF9CSU5BUlksCiAgICAgICAgMzEsIDUKICAgICkKICAgICMgSW52ZXJ0OiBtYWtlIHRleHQgZGFyayBvbiBsaWdodCBiYWNrZ3JvdW5kIChUZXNzZXJhY3QgcHJlZmVycyBkYXJrIHRleHQgb24gbGlnaHQpCiAgICB0aHJfYWRhcHRfaW52ID0gY3YyLmJpdHdpc2Vfbm90KHRocl9hZGFwdCkKICAgICMgQXBwbHkgc2xpZ2h0IHNoYXJwZW5pbmcgdG8gaW1wcm92ZSB0ZXh0IGNsYXJpdHkKICAgIGtlcm5lbF9zaGFycGVuID0gbnAuYXJyYXkoW1stMSwgLTEsIC0xXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFstMSwgIDksIC0xXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFstMSwgLTEsIC0xXV0pCiAgICB0aHJfYWRhcHRfaW52ID0gY3YyLmZpbHRlcjJEKHRocl9hZGFwdF9pbnYsIC0xLCBrZXJuZWxfc2hhcnBlbikKICAgIG91dCA9IHVwc2NhbGUodGhyX2FkYXB0X2ludikKICAgIGluZm9bIm1vZGUiXSA9ICJBREFQVElWRV9USFJFU0hPTEQiCiAgICBpbmZvWyJjb3ZlcmFnZSJdID0gMC4wICAjIFNldCBjb3ZlcmFnZSBmb3IgY29uc2lzdGVuY3kKICAgIHJldHVybiBJbWFnZS5mcm9tYXJyYXkob3V0KSwgaW5mbwoKCmRlZiBvY3JfdGV4dChpbWdfZm9yX29jcjogSW1hZ2UuSW1hZ2UsIHRlc3NlcmFjdF9jb25maWc6IHN0ciwgdGVzc2VyYWN0X2xhbmc6IHN0ciA9ICJlbmciKSAtPiBzdHI6CiAgICAiIiJFeHRyYWN0IHRleHQgZnJvbSBpbWFnZSB1c2luZyBPQ1IuIFN1cHBvcnRzIG11bHRpcGxlIGxhbmd1YWdlcyBpbmNsdWRpbmcgSmFwYW5lc2UuIiIiCiAgICB0cnk6CiAgICAgICAgdGV4dCA9IHB5dGVzc2VyYWN0LmltYWdlX3RvX3N0cmluZyhpbWdfZm9yX29jciwgbGFuZz10ZXNzZXJhY3RfbGFuZywgY29uZmlnPXRlc3NlcmFjdF9jb25maWcpCiAgICAgICAgIyBGb3IgRW5nbGlzaC1vbmx5LCByZW1vdmUgbm9uLWFscGhhYmV0aWMgYW5kIHVwcGVyY2FzZQogICAgICAgICMgRm9yIEphcGFuZXNlL211bHRpLWxhbmd1YWdlLCBrZWVwIGFsbCBjaGFyYWN0ZXJzIChpbmNsdWRpbmcgSmFwYW5lc2UpIGJ1dCByZW1vdmUgc3BhY2VzCiAgICAgICAgaWYgdGVzc2VyYWN0X2xhbmcgPT0gImVuZyIgb3IgKHRlc3NlcmFjdF9sYW5nLnN0YXJ0c3dpdGgoImVuZyIpIGFuZCAiKyIgbm90IGluIHRlc3NlcmFjdF9sYW5nKToKICAgICAgICAgICAgY2xlYW4gPSAiIi5qb2luKGMgZm9yIGMgaW4gdGV4dC51cHBlcigpIGlmIGMuaXNhbHBoYSgpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgRm9yIEphcGFuZXNlL211bHRpLWxhbmd1YWdlOiBrZWVwIGFsbCBjaGFyYWN0ZXJzIGluY2x1ZGluZyBKYXBhbmVzZSwgQ2hpbmVzZSwgZXRjLgogICAgICAgICAgICAjIFJlbW92ZSBzcGFjZXMgYW5kIG5ld2xpbmVzLCBidXQga2VlcCBhbGwgb3RoZXIgY2hhcmFjdGVycwogICAgICAgICAgICBjbGVhbiA9ICIiLmpvaW4oYyBmb3IgYyBpbiB0ZXh0IGlmIG5vdCBjLmlzc3BhY2UoKSkKICAgICAgICByZXR1cm4gY2xlYW4KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBsb2coZiJPQ1IgZXJyb3I6IHtlfSIpCiAgICAgICAgcmV0dXJuICIiCgoKZGVmIGNvbnRhaW5zX2tleXdvcmQoY2xlYW5fdGV4dDogc3RyLCBrZXl3b3JkczogTGlzdFtzdHJdKSAtPiBib29sOgogICAgIiIiQ2hlY2sgaWYgY2xlYW5lZCB0ZXh0IGNvbnRhaW5zIGFueSBrZXl3b3JkLiIiIgogICAgIyBFeGNsdWRlIGZhbHNlIHBvc2l0aXZlczogZW5lbXkgZmVsbGVkLCB0YXJnZXQgZGVzdHJveWVkLCBldGMuCiAgICBleGNsdWRlX2tleXdvcmRzID0gWyJFTkVNWUZFTExFRCIsICJFTkVNWUZFTExFIiwgIlRBUkdFVERFU1RST1lFRCIsICJUQVJHRVRERVNUUk9ZRSJdCiAgICBmb3IgZXhjbHVkZSBpbiBleGNsdWRlX2tleXdvcmRzOgogICAgICAgIGlmIGV4Y2x1ZGUgaW4gY2xlYW5fdGV4dDoKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAKICAgIHJldHVybiBhbnkoayBpbiBjbGVhbl90ZXh0IGZvciBrIGluIGtleXdvcmRzKQoKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQojIE1BSU4gTE9PUAojID09PT09PT09PT09PT09PT09PT09PT09PT0KZGVmIG1haW5fbG9vcCgpOgogICAgb3MubWFrZWRpcnMoQkFTRV9ESVIsIGV4aXN0X29rPVRydWUpCiAgICBlbmFibGVfZHBpX2F3YXJlbmVzcygpCiAgICBtb3ZlX2NvbnNvbGVfdG9fdG9wX3JpZ2h0KCkgICMgTW92ZSBjb25zb2xlIHdpbmRvdyBvdXQgb2YgY2FwdHVyZSBhcmVhCiAgICAKICAgICMgQ2hlY2sgaWYgVGVzc2VyYWN0IGlzIGF2YWlsYWJsZSAoZWl0aGVyIGFzIGZpbGUgcGF0aCBvciBjb21tYW5kKQogICAgdGVzc2VyYWN0X2F2YWlsYWJsZSA9IEZhbHNlCiAgICBpZiBURVNTRVJBQ1RfRVhFID09ICd0ZXNzZXJhY3QnOgogICAgICAgICMgQ2hlY2sgaWYgY29tbWFuZCBpcyBhdmFpbGFibGUKICAgICAgICB0cnk6CiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKFsndGVzc2VyYWN0JywgJy0tdmVyc2lvbiddLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSwgdGltZW91dD0yKQogICAgICAgICAgICB0ZXNzZXJhY3RfYXZhaWxhYmxlID0gKHJlc3VsdC5yZXR1cm5jb2RlID09IDApCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICB0ZXNzZXJhY3RfYXZhaWxhYmxlID0gRmFsc2UKICAgIGVsc2U6CiAgICAgICAgdGVzc2VyYWN0X2F2YWlsYWJsZSA9IG9zLnBhdGguZXhpc3RzKFRFU1NFUkFDVF9FWEUpCiAgICAKICAgIGlmIG5vdCB0ZXNzZXJhY3RfYXZhaWxhYmxlOgogICAgICAgIGxvZyhmIkVSUk9SOiBUZXNzZXJhY3Qgbm90IGZvdW5kIGF0OiB7VEVTU0VSQUNUX0VYRX0iKQogICAgICAgIGxvZygiUGxlYXNlIGluc3RhbGwgVGVzc2VyYWN0IE9DUiBmcm9tOiBodHRwczovL2dpdGh1Yi5jb20vVUItTWFubmhlaW0vdGVzc2VyYWN0L3dpa2kiKQogICAgICAgIGxvZygiT3IgZW5zdXJlIFRlc3NlcmFjdCBpcyBpbiB5b3VyIFBBVEguIikKICAgICAgICBsb2coIkRhZW1vbiB3aWxsIGV4aXQgLSBUZXNzZXJhY3QgaXMgcmVxdWlyZWQuIikKICAgICAgICAjIERvbid0IGNyZWF0ZSByZWFkeSBmaWxlIC0gZGFlbW9uIGlzIG5vdCByZWFkeQogICAgICAgIHJldHVybgogICAgCiAgICBjb25maWcgPSBsb2FkX2NvbmZpZygpCiAgICBzZXR0aW5ncyA9IGNvbmZpZ1sic2V0dGluZ3MiXQogICAgZ2FtZXMgPSBjb25maWdbImdhbWVzIl0KICAgIAogICAgaWYgbm90IGdhbWVzOgogICAgICAgIGxvZygiRVJST1I6IE5vIGdhbWVzIGNvbmZpZ3VyZWQhIikKICAgICAgICBsb2coIkRhZW1vbiB3aWxsIGV4aXQgLSBnYW1lcyBjb25maWd1cmF0aW9uIGlzIHJlcXVpcmVkLiIpCiAgICAgICAgIyBEb24ndCBjcmVhdGUgcmVhZHkgZmlsZSAtIGRhZW1vbiBpcyBub3QgcmVhZHkKICAgICAgICByZXR1cm4KICAgIAogICAgIyBDcmVhdGUgcmVhZHkgZmlsZSBFQVJMWSAtIHJpZ2h0IGFmdGVyIGNyaXRpY2FsIGNoZWNrcyBwYXNzCiAgICAjIFRoaXMgZW5zdXJlcyBHVUkga25vd3MgZGFlbW9uIGlzIHJlYWR5IGV2ZW4gaWYgc29tZXRoaW5nIGxhdGVyIGhhbmdzCiAgICAjIERPIFRISVMgQkVGT1JFIEFOWSBMT0dHSU5HIHRvIGF2b2lkIGVuY29kaW5nIGlzc3VlcwogICAgcmVhZHlfZmlsZV9jcmVhdGVkID0gRmFsc2UKICAgIHRyeToKICAgICAgICAjIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzCiAgICAgICAgb3MubWFrZWRpcnMoQkFTRV9ESVIsIGV4aXN0X29rPVRydWUpCiAgICAgICAgIyBDcmVhdGUgcmVhZHkgZmlsZQogICAgICAgIHJlYWR5X2ZpbGVfcGF0aCA9IG9zLnBhdGguYWJzcGF0aChSRUFEWV9GSUxFKSAgIyBVc2UgYWJzb2x1dGUgcGF0aAogICAgICAgIHdpdGggb3BlbihyZWFkeV9maWxlX3BhdGgsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZShzdHIob3MuZ2V0cGlkKCkpKQogICAgICAgICAgICBmLmZsdXNoKCkgICMgRm9yY2Ugd3JpdGUgdG8gZGlzawogICAgICAgICMgRm9yY2UgT1MgdG8gc3luYyBmaWxlIHRvIGRpc2sKICAgICAgICBpbXBvcnQgc3lzCiAgICAgICAgc3lzLnN0ZG91dC5mbHVzaCgpCiAgICAgICAgc3lzLnN0ZGVyci5mbHVzaCgpCiAgICAgICAgIyBWZXJpZnkgaXQgd2FzIGNyZWF0ZWQKICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhyZWFkeV9maWxlX3BhdGgpOgogICAgICAgICAgICByZWFkeV9maWxlX2NyZWF0ZWQgPSBUcnVlCiAgICAgICAgICAgICMgTm93IHNhZmUgdG8gbG9nIChmaWxlIGlzIGFscmVhZHkgY3JlYXRlZCkKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgbG9nKCJSZWFkeSBmaWxlIGNyZWF0ZWQgRUFSTFkgLSBjcml0aWNhbCBjaGVja3MgcGFzc2VkLiIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MgICMgSWYgbG9nZ2luZyBmYWlscywgdGhhdCdzIE9LIC0gZmlsZSBpcyBjcmVhdGVkCiAgICAgICAgICAgIHByaW50KGYiUmVhZHkgZmlsZSBjcmVhdGVkOiB7cmVhZHlfZmlsZV9wYXRofSIpCiAgICAgICAgICAgIHByaW50KGYiUmVhZHkgZmlsZSBhYnNvbHV0ZSBwYXRoOiB7b3MucGF0aC5hYnNwYXRoKHJlYWR5X2ZpbGVfcGF0aCl9IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIldBUk5JTkc6IFJlYWR5IGZpbGUgd3JpdGUgc3VjY2VlZGVkIGJ1dCBmaWxlIGRvZXNuJ3QgZXhpc3QhIikKICAgICAgICAgICAgcHJpbnQoZiJBdHRlbXB0ZWQgcGF0aDoge3JlYWR5X2ZpbGVfcGF0aH0iKQogICAgICAgICAgICBwcmludChmIkJBU0VfRElSOiB7QkFTRV9ESVJ9IikKICAgICAgICAgICAgcHJpbnQoZiJCQVNFX0RJUiBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhCQVNFX0RJUil9IikKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBlcnJvcl9tc2cgPSBmIkNSSVRJQ0FMOiBDb3VsZCBub3QgY3JlYXRlIHJlYWR5IGZpbGU6IHtlfSIKICAgICAgICAjIFRyeSB0byBsb2csIGJ1dCBkb24ndCBmYWlsIGlmIGxvZ2dpbmcgZmFpbHMKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvZyhlcnJvcl9tc2cpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgcHJpbnQoZXJyb3JfbXNnKQogICAgICAgICMgV3JpdGUgdG8gc3RhcnR1cCBlcnJvciBmaWxlCiAgICAgICAgdHJ5OgogICAgICAgICAgICBTVEFSVFVQX0VSUk9SX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb25fc3RhcnR1cF9lcnJvci50eHQiKQogICAgICAgICAgICB3aXRoIG9wZW4oU1RBUlRVUF9FUlJPUl9GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYiRmFpbGVkIHRvIGNyZWF0ZSByZWFkeSBmaWxlOiB7ZX1cbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiQkFTRV9ESVI6IHtCQVNFX0RJUn1cbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiUkVBRFlfRklMRToge1JFQURZX0ZJTEV9XG4iKQogICAgICAgICAgICAgICAgZi53cml0ZShmIkJBU0VfRElSIGV4aXN0czoge29zLnBhdGguZXhpc3RzKEJBU0VfRElSKX1cbiIpCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiQkFTRV9ESVIgd3JpdGFibGU6IHtvcy5hY2Nlc3MoQkFTRV9ESVIsIG9zLldfT0spfVxuIikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHBhc3MKICAgICAgICAjIERvbid0IGNvbnRpbnVlIC0gcmVhZHkgZmlsZSBpcyBjcml0aWNhbAogICAgICAgIHJldHVybgogICAgCiAgICBpZiBub3QgcmVhZHlfZmlsZV9jcmVhdGVkOgogICAgICAgIHByaW50KCJFUlJPUjogUmVhZHkgZmlsZSB3YXMgbm90IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5ISIpCiAgICAgICAgcmV0dXJuCiAgICAKICAgIHN0YXRlID0gbG9hZF9zdGF0ZSgpCiAgICAKICAgICMgVHJ5IGF1dG8tZGV0ZWN0aW9uIGZpcnN0CiAgICBkZXRlY3RlZF9nYW1lID0gZGV0ZWN0X2dhbWUoZ2FtZXMpCiAgICBpZiBkZXRlY3RlZF9nYW1lIGFuZCBkZXRlY3RlZF9nYW1lIGluIGdhbWVzOgogICAgICAgIGN1cnJlbnRfZ2FtZV9uYW1lID0gZGV0ZWN0ZWRfZ2FtZQogICAgICAgIGxvZyhmIkF1dG8tZGV0ZWN0ZWQgZ2FtZToge2N1cnJlbnRfZ2FtZV9uYW1lfSIpCiAgICBlbHNlOgogICAgICAgICMgRmFsbCBiYWNrIHRvIHNhdmVkIGdhbWUgb3IgZmlyc3QgZ2FtZQogICAgICAgIGN1cnJlbnRfZ2FtZV9uYW1lID0gc3RhdGUuZ2V0KCJjdXJyZW50X2dhbWUiKSBvciBjb25maWcuZ2V0KCJjdXJyZW50X2dhbWUiKSBvciBsaXN0KGdhbWVzLmtleXMoKSlbMF0KICAgICAgICBpZiBkZXRlY3RlZF9nYW1lIGlzIE5vbmU6CiAgICAgICAgICAgIGxvZyhmIk5vIGdhbWUgZGV0ZWN0ZWQgcnVubmluZy4gVXNpbmcgc2F2ZWQgZ2FtZToge2N1cnJlbnRfZ2FtZV9uYW1lfSIpCiAgICAKICAgIGlmIGN1cnJlbnRfZ2FtZV9uYW1lIG5vdCBpbiBnYW1lczoKICAgICAgICBjdXJyZW50X2dhbWVfbmFtZSA9IGxpc3QoZ2FtZXMua2V5cygpKVswXQogICAgCiAgICBnYW1lX2NvbmZpZyA9IGdhbWVzW2N1cnJlbnRfZ2FtZV9uYW1lXQogICAgc3RhdGVbImN1cnJlbnRfZ2FtZSJdID0gY3VycmVudF9nYW1lX25hbWUKICAgIAogICAgIyBHZXQgdGhlIGN1cnJlbnQgZ2FtZSdzIGRlYXRoIGNvdW50IChub3QgdG90YWwpCiAgICBnYW1lX2RlYXRocyA9IHN0YXRlLmdldCgiZ2FtZV9kZWF0aHMiLCB7fSkuZ2V0KGN1cnJlbnRfZ2FtZV9uYW1lLCAwKQogICAgIyBXcml0ZSBpbml0aWFsIHRleHQgZmlsZSBzbyBPQlMgaGFzIGN1cnJlbnQgZ2FtZSdzIGNvdW50IG9uIHN0YXJ0dXAKICAgIHdyaXRlX3RleHQoZ2FtZV9kZWF0aHMsIGN1cnJlbnRfZ2FtZV9uYW1lKQogICAgIyBXcml0ZSBpbml0aWFsIGNoYXQgaW5mbyBmaWxlCiAgICB3cml0ZV9jaGF0X2luZm8oY3VycmVudF9nYW1lX25hbWUsIGdhbWVfZGVhdGhzKQogICAgIyBXcml0ZSBpbml0aWFsIHRvdGFsIGRlYXRocyBmaWxlCiAgICB3cml0ZV90b3RhbF9kZWF0aHMoc3RhdGUuZ2V0KCJ0b3RhbF9kZWF0aHMiLCAwKSkKICAgIAogICAgbG9nKCI9IiAqIDYwKQogICAgbG9nKCJNdWx0aS1HYW1lIERlYXRoIENvdW50ZXIgRGFlbW9uIFN0YXJ0ZWQiKQogICAgbG9nKGYiQ3VycmVudCBHYW1lOiB7Y3VycmVudF9nYW1lX25hbWV9IikKICAgIGxvZyhmIk1vbml0b3I6IHtnYW1lX2NvbmZpZy5nZXQoJ21vbml0b3JfaW5kZXgnLCBzZXR0aW5nc1snbW9uaXRvcl9pbmRleCddKX0iKQogICAgbG9nKGYiUmVnaW9uOiB7Z2FtZV9jb25maWcuZ2V0KCdyZWdpb24nLCB7fSl9IikKICAgIGxvZyhmIktleXdvcmRzOiB7Z2FtZV9jb25maWcuZ2V0KCdrZXl3b3JkcycsIFtdKX0iKQogICAgbG9nKGYiQ3VycmVudCBEZWF0aHMgLSBUb3RhbDoge3N0YXRlWyd0b3RhbF9kZWF0aHMnXX0sIHtjdXJyZW50X2dhbWVfbmFtZX06IHtzdGF0ZVsnZ2FtZV9kZWF0aHMnXS5nZXQoY3VycmVudF9nYW1lX25hbWUsIDApfSIpCiAgICBsb2coIj0iICogNjApCiAgICAKICAgICMgUmVhZHkgZmlsZSBhbHJlYWR5IGNyZWF0ZWQgYWJvdmUgLSBqdXN0IHZlcmlmeSBpdCBleGlzdHMKICAgIGlmIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOgogICAgICAgIGxvZyhmIlJFQURZX0ZJTEUgdmVyaWZpZWQ6IHtSRUFEWV9GSUxFfSIpCiAgICBlbHNlOgogICAgICAgIGxvZyhmIldBUk5JTkc6IFJFQURZX0ZJTEUgbWlzc2luZywgcmVjcmVhdGluZy4uLiIpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aXRoIG9wZW4oUkVBRFlfRklMRSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShzdHIob3MuZ2V0cGlkKCkpKQogICAgICAgICAgICBsb2coZiJSRUFEWV9GSUxFIHJlY3JlYXRlZDoge1JFQURZX0ZJTEV9IikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZyhmIkVSUk9SOiBDb3VsZCBub3QgcmVjcmVhdGUgcmVhZHkgZmlsZToge2V9IikKICAgIAogICAgIyBOb3cgZW50ZXIgbXNzIGNvbnRleHQgLSBpZiB0aGlzIGhhbmdzLCByZWFkeSBmaWxlIGFscmVhZHkgZXhpc3RzCiAgICB3aXRoIG1zcygpIGFzIHNjdDoKICAgICAgICBudW1fbW9uaXRvcnMgPSBsZW4oc2N0Lm1vbml0b3JzKQogICAgICAgIGxvZyhmIkF2YWlsYWJsZSBtb25pdG9yczoge251bV9tb25pdG9yc30iKQogICAgICAgIGZvciBpLCBtb24gaW4gZW51bWVyYXRlKHNjdC5tb25pdG9ycyk6CiAgICAgICAgICAgIGxvZyhmIiAgTW9uaXRvciB7aX06IHttb25bJ3dpZHRoJ119eHttb25bJ2hlaWdodCddfSBhdCAoe21vblsnbGVmdCddfSwge21vblsndG9wJ119KSIpCiAgICAgICAgCiAgICAgICAgIyBHZXQgY29uZmlndXJlZCBtb25pdG9yIGluZGV4IGFuZCB2YWxpZGF0ZSBpdAogICAgICAgIG1vbml0b3JfaW5kZXggPSBnYW1lX2NvbmZpZy5nZXQoIm1vbml0b3JfaW5kZXgiLCBzZXR0aW5nc1sibW9uaXRvcl9pbmRleCJdKQogICAgICAgIAogICAgICAgICMgVmFsaWRhdGUgbW9uaXRvciBpbmRleCAtIG1zcyB1c2VzIDAtaW5kZXhlZCB3aGVyZSAwIGlzICJhbGwgbW9uaXRvcnMiCiAgICAgICAgIyBWYWxpZCBpbmRpY2VzIGFyZSAwIChhbGwpIGFuZCAxIHRvIChudW1fbW9uaXRvcnMtMSkgZm9yIGluZGl2aWR1YWwgbW9uaXRvcnMKICAgICAgICBtYXhfdmFsaWRfaW5kZXggPSBudW1fbW9uaXRvcnMgLSAxCiAgICAgICAgaWYgbW9uaXRvcl9pbmRleCA8IDAgb3IgbW9uaXRvcl9pbmRleCA+IG1heF92YWxpZF9pbmRleDoKICAgICAgICAgICAgbG9nKGYiV0FSTklORzogQ29uZmlndXJlZCBtb25pdG9yX2luZGV4IHttb25pdG9yX2luZGV4fSBpcyBpbnZhbGlkICh2YWxpZCByYW5nZTogMC17bWF4X3ZhbGlkX2luZGV4fSkuIFVzaW5nIG1vbml0b3IgMS4iKQogICAgICAgICAgICBtb25pdG9yX2luZGV4ID0gMSAgIyBEZWZhdWx0IHRvIG1vbml0b3IgMSAocHJpbWFyeSBkaXNwbGF5KQogICAgICAgICAgICAjIFVwZGF0ZSB0aGUgY29uZmlnIHRvIHNhdmUgdGhlIGNvcnJlY3RlZCB2YWx1ZQogICAgICAgICAgICBnYW1lX2NvbmZpZ1sibW9uaXRvcl9pbmRleCJdID0gbW9uaXRvcl9pbmRleAogICAgICAgICAgICBjb25maWdbImdhbWVzIl1bY3VycmVudF9nYW1lX25hbWVdID0gZ2FtZV9jb25maWcKICAgICAgICAgICAgc2F2ZV9jb25maWcoY29uZmlnKQogICAgICAgIAogICAgICAgIHJlZ2lvbiA9IGdhbWVfY29uZmlnLmdldCgicmVnaW9uIiwge30pCiAgICAgICAga2V5d29yZHMgPSBnYW1lX2NvbmZpZy5nZXQoImtleXdvcmRzIiwgWyJZT1VESUVEIl0pCiAgICAgICAgdGVzc2VyYWN0X2NvbmZpZyA9IGdhbWVfY29uZmlnLmdldCgidGVzc2VyYWN0X2NvbmZpZyIsICItLW9lbSAzIC0tcHNtIDciKQogICAgICAgIHRlc3NlcmFjdF9sYW5nID0gZ2FtZV9jb25maWcuZ2V0KCJ0ZXNzZXJhY3RfbGFuZyIsICJlbmciKQogICAgICAgIAogICAgICAgICMgQXV0by1kZXRlY3Rpb24gY2hlY2sgaW50ZXJ2YWwgKGNoZWNrIGV2ZXJ5IDMwIHRpY2tzID0gfjkgc2Vjb25kcyBhdCAwLjNzIHRpY2spCiAgICAgICAgYXV0b19kZXRlY3RfaW50ZXJ2YWwgPSAzMAogICAgICAgIGxhc3RfYXV0b19kZXRlY3RfdGljayA9IDAKICAgICAgICBsYXN0X21vbml0b3JfZGV0ZWN0X3RpY2sgPSAwCiAgICAgICAgY2FjaGVkX21vbml0b3JfaW5kZXggPSBtb25pdG9yX2luZGV4ICAjIENhY2hlIHRoZSBkZXRlY3RlZCBtb25pdG9yCiAgICAgICAgCiAgICAgICAgIyBGbGFnIHRvIHRyYWNrIGlmIGRhZW1vbiBoYXMgZnVsbHkgc3RhcnRlZCAob25seSBydW4gbW9uaXRvciBkZXRlY3Rpb24gYWZ0ZXIgdGhpcykKICAgICAgICBkYWVtb25fc3RhcnRlZCA9IEZhbHNlCiAgICAgICAgc3RhcnR1cF90aWNrcyA9IDEwICAjIFdhaXQgMTAgdGlja3MgKH4zIHNlY29uZHMpIGFmdGVyIGluaXRpYWxpemF0aW9uIGJlZm9yZSBzdGFydGluZyBtb25pdG9yIGRldGVjdGlvbgogICAgICAgIAogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFNUT1BfRklMRSk6CiAgICAgICAgICAgICAgICBsb2coIlNUT1AgZmlsZSBkZXRlY3RlZC4gRXhpdGluZyBjbGVhbmx5LiIpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAKICAgICAgICAgICAgc3RhdGVbInRpY2siXSArPSAxCiAgICAgICAgICAgIG5vdyA9IHRpbWUudGltZSgpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIE1hcmsgZGFlbW9uIGFzIHN0YXJ0ZWQgYWZ0ZXIgaW5pdGlhbCBzdGFydHVwIHBlcmlvZAogICAgICAgICAgICBpZiBub3QgZGFlbW9uX3N0YXJ0ZWQgYW5kIHN0YXRlWyJ0aWNrIl0gPj0gc3RhcnR1cF90aWNrczoKICAgICAgICAgICAgICAgIGRhZW1vbl9zdGFydGVkID0gVHJ1ZQogICAgICAgICAgICAgICAgbG9nKCJNb25pdG9yIGF1dG8tZGV0ZWN0aW9uIGVuYWJsZWQuIikKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQXV0by1kZXRlY3QgZ2FtZSBwZXJpb2RpY2FsbHkKICAgICAgICAgICAgaWYgc3RhdGVbInRpY2siXSAtIGxhc3RfYXV0b19kZXRlY3RfdGljayA+PSBhdXRvX2RldGVjdF9pbnRlcnZhbDoKICAgICAgICAgICAgICAgIGRldGVjdGVkX2dhbWUgPSBkZXRlY3RfZ2FtZShnYW1lcykKICAgICAgICAgICAgICAgIGlmIGRldGVjdGVkX2dhbWUgYW5kIGRldGVjdGVkX2dhbWUgaW4gZ2FtZXMgYW5kIGRldGVjdGVkX2dhbWUgIT0gY3VycmVudF9nYW1lX25hbWU6CiAgICAgICAgICAgICAgICAgICAgbG9nKGYiR2FtZSBjaGFuZ2VkIGRldGVjdGVkOiB7Y3VycmVudF9nYW1lX25hbWV9IC0+IHtkZXRlY3RlZF9nYW1lfSIpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9nYW1lX25hbWUgPSBkZXRlY3RlZF9nYW1lCiAgICAgICAgICAgICAgICAgICAgZ2FtZV9jb25maWcgPSBnYW1lc1tjdXJyZW50X2dhbWVfbmFtZV0KICAgICAgICAgICAgICAgICAgICBzdGF0ZVsiY3VycmVudF9nYW1lIl0gPSBjdXJyZW50X2dhbWVfbmFtZQogICAgICAgICAgICAgICAgICAgICMgVXBkYXRlIGNvbmZpZyBmaWxlCiAgICAgICAgICAgICAgICAgICAgY29uZmlnWyJjdXJyZW50X2dhbWUiXSA9IGN1cnJlbnRfZ2FtZV9uYW1lCiAgICAgICAgICAgICAgICAgICAgc2F2ZV9jb25maWcoY29uZmlnKQogICAgICAgICAgICAgICAgICAgICMgR2V0IHRoZSBuZXcgZ2FtZSdzIGRlYXRoIGNvdW50CiAgICAgICAgICAgICAgICAgICAgZ2FtZV9kZWF0aHMgPSBzdGF0ZS5nZXQoImdhbWVfZGVhdGhzIiwge30pLmdldChjdXJyZW50X2dhbWVfbmFtZSwgMCkKICAgICAgICAgICAgICAgICAgICAjIFdyaXRlIHVwZGF0ZWQgdGV4dCBmaWxlcyB3aXRoIHRoZSBuZXcgZ2FtZSdzIGNvdW50CiAgICAgICAgICAgICAgICAgICAgd3JpdGVfdGV4dChnYW1lX2RlYXRocywgY3VycmVudF9nYW1lX25hbWUpCiAgICAgICAgICAgICAgICAgICAgIyBXcml0ZSB1cGRhdGVkIGNoYXQgaW5mbwogICAgICAgICAgICAgICAgICAgIHdyaXRlX2NoYXRfaW5mbyhjdXJyZW50X2dhbWVfbmFtZSwgZ2FtZV9kZWF0aHMpCiAgICAgICAgICAgICAgICAgICAgIyBXcml0ZSB1cGRhdGVkIHRvdGFsIGRlYXRocwogICAgICAgICAgICAgICAgICAgIHdyaXRlX3RvdGFsX2RlYXRocyhzdGF0ZS5nZXQoInRvdGFsX2RlYXRocyIsIDApKQogICAgICAgICAgICAgICAgICAgICMgVXBkYXRlIG1vbml0b3IgYW5kIHJlZ2lvbiBzZXR0aW5ncyAtIHZhbGlkYXRlIG1vbml0b3IgaW5kZXgKICAgICAgICAgICAgICAgICAgICBtb25pdG9yX2luZGV4ID0gZ2FtZV9jb25maWcuZ2V0KCJtb25pdG9yX2luZGV4Iiwgc2V0dGluZ3NbIm1vbml0b3JfaW5kZXgiXSkKICAgICAgICAgICAgICAgICAgICBtYXhfdmFsaWRfaW5kZXggPSBsZW4oc2N0Lm1vbml0b3JzKSAtIDEKICAgICAgICAgICAgICAgICAgICBpZiBtb25pdG9yX2luZGV4IDwgMCBvciBtb25pdG9yX2luZGV4ID4gbWF4X3ZhbGlkX2luZGV4OgogICAgICAgICAgICAgICAgICAgICAgICBsb2coZiJXQVJOSU5HOiBNb25pdG9yIHttb25pdG9yX2luZGV4fSBpbnZhbGlkIGZvciB7Y3VycmVudF9nYW1lX25hbWV9ICh2YWxpZDogMC17bWF4X3ZhbGlkX2luZGV4fSkuIFVzaW5nIG1vbml0b3IgMS4iKQogICAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yX2luZGV4ID0gMQogICAgICAgICAgICAgICAgICAgICAgICBnYW1lX2NvbmZpZ1sibW9uaXRvcl9pbmRleCJdID0gbW9uaXRvcl9pbmRleAogICAgICAgICAgICAgICAgICAgICAgICBjb25maWdbImdhbWVzIl1bY3VycmVudF9nYW1lX25hbWVdID0gZ2FtZV9jb25maWcKICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZV9jb25maWcoY29uZmlnKQogICAgICAgICAgICAgICAgICAgIGNhY2hlZF9tb25pdG9yX2luZGV4ID0gbW9uaXRvcl9pbmRleCAgIyBSZXNldCBjYWNoZSB3aGVuIGdhbWUgY2hhbmdlcwogICAgICAgICAgICAgICAgICAgIHJlZ2lvbiA9IGdhbWVfY29uZmlnLmdldCgicmVnaW9uIiwge30pCiAgICAgICAgICAgICAgICAgICAga2V5d29yZHMgPSBnYW1lX2NvbmZpZy5nZXQoImtleXdvcmRzIiwgWyJZT1VESUVEIl0pCiAgICAgICAgICAgICAgICAgICAgdGVzc2VyYWN0X2NvbmZpZyA9IGdhbWVfY29uZmlnLmdldCgidGVzc2VyYWN0X2NvbmZpZyIsICItLW9lbSAzIC0tcHNtIDciKQogICAgICAgICAgICAgICAgICAgIGxvZyhmIlN3aXRjaGVkIHRvOiB7Y3VycmVudF9nYW1lX25hbWV9IHwgTW9uaXRvcjoge21vbml0b3JfaW5kZXh9IHwgUmVnaW9uOiB7cmVnaW9ufSB8IERlYXRoczoge2dhbWVfZGVhdGhzfSIpCiAgICAgICAgICAgICAgICBsYXN0X2F1dG9fZGV0ZWN0X3RpY2sgPSBzdGF0ZVsidGljayJdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEF1dG8tZGV0ZWN0IG1vbml0b3IgcGVyaW9kaWNhbGx5ICh0aHJvdHRsZWQgdG8gcHJldmVudCByYWNlIGNvbmRpdGlvbnMpCiAgICAgICAgICAgICMgT25seSBydW4gYWZ0ZXIgZGFlbW9uIGhhcyBmdWxseSBzdGFydGVkIHRvIGF2b2lkIHJhY2UgY29uZGl0aW9ucyBkdXJpbmcgaW5pdGlhbGl6YXRpb24KICAgICAgICAgICAgaWYgZGFlbW9uX3N0YXJ0ZWQgYW5kIHN0YXRlWyJ0aWNrIl0gLSBsYXN0X21vbml0b3JfZGV0ZWN0X3RpY2sgPj0gYXV0b19kZXRlY3RfaW50ZXJ2YWw6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZ2FtZV9wcm9jZXNzID0gZ2V0X2dhbWVfcHJvY2VzcyhnYW1lX2NvbmZpZykKICAgICAgICAgICAgICAgICAgICBpZiBnYW1lX3Byb2Nlc3M6CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvd19yZWN0ID0gZ2V0X3dpbmRvd19yZWN0KGdhbWVfcHJvY2VzcykKICAgICAgICAgICAgICAgICAgICAgICAgaWYgd2luZG93X3JlY3Q6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRlY3RlZF9tb25pdG9yID0gZmluZF9tb25pdG9yX2Zvcl93aW5kb3cod2luZG93X3JlY3QsIHNjdC5tb25pdG9ycykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRldGVjdGVkX21vbml0b3IgaXMgbm90IE5vbmUgYW5kIGRldGVjdGVkX21vbml0b3IgIT0gY2FjaGVkX21vbml0b3JfaW5kZXg6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGYiQXV0by1kZXRlY3RlZCBtb25pdG9yIHtkZXRlY3RlZF9tb25pdG9yfSBmb3IgZ2FtZSB3aW5kb3cgKHdhcyB1c2luZyB7Y2FjaGVkX21vbml0b3JfaW5kZXh9KSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVkX21vbml0b3JfaW5kZXggPSBkZXRlY3RlZF9tb25pdG9yCiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uOgogICAgICAgICAgICAgICAgICAgICMgRmFsbCBiYWNrIHRvIGNvbmZpZ3VyZWQgbW9uaXRvciBpZiBhdXRvLWRldGVjdGlvbiBmYWlscwogICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgIGxhc3RfbW9uaXRvcl9kZXRlY3RfdGljayA9IHN0YXRlWyJ0aWNrIl0KICAgICAgICAgICAgCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgQ2FwdHVyZSByZWdpb24gdXNpbmcgY2FjaGVkIG1vbml0b3IgaW5kZXggKG5vIEVudW1XaW5kb3dzIGNhbGwgaGVyZSkKICAgICAgICAgICAgICAgIGltZ19yZ2IgPSBncmFiX3JlZ2lvbihzY3QsIGNhY2hlZF9tb25pdG9yX2luZGV4LCByZWdpb24pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU2F2ZSBkZWJ1ZyBpbWFnZXMgcGVyaW9kaWNhbGx5CiAgICAgICAgICAgICAgICBzYXZlX2RlYnVnID0gKHN0YXRlWyJ0aWNrIl0gJSBzZXR0aW5nc1siZGVidWdfZXZlcnlfdGlja3MiXSA9PSAwKQogICAgICAgICAgICAgICAgaWYgc2F2ZV9kZWJ1ZzoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGltZ19yZ2Iuc2F2ZShERUJVR19SQVcpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2coZiJERUJVRyBSQVcgU0FWRSBFUlJPUjoge2V9IikKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBQcmVwcm9jZXNzICsgT0NSCiAgICAgICAgICAgICAgICBvY3JfaW1nLCBpbmZvID0gcHJlcHJvY2Vzc19mb3Jfb2NyKGltZ19yZ2IpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIHNhdmVfZGVidWc6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBvY3JfaW1nLnNhdmUoREVCVUdfT0NSKQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgbG9nKGYiREVCVUcgT0NSIFNBVkUgRVJST1I6IHtlfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGNsZWFuID0gb2NyX3RleHQob2NyX2ltZywgdGVzc2VyYWN0X2NvbmZpZywgdGVzc2VyYWN0X2xhbmcpCiAgICAgICAgICAgICAgICBkZXRlY3RlZCA9IGNvbnRhaW5zX2tleXdvcmQoY2xlYW4sIGtleXdvcmRzKQogICAgICAgICAgICAgICAgc3RhdGVbInN0cmVhayJdID0gKHN0YXRlWyJzdHJlYWsiXSArIDEpIGlmIGRldGVjdGVkIGVsc2UgMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIExvZyBwZXJpb2RpY2FsbHkKICAgICAgICAgICAgICAgIGlmIHN0YXRlWyJ0aWNrIl0gJSAxMCA9PSAwIG9yIHNhdmVfZGVidWc6CiAgICAgICAgICAgICAgICAgICAgY292ZXJhZ2UgPSBpbmZvLmdldCgnY292ZXJhZ2UnLCAwLjApCiAgICAgICAgICAgICAgICAgICAgbG9nKGYiVGljaz17c3RhdGVbJ3RpY2snXX0gR2FtZT17Y3VycmVudF9nYW1lX25hbWV9IE1vZGU9e2luZm9bJ21vZGUnXX0gIgogICAgICAgICAgICAgICAgICAgICAgICBmIkNvdmVyYWdlPXtjb3ZlcmFnZTouNGZ9IE9DUj0ne2NsZWFufScgIgogICAgICAgICAgICAgICAgICAgICAgICBmIkRldGVjdGVkPXtkZXRlY3RlZH0gU3RyZWFrPXtzdGF0ZVsnc3RyZWFrJ119L3tzZXR0aW5nc1snY29uc2VjdXRpdmVfaGl0cyddfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ291bnQgZGVhdGg6IHN0YWJsZSBkZXRlY3Rpb24gKyBjb29sZG93bgogICAgICAgICAgICAgICAgY29vbGRvd25fcGFzc2VkID0gKG5vdyAtIGZsb2F0KHN0YXRlWyJsYXN0X2RlYXRoX3RzIl0pKSA+PSBzZXR0aW5nc1siY29vbGRvd25fc2Vjb25kcyJdCiAgICAgICAgICAgICAgICBpZiBzdGF0ZVsic3RyZWFrIl0gPj0gc2V0dGluZ3NbImNvbnNlY3V0aXZlX2hpdHMiXSBhbmQgY29vbGRvd25fcGFzc2VkOgogICAgICAgICAgICAgICAgICAgIHN0YXRlWyJ0b3RhbF9kZWF0aHMiXSA9IGludChzdGF0ZVsidG90YWxfZGVhdGhzIl0pICsgMQogICAgICAgICAgICAgICAgICAgIHN0YXRlWyJnYW1lX2RlYXRocyJdLnNldGRlZmF1bHQoY3VycmVudF9nYW1lX25hbWUsIDApCiAgICAgICAgICAgICAgICAgICAgc3RhdGVbImdhbWVfZGVhdGhzIl1bY3VycmVudF9nYW1lX25hbWVdID0gaW50KHN0YXRlWyJnYW1lX2RlYXRocyJdW2N1cnJlbnRfZ2FtZV9uYW1lXSkgKyAxCiAgICAgICAgICAgICAgICAgICAgc3RhdGVbImxhc3RfZGVhdGhfdHMiXSA9IG5vdwogICAgICAgICAgICAgICAgICAgIHN0YXRlWyJzdHJlYWsiXSA9IDAKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFNhdmUgc3RhdGUgYW5kIHdyaXRlIHRleHQgZmlsZQogICAgICAgICAgICAgICAgICAgIHNhdmVfc3RhdGUoc3RhdGUpCiAgICAgICAgICAgICAgICAgICAgIyBXcml0ZSB0aGUgY3VycmVudCBnYW1lJ3MgZGVhdGggY291bnQgKG5vdCB0b3RhbCkKICAgICAgICAgICAgICAgICAgICBnYW1lX2RlYXRocyA9IHN0YXRlWyJnYW1lX2RlYXRocyJdLmdldChjdXJyZW50X2dhbWVfbmFtZSwgMCkKICAgICAgICAgICAgICAgICAgICB3cml0ZV90ZXh0KGdhbWVfZGVhdGhzLCBjdXJyZW50X2dhbWVfbmFtZSkKICAgICAgICAgICAgICAgICAgICAjIFdyaXRlIHVwZGF0ZWQgY2hhdCBpbmZvCiAgICAgICAgICAgICAgICAgICAgd3JpdGVfY2hhdF9pbmZvKGN1cnJlbnRfZ2FtZV9uYW1lLCBnYW1lX2RlYXRocykKICAgICAgICAgICAgICAgICAgICAjIFdyaXRlIHVwZGF0ZWQgdG90YWwgZGVhdGhzCiAgICAgICAgICAgICAgICAgICAgd3JpdGVfdG90YWxfZGVhdGhzKHN0YXRlWyJ0b3RhbF9kZWF0aHMiXSkKICAgICAgICAgICAgICAgICAgICBsb2coZiJERUFUSCBDT1VOVEVEIC0+IFRvdGFsOiB7c3RhdGVbJ3RvdGFsX2RlYXRocyddfSB8ICIKICAgICAgICAgICAgICAgICAgICAgICAgZiJ7Y3VycmVudF9nYW1lX25hbWV9OiB7c3RhdGVbJ2dhbWVfZGVhdGhzJ11bY3VycmVudF9nYW1lX25hbWVdfSIpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU2F2ZSBzdGF0ZSBwZXJpb2RpY2FsbHkgKGV2ZXJ5IDEwIHRpY2tzIHRvIHJlZHVjZSBJL08pCiAgICAgICAgICAgICAgICBpZiBzdGF0ZVsidGljayJdICUgMTAgPT0gMDoKICAgICAgICAgICAgICAgICAgICBzYXZlX3N0YXRlKHN0YXRlKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZyhmIkVycm9yIGluIG1haW4gbG9vcDoge2V9IikKICAgICAgICAgICAgICAgIGxvZyh0cmFjZWJhY2suZm9ybWF0X2V4YygpKQogICAgICAgICAgICAKICAgICAgICAgICAgdGltZS5zbGVlcChzZXR0aW5nc1sidGlja19zZWNvbmRzIl0pCgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09CiMgRU5UUllQT0lOVAojID09PT09PT09PT09PT09PT09PT09PT09PT0KaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgICMgQ3JlYXRlIGxvY2sgZmlsZSBGSVJTVCAtIGJlZm9yZSBhbnl0aGluZyBlbHNlCiAgICBpZiBub3QgYWNxdWlyZV9sb2NrKCk6CiAgICAgICAgcHJpbnQoIkFub3RoZXIgaW5zdGFuY2UgaXMgYWxyZWFkeSBydW5uaW5nLiBFeGl0aW5nLiIpCiAgICAgICAgcmFpc2UgU3lzdGVtRXhpdCgwKQogICAgCiAgICAjIENyZWF0ZSBhIHN0YXJ0dXAgZXJyb3IgZmlsZSB0byBjYXB0dXJlIGFueSBpbW1lZGlhdGUgZXJyb3JzCiAgICBTVEFSVFVQX0VSUk9SX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb25fc3RhcnR1cF9lcnJvci50eHQiKQogICAgdHJ5OgogICAgICAgIHdpdGggb3BlbihTVEFSVFVQX0VSUk9SX0ZJTEUsICJ3IikgYXMgZjoKICAgICAgICAgICAgZi53cml0ZSgiIikgICMgQ2xlYXIgYW55IG9sZCBlcnJvcnMKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICAKICAgICMgTG9nIHN0YXJ0dXAgaW1tZWRpYXRlbHkgLSB1c2UgYm90aCBsb2coKSBhbmQgcHJpbnQoKSBmb3IgdmlzaWJpbGl0eQogICAgc3RhcnR1cF9tc2cgPSAiPSIgKiA3MCArICJcbkRFQVRIIENPVU5URVIgREFFTU9OIFNUQVJUSU5HXG4iICsgIj0iICogNzAKICAgIHByaW50KHN0YXJ0dXBfbXNnKQogICAgbG9nKHN0YXJ0dXBfbXNnKQogICAgbG9nKGYiUElEOiB7b3MuZ2V0cGlkKCl9IikKICAgIGxvZyhmIkJBU0VfRElSOiB7QkFTRV9ESVJ9IikKICAgIGxvZyhmIkxPQ0tfRklMRToge0xPQ0tfRklMRX0iKQogICAgbG9nKGYiUkVBRFlfRklMRToge1JFQURZX0ZJTEV9IikKICAgIGxvZyhmIlB5dGhvbjoge3N5cy5leGVjdXRhYmxlfSIpCiAgICBsb2coZiJTY3JpcHQ6IHtfX2ZpbGVfX30iKQogICAgCiAgICAjIEFsc28gcHJpbnQgY3JpdGljYWwgaW5mbyB0byBzdGRvdXQgKHZpc2libGUgaW4gY29uc29sZSkKICAgIHByaW50KGYiUElEOiB7b3MuZ2V0cGlkKCl9IikKICAgIHByaW50KGYiQkFTRV9ESVI6IHtCQVNFX0RJUn0iKQogICAgcHJpbnQoZiJMT0NLX0ZJTEU6IHtMT0NLX0ZJTEV9IikKICAgIHByaW50KGYiUkVBRFlfRklMRToge1JFQURZX0ZJTEV9IikKICAgIAogICAgaW5pdGlhbGl6YXRpb25fY29tcGxldGUgPSBGYWxzZQogICAgdHJ5OgogICAgICAgICMgU21hbGwgZGVsYXkgdG8gZW5zdXJlIGxvY2sgZmlsZSBpcyB3cml0dGVuIHRvIGRpc2sKICAgICAgICB0aW1lLnNsZWVwKDAuMSkKICAgICAgICBwcmludCgiU3RhcnRpbmcgbWFpbl9sb29wKCkuLi4iKQogICAgICAgIGxvZygiU3RhcnRpbmcgbWFpbl9sb29wKCkuLi4iKQogICAgICAgICMgQ2FsbCBtYWluX2xvb3AgYW5kIHRyYWNrIGlmIGl0IGNvbXBsZXRlcyBpbml0aWFsaXphdGlvbgogICAgICAgIG1haW5fbG9vcCgpCiAgICAgICAgaW5pdGlhbGl6YXRpb25fY29tcGxldGUgPSBUcnVlCiAgICAgICAgcHJpbnQoIm1haW5fbG9vcCgpIGNvbXBsZXRlZCBub3JtYWxseSIpCiAgICAgICAgbG9nKCJtYWluX2xvb3AoKSBjb21wbGV0ZWQgbm9ybWFsbHkiKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KCJEYWVtb24gc3RvcHBlZCAoS2V5Ym9hcmRJbnRlcnJ1cHQpLiIpCiAgICAgICAgbG9nKCJEYWVtb24gc3RvcHBlZCAoS2V5Ym9hcmRJbnRlcnJ1cHQpLiIpCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgZXJyb3JfbXNnID0gZiJGQVRBTCBFUlJPUjoge3N0cihlKX1cbnt0cmFjZWJhY2suZm9ybWF0X2V4YygpfSIKICAgICAgICBwcmludChlcnJvcl9tc2cpCiAgICAgICAgbG9nKGVycm9yX21zZykKICAgICAgICAjIFdyaXRlIGVycm9yIHRvIHN0YXJ0dXAgZXJyb3IgZmlsZQogICAgICAgIHRyeToKICAgICAgICAgICAgd2l0aCBvcGVuKFNUQVJUVVBfRVJST1JfRklMRSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShlcnJvcl9tc2cpCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCiAgICAgICAgIyBJZiB3ZSBnb3QgaGVyZSwgaW5pdGlhbGl6YXRpb24gZmFpbGVkIC0gcmVtb3ZlIHJlYWR5IGZpbGUgaWYgaXQgZXhpc3RzCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIG9zLnJlbW92ZShSRUFEWV9GSUxFKQogICAgICAgICAgICAgICAgcHJpbnQoIlJlbW92ZWQgcmVhZHkgZmlsZSBkdWUgdG8gZXJyb3IiKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICBmaW5hbGx5OgogICAgICAgIHByaW50KCJSZWxlYXNpbmcgbG9jayBhbmQgc2h1dHRpbmcgZG93bi4uLiIpCiAgICAgICAgcmVsZWFzZV9sb2NrKCkKICAgICAgICBsb2coIkRhZW1vbiBzaHV0ZG93biBjb21wbGV0ZS4iKQogICAgICAgIHByaW50KCJEYWVtb24gc2h1dGRvd24gY29tcGxldGUuIikKCg==",
  "death_counter_gui.py": "IiIiDQpEZWF0aCBDb3VudGVyIEdVSSBBcHBsaWNhdGlvbg0KQSBzaW1wbGUgR1VJIHRvIGNvbnRyb2wgdGhlIGRlYXRoIGNvdW50ZXIgZGFlbW9uIGFuZCB2aWV3IHN0YXRzLg0KDQpUbyBjcmVhdGUgYW4gLmV4ZToNCiAgICBwaXAgaW5zdGFsbCBweWluc3RhbGxlcg0KICAgIHB5aW5zdGFsbGVyIC0tb25lZmlsZSAtLXdpbmRvd2VkIC0tbmFtZSAiRGVhdGhDb3VudGVyIiBkZWF0aF9jb3VudGVyX2d1aS5weQ0KIiIiDQoNCmltcG9ydCBvcw0KaW1wb3J0IHN5cw0KaW1wb3J0IGpzb24NCmltcG9ydCB0aW1lDQppbXBvcnQgc3VicHJvY2Vzcw0KaW1wb3J0IHRocmVhZGluZw0KZnJvbSB0a2ludGVyIGltcG9ydCAqDQpmcm9tIHRraW50ZXIgaW1wb3J0IHR0aywgbWVzc2FnZWJveA0KDQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQgKHdvcmtzIGZvciBib3RoIC5leGUgYW5kIC5weSkNCmRlZiBnZXRfYmFzZV9kaXIoKToNCiAgICAiIiJHZXQgdGhlIGJhc2UgZGlyZWN0b3J5IC0gc2FtZSBmb2xkZXIgYXMgdGhpcyBzY3JpcHQuIiIiDQogICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgICMgUnVubmluZyBhcyBjb21waWxlZCAuZXhlIC0gdXNlIHRoZSBkaXJlY3Rvcnkgd2hlcmUgLmV4ZSBpcyBsb2NhdGVkDQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKHN5cy5leGVjdXRhYmxlKSkNCiAgICBlbHNlOg0KICAgICAgICAjIFJ1bm5pbmcgYXMgc2NyaXB0IC0gdXNlIHRoZSBkaXJlY3Rvcnkgd2hlcmUgdGhlIHNjcmlwdCBpcyBsb2NhdGVkDQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkNCg0KQkFTRV9ESVIgPSBnZXRfYmFzZV9kaXIoKQ0KQ09ORklHX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJnYW1lc19jb25maWcuanNvbiIpDQpTVEFURV9KU09OID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVhdGhfc3RhdGUuanNvbiIpDQpMT0NLX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb24ubG9jayIpDQpSRUFEWV9GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGFlbW9uLnJlYWR5IikgICMgU2lnbmFsIGZpbGUgY3JlYXRlZCBhZnRlciBmdWxsIGluaXRpYWxpemF0aW9uDQpTVE9QX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJTVE9QIikNCkdVSV9ERUJVR19MT0cgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJndWlfZGVidWcubG9nIikgICMgRGVidWcgbG9nIGZvciBHVUkNCiMgVHJ5IGJvdGggcG9zc2libGUgc2NyaXB0IG5hbWVzICh3aXRoIGFuZCB3aXRob3V0ICIxIiBwcmVmaXgpDQpTQ1JJUFRfUEFUSCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgIjFtdWx0aV9nYW1lX2RlYXRoX2NvdW50ZXIucHkiKQ0KaWYgbm90IG9zLnBhdGguZXhpc3RzKFNDUklQVF9QQVRIKToNCiAgICBTQ1JJUFRfUEFUSCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgIm11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weSIpDQpERUFUSF9UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9jb3VudGVyLnR4dCIpDQoNCg0KY2xhc3MgRGVhdGhDb3VudGVyR1VJOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCByb290KToNCiAgICAgICAgc2VsZi5yb290ID0gcm9vdA0KICAgICAgICBzZWxmLnJvb3QudGl0bGUoIkRlYXRoIENvdW50ZXIgQ29udHJvbCIpDQogICAgICAgIHNlbGYucm9vdC5nZW9tZXRyeSgiNDAweDM0MCIpDQogICAgICAgIHNlbGYucm9vdC5yZXNpemFibGUoRmFsc2UsIEZhbHNlKQ0KICAgICAgICANCiAgICAgICAgIyBWYXJpYWJsZXMNCiAgICAgICAgc2VsZi5kYWVtb25fcHJvY2VzcyA9IE5vbmUNCiAgICAgICAgc2VsZi5tb25pdG9yaW5nID0gRmFsc2UNCiAgICAgICAgDQogICAgICAgICMgQ3JlYXRlIFVJDQogICAgICAgIHNlbGYuY3JlYXRlX3VpKCkNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgaW5pdGlhbCBzdGF0ZSAoYWZ0ZXIgVUkgaXMgY3JlYXRlZCkNCiAgICAgICAgc2VsZi51cGRhdGVfc3RhdHVzKCkNCiAgICAgICAgDQogICAgICAgICMgU3RhcnQgbW9uaXRvcmluZyB0aHJlYWQNCiAgICAgICAgc2VsZi5zdGFydF9tb25pdG9yaW5nKCkNCiAgICANCiAgICBkZWYgY3JlYXRlX3VpKHNlbGYpOg0KICAgICAgICAjIE1haW4gZnJhbWUNCiAgICAgICAgbWFpbl9mcmFtZSA9IHR0ay5GcmFtZShzZWxmLnJvb3QsIHBhZGRpbmc9IjEwIikNCiAgICAgICAgbWFpbl9mcmFtZS5ncmlkKHJvdz0wLCBjb2x1bW49MCwgc3RpY2t5PShXLCBFLCBOLCBTKSkNCiAgICAgICAgDQogICAgICAgICMgVGl0bGUNCiAgICAgICAgdGl0bGVfbGFiZWwgPSB0dGsuTGFiZWwobWFpbl9mcmFtZSwgdGV4dD0iRGVhdGggQ291bnRlciIsIGZvbnQ9KCJBcmlhbCIsIDE2LCAiYm9sZCIpKQ0KICAgICAgICB0aXRsZV9sYWJlbC5ncmlkKHJvdz0wLCBjb2x1bW49MCwgY29sdW1uc3Bhbj0yLCBwYWR5PSgwLCAyMCkpDQogICAgICAgIA0KICAgICAgICAjIFN0YXR1cyBmcmFtZQ0KICAgICAgICBzdGF0dXNfZnJhbWUgPSB0dGsuTGFiZWxGcmFtZShtYWluX2ZyYW1lLCB0ZXh0PSJTdGF0dXMiLCBwYWRkaW5nPSIxMCIpDQogICAgICAgIHN0YXR1c19mcmFtZS5ncmlkKHJvdz0xLCBjb2x1bW49MCwgY29sdW1uc3Bhbj0yLCBzdGlja3k9KFcsIEUpLCBwYWR5PSgwLCAxMCkpDQogICAgICAgIA0KICAgICAgICAjIFN0YXR1cyBhbmQgdG90YWwgZGVhdGhzIGluIGEgcm93DQogICAgICAgIHN0YXR1c19yb3cgPSB0dGsuRnJhbWUoc3RhdHVzX2ZyYW1lKQ0KICAgICAgICBzdGF0dXNfcm93LmdyaWQocm93PTAsIGNvbHVtbj0wLCBzdGlja3k9KFcsIEUpKQ0KICAgICAgICBzdGF0dXNfZnJhbWUuY29sdW1uY29uZmlndXJlKDAsIHdlaWdodD0xKQ0KICAgICAgICANCiAgICAgICAgc2VsZi5zdGF0dXNfbGFiZWwgPSB0dGsuTGFiZWwoc3RhdHVzX3JvdywgdGV4dD0iQ2hlY2tpbmcuLi4iLCBmb250PSgiQXJpYWwiLCAxMCkpDQogICAgICAgIHNlbGYuc3RhdHVzX2xhYmVsLmdyaWQocm93PTAsIGNvbHVtbj0wLCBzdGlja3k9VykNCiAgICAgICAgDQogICAgICAgICMgVG90YWwgZGVhdGhzIGxhYmVsDQogICAgICAgIHNlbGYudG90YWxfZGVhdGhzX2xhYmVsID0gdHRrLkxhYmVsKHN0YXR1c19yb3csIHRleHQ9IlRvdGFsIERlYXRoczogMCIsIGZvbnQ9KCJBcmlhbCIsIDEwLCAiYm9sZCIpKQ0KICAgICAgICBzZWxmLnRvdGFsX2RlYXRoc19sYWJlbC5ncmlkKHJvdz0wLCBjb2x1bW49MSwgc3RpY2t5PUUsIHBhZHg9KDIwLCAwKSkNCiAgICAgICAgDQogICAgICAgICMgRGVhdGggY291bnQgZGlzcGxheSAtIExhcmdlIGNsaWNrYWJsZSBidXR0b24NCiAgICAgICAgY291bnRfZnJhbWUgPSB0dGsuRnJhbWUobWFpbl9mcmFtZSkNCiAgICAgICAgY291bnRfZnJhbWUuZ3JpZChyb3c9MiwgY29sdW1uPTAsIGNvbHVtbnNwYW49Miwgc3RpY2t5PShXLCBFKSwgcGFkeT0oMCwgMTApKQ0KICAgICAgICANCiAgICAgICAgIyBDcmVhdGUgYSBsYXJnZSBidXR0b24gdGhhdCBzaG93cyBkZWF0aCBjb3VudCBhbmQgZ2FtZSBuYW1lDQogICAgICAgICMgVXNlIGEgZnJhbWUgd2l0aCBsYWJlbCBmb3IgYmV0dGVyIHRleHQgY29udHJvbA0KICAgICAgICBidXR0b25fY29udGFpbmVyID0gRnJhbWUoY291bnRfZnJhbWUsIGJnPSIjZjBmMGYwIiwgcmVsaWVmPVJBSVNFRCwgYmQ9MykNCiAgICAgICAgYnV0dG9uX2NvbnRhaW5lci5ncmlkKHJvdz0wLCBjb2x1bW49MCwgc3RpY2t5PShXLCBFKSwgaXBhZHg9MTAsIGlwYWR5PTEwKQ0KICAgICAgICBjb3VudF9mcmFtZS5jb2x1bW5jb25maWd1cmUoMCwgd2VpZ2h0PTEpDQogICAgICAgIA0KICAgICAgICAjIERlYXRoIGNvdW50IGxhYmVsIChsYXJnZSkNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbCA9IExhYmVsKA0KICAgICAgICAgICAgYnV0dG9uX2NvbnRhaW5lciwNCiAgICAgICAgICAgIHRleHQ9IjAiLA0KICAgICAgICAgICAgZm9udD0oIkFyaWFsIiwgMjQsICJib2xkIiksDQogICAgICAgICAgICBiZz0iI2YwZjBmMCIsDQogICAgICAgICAgICBmZz0iYmxhY2siDQogICAgICAgICkNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbC5wYWNrKHBhZHk9KDEwLCA1KSkNCiAgICAgICAgDQogICAgICAgICMgR2FtZSBuYW1lIGxhYmVsIChzbWFsbGVyLCB3cmFwcykNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwgPSBMYWJlbCgNCiAgICAgICAgICAgIGJ1dHRvbl9jb250YWluZXIsDQogICAgICAgICAgICB0ZXh0PSJObyBnYW1lIHNlbGVjdGVkIiwNCiAgICAgICAgICAgIGZvbnQ9KCJBcmlhbCIsIDEwKSwNCiAgICAgICAgICAgIGJnPSIjZjBmMGYwIiwNCiAgICAgICAgICAgIGZnPSJibGFjayIsDQogICAgICAgICAgICB3cmFwbGVuZ3RoPTMyMCwNCiAgICAgICAgICAgIGp1c3RpZnk9Q0VOVEVSDQogICAgICAgICkNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwucGFjayhwYWR5PSgwLCAxMCkpDQogICAgICAgIA0KICAgICAgICAjIE1ha2UgdGhlIHdob2xlIGNvbnRhaW5lciBjbGlja2FibGUNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9idXR0b24gPSBidXR0b25fY29udGFpbmVyDQogICAgICAgICMgVXNlIEJ1dHRvblJlbGVhc2UtMSBmb3IgYmV0dGVyIGNsaWNrIGRldGVjdGlvbg0KICAgICAgICBidXR0b25fY29udGFpbmVyLmJpbmQoIjxCdXR0b25SZWxlYXNlLTE+IiwgbGFtYmRhIGU6IHNlbGYuY3ljbGVfZ2FtZSgpKQ0KICAgICAgICBidXR0b25fY29udGFpbmVyLmJpbmQoIjxFbnRlcj4iLCBsYW1iZGEgZTogc2VsZi5vbl9idXR0b25fZW50ZXIoYnV0dG9uX2NvbnRhaW5lcikpDQogICAgICAgIGJ1dHRvbl9jb250YWluZXIuYmluZCgiPExlYXZlPiIsIGxhbWJkYSBlOiBzZWxmLm9uX2J1dHRvbl9sZWF2ZShidXR0b25fY29udGFpbmVyKSkNCiAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbC5iaW5kKCI8QnV0dG9uUmVsZWFzZS0xPiIsIGxhbWJkYSBlOiBzZWxmLmN5Y2xlX2dhbWUoKSkNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwuYmluZCgiPEJ1dHRvblJlbGVhc2UtMT4iLCBsYW1iZGEgZTogc2VsZi5jeWNsZV9nYW1lKCkpDQogICAgICAgIGJ1dHRvbl9jb250YWluZXIuY29uZmlnKGN1cnNvcj0iaGFuZDIiKQ0KICAgICAgICBzZWxmLmRlYXRoX2NvdW50X2xhYmVsLmNvbmZpZyhjdXJzb3I9ImhhbmQyIikNCiAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwuY29uZmlnKGN1cnNvcj0iaGFuZDIiKQ0KICAgICAgICANCiAgICAgICAgIyBDb250cm9sIGJ1dHRvbnMgZnJhbWUNCiAgICAgICAgY29udHJvbF9mcmFtZSA9IHR0ay5MYWJlbEZyYW1lKG1haW5fZnJhbWUsIHRleHQ9IkNvbnRyb2wiLCBwYWRkaW5nPSIxMCIpDQogICAgICAgIGNvbnRyb2xfZnJhbWUuZ3JpZChyb3c9MywgY29sdW1uPTAsIGNvbHVtbnNwYW49Miwgc3RpY2t5PShXLCBFKSwgcGFkeT0oMCwgMCkpDQogICAgICAgIA0KICAgICAgICBzZWxmLnN0YXJ0X2J1dHRvbiA9IHR0ay5CdXR0b24oY29udHJvbF9mcmFtZSwgdGV4dD0iU3RhcnQgRGFlbW9uIiwgY29tbWFuZD1zZWxmLnN0YXJ0X2RhZW1vbiwgd2lkdGg9MTgpDQogICAgICAgIHNlbGYuc3RhcnRfYnV0dG9uLmdyaWQocm93PTAsIGNvbHVtbj0wLCBwYWR4PSgwLCA1KSkNCiAgICAgICAgDQogICAgICAgIHNlbGYuc3RvcF9idXR0b24gPSB0dGsuQnV0dG9uKGNvbnRyb2xfZnJhbWUsIHRleHQ9IlN0b3AgRGFlbW9uIiwgY29tbWFuZD1zZWxmLnN0b3BfZGFlbW9uLCB3aWR0aD0xOCwgc3RhdGU9RElTQUJMRUQpDQogICAgICAgIHNlbGYuc3RvcF9idXR0b24uZ3JpZChyb3c9MCwgY29sdW1uPTEsIHBhZHg9KDUsIDApKQ0KICAgICAgICANCiAgICAgICAgIyBMb2FkIGF2YWlsYWJsZSBnYW1lcw0KICAgICAgICBzZWxmLmxvYWRfZ2FtZXMoKQ0KICAgIA0KICAgIGRlZiBvbl9idXR0b25fZW50ZXIoc2VsZiwgY29udGFpbmVyKToNCiAgICAgICAgIiIiQ2hhbmdlIGJhY2tncm91bmQgb24gaG92ZXIuIiIiDQogICAgICAgIGNvbnRhaW5lci5jb25maWcoYmc9IiNlMGUwZTAiKQ0KICAgICAgICBzZWxmLmRlYXRoX2NvdW50X2xhYmVsLmNvbmZpZyhiZz0iI2UwZTBlMCIpDQogICAgICAgIHNlbGYuZ2FtZV9uYW1lX2xhYmVsLmNvbmZpZyhiZz0iI2UwZTBlMCIpDQogICAgDQogICAgZGVmIG9uX2J1dHRvbl9sZWF2ZShzZWxmLCBjb250YWluZXIpOg0KICAgICAgICAiIiJSZXN0b3JlIGJhY2tncm91bmQgb24gbGVhdmUuIiIiDQogICAgICAgIGNvbnRhaW5lci5jb25maWcoYmc9IiNmMGYwZjAiKQ0KICAgICAgICBzZWxmLmRlYXRoX2NvdW50X2xhYmVsLmNvbmZpZyhiZz0iI2YwZjBmMCIpDQogICAgICAgIHNlbGYuZ2FtZV9uYW1lX2xhYmVsLmNvbmZpZyhiZz0iI2YwZjBmMCIpDQogICAgDQogICAgZGVmIGxvYWRfZ2FtZXMoc2VsZik6DQogICAgICAgICIiIkxvYWQgYXZhaWxhYmxlIGdhbWVzIGZyb20gY29uZmlnLiIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhDT05GSUdfRklMRSk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgICAgIHNlbGYuYXZhaWxhYmxlX2dhbWVzID0gbGlzdChjb25maWcuZ2V0KCJnYW1lcyIsIHt9KS5rZXlzKCkpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHNlbGYuYXZhaWxhYmxlX2dhbWVzID0gWyJFbGRlbiBSaW5nIiwgIkRhcmsgU291bHMgMyIsICJEYXJrIFNvdWxzIFJlbWFzdGVyZWQiLCAiU2VraXJvIl0NCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgc2VsZi5hdmFpbGFibGVfZ2FtZXMgPSBbIkVsZGVuIFJpbmciLCAiRGFyayBTb3VscyAzIiwgIkRhcmsgU291bHMgUmVtYXN0ZXJlZCIsICJTZWtpcm8iXQ0KICAgICAgICANCiAgICAgICAgaWYgbm90IHNlbGYuYXZhaWxhYmxlX2dhbWVzOg0KICAgICAgICAgICAgc2VsZi5hdmFpbGFibGVfZ2FtZXMgPSBbIk5vIGdhbWVzIGNvbmZpZ3VyZWQiXQ0KICAgIA0KICAgIGRlZiBnZXRfY3VycmVudF9nYW1lKHNlbGYpOg0KICAgICAgICAiIiJHZXQgY3VycmVudCBnYW1lIGZyb20gc3RhdGUgb3IgY29uZmlnLiIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjIFRyeSBzdGF0ZSBmaWxlIGZpcnN0DQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhTVEFURV9KU09OKToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oU1RBVEVfSlNPTiwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBzdGF0ZSA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgICAgIGdhbWUgPSBzdGF0ZS5nZXQoImN1cnJlbnRfZ2FtZSIpDQogICAgICAgICAgICAgICAgaWYgZ2FtZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdhbWUNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBGYWxsIGJhY2sgdG8gY29uZmlnDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhDT05GSUdfRklMRSk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcuZ2V0KCJjdXJyZW50X2dhbWUiLCBzZWxmLmF2YWlsYWJsZV9nYW1lc1swXSBpZiBzZWxmLmF2YWlsYWJsZV9nYW1lcyBlbHNlICJVbmtub3duIikNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNlbGYuYXZhaWxhYmxlX2dhbWVzWzBdIGlmIHNlbGYuYXZhaWxhYmxlX2dhbWVzIGVsc2UgIlVua25vd24iDQogICAgDQogICAgZGVmIGdldF9kZWF0aF9jb3VudChzZWxmLCBnYW1lX25hbWUpOg0KICAgICAgICAiIiJHZXQgZGVhdGggY291bnQgZm9yIGEgc3BlY2lmaWMgZ2FtZS4iIiINCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoU1RBVEVfSlNPTik6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKFNUQVRFX0pTT04sICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgc3RhdGUgPSBqc29uLmxvYWQoZikNCiAgICAgICAgICAgICAgICBnYW1lX2RlYXRocyA9IHN0YXRlLmdldCgiZ2FtZV9kZWF0aHMiLCB7fSkNCiAgICAgICAgICAgICAgICByZXR1cm4gZ2FtZV9kZWF0aHMuZ2V0KGdhbWVfbmFtZSwgMCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICByZXR1cm4gMA0KICAgIA0KICAgIGRlZiBnZXRfdG90YWxfZGVhdGhzKHNlbGYpOg0KICAgICAgICAiIiJHZXQgdG90YWwgZGVhdGhzIGFjcm9zcyBhbGwgZ2FtZXMuIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFNUQVRFX0pTT04pOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmdldCgidG90YWxfZGVhdGhzIiwgMCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICByZXR1cm4gMA0KICAgIA0KICAgIGRlZiBjeWNsZV9nYW1lKHNlbGYsIGV2ZW50PU5vbmUpOg0KICAgICAgICAiIiJDeWNsZSB0byB0aGUgbmV4dCBnYW1lIGluIHRoZSBsaXN0LiIiIg0KICAgICAgICBpZiBub3Qgc2VsZi5hdmFpbGFibGVfZ2FtZXMgb3IgbGVuKHNlbGYuYXZhaWxhYmxlX2dhbWVzKSA9PSAwOg0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93d2FybmluZygiTm8gR2FtZXMiLCAiTm8gZ2FtZXMgY29uZmlndXJlZC4iKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICBjdXJyZW50X2dhbWUgPSBzZWxmLmdldF9jdXJyZW50X2dhbWUoKQ0KICAgICAgICANCiAgICAgICAgIyBGaW5kIGN1cnJlbnQgaW5kZXgNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgY3VycmVudF9pbmRleCA9IHNlbGYuYXZhaWxhYmxlX2dhbWVzLmluZGV4KGN1cnJlbnRfZ2FtZSkNCiAgICAgICAgICAgIG5leHRfaW5kZXggPSAoY3VycmVudF9pbmRleCArIDEpICUgbGVuKHNlbGYuYXZhaWxhYmxlX2dhbWVzKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBuZXh0X2luZGV4ID0gMA0KICAgICAgICANCiAgICAgICAgbmV3X2dhbWUgPSBzZWxmLmF2YWlsYWJsZV9nYW1lc1tuZXh0X2luZGV4XQ0KICAgICAgICANCiAgICAgICAgIyBTd2l0Y2ggZ2FtZSB1c2luZyB0aGUgbWFudWFsIHN3aXRjaCBzY3JpcHQNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgc3dpdGNoX3NjcmlwdCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgInN3aXRjaF9nYW1lX21hbnVhbC5weSIpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzd2l0Y2hfc2NyaXB0KToNCiAgICAgICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bigNCiAgICAgICAgICAgICAgICAgICAgW3N5cy5leGVjdXRhYmxlLCBzd2l0Y2hfc2NyaXB0LCBuZXdfZ2FtZV0sDQogICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsDQogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgY3dkPUJBU0VfRElSDQogICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgICAgIHNlbGYudXBkYXRlX3N0YXR1cygpDQogICAgICAgICAgICAgICAgICAgICMgU2lsZW50bHkgc3dpdGNoIC0gbm8gcG9wdXANCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrIHRvIGRpcmVjdCBzd2l0Y2ggaWYgc2NyaXB0IGZhaWxzDQogICAgICAgICAgICAgICAgICAgIHNlbGYuc3dpdGNoX2dhbWVfZGlyZWN0KG5ld19nYW1lKQ0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiBkaXJlY3RseSB1cGRhdGUgY29uZmlnDQogICAgICAgICAgICAgICAgc2VsZi5zd2l0Y2hfZ2FtZV9kaXJlY3QobmV3X2dhbWUpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gZGlyZWN0IHN3aXRjaCBvbiBhbnkgZXJyb3INCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBzZWxmLnN3aXRjaF9nYW1lX2RpcmVjdChuZXdfZ2FtZSkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgDQogICAgZGVmIHN3aXRjaF9nYW1lX2RpcmVjdChzZWxmLCBnYW1lX25hbWUpOg0KICAgICAgICAiIiJEaXJlY3RseSBzd2l0Y2ggZ2FtZSBieSB1cGRhdGluZyBjb25maWcgYW5kIHN0YXRlLiIiIg0KICAgICAgICB0cnk6DQogICAgICAgICAgICAjIFVwZGF0ZSBjb25maWcNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oQ09ORklHX0ZJTEUsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgY29uZmlnWyJjdXJyZW50X2dhbWUiXSA9IGdhbWVfbmFtZQ0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihDT05GSUdfRklMRSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBVcGRhdGUgc3RhdGUNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFNUQVRFX0pTT04pOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIHN0YXRlID0ganNvbi5sb2FkKGYpDQogICAgICAgICAgICAgICAgc3RhdGVbImN1cnJlbnRfZ2FtZSJdID0gZ2FtZV9uYW1lDQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKFNUQVRFX0pTT04sICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAganNvbi5kdW1wKHN0YXRlLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBVcGRhdGUgdGV4dCBmaWxlDQogICAgICAgICAgICBnYW1lX2RlYXRocyA9IHNlbGYuZ2V0X2RlYXRoX2NvdW50KGdhbWVfbmFtZSkNCiAgICAgICAgICAgIHdpdGggb3BlbihERUFUSF9UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICBmLndyaXRlKHN0cihnYW1lX2RlYXRocykpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYudXBkYXRlX3N0YXR1cygpDQogICAgICAgICAgICAjIFNpbGVudGx5IHN3aXRjaCAtIG5vIHBvcHVwDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRmFpbGVkIHRvIHN3aXRjaCBnYW1lOiB7ZX0iKQ0KICAgIA0KICAgIGRlZiBpc19kYWVtb25fcnVubmluZyhzZWxmKToNCiAgICAgICAgIiIiQ2hlY2sgaWYgZGFlbW9uIGlzIHJ1bm5pbmcgLSBjaGVjayBib3RoIGxvY2sgZmlsZSBhbmQgcHJvY2Vzcy4iIiINCiAgICAgICAgIyBDaGVjayBsb2NrIGZpbGUNCiAgICAgICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICAgICMgVmVyaWZ5IHRoZSBwcm9jZXNzIGluIHRoZSBsb2NrIGZpbGUgaXMgYWN0dWFsbHkgcnVubmluZw0KICAgICAgICB0cnk6DQogICAgICAgICAgICB3aXRoIG9wZW4oTE9DS19GSUxFLCAiciIpIGFzIGY6DQogICAgICAgICAgICAgICAgcGlkX3N0ciA9IGYucmVhZCgpLnN0cmlwKCkNCiAgICAgICAgICAgIGlmIHBpZF9zdHI6DQogICAgICAgICAgICAgICAgcGlkID0gaW50KHBpZF9zdHIpDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiBwcm9jZXNzIGV4aXN0cw0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgaW1wb3J0IHBzdXRpbA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHN1dGlsLnBpZF9leGlzdHMocGlkKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgIyBGYWxsYmFjazogdXNlIHRhc2tsaXN0IG9uIFdpbmRvd3MNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgWyJ0YXNrbGlzdCIsICIvRkkiLCBmIlBJRCBlcSB7cGlkfSJdLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9Mg0KICAgICAgICAgICAgICAgICAgICAgICAgKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYie3BpZH0iIGluIHJlc3VsdC5zdGRvdXQNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiB3ZSBjYW4ndCBjaGVjaywgYXNzdW1lIGl0J3MgcnVubmluZyBpZiBsb2NrIGZpbGUgZXhpc3RzDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAjIElmIHdlIGNhbid0IHJlYWQgdGhlIGxvY2sgZmlsZSwgYXNzdW1lIGl0J3Mgbm90IHJ1bm5pbmcNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIFRydWUNCiAgICANCiAgICBkZWYgZmluZF9weXRob25fZXhlY3V0YWJsZShzZWxmKToNCiAgICAgICAgIiIiRmluZCBQeXRob24gZXhlY3V0YWJsZSwgY2hlY2tpbmcgUEFUSCBhbmQgY29tbW9uIGluc3RhbGxhdGlvbiBsb2NhdGlvbnMuDQogICAgICAgIENvbXByZWhlbnNpdmUgc2VhcmNoIGZvciBnZW5lcmFsIHB1YmxpYyB1c2UuIiIiDQogICAgICAgICMgSWYgcnVubmluZyBhcyBhIHNjcmlwdCAobm90IGZyb3plbiksIHVzZSBzeXMuZXhlY3V0YWJsZQ0KICAgICAgICBpZiBub3QgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgICAgICByZXR1cm4gc3lzLmV4ZWN1dGFibGUNCiAgICAgICAgDQogICAgICAgICMgSWYgcnVubmluZyBhcyBQeUluc3RhbGxlciBleGUsIHdlIG5lZWQgdG8gZmluZCBQeXRob24NCiAgICAgICAgIyBNZXRob2QgMTogVHJ5ICdweXRob24nIGNvbW1hbmQgKGlmIGluIFBBVEgpIC0gbW9zdCByZWxpYWJsZQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3B5dGhvbicsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTIpDQogICAgICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSA9PSAwOg0KICAgICAgICAgICAgICAgIHJldHVybiAncHl0aG9uJw0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIE1ldGhvZCAyOiBUcnkgJ3B5JyBsYXVuY2hlciAoV2luZG93cyBQeXRob24gbGF1bmNoZXIpIC0gYWxzbyByZWxpYWJsZQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3B5JywgJy0tdmVyc2lvbiddLCANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MikNCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgcmV0dXJuICdweScNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBNZXRob2QgMzogU2VhcmNoIFdpbmRvd3MgUmVnaXN0cnkgZm9yIFB5dGhvbiBpbnN0YWxsYXRpb25zDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGltcG9ydCB3aW5yZWcNCiAgICAgICAgICAgICMgQ2hlY2sgYm90aCAzMi1iaXQgYW5kIDY0LWJpdCByZWdpc3RyeQ0KICAgICAgICAgICAgZm9yIGFyY2ggaW4gW3dpbnJlZy5LRVlfV09XNjRfNjRLRVksIHdpbnJlZy5LRVlfV09XNjRfMzJLRVldOg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBIS0VZX0xPQ0FMX01BQ0hJTkUNCiAgICAgICAgICAgICAgICAgICAga2V5ID0gd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfTE9DQUxfTUFDSElORSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTT0ZUV0FSRVxQeXRob25cUHl0aG9uQ29yZSIsIDAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lucmVnLktFWV9SRUFEIHwgYXJjaCkNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgIyBHZXQgYWxsIGluc3RhbGxlZCBQeXRob24gdmVyc2lvbnMNCiAgICAgICAgICAgICAgICAgICAgICAgIGkgPSAwDQogICAgICAgICAgICAgICAgICAgICAgICB3aGlsZSBUcnVlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbiA9IHdpbnJlZy5FbnVtS2V5KGtleSwgaSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbF9wYXRoX2tleSA9IHdpbnJlZy5PcGVuS2V5KGtleSwgZiJ7dmVyc2lvbn1cXEluc3RhbGxQYXRoIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5zdGFsbF9wYXRoID0gd2lucmVnLlF1ZXJ5VmFsdWVFeChpbnN0YWxsX3BhdGhfa2V5LCAiIilbMF0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl9leGUgPSBvcy5wYXRoLmpvaW4oaW5zdGFsbF9wYXRoLCAicHl0aG9uLmV4ZSIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoaW5zdGFsbF9wYXRoX2tleSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoa2V5KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBweXRob25fZXhlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoaW5zdGFsbF9wYXRoX2tleSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICs9IDENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgT1NFcnJvcjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpbnJlZy5DbG9zZUtleShrZXkpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5yZWcuQ2xvc2VLZXkoa2V5KQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBNZXRob2QgNDogU2VhcmNoIGNvbW1vbiBpbnN0YWxsYXRpb24gbG9jYXRpb25zDQogICAgICAgIHVzZXJwcm9maWxlID0gb3MuZ2V0ZW52KCdVU0VSUFJPRklMRScsICcnKQ0KICAgICAgICBwcm9ncmFtZmlsZXMgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcycsIHInQzpcUHJvZ3JhbSBGaWxlcycpDQogICAgICAgIHByb2dyYW1maWxlc194ODYgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcyh4ODYpJywgcidDOlxQcm9ncmFtIEZpbGVzICh4ODYpJykNCiAgICAgICAgDQogICAgICAgIHNlYXJjaF9wYXRocyA9IFtdDQogICAgICAgIA0KICAgICAgICAjIFVzZXIgQXBwRGF0YSBsb2NhdGlvbnMgKG1vc3QgY29tbW9uIGZvciBQeXRob24gMy44KykNCiAgICAgICAgaWYgdXNlcnByb2ZpbGU6DQogICAgICAgICAgICBhcHBkYXRhX2xvY2FsID0gb3MucGF0aC5qb2luKHVzZXJwcm9maWxlLCByIkFwcERhdGFcTG9jYWxcUHJvZ3JhbXNcUHl0aG9uIikNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGFwcGRhdGFfbG9jYWwpOg0KICAgICAgICAgICAgICAgICMgU2VhcmNoIGFsbCBQeXRob24gdmVyc2lvbnMgaW4gdGhpcyBkaXJlY3RvcnkNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGZvciBpdGVtIGluIG9zLmxpc3RkaXIoYXBwZGF0YV9sb2NhbCk6DQogICAgICAgICAgICAgICAgICAgICAgICBweXRob25fZGlyID0gb3MucGF0aC5qb2luKGFwcGRhdGFfbG9jYWwsIGl0ZW0pDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZGlyKHB5dGhvbl9kaXIpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl9leGUgPSBvcy5wYXRoLmpvaW4ocHl0aG9uX2RpciwgInB5dGhvbi5leGUiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hfcGF0aHMuYXBwZW5kKHB5dGhvbl9leGUpDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIENvbW1vbiByb290LWxldmVsIFB5dGhvbiBpbnN0YWxsYXRpb25zDQogICAgICAgIGZvciB2ZXJzaW9uIGluIFsnMzEyJywgJzMxMScsICczMTAnLCAnMzknLCAnMzgnXToNCiAgICAgICAgICAgIHNlYXJjaF9wYXRocy5leHRlbmQoWw0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihyIkM6XFB5dGhvbiIgKyB2ZXJzaW9uLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihwcm9ncmFtZmlsZXMsIGYiUHl0aG9ue3ZlcnNpb259IiwgInB5dGhvbi5leGUiKSwNCiAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4ocHJvZ3JhbWZpbGVzX3g4NiwgZiJQeXRob257dmVyc2lvbn0iLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgXSkNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgYWxsIGNvbGxlY3RlZCBwYXRocw0KICAgICAgICBmb3IgcGF0aCBpbiBzZWFyY2hfcGF0aHM6DQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhwYXRoKToNCiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aA0KICAgICAgICANCiAgICAgICAgIyBNZXRob2QgNTogUmVjdXJzaXZlIHNlYXJjaCBpbiBQcm9ncmFtIEZpbGVzIChsYXN0IHJlc29ydCwgc2xvd2VyKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBmb3Igcm9vdF9kaXIgaW4gW3Byb2dyYW1maWxlcywgcHJvZ3JhbWZpbGVzX3g4Nl06DQogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMocm9vdF9kaXIpOg0KICAgICAgICAgICAgICAgICAgICBmb3Igcm9vdCwgZGlycywgZmlsZXMgaW4gb3Mud2Fsayhyb290X2Rpcik6DQogICAgICAgICAgICAgICAgICAgICAgICAjIExpbWl0IGRlcHRoIHRvIGF2b2lkIHNsb3cgc2VhcmNoZXMNCiAgICAgICAgICAgICAgICAgICAgICAgIGRlcHRoID0gcm9vdFtsZW4ocm9vdF9kaXIpOl0uY291bnQob3Muc2VwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVwdGggPiAyOiAgIyBNYXggMiBsZXZlbHMgZGVlcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpcnNbOl0gPSBbXSAgIyBEb24ndCByZWN1cnNlIGRlZXBlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICdweXRob24uZXhlJyBpbiBmaWxlczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fZXhlID0gb3MucGF0aC5qb2luKHJvb3QsICdweXRob24uZXhlJykNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFZlcmlmeSBpdCdzIGFjdHVhbGx5IFB5dGhvbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oW3B5dGhvbl9leGUsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0aW1lb3V0PTEpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcHl0aG9uX2V4ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICByZXR1cm4gTm9uZQ0KICAgIA0KICAgIGRlZiBpc19weXRob25fdmVyc2lvbl9jb21wYXRpYmxlKHNlbGYsIHB5dGhvbl9leGUpOg0KICAgICAgICAiIiJDaGVjayBpZiBQeXRob24gdmVyc2lvbiBpcyBjb21wYXRpYmxlICgzLjgtMy4xMykuIiIiDQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgVHJ5IHRvIGdldCB2ZXJzaW9uIHdpdGhvdXQgaGFuZ2luZyAtIHVzZSBhIHZlcnkgc2hvcnQgdGltZW91dA0KICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgW3B5dGhvbl9leGUsICctLXZlcnNpb24nXSwNCiAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLA0KICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICB0aW1lb3V0PTENCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgdmVyc2lvbl9zdHIgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkgb3IgcmVzdWx0LnN0ZGVyci5zdHJpcCgpDQogICAgICAgICAgICAgICAgIyBQYXJzZSB2ZXJzaW9uIChlLmcuLCAiUHl0aG9uIDMuMTIuMCIgLT4gKDMsIDEyKSkNCiAgICAgICAgICAgICAgICBpbXBvcnQgcmUNCiAgICAgICAgICAgICAgICBtYXRjaCA9IHJlLnNlYXJjaChyJyhcZCspXC4oXGQrKScsIHZlcnNpb25fc3RyKQ0KICAgICAgICAgICAgICAgIGlmIG1hdGNoOg0KICAgICAgICAgICAgICAgICAgICBtYWpvciA9IGludChtYXRjaC5ncm91cCgxKSkNCiAgICAgICAgICAgICAgICAgICAgbWlub3IgPSBpbnQobWF0Y2guZ3JvdXAoMikpDQogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdmVyc2lvbiBpcyAzLjgtMy4xMw0KICAgICAgICAgICAgICAgICAgICBpZiBtYWpvciA9PSAzIGFuZCA4IDw9IG1pbm9yIDw9IDEzOg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICBkZWYgZmluZF9weXRob25fZXhlY3V0YWJsZV9kYWVtb24oc2VsZik6DQogICAgICAgICIiIkZpbmQgcHl0aG9uLmV4ZSBzcGVjaWZpY2FsbHkgKG5vdCBweXRob253LmV4ZSkgZm9yIGRhZW1vbi4NCiAgICAgICAgT25seSByZXR1cm5zIFB5dGhvbiB2ZXJzaW9ucyAzLjgtMy4xMyAoY29tcGF0aWJsZSB3aXRoIGRlcGVuZGVuY2llcykuIiIiDQogICAgICAgICMgVHJ5ICdweXRob24nIGNvbW1hbmQgZmlyc3QgKHNob3VsZCBiZSBweXRob24uZXhlKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3B5dGhvbicsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlLCB0aW1lb3V0PTEpDQogICAgICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSA9PSAwOg0KICAgICAgICAgICAgICAgIGlmIHNlbGYuaXNfcHl0aG9uX3ZlcnNpb25fY29tcGF0aWJsZSgncHl0aG9uJyk6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiAncHl0aG9uJw0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIFNlYXJjaCBmb3IgcHl0aG9uLmV4ZSBpbiBjb21tb24gbG9jYXRpb25zDQogICAgICAgIHVzZXJwcm9maWxlID0gb3MuZ2V0ZW52KCdVU0VSUFJPRklMRScsICcnKQ0KICAgICAgICBwcm9ncmFtZmlsZXMgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcycsIHInQzpcUHJvZ3JhbSBGaWxlcycpDQogICAgICAgIHByb2dyYW1maWxlc194ODYgPSBvcy5nZXRlbnYoJ1Byb2dyYW1GaWxlcyh4ODYpJywgcidDOlxQcm9ncmFtIEZpbGVzICh4ODYpJykNCiAgICAgICAgDQogICAgICAgIHB5dGhvbl92ZXJzaW9ucyA9IFtdICAjIExpc3Qgb2YgKHZlcnNpb25fdHVwbGUsIHBhdGgpIGZvciBzb3J0aW5nDQogICAgICAgIA0KICAgICAgICAjIFVzZXIgQXBwRGF0YSBsb2NhdGlvbnMgLSBjb2xsZWN0IGFsbCB2ZXJzaW9ucyBhbmQgY2hlY2sgY29tcGF0aWJpbGl0eQ0KICAgICAgICBpZiB1c2VycHJvZmlsZToNCiAgICAgICAgICAgIGFwcGRhdGFfbG9jYWwgPSBvcy5wYXRoLmpvaW4odXNlcnByb2ZpbGUsIHIiQXBwRGF0YVxMb2NhbFxQcm9ncmFtc1xQeXRob24iKQ0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoYXBwZGF0YV9sb2NhbCk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBmb3IgaXRlbSBpbiBvcy5saXN0ZGlyKGFwcGRhdGFfbG9jYWwpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2RpciA9IG9zLnBhdGguam9pbihhcHBkYXRhX2xvY2FsLCBpdGVtKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2RpcihweXRob25fZGlyKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fZXhlID0gb3MucGF0aC5qb2luKHB5dGhvbl9kaXIsICJweXRob24uZXhlIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBpZiB2ZXJzaW9uIGlzIGNvbXBhdGlibGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5pc19weXRob25fdmVyc2lvbl9jb21wYXRpYmxlKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBFeHRyYWN0IHZlcnNpb24gbnVtYmVyIGZyb20gZGlyZWN0b3J5IG5hbWUgKGUuZy4sICJQeXRob24zMTIiIC0+ICgzLCAxMikpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmVyc2lvbl9zdHIgPSBpdGVtLnJlcGxhY2UoIlB5dGhvbiIsICIiKS5yZXBsYWNlKCJweXRob24iLCAiIikucmVwbGFjZSgiLiIsICIiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHZlcnNpb25fc3RyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIEhhbmRsZSBmb3JtYXRzIGxpa2UgIjMxMiIsICIzOSIsICIzMTAiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxlbih2ZXJzaW9uX3N0cikgPj0gMjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ham9yID0gMw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGVuKHZlcnNpb25fc3RyKSA9PSAyOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbm9yID0gaW50KHZlcnNpb25fc3RyKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5vciA9IGludCh2ZXJzaW9uX3N0cls6Ml0pDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fdmVyc2lvbnMuYXBwZW5kKCgobWFqb3IsIG1pbm9yKSwgcHl0aG9uX2V4ZSkpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBJZiB3ZSBjYW4ndCBwYXJzZSwgY2hlY2sgYnkgcnVubmluZyBQeXRob24NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fdmVyc2lvbnMuYXBwZW5kKCgoMCwgMCksIHB5dGhvbl9leGUpKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBDb21tb24gcm9vdC1sZXZlbCBQeXRob24gaW5zdGFsbGF0aW9ucyAoMy44LTMuMTMpDQogICAgICAgIGZvciBtYWpvcl9taW5vciBpbiBbKDMsIDEzKSwgKDMsIDEyKSwgKDMsIDExKSwgKDMsIDEwKSwgKDMsIDkpLCAoMywgOCldOg0KICAgICAgICAgICAgdmVyc2lvbl9zdHIgPSBmInttYWpvcl9taW5vclswXX17bWFqb3JfbWlub3JbMV06MDJkfSIgICMgZS5nLiwgIjMxMiIsICIzOSINCiAgICAgICAgICAgIGZvciBiYXNlX3BhdGggaW4gWw0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihyZiJDOlxQeXRob257dmVyc2lvbl9zdHJ9IiwgInB5dGhvbi5leGUiKSwNCiAgICAgICAgICAgICAgICBvcy5wYXRoLmpvaW4ocHJvZ3JhbWZpbGVzLCBmIlB5dGhvbnt2ZXJzaW9uX3N0cn0iLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgICAgIG9zLnBhdGguam9pbihwcm9ncmFtZmlsZXNfeDg2LCBmIlB5dGhvbnt2ZXJzaW9uX3N0cn0iLCAicHl0aG9uLmV4ZSIpLA0KICAgICAgICAgICAgXToNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhiYXNlX3BhdGgpOg0KICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLmlzX3B5dGhvbl92ZXJzaW9uX2NvbXBhdGlibGUoYmFzZV9wYXRoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl92ZXJzaW9ucy5hcHBlbmQoKG1ham9yX21pbm9yLCBiYXNlX3BhdGgpKQ0KICAgICAgICANCiAgICAgICAgIyBTb3J0IGJ5IHZlcnNpb24gKG5ld2VzdCBmaXJzdCkgLSAoMywgMTMpID4gKDMsIDEyKSA+IC4uLiA+ICgzLCA4KQ0KICAgICAgICBweXRob25fdmVyc2lvbnMuc29ydChyZXZlcnNlPVRydWUsIGtleT1sYW1iZGEgeDogeFswXSkNCiAgICAgICAgDQogICAgICAgICMgUmV0dXJuIHRoZSBuZXdlc3QgY29tcGF0aWJsZSB2ZXJzaW9uDQogICAgICAgIGZvciAobWFqb3IsIG1pbm9yKSwgcGF0aCBpbiBweXRob25fdmVyc2lvbnM6DQogICAgICAgICAgICByZXR1cm4gcGF0aA0KICAgICAgICANCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICANCiAgICBkZWYgc3RhcnRfZGFlbW9uKHNlbGYpOg0KICAgICAgICAiIiJTdGFydCB0aGUgZGVhdGggY291bnRlciBkYWVtb24uIiIiDQogICAgICAgICMgSW5pdGlhbGl6ZSBkZWJ1ZyBsb2cgYXQgdGhlIHZlcnkgc3RhcnQgLSBNVVNUIGJlIGZpcnN0IHRoaW5nDQogICAgICAgIGRlYnVnX2xvZ19jcmVhdGVkID0gRmFsc2UNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgb3MubWFrZWRpcnMoQkFTRV9ESVIsIGV4aXN0X29rPVRydWUpICAjIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzDQogICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7Jz0nKjcwfVxuIikNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBzdGFydF9kYWVtb24oKSBjYWxsZWQgYXQge3RpbWUuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyl9XG4iKQ0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEJBU0VfRElSID0ge0JBU0VfRElSfVxuIikNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMT0NLX0ZJTEUgPSB7TE9DS19GSUxFfVxuIikNCiAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBSRUFEWV9GSUxFID0ge1JFQURZX0ZJTEV9XG4iKQ0KICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEJBU0VfRElSIGV4aXN0czoge29zLnBhdGguZXhpc3RzKEJBU0VfRElSKX1cbiIpDQogICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogQkFTRV9ESVIgd3JpdGFibGU6IHtvcy5hY2Nlc3MoQkFTRV9ESVIsIG9zLldfT0spfVxuIikNCiAgICAgICAgICAgICAgICBmLmZsdXNoKCkgICMgRm9yY2Ugd3JpdGUNCiAgICAgICAgICAgIGRlYnVnX2xvZ19jcmVhdGVkID0gVHJ1ZQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAjIElmIHdlIGNhbid0IHdyaXRlIGRlYnVnIGxvZywgdHJ5IHRvIHNob3cgZXJyb3IgaW4gbWVzc2FnZWJveA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJEZWJ1ZyBMb2cgRXJyb3IiLCBmIkNvdWxkIG5vdCBjcmVhdGUgZGVidWcgbG9nOiB7ZX1cblxuQkFTRV9ESVI6IHtCQVNFX0RJUn0iKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgaWYgZGFlbW9uIGlzIHJ1bm5pbmcNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiR1VJOiBDYWxsaW5nIGlzX2RhZW1vbl9ydW5uaW5nKCkuLi5cbiIpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgDQogICAgICAgIGRhZW1vbl9ydW5uaW5nX2NoZWNrID0gc2VsZi5pc19kYWVtb25fcnVubmluZygpDQogICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBpc19kYWVtb25fcnVubmluZygpIHJldHVybmVkOiB7ZGFlbW9uX3J1bm5pbmdfY2hlY2t9XG4iKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICBpZiBkYWVtb25fcnVubmluZ19jaGVjazoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIkdVSTogRGFlbW9uIGFwcGVhcnMgdG8gYmUgcnVubmluZyAtIGNoZWNraW5nIHByb2Nlc3MuLi5cbiIpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGUgcHJvY2VzcyBpcyBhY3R1YWxseSBydW5uaW5nDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKExPQ0tfRklMRSwgInIiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBwaWRfc3RyID0gZi5yZWFkKCkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgIGlmIHBpZF9zdHI6DQogICAgICAgICAgICAgICAgICAgIHBpZCA9IGludChwaWRfc3RyKQ0KICAgICAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgZXhpc3RzDQogICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCBwc3V0aWwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBzdXRpbC5waWRfZXhpc3RzKHBpZCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiSW5mbyIsIGYiRGFlbW9uIGlzIGFscmVhZHkgcnVubmluZyAoUElEOiB7cGlkfSkuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTdGFsZSBsb2NrIGZpbGUgLSBwcm9jZXNzIGRvZXNuJ3QgZXhpc3QNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoTE9DS19GSUxFKQ0KICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAjIHBzdXRpbCBub3QgYXZhaWxhYmxlIG9yIG90aGVyIGVycm9yIC0gdHJ5IHRhc2tsaXN0DQogICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsidGFza2xpc3QiLCAiL0ZJIiwgZiJQSUQgZXEge3BpZH0iXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZiJ7cGlkfSIgaW4gcmVzdWx0LnN0ZG91dDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiSW5mbyIsIGYiRGFlbW9uIGlzIGFscmVhZHkgcnVubmluZyAoUElEOiB7cGlkfSkuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBTdGFsZSBsb2NrIGZpbGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKExPQ0tfRklMRSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIENhbid0IGNoZWNrIC0gcmVtb3ZlIGxvY2sgZmlsZSB0byBiZSBzYWZlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoTE9DS19GSUxFKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICMgQ2FuJ3QgcmVhZCBsb2NrIGZpbGUgLSByZW1vdmUgaXQNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShMT0NLX0ZJTEUpDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIENoZWNrIGlmIHNjcmlwdCBleGlzdHMgKHRyeSBib3RoIHBvc3NpYmxlIG5hbWVzKQ0KICAgICAgICBzY3JpcHRfcGF0aCA9IFNDUklQVF9QQVRIDQogICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhzY3JpcHRfcGF0aCk6DQogICAgICAgICAgICBhbHRfcGF0aCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgIm11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weSIpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhhbHRfcGF0aCk6DQogICAgICAgICAgICAgICAgc2NyaXB0X3BhdGggPSBhbHRfcGF0aA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBtZXNzYWdlYm94LnNob3dlcnJvcigiRXJyb3IiLCBmIkRlYXRoIGNvdW50ZXIgc2NyaXB0IG5vdCBmb3VuZC5cblxuTG9va2luZyBmb3I6XG57U0NSSVBUX1BBVEh9XG5vclxue2FsdF9wYXRofSIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJHVUk6IEZpbmRpbmcgUHl0aG9uIGV4ZWN1dGFibGUuLi5cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IHN5cy5mcm96ZW4gPSB7Z2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSl9XG4iKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIEZpbmQgUHl0aG9uIGV4ZWN1dGFibGUgKHVzZSBweXRob24uZXhlLCBub3QgcHl0aG9udy5leGUgZm9yIGRhZW1vbikNCiAgICAgICAgcHl0aG9uX2NtZCA9IE5vbmUNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiR1VJOiBBYm91dCB0byBjaGVjayBzeXMuZnJvemVuLi4uXG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgICAgICAgICAgIyBSdW5uaW5nIGFzIGNvbXBpbGVkIGV4ZSAtIG5lZWQgdG8gZmluZCBQeXRob24NCiAgICAgICAgICAgICAgICAjIEZpcnN0IHRyeSB0byBmaW5kIHB5dGhvbi5leGUgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICBweXRob25fY21kID0gc2VsZi5maW5kX3B5dGhvbl9leGVjdXRhYmxlX2RhZW1vbigpDQogICAgICAgICAgICAgICAgaWYgbm90IHB5dGhvbl9jbWQ6DQogICAgICAgICAgICAgICAgICAgICMgRmFsbGJhY2sgdG8gcmVndWxhciBmaW5kZXINCiAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2NtZCA9IHNlbGYuZmluZF9weXRob25fZXhlY3V0YWJsZSgpDQogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBweXRob25fY21kOg0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgIlB5dGhvbiBub3QgZm91bmQuIFBsZWFzZSBpbnN0YWxsIFB5dGhvbiBhbmQgYWRkIGl0IHRvIFBBVEgsIG9yIHJlc3RhcnQgdGhlIGluc3RhbGxlciBhZnRlciBpbnN0YWxsaW5nIFB5dGhvbi4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBFbnN1cmUgd2UncmUgdXNpbmcgcHl0aG9uLmV4ZSwgbm90IHB5dGhvbncuZXhlDQogICAgICAgICAgICAgICAgaWYgcHl0aG9uX2NtZC5lbmRzd2l0aCgncHl0aG9udy5leGUnKSBvciAncHl0aG9udycgaW4gcHl0aG9uX2NtZC5sb3dlcigpOg0KICAgICAgICAgICAgICAgICAgICAjIFRyeSB0byBmaW5kIHB5dGhvbi5leGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5DQogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9jbWQpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2RpciA9IG9zLnBhdGguZGlybmFtZShweXRob25fY21kKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2V4ZSA9IG9zLnBhdGguam9pbihweXRob25fZGlyLCAicHl0aG9uLmV4ZSIpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBweXRob25fY21kID0gcHl0aG9uX2V4ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFRyeSByZXBsYWNpbmcgcHl0aG9udyB3aXRoIHB5dGhvbiBpbiB0aGUgcGF0aA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB5dGhvbl9jbWQgPSBweXRob25fY21kLnJlcGxhY2UoJ3B5dGhvbncuZXhlJywgJ3B5dGhvbi5leGUnKS5yZXBsYWNlKCdweXRob253JywgJ3B5dGhvbicpDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICMgUnVubmluZyBhcyBzY3JpcHQgLSB1c2Ugc3lzLmV4ZWN1dGFibGUNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBSdW5uaW5nIGFzIHNjcmlwdCwgdXNpbmcgc3lzLmV4ZWN1dGFibGVcbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogc3lzLmV4ZWN1dGFibGUgPSB7c3lzLmV4ZWN1dGFibGV9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgIHB5dGhvbl9jbWQgPSBzeXMuZXhlY3V0YWJsZQ0KICAgICAgICAgICAgICAgICMgSWYgaXQncyBweXRob253LCB0cnkgdG8gZmluZCBweXRob24uZXhlDQogICAgICAgICAgICAgICAgaWYgcHl0aG9uX2NtZC5lbmRzd2l0aCgncHl0aG9udy5leGUnKToNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogc3lzLmV4ZWN1dGFibGUgaXMgcHl0aG9udy5leGUsIGxvb2tpbmcgZm9yIHB5dGhvbi5leGVcbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgIHB5dGhvbl9kaXIgPSBvcy5wYXRoLmRpcm5hbWUocHl0aG9uX2NtZCkNCiAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2V4ZSA9IG9zLnBhdGguam9pbihweXRob25fZGlyLCAicHl0aG9uLmV4ZSIpDQogICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHl0aG9uX2NtZCA9IHB5dGhvbl9leGUNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEZvdW5kIHB5dGhvbi5leGU6IHtweXRob25fZXhlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IHB5dGhvbi5leGUgbm90IGZvdW5kIGluIHtweXRob25fZGlyfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBVc2luZyBzeXMuZXhlY3V0YWJsZSBhcy1pczoge3B5dGhvbl9jbWR9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAjIElmIHRoZXJlJ3MgYW4gZXJyb3IgZmluZGluZyBQeXRob24sIGxvZyBpdA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogRVJST1IgaW4gUHl0aG9uIGZpbmRpbmcgbG9naWM6IHtlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGltcG9ydCB0cmFjZWJhY2sNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUodHJhY2ViYWNrLmZvcm1hdF9leGMoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRXJyb3IgZmluZGluZyBQeXRob24gZXhlY3V0YWJsZToge2V9IikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogRmluYWwgUHl0aG9uIGNvbW1hbmQ6IHtweXRob25fY21kfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUHl0aG9uIGV4aXN0czoge29zLnBhdGguZXhpc3RzKHB5dGhvbl9jbWQpIGlmIHB5dGhvbl9jbWQgZWxzZSBGYWxzZX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICBpZiBub3QgcHl0aG9uX2NtZDoNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIkdVSTogRVJST1IgLSBweXRob25fY21kIGlzIE5vbmUhXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZi5mbHVzaCgpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgIkNvdWxkIG5vdCBkZXRlcm1pbmUgUHl0aG9uIGV4ZWN1dGFibGUuIikNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICANCiAgICAgICAgIyBTa2lwIFB5dGhvbiB0ZXN0IC0gd2UgYWxyZWFkeSB2ZXJpZmllZCB0aGUgZXhlY3V0YWJsZSBleGlzdHMNCiAgICAgICAgIyBUaGUgdGVzdCB3YXMgdGltaW5nIG91dCBvbiBzb21lIHN5c3RlbXMgKGVzcGVjaWFsbHkgd2l0aCBtdWx0aXBsZSBQeXRob24gdmVyc2lvbnMpLA0KICAgICAgICAjIGFuZCB3ZSdsbCBnZXQgYmV0dGVyIGVycm9yIG1lc3NhZ2VzIGZyb20gdGhlIGRhZW1vbiBpdHNlbGYgaWYgUHl0aG9uIGRvZXNuJ3Qgd29yaw0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKCJHVUk6IFNraXBwaW5nIFB5dGhvbiB0ZXN0IChhbHJlYWR5IHZlcmlmaWVkIGV4ZWN1dGFibGUgZXhpc3RzKVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogVXNpbmcgUHl0aG9uOiB7cHl0aG9uX2NtZH1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoIkdVSTogUHJvY2VlZGluZyBkaXJlY3RseSB0byBzdGFydCBkYWVtb25cbiIpDQogICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwYXNzDQogICAgICAgIA0KICAgICAgICAjIFN0YXJ0IGRhZW1vbiBpbiBiYWNrZ3JvdW5kDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEFib3V0IHRvIHN0YXJ0IGRhZW1vbiBwcm9jZXNzIHdpdGggc3VicHJvY2Vzcy5Qb3BlblxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUHl0aG9uOiB7cHl0aG9uX2NtZH1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFNjcmlwdDoge3NjcmlwdF9wYXRofVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogV29ya2luZyBkaXI6IHtCQVNFX0RJUn1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFNjcmlwdCBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhzY3JpcHRfcGF0aCl9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgIyBVc2Ugc3VicHJvY2Vzcy5QSVBFIGJ1dCBhbHNvIGFsbG93IHNlZWluZyBvdXRwdXQgZm9yIGRlYnVnZ2luZw0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiR1VJOiBDYWxsaW5nIHN1YnByb2Nlc3MuUG9wZW4oKSBub3cuLi5cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICANCiAgICAgICAgICAgIENSRUFURV9OT19XSU5ET1cgPSAweDA4MDAwMDAwIGlmIGhhc2F0dHIoc3VicHJvY2VzcywgJ0NSRUFURV9OT19XSU5ET1cnKSBlbHNlIDANCiAgICAgICAgICAgIGlmIHN5cy5wbGF0Zm9ybSA9PSAid2luMzIiOg0KICAgICAgICAgICAgICAgIHNlbGYuZGFlbW9uX3Byb2Nlc3MgPSBzdWJwcm9jZXNzLlBvcGVuKA0KICAgICAgICAgICAgICAgICAgICBbcHl0aG9uX2NtZCwgc2NyaXB0X3BhdGhdLA0KICAgICAgICAgICAgICAgICAgICBjd2Q9QkFTRV9ESVIsDQogICAgICAgICAgICAgICAgICAgIHN0ZG91dD1zdWJwcm9jZXNzLlBJUEUsDQogICAgICAgICAgICAgICAgICAgIHN0ZGVycj1zdWJwcm9jZXNzLlNURE9VVCwgICMgTWVyZ2Ugc3RkZXJyIGludG8gc3Rkb3V0DQogICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgYnVmc2l6ZT0xLCAgIyBMaW5lIGJ1ZmZlcmVkDQogICAgICAgICAgICAgICAgICAgIGNyZWF0aW9uZmxhZ3M9Q1JFQVRFX05PX1dJTkRPVw0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5kYWVtb25fcHJvY2VzcyA9IHN1YnByb2Nlc3MuUG9wZW4oDQogICAgICAgICAgICAgICAgICAgIFtweXRob25fY21kLCBzY3JpcHRfcGF0aF0sDQogICAgICAgICAgICAgICAgICAgIGN3ZD1CQVNFX0RJUiwNCiAgICAgICAgICAgICAgICAgICAgc3Rkb3V0PXN1YnByb2Nlc3MuUElQRSwNCiAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuU1RET1VULA0KICAgICAgICAgICAgICAgICAgICB0ZXh0PVRydWUsDQogICAgICAgICAgICAgICAgICAgIGJ1ZnNpemU9MQ0KICAgICAgICAgICAgICAgICkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogc3VicHJvY2Vzcy5Qb3BlbigpIGNvbXBsZXRlZFxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IERhZW1vbiBwcm9jZXNzIFBJRDoge3NlbGYuZGFlbW9uX3Byb2Nlc3MucGlkfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFByb2Nlc3MgcG9sbCByZXN1bHQ6IHtzZWxmLmRhZW1vbl9wcm9jZXNzLnBvbGwoKX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBFUlJPUiBsb2dnaW5nIHByb2Nlc3MgaW5mbzoge2V9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYuZmx1c2goKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBFUlJPUiAtIEV4Y2VwdGlvbiBkdXJpbmcgc3VicHJvY2Vzcy5Qb3BlbigpOiB7ZX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgdHJhY2ViYWNrDQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKHRyYWNlYmFjay5mb3JtYXRfZXhjKCkpDQogICAgICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICBtZXNzYWdlYm94LnNob3dlcnJvcigiRXJyb3IiLCBmIkVycm9yIHN0YXJ0aW5nIGRhZW1vbjoge2V9XG5cblB5dGhvbjoge3B5dGhvbl9jbWR9XG5TY3JpcHQ6IHtzY3JpcHRfcGF0aH0iKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICAjIFdhaXQgZm9yIGRhZW1vbiB0byBzdGFydCAtIHBvbGwgYm90aCBwcm9jZXNzIGFuZCBsb2NrIGZpbGUNCiAgICAgICAgbWF4X3dhaXRfdGltZSA9IDE1ICAjIFdhaXQgdXAgdG8gMTUgc2Vjb25kcyAoaW5jcmVhc2VkIGZvciBzYWZldHkpDQogICAgICAgIGNoZWNrX2ludGVydmFsID0gMC4yICAjIENoZWNrIGV2ZXJ5IDAuMiBzZWNvbmRzIChtb3JlIGZyZXF1ZW50KQ0KICAgICAgICB3YWl0ZWQgPSAwDQogICAgICAgIHByb2Nlc3NfZXhpdGVkID0gRmFsc2UNCiAgICAgICAgbG9ja19maWxlX2NyZWF0ZWQgPSBGYWxzZQ0KICAgICAgICANCiAgICAgICAgIyBEZWJ1ZzogTG9nIHBhdGhzIGJlaW5nIGNoZWNrZWQgdG8gZmlsZQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBkZWJ1Z19sb2dfY3JlYXRlZDoNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiXG57Jz0nKjcwfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogU3RhcnRpbmcgZGFlbW9uIGF0IHt0aW1lLnN0cmZ0aW1lKCclWS0lbS0lZCAlSDolTTolUycpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogQ2hlY2tpbmcgZm9yIExPQ0tfRklMRSBhdDoge0xPQ0tfRklMRX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IENoZWNraW5nIGZvciBSRUFEWV9GSUxFIGF0OiB7UkVBRFlfRklMRX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEJBU0VfRElSIGlzOiB7QkFTRV9ESVJ9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBTY3JpcHQgcGF0aDoge3NjcmlwdF9wYXRofVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUHl0aG9uIGNtZDoge3B5dGhvbl9jbWR9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMT0NLX0ZJTEUgZXhpc3RzOiB7b3MucGF0aC5leGlzdHMoTE9DS19GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFJFQURZX0ZJTEUgZXhpc3RzOiB7b3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSl9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgd2hpbGUgd2FpdGVkIDwgbWF4X3dhaXRfdGltZToNCiAgICAgICAgICAgICMgTG9nIGV2ZXJ5IDIgc2Vjb25kcyB3aGF0IHdlJ3JlIGNoZWNraW5nDQogICAgICAgICAgICBpZiB3YWl0ZWQgPiAwIGFuZCBpbnQod2FpdGVkICogMTApICUgMTAgPT0gMDogICMgRXZlcnkgMSBzZWNvbmQNCiAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGVidWdfbG9nX2NyZWF0ZWQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKEdVSV9ERUJVR19MT0csICJhIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogV2FpdCBsb29wIC0gd2FpdGVkIHt3YWl0ZWQ6LjFmfXMsIGNoZWNraW5nIGZpbGVzLi4uXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiAgIExPQ0tfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogICBSRUFEWV9GSUxFIGV4aXN0czoge29zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogICBQcm9jZXNzIHJ1bm5pbmc6IHtzZWxmLmRhZW1vbl9wcm9jZXNzLnBvbGwoKSBpcyBOb25lfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgZXhpdGVkIChlcnJvcikNCiAgICAgICAgICAgIGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIG5vdCBOb25lOg0KICAgICAgICAgICAgICAgICAgICBwcm9jZXNzX2V4aXRlZCA9IFRydWUNCiAgICAgICAgICAgICAgICAgICAgIyBQcm9jZXNzIGV4aXRlZCAtIHRoZXJlIHdhcyBhbiBlcnJvcg0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQsIF8gPSBzZWxmLmRhZW1vbl9wcm9jZXNzLmNvbW11bmljYXRlKHRpbWVvdXQ9MSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICIiDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBzdGRvdXQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gc3Rkb3V0LnN0cmlwKCkgaWYgaXNpbnN0YW5jZShzdGRvdXQsIHN0cikgZWxzZSBzdGRvdXQuZGVjb2RlKCd1dGYtOCcsIGVycm9ycz0naWdub3JlJykuc3RyaXAoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGVycm9yX21zZzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBmIlByb2Nlc3MgZXhpdGVkIHdpdGggY29kZSB7c2VsZi5kYWVtb25fcHJvY2Vzcy5yZXR1cm5jb2RlfSINCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIyBDaGVjayBkZWJ1Zy5sb2cgZm9yIG1vcmUgZGV0YWlscw0KICAgICAgICAgICAgICAgICAgICAgICAgbG9nX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMobG9nX2ZpbGUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGluZXM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9saW5lcyA9ICcnLmpvaW4obGluZXNbLTU6XSkgICMgTGFzdCA1IGxpbmVzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGFzdF9saW5lcy5zdHJpcCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gZiJcblxuTGFzdCBsb2cgZW50cmllczpcbntsYXN0X2xpbmVzWzo0MDBdfSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgIyBUcnkgdG8gZ2V0IG1vcmUgaW5mbyBieSBydW5uaW5nIHRoZSBzY3JpcHQgZGlyZWN0bHkNCiAgICAgICAgICAgICAgICAgICAgICAgIGRpcmVjdF90ZXN0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgW3B5dGhvbl9jbWQsIHNjcmlwdF9wYXRoXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PTUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3dkPUJBU0VfRElSDQogICAgICAgICAgICAgICAgICAgICAgICApDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXJlY3RfdGVzdC5zdGRlcnI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnID0gZGlyZWN0X3Rlc3Quc3RkZXJyWzo1MDBdDQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGRpcmVjdF90ZXN0LnN0ZG91dDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgPSBkaXJlY3RfdGVzdC5zdGRvdXRbOjUwMF0NCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJGYWlsZWQgdG8gc3RhcnQgZGFlbW9uLlxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cbkVycm9yOiB7ZXJyb3JfbXNnWzo1MDBdfSIpDQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJFcnJvciIsIGYiRmFpbGVkIHRvIHN0YXJ0IGRhZW1vbi5cblxuUHl0aG9uOiB7cHl0aG9uX2NtZH1cblNjcmlwdDoge3NjcmlwdF9wYXRofVxuXG5Qcm9jZXNzIGV4aXRlZCBpbW1lZGlhdGVseS4gQ2hlY2sgaWYgYWxsIGRlcGVuZGVuY2llcyBhcmUgaW5zdGFsbGVkLlxuXG5FeGNlcHRpb246IHtlfSIpDQogICAgICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENoZWNrIGlmIGxvY2sgZmlsZSBleGlzdHMgKGV2ZW4gaWYgcHJvY2VzcyBjaGVjayBmYWlscykNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6DQogICAgICAgICAgICAgICAgICAgIGxvY2tfZmlsZV9jcmVhdGVkID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBpZiB3YWl0ZWQgPCAwLjU6ICAjIE9ubHkgbG9nIG9uY2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMb2NrIGZpbGUgZm91bmQgYXQ6IHtMT0NLX0ZJTEV9XG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgICAgICMgQ2hlY2sgZm9yIHJlYWR5IGZpbGUgKGRhZW1vbiBmdWxseSBpbml0aWFsaXplZCkNCiAgICAgICAgICAgICAgICAgICAgIyBBbHNvIHZlcmlmeSB0aGUgZmlsZSBhY3R1YWxseSBoYXMgY29udGVudCAobm90IGp1c3QgY3JlYXRlZCkNCiAgICAgICAgICAgICAgICAgICAgIyBUcnkgbXVsdGlwbGUgdGltZXMgd2l0aCBzbWFsbCBkZWxheSB0byBoYW5kbGUgZmlsZXN5c3RlbSBkZWxheXMNCiAgICAgICAgICAgICAgICAgICAgcmVhZHlfZmlsZV9mb3VuZCA9IEZhbHNlDQogICAgICAgICAgICAgICAgICAgIGZvciBjaGVja19hdHRlbXB0IGluIHJhbmdlKDUpOiAgIyBJbmNyZWFzZWQgcmV0cmllcw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFZlcmlmeSBmaWxlIGhhcyBjb250ZW50IGFuZCBpcyByZWNlbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdCA9IG9zLnN0YXQoUkVBRFlfRklMRSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RhdC5zdF9zaXplID4gMDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRG91YmxlLWNoZWNrIHRoZSBwcm9jZXNzIGlzIHN0aWxsIHJ1bm5pbmcNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBEYWVtb24gaXMgZnVsbHkgcmVhZHkhDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUmVhZHkgZmlsZSBmb3VuZCBhbmQgdmVyaWZpZWQhIFNpemU6IHtzdGF0LnN0X3NpemV9IGJ5dGVzXG4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogRGFlbW9uIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5IVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnVwZGF0ZV9zdGF0dXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2luZm8oIlN1Y2Nlc3MiLCAiRGVhdGggY291bnRlciBkYWVtb24gc3RhcnRlZCBzdWNjZXNzZnVsbHkhIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBQcm9jZXNzIGRpZWQgLSBicmVhayBvdXQgYW5kIHNob3cgZXJyb3INCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBSZWFkeSBmaWxlIGV4aXN0cyBidXQgcHJvY2VzcyBleGl0ZWQgKGNvZGU6IHtzZWxmLmRhZW1vbl9wcm9jZXNzLnJldHVybmNvZGV9KVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFJlYWR5IGZpbGUgZXhpc3RzIGJ1dCBpcyBlbXB0eSAoYXR0ZW1wdCB7Y2hlY2tfYXR0ZW1wdCArIDF9KVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oR1VJX0RFQlVHX0xPRywgImEiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IEVycm9yIGNoZWNraW5nIHJlYWR5IGZpbGU6IHtlfVxuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGVja19hdHRlbXB0ID09IDAgYW5kIHdhaXRlZCA+IDE6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUmVhZHkgZmlsZSBub3QgZm91bmQgeWV0IChhdHRlbXB0IHtjaGVja19hdHRlbXB0ICsgMX0pLCB3YWl0ZWQge3dhaXRlZDouMWZ9c1xuIikNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiR1VJOiBMT0NLX0ZJTEUgZXhpc3RzOiB7b3MucGF0aC5leGlzdHMoTE9DS19GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUkVBRFlfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhSRUFEWV9GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICMgU21hbGwgZGVsYXkgYmVmb3JlIHJldHJ5IChmaWxlc3lzdGVtIG1pZ2h0IG5lZWQgdGltZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrX2F0dGVtcHQgPCA0Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4yKQ0KICAgICAgICAgICAgICAgICAgICAjIExvY2sgZmlsZSBleGlzdHMgYnV0IG5vdCByZWFkeSB5ZXQgLSBjaGVjayBkZWJ1Zy5sb2cgdG8gc2VlIHdoYXQncyBoYXBwZW5pbmcNCiAgICAgICAgICAgICAgICAgICAgbG9nX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSkgYW5kIHdhaXRlZCA+IDI6ICAjIE9ubHkgY2hlY2sgbG9nIGFmdGVyIDIgc2Vjb25kcw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBsaW5lczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbGluZSA9IGxpbmVzWy0xXS5zdHJpcCgpIGlmIGxpbmVzIGVsc2UgIiINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgSWYgd2Ugc2VlICJSZWFkeSBmaWxlIGNyZWF0ZWQiIGJ1dCBmaWxlIGRvZXNuJ3QgZXhpc3QsIHRoZXJlJ3MgYSBmaWxlc3lzdGVtIGlzc3VlDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAiUmVhZHkgZmlsZSBjcmVhdGVkIiBpbiBsYXN0X2xpbmUgb3IgIlJFQURZX0ZJTEUgY3JlYXRlZCIgaW4gbGFzdF9saW5lOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgRmlsZSBzaG91bGQgZXhpc3QgLSBtYXliZSBmaWxlc3lzdGVtIGRlbGF5LCB3YWl0IGEgYml0IG1vcmUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhSRUFEWV9GSUxFKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi51cGRhdGVfc3RhdHVzKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93aW5mbygiU3VjY2VzcyIsICJEZWF0aCBjb3VudGVyIGRhZW1vbiBzdGFydGVkIHN1Y2Nlc3NmdWxseSEiKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXNzDQogICAgICAgICAgICAgICAgICAgICMgTG9jayBmaWxlIGV4aXN0cyBidXQgbm90IHJlYWR5IHlldCAtIGdpdmUgaXQgbW9yZSB0aW1lDQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMC4yKQ0KICAgICAgICAgICAgICAgICAgICBjb250aW51ZQ0KICAgICAgICAgICAgIyBBbHNvIGNoZWNrIGlmIHByb2Nlc3MgaXMgc3RpbGwgcnVubmluZyAoZXZlbiB3aXRob3V0IGxvY2sgZmlsZSB5ZXQpDQogICAgICAgICAgICBlbGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgIyBQcm9jZXNzIGlzIHJ1bm5pbmcsIG1pZ2h0IHN0aWxsIGJlIGluaXRpYWxpemluZw0KICAgICAgICAgICAgICAgIGNvbnRpbnVlDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgV2FpdCBhIGJpdCBiZWZvcmUgY2hlY2tpbmcgYWdhaW4NCiAgICAgICAgICAgIHRpbWUuc2xlZXAoY2hlY2tfaW50ZXJ2YWwpDQogICAgICAgICAgICB3YWl0ZWQgKz0gY2hlY2tfaW50ZXJ2YWwNCiAgICAgICAgDQogICAgICAgICMgVGltZW91dCAtIGNoZWNrIHdoYXQgaGFwcGVuZWQNCiAgICAgICAgIyBMb2cgdGltZW91dCB0byBkZWJ1ZyBmaWxlDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIGRlYnVnX2xvZ19jcmVhdGVkOg0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihHVUlfREVCVUdfTE9HLCAiYSIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFRJTUVPVVQgYWZ0ZXIge3dhaXRlZDouMWZ9IHNlY29uZHNcbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IExPQ0tfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpfVxuIikNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIkdVSTogUkVBRFlfRklMRSBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhSRUFEWV9GSUxFKX1cbiIpDQogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiJHVUk6IFByb2Nlc3MgcnVubmluZzoge3NlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmV9XG4iKQ0KICAgICAgICAgICAgICAgICAgICBmLmZsdXNoKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgIyBGaXJzdCwgY2hlY2sgZm9yIHN0YXJ0dXAgZXJyb3IgZmlsZQ0KICAgICAgICBzdGFydHVwX2Vycm9yX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb25fc3RhcnR1cF9lcnJvci50eHQiKQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzdGFydHVwX2Vycm9yX2ZpbGUpOg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHdpdGggb3BlbihzdGFydHVwX2Vycm9yX2ZpbGUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBlcnJvcl9jb250ZW50ID0gZi5yZWFkKCkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgIGlmIGVycm9yX2NvbnRlbnQ6DQogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2Vib3guc2hvd2Vycm9yKCJEYWVtb24gU3RhcnR1cCBFcnJvciIsIA0KICAgICAgICAgICAgICAgICAgICAgICAgZiJEYWVtb24gZW5jb3VudGVyZWQgYW4gZXJyb3IgZHVyaW5nIHN0YXJ0dXA6XG5cbntlcnJvcl9jb250ZW50WzoxMDAwXX1cblxuIg0KICAgICAgICAgICAgICAgICAgICAgICAgZiJQeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9IikNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICANCiAgICAgICAgaWYgcHJvY2Vzc19leGl0ZWQ6DQogICAgICAgICAgICAjIEFscmVhZHkgaGFuZGxlZCBhYm92ZQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGVsaWYgbG9ja19maWxlX2NyZWF0ZWQgYW5kIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOg0KICAgICAgICAgICAgIyBCb3RoIGZpbGVzIGV4aXN0IC0gZGFlbW9uIHNob3VsZCBiZSBydW5uaW5nDQogICAgICAgICAgICBpZiBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCk6DQogICAgICAgICAgICAgICAgc2VsZi51cGRhdGVfc3RhdHVzKCkNCiAgICAgICAgICAgICAgICBtZXNzYWdlYm94LnNob3dpbmZvKCJTdWNjZXNzIiwgIkRlYXRoIGNvdW50ZXIgZGFlbW9uIHN0YXJ0ZWQgc3VjY2Vzc2Z1bGx5ISIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9ICJSZWFkeSBmaWxlIGV4aXN0cyBidXQgcHJvY2VzcyBpcyBub3QgcnVubmluZy4iDQogICAgICAgIGVsaWYgbG9ja19maWxlX2NyZWF0ZWQ6DQogICAgICAgICAgICAjIExvY2sgZmlsZSBleGlzdHMgYnV0IHJlYWR5IGZpbGUgZG9lc24ndCAtIGRhZW1vbiBtYXkgYmUgc3R1Y2sgaW5pdGlhbGl6aW5nDQogICAgICAgICAgICBlcnJvcl9tc2cgPSAiTG9jayBmaWxlIGV4aXN0cyBidXQgZGFlbW9uIGRpZCBub3QgZmluaXNoIGluaXRpYWxpemluZyAocmVhZHkgZmlsZSBtaXNzaW5nKS4iDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgd2l0aCBvcGVuKExPQ0tfRklMRSwgInIiKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICBwaWRfc3RyID0gZi5yZWFkKCkuc3RyaXAoKQ0KICAgICAgICAgICAgICAgIGVycm9yX21zZyA9IGYiTG9jayBmaWxlIGV4aXN0cyAoUElEOiB7cGlkX3N0cn0pIGJ1dCBkYWVtb24gZGlkIG5vdCBmaW5pc2ggaW5pdGlhbGl6aW5nIChyZWFkeSBmaWxlIG1pc3NpbmcpLiINCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHByb2Nlc3MgaXMgc3RpbGwgcnVubmluZw0KICAgICAgICAgICAgICAgIHByb2Nlc3NfcnVubmluZyA9IEZhbHNlDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBpbXBvcnQgcHN1dGlsDQogICAgICAgICAgICAgICAgICAgIGlmIHBpZF9zdHI6DQogICAgICAgICAgICAgICAgICAgICAgICBwaWQgPSBpbnQocGlkX3N0cikNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBzdXRpbC5waWRfZXhpc3RzKHBpZCk6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc19ydW5uaW5nID0gVHJ1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyArPSBmIlxuXG5Qcm9jZXNzIHtwaWR9IGlzIHN0aWxsIHJ1bm5pbmcuIg0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gZiJcblxuUHJvY2VzcyB7cGlkfSBpcyBOT1QgcnVubmluZyAoc3RhbGUgbG9jayBmaWxlKS4iDQogICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAjIEZhbGxiYWNrOiBjaGVjayBpZiBkYWVtb24gcHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nDQogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuZGFlbW9uX3Byb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzX3J1bm5pbmcgPSBUcnVlDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gIlxuXG5EYWVtb24gcHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nLiINCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIElmIHByb2Nlc3MgaXMgcnVubmluZyBidXQgcmVhZHkgZmlsZSBtaXNzaW5nLCBjaGVjayBpZiBpdCdzIGp1c3Qgc2xvdw0KICAgICAgICAgICAgICAgIGlmIHByb2Nlc3NfcnVubmluZzoNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9ICJcblxuVGhpcyBtaWdodCBiZSBhIGZpbGVzeXN0ZW0gZGVsYXkuIFRoZSBkYWVtb24gbWF5IHN0aWxsIGJlIHN0YXJ0aW5nLiINCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9ICJcbkNoZWNrIGRlYnVnLmxvZyB0byBzZWUgaWYgJ1JlYWR5IGZpbGUgY3JlYXRlZCcgYXBwZWFycy4iDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENoZWNrIGRlYnVnLmxvZw0KICAgICAgICAgICAgbG9nX2ZpbGUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMobG9nX2ZpbGUpOg0KICAgICAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKGxvZ19maWxlLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmVzID0gZi5yZWFkbGluZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGluZXM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9saW5lcyA9ICcnLmpvaW4obGluZXNbLTE1Ol0pICAjIExhc3QgMTUgbGluZXMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl9tc2cgKz0gZiJcblxuTGFzdCBsb2cgZW50cmllczpcbntsYXN0X2xpbmVzWzo1MDBdfSINCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJ7ZXJyb3JfbXNnfVxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cblRyeSBzdG9wcGluZyBhbnkgZXhpc3RpbmcgZGFlbW9uIGZpcnN0LCB0aGVuIHN0YXJ0IGFnYWluLiIpDQogICAgICAgIGVsaWYgc2VsZi5kYWVtb25fcHJvY2Vzcy5wb2xsKCkgaXMgTm9uZToNCiAgICAgICAgICAgICMgUHJvY2VzcyBpcyBzdGlsbCBydW5uaW5nIGJ1dCBubyBsb2NrIGZpbGUNCiAgICAgICAgICAgIGVycm9yX21zZyA9ICJEYWVtb24gcHJvY2VzcyBpcyBydW5uaW5nIGJ1dCBmYWlsZWQgdG8gY3JlYXRlIGxvY2sgZmlsZS4iDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgIyBDaGVjayBkZWJ1Zy5sb2cgZm9yIGVycm9ycw0KICAgICAgICAgICAgICAgIGxvZ19maWxlID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVidWcubG9nIikNCiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSk6DQogICAgICAgICAgICAgICAgICAgIHdpdGggb3Blbihsb2dfZmlsZSwgJ3InLCBlbmNvZGluZz0ndXRmLTgnLCBlcnJvcnM9J2lnbm9yZScpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICBsaW5lcyA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGxpbmVzOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfbGluZXMgPSAnJy5qb2luKGxpbmVzWy0xNTpdKSAgIyBMYXN0IDE1IGxpbmVzDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9IGYiXG5cbkxhc3QgbG9nIGVudHJpZXM6XG57bGFzdF9saW5lc1s6NTAwXX0iDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgZXJyb3JfbXNnICs9ICJcblxuTm8gZGVidWcubG9nIGZvdW5kIC0gZGFlbW9uIG1heSBub3QgaGF2ZSBpbml0aWFsaXplZC4iDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJ7ZXJyb3JfbXNnfVxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cbkNoZWNrIGlmIGFsbCBkZXBlbmRlbmNpZXMgYXJlIGluc3RhbGxlZCBhbmQgVGVzc2VyYWN0IE9DUiBpcyBpbnN0YWxsZWQuIikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgICMgUHJvY2VzcyBleGl0ZWQgZHVyaW5nIHdhaXQNCiAgICAgICAgICAgIGVycm9yX21zZyA9ICJQcm9jZXNzIGV4aXRlZCBiZWZvcmUgY3JlYXRpbmcgbG9jayBmaWxlLiINCiAgICAgICAgICAgICMgQ2hlY2sgZGVidWcubG9nDQogICAgICAgICAgICBsb2dfZmlsZSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYnVnLmxvZyIpDQogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhsb2dfZmlsZSk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4obG9nX2ZpbGUsICdyJywgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOg0KICAgICAgICAgICAgICAgICAgICAgICAgbGluZXMgPSBmLnJlYWRsaW5lcygpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBsaW5lczoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0X2xpbmVzID0gJycuam9pbihsaW5lc1stMTU6XSkgICMgTGFzdCAxNSBsaW5lcw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX21zZyArPSBmIlxuXG5MYXN0IGxvZyBlbnRyaWVzOlxue2xhc3RfbGluZXNbOjUwMF19Ig0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICAgICAgbWVzc2FnZWJveC5zaG93ZXJyb3IoIkVycm9yIiwgZiJ7ZXJyb3JfbXNnfVxuXG5QeXRob246IHtweXRob25fY21kfVxuU2NyaXB0OiB7c2NyaXB0X3BhdGh9XG5cbkNoZWNrIGRlYnVnLmxvZyBmb3IgZGV0YWlscy4iKQ0KICAgIA0KICAgIGRlZiBzdG9wX2RhZW1vbihzZWxmKToNCiAgICAgICAgIiIiU3RvcCB0aGUgZGVhdGggY291bnRlciBkYWVtb24uIiIiDQogICAgICAgIGlmIG5vdCBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCk6DQogICAgICAgICAgICAjIFNpbGVudGx5IHJldHVybiAtIG5vIHBvcHVwDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgDQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgQ3JlYXRlIFNUT1AgZmlsZQ0KICAgICAgICAgICAgd2l0aCBvcGVuKFNUT1BfRklMRSwgInciKSBhcyBmOg0KICAgICAgICAgICAgICAgIGYud3JpdGUoIiIpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgV2FpdCBmb3IgZGFlbW9uIHRvIHN0b3ANCiAgICAgICAgICAgIGZvciBpIGluIHJhbmdlKDEwKToNCiAgICAgICAgICAgICAgICB0aW1lLnNsZWVwKDEpDQogICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuaXNfZGFlbW9uX3J1bm5pbmcoKToNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBJZiBzdGlsbCBydW5uaW5nLCB0cnkgdG8ga2lsbCBwcm9jZXNzDQogICAgICAgICAgICBpZiBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCk6DQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oTE9DS19GSUxFLCAiciIpIGFzIGY6DQogICAgICAgICAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpDQogICAgICAgICAgICAgICAgICAgIGlmIHBpZDoNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsidGFza2tpbGwiLCAiL0YiLCAiL1BJRCIsIHBpZF0sIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhcHR1cmVfb3V0cHV0PVRydWUsIGNoZWNrPUZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKExPQ0tfRklMRSkNCiAgICAgICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgICAgIHBhc3MNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBDbGVhbiB1cA0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoU1RPUF9GSUxFKToNCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoU1RPUF9GSUxFKQ0KICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoUkVBRFlfRklMRSk6DQogICAgICAgICAgICAgICAgb3MucmVtb3ZlKFJFQURZX0ZJTEUpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNlbGYudXBkYXRlX3N0YXR1cygpDQogICAgICAgICAgICAjIFNpbGVudGx5IHN0b3AgLSBubyBwb3B1cA0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICAjIFNpbGVudGx5IGZhaWwgLSBubyBwb3B1cA0KICAgICAgICAgICAgcGFzcw0KICAgIA0KICAgIGRlZiB1cGRhdGVfc3RhdHVzKHNlbGYpOg0KICAgICAgICAiIiJVcGRhdGUgdGhlIFVJIHdpdGggY3VycmVudCBzdGF0dXMuIiIiDQogICAgICAgICMgQ2hlY2sgaWYgVUkgZWxlbWVudHMgZXhpc3QgKHRoZXkgbWlnaHQgbm90IGR1cmluZyBpbml0aWFsaXphdGlvbikNCiAgICAgICAgaWYgbm90IGhhc2F0dHIoc2VsZiwgJ3N0YXR1c19sYWJlbCcpOg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICAjIFVwZGF0ZSBkYWVtb24gc3RhdHVzDQogICAgICAgIHJ1bm5pbmcgPSBzZWxmLmlzX2RhZW1vbl9ydW5uaW5nKCkNCiAgICAgICAgaWYgcnVubmluZzoNCiAgICAgICAgICAgIHNlbGYuc3RhdHVzX2xhYmVsLmNvbmZpZyh0ZXh0PSJTdGF0dXM6IFJ1bm5pbmciLCBmb3JlZ3JvdW5kPSJncmVlbiIpDQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdzdGFydF9idXR0b24nKToNCiAgICAgICAgICAgICAgICBzZWxmLnN0YXJ0X2J1dHRvbi5jb25maWcoc3RhdGU9RElTQUJMRUQpDQogICAgICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdzdG9wX2J1dHRvbicpOg0KICAgICAgICAgICAgICAgIHNlbGYuc3RvcF9idXR0b24uY29uZmlnKHN0YXRlPU5PUk1BTCkNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHNlbGYuc3RhdHVzX2xhYmVsLmNvbmZpZyh0ZXh0PSJTdGF0dXM6IFN0b3BwZWQiLCBmb3JlZ3JvdW5kPSJyZWQiKQ0KICAgICAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAnc3RhcnRfYnV0dG9uJyk6DQogICAgICAgICAgICAgICAgc2VsZi5zdGFydF9idXR0b24uY29uZmlnKHN0YXRlPU5PUk1BTCkNCiAgICAgICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ3N0b3BfYnV0dG9uJyk6DQogICAgICAgICAgICAgICAgc2VsZi5zdG9wX2J1dHRvbi5jb25maWcoc3RhdGU9RElTQUJMRUQpDQogICAgICAgIA0KICAgICAgICAjIFVwZGF0ZSBnYW1lIGFuZCBkZWF0aCBjb3VudCBvbiB0aGUgYnV0dG9uDQogICAgICAgIGN1cnJlbnRfZ2FtZSA9IHNlbGYuZ2V0X2N1cnJlbnRfZ2FtZSgpDQogICAgICAgIGRlYXRoX2NvdW50ID0gc2VsZi5nZXRfZGVhdGhfY291bnQoY3VycmVudF9nYW1lKQ0KICAgICAgICB0b3RhbF9kZWF0aHMgPSBzZWxmLmdldF90b3RhbF9kZWF0aHMoKQ0KICAgICAgICANCiAgICAgICAgIyBVcGRhdGUgdGhlIGxhYmVscyBzZXBhcmF0ZWx5DQogICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ2RlYXRoX2NvdW50X2xhYmVsJykgYW5kIGhhc2F0dHIoc2VsZiwgJ2dhbWVfbmFtZV9sYWJlbCcpOg0KICAgICAgICAgICAgc2VsZi5kZWF0aF9jb3VudF9sYWJlbC5jb25maWcodGV4dD1zdHIoZGVhdGhfY291bnQpKQ0KICAgICAgICAgICAgc2VsZi5nYW1lX25hbWVfbGFiZWwuY29uZmlnKHRleHQ9Y3VycmVudF9nYW1lKQ0KICAgICAgICANCiAgICAgICAgIyBVcGRhdGUgdG90YWwgZGVhdGhzIGRpc3BsYXkNCiAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAndG90YWxfZGVhdGhzX2xhYmVsJyk6DQogICAgICAgICAgICBzZWxmLnRvdGFsX2RlYXRoc19sYWJlbC5jb25maWcodGV4dD1mIlRvdGFsIERlYXRoczoge3RvdGFsX2RlYXRoc30iKQ0KICAgIA0KICAgIGRlZiBzdGFydF9tb25pdG9yaW5nKHNlbGYpOg0KICAgICAgICAiIiJTdGFydCBiYWNrZ3JvdW5kIHRocmVhZCB0byBtb25pdG9yIHN0YXR1cy4iIiINCiAgICAgICAgc2VsZi5tb25pdG9yaW5nID0gVHJ1ZQ0KICAgICAgICANCiAgICAgICAgZGVmIG1vbml0b3IoKToNCiAgICAgICAgICAgIHdoaWxlIHNlbGYubW9uaXRvcmluZzoNCiAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgIHNlbGYucm9vdC5hZnRlcigwLCBzZWxmLnVwZGF0ZV9zdGF0dXMpDQogICAgICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMikgICMgVXBkYXRlIGV2ZXJ5IDIgc2Vjb25kcw0KICAgICAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgDQogICAgICAgIHRocmVhZCA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PW1vbml0b3IsIGRhZW1vbj1UcnVlKQ0KICAgICAgICB0aHJlYWQuc3RhcnQoKQ0KICAgIA0KICAgIGRlZiBvbl9jbG9zaW5nKHNlbGYpOg0KICAgICAgICAiIiJIYW5kbGUgd2luZG93IGNsb3NpbmcuIiIiDQogICAgICAgIHNlbGYubW9uaXRvcmluZyA9IEZhbHNlDQogICAgICAgIHNlbGYucm9vdC5kZXN0cm95KCkNCg0KDQpkZWYgbWFpbigpOg0KICAgICMgUHJldmVudCBtdWx0aXBsZSBpbnN0YW5jZXMgb2YgdGhlIEdVSSB1c2luZyBXaW5kb3dzIG11dGV4DQogICAgIyBDaGVjayBtdXRleCBCRUZPUkUgY3JlYXRpbmcgYW55IEdVSSBlbGVtZW50cw0KICAgIG11dGV4ID0gTm9uZQ0KICAgIGtlcm5lbDMyID0gTm9uZQ0KICAgIHRyeToNCiAgICAgICAgaW1wb3J0IGN0eXBlcw0KICAgICAgICBtdXRleF9uYW1lID0gIkdsb2JhbFxcRGVhdGhDb3VudGVyR1VJTXV0ZXgiDQogICAgICAgIGtlcm5lbDMyID0gY3R5cGVzLndpbmRsbC5rZXJuZWwzMg0KICAgICAgICBtdXRleCA9IGtlcm5lbDMyLkNyZWF0ZU11dGV4VyhOb25lLCBGYWxzZSwgbXV0ZXhfbmFtZSkNCiAgICAgICAgbGFzdF9lcnJvciA9IGtlcm5lbDMyLkdldExhc3RFcnJvcigpDQogICAgICAgIA0KICAgICAgICAjIElmIEVSUk9SX0FMUkVBRFlfRVhJU1RTLCBhbm90aGVyIEdVSSBpbnN0YW5jZSBpcyBydW5uaW5nDQogICAgICAgIGlmIGxhc3RfZXJyb3IgPT0gMTgzOiAgIyBFUlJPUl9BTFJFQURZX0VYSVNUUw0KICAgICAgICAgICAgaWYgbXV0ZXg6DQogICAgICAgICAgICAgICAga2VybmVsMzIuQ2xvc2VIYW5kbGUobXV0ZXgpDQogICAgICAgICAgICAjIEV4aXQgaW1tZWRpYXRlbHkgLSBHVUkgYWxyZWFkeSBydW5uaW5nDQogICAgICAgICAgICBzeXMuZXhpdCgwKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb246DQogICAgICAgICMgSWYgbXV0ZXggZmFpbHMsIGNvbnRpbnVlIGFueXdheQ0KICAgICAgICBwYXNzDQogICAgDQogICAgcm9vdCA9IFRrKCkNCiAgICBhcHAgPSBEZWF0aENvdW50ZXJHVUkocm9vdCkNCiAgICANCiAgICBkZWYgY2xlYW51cCgpOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBpZiBtdXRleCBhbmQga2VybmVsMzI6DQogICAgICAgICAgICAgICAga2VybmVsMzIuQ2xvc2VIYW5kbGUobXV0ZXgpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICAgICAgaWYgaGFzYXR0cihhcHAsICdvbl9jbG9zaW5nJyk6DQogICAgICAgICAgICBhcHAub25fY2xvc2luZygpDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByb290LmRlc3Ryb3koKQ0KICAgIA0KICAgIHJvb3QucHJvdG9jb2woIldNX0RFTEVURV9XSU5ET1ciLCBjbGVhbnVwKQ0KICAgIA0KICAgIHRyeToNCiAgICAgICAgcm9vdC5tYWlubG9vcCgpDQogICAgZmluYWxseToNCiAgICAgICAgY2xlYW51cCgpDQoNCg0KaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoNCiAgICBtYWluKCkNCg0K",
  "switch_game_manual.py": "IiIiDQpNYW51YWxseSBTd2l0Y2ggR2FtZQ0KU3dpdGNoIHRoZSBkZWF0aCBjb3VudGVyIHRvIGEgc3BlY2lmaWMgZ2FtZSBtYW51YWxseS4NCg0KVXNhZ2U6DQogICAgcHl0aG9uIHN3aXRjaF9nYW1lX21hbnVhbC5weSAiRWxkZW4gUmluZyINCiAgICBweXRob24gc3dpdGNoX2dhbWVfbWFudWFsLnB5ICJEYXJrIFNvdWxzIDMiDQoiIiINCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQganNvbg0KDQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQNCmRlZiBnZXRfYmFzZV9kaXIoKToNCiAgICAiIiJHZXQgdGhlIGJhc2UgZGlyZWN0b3J5IC0gc2FtZSBmb2xkZXIgYXMgdGhpcyBzY3JpcHQuIiIiDQogICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KDQpCQVNFX0RJUiA9IGdldF9iYXNlX2RpcigpDQpDT05GSUdfRklMRSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImdhbWVzX2NvbmZpZy5qc29uIikNClNUQVRFX0pTT04gPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9zdGF0ZS5qc29uIikNCkRFQVRIX1RYVCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYXRoX2NvdW50ZXIudHh0IikNCg0KDQpkZWYgbG9hZF9jb25maWcoKToNCiAgICAiIiJMb2FkIGdhbWUgY29uZmlndXJhdGlvbnMgZnJvbSBKU09OIGZpbGUuIiIiDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToNCiAgICAgICAgcHJpbnQoZiJbRVJST1JdIENvbmZpZyBmaWxlIG5vdCBmb3VuZDoge0NPTkZJR19GSUxFfSIpDQogICAgICAgIHJldHVybiBOb25lDQogICAgDQogICAgdHJ5Og0KICAgICAgICB3aXRoIG9wZW4oQ09ORklHX0ZJTEUsICJyIiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIHJldHVybiBqc29uLmxvYWQoZikNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiW0VSUk9SXSBGYWlsZWQgdG8gbG9hZCBjb25maWc6IHtlfSIpDQogICAgICAgIHJldHVybiBOb25lDQoNCg0KZGVmIGxvYWRfc3RhdGUoKToNCiAgICAiIiJMb2FkIHN0YXRlIGZyb20gSlNPTiBmaWxlLiIiIg0KICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhTVEFURV9KU09OKToNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICJ0b3RhbF9kZWF0aHMiOiAwLA0KICAgICAgICAgICAgImdhbWVfZGVhdGhzIjoge30sDQogICAgICAgICAgICAidGljayI6IDAsDQogICAgICAgICAgICAic3RyZWFrIjogMCwNCiAgICAgICAgICAgICJsYXN0X2RlYXRoX3RzIjogMC4wLA0KICAgICAgICAgICAgImN1cnJlbnRfZ2FtZSI6IE5vbmUsDQogICAgICAgIH0NCiAgICANCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBzdGF0ZSA9IGpzb24ubG9hZChmKQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgc3RhdGUgPSB7fQ0KICAgIA0KICAgIHN0YXRlLnNldGRlZmF1bHQoInRvdGFsX2RlYXRocyIsIDApDQogICAgc3RhdGUuc2V0ZGVmYXVsdCgiZ2FtZV9kZWF0aHMiLCB7fSkNCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJ0aWNrIiwgMCkNCiAgICBzdGF0ZS5zZXRkZWZhdWx0KCJzdHJlYWsiLCAwKQ0KICAgIHN0YXRlLnNldGRlZmF1bHQoImxhc3RfZGVhdGhfdHMiLCAwLjApDQogICAgc3RhdGUuc2V0ZGVmYXVsdCgiY3VycmVudF9nYW1lIiwgTm9uZSkNCiAgICByZXR1cm4gc3RhdGUNCg0KDQpkZWYgc2F2ZV9jb25maWcoY29uZmlnKToNCiAgICAiIiJTYXZlIGNvbmZpZ3VyYXRpb24gdG8gSlNPTiBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgcmV0dXJuIFRydWUNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiW0VSUk9SXSBGYWlsZWQgdG8gc2F2ZSBjb25maWc6IHtlfSIpDQogICAgICAgIHJldHVybiBGYWxzZQ0KDQoNCmRlZiBzYXZlX3N0YXRlKHN0YXRlKToNCiAgICAiIiJTYXZlIHN0YXRlIHRvIEpTT04gZmlsZS4iIiINCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBqc29uLmR1bXAoc3RhdGUsIGYsIGluZGVudD0yKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJbRVJST1JdIEZhaWxlZCB0byBzYXZlIHN0YXRlOiB7ZX0iKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCg0KDQpkZWYgd3JpdGVfdGV4dChkZWF0aHMsIGdhbWVfbmFtZSk6DQogICAgIiIiV3JpdGUgZGVhdGggY291bnQgdG8gdGV4dCBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgIyBXcml0ZSBtYWluIGZpbGUNCiAgICAgICAgd2l0aCBvcGVuKERFQVRIX1RYVCwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgZi53cml0ZShzdHIoZGVhdGhzKSkNCiAgICAgICAgDQogICAgICAgICMgV3JpdGUgcGVyLWdhbWUgZmlsZQ0KICAgICAgICBpZiBnYW1lX25hbWU6DQogICAgICAgICAgICBnYW1lX3R4dCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgZiJkZWF0aF9jb3VudGVyX3tnYW1lX25hbWUucmVwbGFjZSgnICcsICdfJyl9LnR4dCIpDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgc3RhdGUgPSBsb2FkX3N0YXRlKCkNCiAgICAgICAgICAgICAgICBnYW1lX2RlYXRocyA9IHN0YXRlLmdldCgiZ2FtZV9kZWF0aHMiLCB7fSkuZ2V0KGdhbWVfbmFtZSwgMCkNCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZ2FtZV90eHQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShzdHIoZ2FtZV9kZWF0aHMpKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICAgICAgICAgIHByaW50KGYiW1dBUk5JTkddIENvdWxkIG5vdCB3cml0ZSBwZXItZ2FtZSBmaWxlOiB7ZX0iKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJbRVJST1JdIEZhaWxlZCB0byB3cml0ZSB0ZXh0IGZpbGU6IHtlfSIpDQogICAgICAgIHJldHVybiBGYWxzZQ0KDQoNCmRlZiBzd2l0Y2hfZ2FtZShnYW1lX25hbWUpOg0KICAgICIiIlN3aXRjaCB0byB0aGUgc3BlY2lmaWVkIGdhbWUuIiIiDQogICAgcHJpbnQoIj0iICogNzApDQogICAgcHJpbnQoIk1BTlVBTCBHQU1FIFNXSVRDSCIpDQogICAgcHJpbnQoIj0iICogNzApDQogICAgDQogICAgIyBMb2FkIGNvbmZpZw0KICAgIGNvbmZpZyA9IGxvYWRfY29uZmlnKCkNCiAgICBpZiBub3QgY29uZmlnOg0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICBnYW1lcyA9IGNvbmZpZy5nZXQoImdhbWVzIiwge30pDQogICAgaWYgbm90IGdhbWVzOg0KICAgICAgICBwcmludCgiW0VSUk9SXSBObyBnYW1lcyBjb25maWd1cmVkIikNCiAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQogICAgIyBDaGVjayBpZiBnYW1lIGV4aXN0cw0KICAgIGlmIGdhbWVfbmFtZSBub3QgaW4gZ2FtZXM6DQogICAgICAgIHByaW50KGYiW0VSUk9SXSBHYW1lICd7Z2FtZV9uYW1lfScgbm90IGZvdW5kIGluIGNvbmZpZ3VyYXRpb24uIikNCiAgICAgICAgcHJpbnQoZiJcbkF2YWlsYWJsZSBnYW1lczoiKQ0KICAgICAgICBmb3IgbmFtZSBpbiBnYW1lcy5rZXlzKCk6DQogICAgICAgICAgICBwcmludChmIiAgLSB7bmFtZX0iKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICAjIExvYWQgc3RhdGUNCiAgICBzdGF0ZSA9IGxvYWRfc3RhdGUoKQ0KICAgIG9sZF9nYW1lID0gc3RhdGUuZ2V0KCJjdXJyZW50X2dhbWUiLCAiVW5rbm93biIpDQogICAgDQogICAgIyBVcGRhdGUgc3RhdGUNCiAgICBzdGF0ZVsiY3VycmVudF9nYW1lIl0gPSBnYW1lX25hbWUNCiAgICANCiAgICAjIFVwZGF0ZSBjb25maWcNCiAgICBjb25maWdbImN1cnJlbnRfZ2FtZSJdID0gZ2FtZV9uYW1lDQogICAgDQogICAgIyBHZXQgdGhlIGdhbWUncyBkZWF0aCBjb3VudA0KICAgIGdhbWVfZGVhdGhzID0gc3RhdGUuZ2V0KCJnYW1lX2RlYXRocyIsIHt9KS5nZXQoZ2FtZV9uYW1lLCAwKQ0KICAgIA0KICAgICMgU2F2ZSBmaWxlcw0KICAgIGlmIG5vdCBzYXZlX3N0YXRlKHN0YXRlKToNCiAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQogICAgaWYgbm90IHNhdmVfY29uZmlnKGNvbmZpZyk6DQogICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA0KICAgICMgVXBkYXRlIHRleHQgZmlsZXMNCiAgICB3cml0ZV90ZXh0KGdhbWVfZGVhdGhzLCBnYW1lX25hbWUpDQogICAgDQogICAgIyBTaG93IGluZm8NCiAgICBnYW1lX2NvbmZpZyA9IGdhbWVzW2dhbWVfbmFtZV0NCiAgICBwcmludChmIlxuW09LXSBTd2l0Y2hlZCBmcm9tICd7b2xkX2dhbWV9JyB0byAne2dhbWVfbmFtZX0nIikNCiAgICBwcmludChmIlxuR2FtZSBJbmZvOiIpDQogICAgcHJpbnQoZiIgIERlYXRoczoge2dhbWVfZGVhdGhzfSIpDQogICAgcHJpbnQoZiIgIE1vbml0b3I6IHtnYW1lX2NvbmZpZy5nZXQoJ21vbml0b3JfaW5kZXgnLCAnZGVmYXVsdCcpfSIpDQogICAgcHJpbnQoZiIgIFJlZ2lvbjoge2dhbWVfY29uZmlnLmdldCgncmVnaW9uJywge30pfSIpDQogICAgcHJpbnQoZiIgIEtleXdvcmRzOiB7Z2FtZV9jb25maWcuZ2V0KCdrZXl3b3JkcycsIFtdKX0iKQ0KICAgIA0KICAgIHByaW50KGYiXG5bT0tdIFRleHQgZmlsZXMgdXBkYXRlZDoiKQ0KICAgIHByaW50KGYiICAtIHtERUFUSF9UWFR9IC0+IHtnYW1lX2RlYXRoc30iKQ0KICAgIHByaW50KGYiICAtIGRlYXRoX2NvdW50ZXJfe2dhbWVfbmFtZS5yZXBsYWNlKCcgJywgJ18nKX0udHh0IC0+IHtnYW1lX2RlYXRoc30iKQ0KICAgIA0KICAgIHByaW50KCJcbiIgKyAiPSIgKiA3MCkNCiAgICBwcmludCgiW05PVEVdIFRoZSBkYWVtb24gd2lsbCBjb250aW51ZSBydW5uaW5nIHdpdGggdGhlIG5ldyBnYW1lLiIpDQogICAgcHJpbnQoIiAgICAgICBBdXRvLWRldGVjdGlvbiB3aWxsIG92ZXJyaWRlIHRoaXMgaWYgaXQgZGV0ZWN0cyBhIGRpZmZlcmVudCBnYW1lLiIpDQogICAgcHJpbnQoIj0iICogNzApDQogICAgDQogICAgcmV0dXJuIFRydWUNCg0KDQpkZWYgbWFpbigpOg0KICAgIGlmIGxlbihzeXMuYXJndikgPCAyOg0KICAgICAgICBwcmludCgiVXNhZ2U6IHB5dGhvbiBzd2l0Y2hfZ2FtZV9tYW51YWwucHkgXCJHYW1lIE5hbWVcIiIpDQogICAgICAgIHByaW50KCJcbkV4YW1wbGVzOiIpDQogICAgICAgIHByaW50KCcgIHB5dGhvbiBzd2l0Y2hfZ2FtZV9tYW51YWwucHkgIkVsZGVuIFJpbmciJykNCiAgICAgICAgcHJpbnQoJyAgcHl0aG9uIHN3aXRjaF9nYW1lX21hbnVhbC5weSAiRGFyayBTb3VscyAzIicpDQogICAgICAgIHByaW50KCcgIHB5dGhvbiBzd2l0Y2hfZ2FtZV9tYW51YWwucHkgIkRhcmsgU291bHMgUmVtYXN0ZXJlZCInKQ0KICAgICAgICBwcmludCgnICBweXRob24gc3dpdGNoX2dhbWVfbWFudWFsLnB5ICJTZWtpcm8iJykNCiAgICAgICAgcmV0dXJuIDENCiAgICANCiAgICBnYW1lX25hbWUgPSBzeXMuYXJndlsxXQ0KICAgIA0KICAgIGlmIHN3aXRjaF9nYW1lKGdhbWVfbmFtZSk6DQogICAgICAgIHJldHVybiAwDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIDENCg0KDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIHN5cy5leGl0KG1haW4oKSkNCg0K",
  "games_config.json": "ew0KICAic2V0dGluZ3MiOiB7DQogICAgInRpY2tfc2Vjb25kcyI6IDAuMywNCiAgICAiZGVidWdfZXZlcnlfdGlja3MiOiAzMCwNCiAgICAiY29uc2VjdXRpdmVfaGl0cyI6IDIsDQogICAgImNvb2xkb3duX3NlY29uZHMiOiA1LjAsDQogICAgIm1vbml0b3JfaW5kZXgiOiAxDQogIH0sDQogICJnYW1lcyI6IHsNCiAgICAiRWxkZW4gUmluZyI6IHsNCiAgICAgICJyZWdpb24iOiB7DQogICAgICAgICJ1c2VfcGVyY2VudGFnZXMiOiB0cnVlLA0KICAgICAgICAibGVmdCI6IDAuMjcwOCwNCiAgICAgICAgInRvcCI6IDAuNDM1MiwNCiAgICAgICAgIndpZHRoIjogMC40NTgzLA0KICAgICAgICAiaGVpZ2h0IjogMC4xODUyDQogICAgICB9LA0KICAgICAgImtleXdvcmRzIjogWw0KICAgICAgICAiWU9VRElFRCIsDQogICAgICAgICJZT1VESUUiLA0KICAgICAgICAiWU9VREVEIiwNCiAgICAgICAgIkRJRUQiDQogICAgICBdLA0KICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IC1jIHRlc3NlZGl0X2NoYXJfd2hpdGVsaXN0PVlPVURJRUFERlQiLA0KICAgICAgIm1vbml0b3JfaW5kZXgiOiAyLA0KICAgICAgInByb2Nlc3NfbmFtZXMiOiBbDQogICAgICAgICJlbGRlbnJpbmcuZXhlIiwNCiAgICAgICAgImVsZGVuIHJpbmcuZXhlIg0KICAgICAgXQ0KICAgIH0sDQogICAgIkRhcmsgU291bHMgMyI6IHsNCiAgICAgICJyZWdpb24iOiB7DQogICAgICAgICJ1c2VfcGVyY2VudGFnZXMiOiB0cnVlLA0KICAgICAgICAibGVmdCI6IDAuMjcwOCwNCiAgICAgICAgInRvcCI6IDAuNDM1MiwNCiAgICAgICAgIndpZHRoIjogMC40NTgzLA0KICAgICAgICAiaGVpZ2h0IjogMC4xODUyDQogICAgICB9LA0KICAgICAgImtleXdvcmRzIjogWw0KICAgICAgICAiWU9VRElFRCIsDQogICAgICAgICJZT1VESUUiLA0KICAgICAgICAiWU9VRDFFRCIsDQogICAgICAgICJZT1VEbEVEIiwNCiAgICAgICAgIllPVURJIiwNCiAgICAgICAgIk9VRElFRCIsDQogICAgICAgICJZT1VESUUwIg0KICAgICAgXSwNCiAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyAtYyB0ZXNzZWRpdF9jaGFyX3doaXRlbGlzdD1ZT1VESUVBREZUIiwNCiAgICAgICJtb25pdG9yX2luZGV4IjogMiwNCiAgICAgICJwcm9jZXNzX25hbWVzIjogWw0KICAgICAgICAiZGFya3NvdWxzaWlpLmV4ZSIsDQogICAgICAgICJkYXJrIHNvdWxzIGlpaS5leGUiDQogICAgICBdDQogICAgfSwNCiAgICAiRGFyayBTb3VscyBSZW1hc3RlcmVkIjogew0KICAgICAgInJlZ2lvbiI6IHsNCiAgICAgICAgInVzZV9wZXJjZW50YWdlcyI6IHRydWUsDQogICAgICAgICJsZWZ0IjogMC4yNzA4LA0KICAgICAgICAidG9wIjogMC40MzUyLA0KICAgICAgICAid2lkdGgiOiAwLjQ1ODMsDQogICAgICAgICJoZWlnaHQiOiAwLjE4NTINCiAgICAgIH0sDQogICAgICAia2V5d29yZHMiOiBbDQogICAgICAgICJZT1VESUVEIiwNCiAgICAgICAgIllPVURJRSIsDQogICAgICAgICJZT1VEMUVEIiwNCiAgICAgICAgIllPVURsRUQiLA0KICAgICAgICAiWU9VREkiLA0KICAgICAgICAiT1VESUVEIiwNCiAgICAgICAgIllPVURJRTAiDQogICAgICBdLA0KICAgICAgInRlc3NlcmFjdF9jb25maWciOiAiLS1vZW0gMyAtLXBzbSA3IC1jIHRlc3NlZGl0X2NoYXJfd2hpdGVsaXN0PVlPVURJRUFERlQiLA0KICAgICAgIm1vbml0b3JfaW5kZXgiOiAyLA0KICAgICAgInByb2Nlc3NfbmFtZXMiOiBbDQogICAgICAgICJkYXJrc291bHNyZW1hc3RlcmVkLmV4ZSIsDQogICAgICAgICJkYXJrIHNvdWxzIHJlbWFzdGVyZWQuZXhlIg0KICAgICAgXQ0KICAgIH0sDQogICAgIkRhcmsgU291bHMgSUk6IFNjaG9sYXIgb2YgdGhlIEZpcnN0IFNpbiI6IHsNCiAgICAgICJyZWdpb24iOiB7DQogICAgICAgICJ1c2VfcGVyY2VudGFnZXMiOiB0cnVlLA0KICAgICAgICAibGVmdCI6IDAuMjcwOCwNCiAgICAgICAgInRvcCI6IDAuNDM1MiwNCiAgICAgICAgIndpZHRoIjogMC40NTgzLA0KICAgICAgICAiaGVpZ2h0IjogMC4xODUyDQogICAgICB9LA0KICAgICAgImtleXdvcmRzIjogWw0KICAgICAgICAiWU9VRElFRCIsDQogICAgICAgICJZT1VESUUiLA0KICAgICAgICAiWU9VRDFFRCIsDQogICAgICAgICJZT1VEbEVEIiwNCiAgICAgICAgIllPVURJIiwNCiAgICAgICAgIk9VRElFRCIsDQogICAgICAgICJZT1VESUUwIg0KICAgICAgXSwNCiAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyAtYyB0ZXNzZWRpdF9jaGFyX3doaXRlbGlzdD1ZT1VESUVBREZUIiwNCiAgICAgICJtb25pdG9yX2luZGV4IjogMiwNCiAgICAgICJwcm9jZXNzX25hbWVzIjogWw0KICAgICAgICAiZGFya3NvdWxzaWkuZXhlIiwNCiAgICAgICAgImRhcmsgc291bHMgaWkuZXhlIiwNCiAgICAgICAgImRhcmtzb3VsczIuZXhlIg0KICAgICAgXQ0KICAgIH0sDQogICAgIlNla2lybyI6IHsNCiAgICAgICJyZWdpb24iOiB7DQogICAgICAgICJ1c2VfcGVyY2VudGFnZXMiOiB0cnVlLA0KICAgICAgICAibGVmdCI6IDAuMzgwMiwNCiAgICAgICAgInRvcCI6IDAuMjY4NSwNCiAgICAgICAgIndpZHRoIjogMC4yMjQwLA0KICAgICAgICAiaGVpZ2h0IjogMC40MDc0DQogICAgICB9LA0KICAgICAgImtleXdvcmRzIjogWw0KICAgICAgICAiREVBVEgiLA0KICAgICAgICAi5q27Ig0KICAgICAgXSwNCiAgICAgICJ0ZXNzZXJhY3RfY29uZmlnIjogIi0tb2VtIDMgLS1wc20gNyIsDQogICAgICAidGVzc2VyYWN0X2xhbmciOiAianBuK2VuZyIsDQogICAgICAibW9uaXRvcl9pbmRleCI6IDIsDQogICAgICAicHJvY2Vzc19uYW1lcyI6IFsNCiAgICAgICAgInNla2lyby5leGUiDQogICAgICBdDQogICAgfQ0KICB9LA0KICAiY3VycmVudF9nYW1lIjogIkRhcmsgU291bHMgUmVtYXN0ZXJlZCINCn0=",
  "START_DEATH_COUNTER.bat": "QGVjaG8gb2ZmDQpSRU0gU3RhcnQgRGVhdGggQ291bnRlciBEYWVtb24NClJFTSBUaGlzIGJhdGNoIGZpbGUgc3RhcnRzIHRoZSBkZWF0aCBjb3VudGVyIGRhZW1vbg0KUkVNIFdpbmRvdyB3aWxsIGJlIHBvc2l0aW9uZWQgaW4gdG9wIHJpZ2h0IGNvcm5lcg0KDQpjZCAvZCAiJX5kcDAiDQoNClJFTSBQb3NpdGlvbiB0aGlzIGNvbnNvbGUgd2luZG93IHRvIHRvcCByaWdodCBiZWZvcmUgc3RhcnRpbmcNCnBvd2Vyc2hlbGwgLUNvbW1hbmQgIiRob3N0LlVJLlJhd1VJLldpbmRvd1Bvc2l0aW9uID0gTmV3LU9iamVjdCBTeXN0ZW0uTWFuYWdlbWVudC5BdXRvbWF0aW9uLkhvc3QuQ29vcmRpbmF0ZXMgKChHZXQtSG9zdCkuVUkuUmF3VUkuQnVmZmVyU2l6ZS5XaWR0aCAtIDgwMCksIDAiDQoNCnB5dGhvbiBtdWx0aV9nYW1lX2RlYXRoX2NvdW50ZXIucHkNCg0KcGF1c2UNCg0K",
  "STOP_DEATH_COUNTER.bat": "QGVjaG8gb2ZmDQpSRU0gU3RvcCBEZWF0aCBDb3VudGVyIERhZW1vbg0KUkVNIFRoaXMgYmF0Y2ggZmlsZSBzdG9wcyB0aGUgZGVhdGggY291bnRlciBkYWVtb24gYnkgY3JlYXRpbmcgYSBTVE9QIGZpbGUNCg0KY2QgL2QgIiV+ZHAwIg0KZWNoby4gPiBTVE9QDQplY2hvIFNUT1AgZmlsZSBjcmVhdGVkLiBEYWVtb24gc2hvdWxkIHN0b3Agd2l0aGluIGEgZmV3IHNlY29uZHMuDQp0aW1lb3V0IC90IDIgL25vYnJlYWsgPm51bA0KDQppZiBleGlzdCBkYWVtb24ubG9jayAoDQogICAgZWNobyBEYWVtb24gbWF5IHN0aWxsIGJlIHJ1bm5pbmcuIENoZWNraW5nIGxvY2sgZmlsZS4uLg0KICAgIGZvciAvZiAidG9rZW5zPSoiICUlaSBpbiAoZGFlbW9uLmxvY2spIGRvICgNCiAgICAgICAgZWNobyBBdHRlbXB0aW5nIHRvIGtpbGwgcHJvY2VzcyAlJWkuLi4NCiAgICAgICAgdGFza2tpbGwgL0YgL1BJRCAlJWkgPm51bCAyPiYxDQogICAgKQ0KICAgIGRlbCBkYWVtb24ubG9jayA+bnVsIDI+JjENCiAgICBlY2hvIERhZW1vbiBzdG9wcGVkLg0KKSBlbHNlICgNCiAgICBlY2hvIERhZW1vbiBpcyBub3QgcnVubmluZy4NCikNCg0KaWYgZXhpc3QgU1RPUCBkZWwgU1RPUCA+bnVsIDI+JjENCnBhdXNlDQoNCg==",
  "install_dependencies.bat": "QGVjaG8gb2ZmDQpSRU0gSW5zdGFsbCBQeXRob24gRGVwZW5kZW5jaWVzIGZvciBEZWF0aCBDb3VudGVyDQpSRU0gVGhpcyBiYXRjaCBmaWxlIGluc3RhbGxzIGFsbCByZXF1aXJlZCBQeXRob24gcGFja2FnZXMNCg0KZWNobyBJbnN0YWxsaW5nIGRlcGVuZGVuY2llcyBmb3IgRGVhdGggQ291bnRlci4uLg0KZWNoby4NCg0KY2QgL2QgIiV+ZHAwIg0KDQpweXRob24gLW0gcGlwIGluc3RhbGwgLS11cGdyYWRlIHBpcA0KcHl0aG9uIC1tIHBpcCBpbnN0YWxsIG1zcyBwaWxsb3cgcHl0ZXNzZXJhY3Qgb3BlbmN2LXB5dGhvbiBudW1weSBwc3V0aWwNCg0KZWNoby4NCmVjaG8gSW5zdGFsbGF0aW9uIGNvbXBsZXRlIQ0KZWNoby4NCmVjaG8gTm90ZTogWW91IGFsc28gbmVlZCB0byBpbnN0YWxsIFRlc3NlcmFjdCBPQ1Igc2VwYXJhdGVseToNCmVjaG8gRG93bmxvYWQgZnJvbTogaHR0cHM6Ly9naXRodWIuY29tL1VCLU1hbm5oZWltL3Rlc3NlcmFjdC93aWtpDQplY2hvIERlZmF1bHQgcGF0aDogQzpcUHJvZ3JhbSBGaWxlc1xUZXNzZXJhY3QtT0NSXHRlc3NlcmFjdC5leGUNCmVjaG8uDQpwYXVzZQ0KDQo=",
  "README.md": "IyBNdWx0aS1HYW1lIERlYXRoIENvdW50ZXINCg0KQW4gYXV0b21hdGljIGRlYXRoIGNvdW50ZXIgdGhhdCB3b3JrcyBhY3Jvc3MgbXVsdGlwbGUgU291bHMtbGlrZSBnYW1lcyAoRWxkZW4gUmluZywgRGFyayBTb3VscywgU2VraXJvLCBldGMuKQ0KDQojIyBRdWljayBTdGFydA0KDQojIyMgMS4gSW5zdGFsbCBEZXBlbmRlbmNpZXMNCg0KKipPcHRpb24gQTogVXNlIHRoZSBiYXRjaCBmaWxlIChSZWNvbW1lbmRlZCkqKg0KYGBgDQpEb3VibGUtY2xpY2s6IGluc3RhbGxfZGVwZW5kZW5jaWVzLmJhdA0KYGBgDQoNCioqT3B0aW9uIEI6IE1hbnVhbCBpbnN0YWxsYXRpb24qKg0KYGBgYmFzaA0KcGlwIGluc3RhbGwgLXIgcmVxdWlyZW1lbnRzLnR4dA0KYGBgDQoNCiMjIyAyLiBJbnN0YWxsIFRlc3NlcmFjdCBPQ1INCg0KRG93bmxvYWQgYW5kIGluc3RhbGwgVGVzc2VyYWN0IE9DUjoNCi0gKipEb3dubG9hZDoqKiBodHRwczovL2dpdGh1Yi5jb20vVUItTWFubmhlaW0vdGVzc2VyYWN0L3dpa2kNCi0gKipEZWZhdWx0IHBhdGg6KiogYEM6XFByb2dyYW0gRmlsZXNcVGVzc2VyYWN0LU9DUlx0ZXNzZXJhY3QuZXhlYA0KLSBJZiBpbnN0YWxsZWQgZWxzZXdoZXJlLCBlZGl0IGBURVNTRVJBQ1RfRVhFYCBpbiBgbXVsdGlfZ2FtZV9kZWF0aF9jb3VudGVyLnB5YA0KDQojIyMgMy4gUnVuIHRoZSBEZWF0aCBDb3VudGVyDQoNCioqT3B0aW9uIEE6IFVzZSB0aGUgYmF0Y2ggZmlsZSAoUmVjb21tZW5kZWQpKioNCmBgYA0KRG91YmxlLWNsaWNrOiBTVEFSVF9ERUFUSF9DT1VOVEVSLmJhdA0KYGBgDQoNCioqT3B0aW9uIEI6IENvbW1hbmQgbGluZSoqDQpgYGBiYXNoDQpweXRob24gbXVsdGlfZ2FtZV9kZWF0aF9jb3VudGVyLnB5DQpgYGANCg0KKipUbyBzdG9wOioqIERvdWJsZS1jbGljayBgU1RPUF9ERUFUSF9DT1VOVEVSLmJhdGAgb3IgcHJlc3MgQ3RybCtDDQoNCiMjIEZpbGVzIE92ZXJ2aWV3DQoNCiMjIyBNYWluIEZpbGVzDQotICoqYG11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weWAqKiAtIE1haW4gZGFlbW9uIHNjcmlwdCAocnVuIHRoaXMpDQotICoqYHN3aXRjaF9nYW1lLnB5YCoqIC0gVXRpbGl0eSB0byBzd2l0Y2ggYmV0d2VlbiBnYW1lcw0KLSAqKmB0ZXN0X3ByZXByb2Nlc3NpbmcucHlgKiogLSBUZXN0IHNjcmlwdCB0byB2ZXJpZnkgeW91ciBzZXR1cA0KLSAqKmByZXF1aXJlbWVudHMudHh0YCoqIC0gUHl0aG9uIGRlcGVuZGVuY2llcw0KLSAqKmBTVEFSVF9ERUFUSF9DT1VOVEVSLmJhdGAqKiAtIEVhc3kgbGF1bmNoZXINCi0gKipgU1RPUF9ERUFUSF9DT1VOVEVSLmJhdGAqKiAtIEVhc3kgc3RvcHBlcg0KLSAqKmBpbnN0YWxsX2RlcGVuZGVuY2llcy5iYXRgKiogLSBEZXBlbmRlbmN5IGluc3RhbGxlcg0KDQojIyMgU3RyZWFtZXIuYm90IEludGVncmF0aW9uIChPcHRpb25hbCkNCi0gKipgU3RyZWFtZXJCb3RfU3RhcnREZWF0aENvdW50ZXIuY3NgKiogLSBTdGFydCBkYWVtb24gZnJvbSBTdHJlYW1lci5ib3QNCi0gKipgU3RyZWFtZXJCb3RfU3RvcERlYXRoQ291bnRlci5jc2AqKiAtIFN0b3AgZGFlbW9uIGZyb20gU3RyZWFtZXIuYm90DQotICoqYFN0cmVhbWVyQm90X0dldERlYXRoQ291bnQuY3NgKiogLSBHZXQgZGVhdGggY291bnQgaW4gU3RyZWFtZXIuYm90DQotICoqYFN0cmVhbWVyQm90X1N3aXRjaEdhbWUuY3NgKiogLSBTd2l0Y2ggZ2FtZXMgZnJvbSBTdHJlYW1lci5ib3QNCg0KIyMgQ29uZmlndXJhdGlvbg0KDQojIyMgRmlyc3QgUnVuDQpPbiBmaXJzdCBydW4sIHRoZSBzY3JpcHQgY3JlYXRlczoNCi0gYEM6XGRlYXRoY291bnRlclxnYW1lc19jb25maWcuanNvbmAgLSBHYW1lIGNvbmZpZ3VyYXRpb25zDQotIGBDOlxkZWF0aGNvdW50ZXJcZGVhdGhfc3RhdGUuanNvbmAgLSBEZWF0aCBjb3VudHMgYW5kIHN0YXRlDQotIGBDOlxkZWF0aGNvdW50ZXJcZGVhdGhfY291bnRlci50eHRgIC0gVGV4dCBmaWxlIGZvciBPQlMgKHRvdGFsIGRlYXRocykNCi0gYEM6XGRlYXRoY291bnRlclxkZWJ1Zy5sb2dgIC0gTG9nIGZpbGUNCg0KIyMjIEVkaXRpbmcgR2FtZSBTZXR0aW5ncw0KDQpFZGl0IGBDOlxkZWF0aGNvdW50ZXJcZ2FtZXNfY29uZmlnLmpzb25gIHRvIGNvbmZpZ3VyZToNCg0KYGBganNvbg0Kew0KICAic2V0dGluZ3MiOiB7DQogICAgInRpY2tfc2Vjb25kcyI6IDAuMzAsDQogICAgImRlYnVnX2V2ZXJ5X3RpY2tzIjogMzAsDQogICAgImNvbnNlY3V0aXZlX2hpdHMiOiAyLA0KICAgICJjb29sZG93bl9zZWNvbmRzIjogOC4wLA0KICAgICJtb25pdG9yX2luZGV4IjogMg0KICB9LA0KICAiZ2FtZXMiOiB7DQogICAgIkVsZGVuIFJpbmciOiB7DQogICAgICAicmVnaW9uIjogeyJsZWZ0IjogNTIwLCAidG9wIjogNDcwLCAid2lkdGgiOiA4ODAsICJoZWlnaHQiOiAyMDB9LA0KICAgICAgImtleXdvcmRzIjogWyJZT1VESUVEIiwgIllPVURJRSIsICJESUVEIl0sDQogICAgICAidGVzc2VyYWN0X2NvbmZpZyI6ICItLW9lbSAzIC0tcHNtIDcgLWMgdGVzc2VkaXRfY2hhcl93aGl0ZWxpc3Q9WU9VRElFQURGVCIsDQogICAgICAibW9uaXRvcl9pbmRleCI6IDINCiAgICB9DQogIH0sDQogICJjdXJyZW50X2dhbWUiOiAiRWxkZW4gUmluZyINCn0NCmBgYA0KDQojIyMgRmluZGluZyB0aGUgUmlnaHQgUmVnaW9uIENvb3JkaW5hdGVzDQoNCjEuIFRha2UgYSBzY3JlZW5zaG90IHdoZW4gIllPVSBESUVEIiBhcHBlYXJzDQoyLiBVc2UgYW4gaW1hZ2UgZWRpdG9yIChQYWludCwgR0lNUCwgZXRjLikgdG8gZmluZCBjb29yZGluYXRlcw0KMy4gVXBkYXRlIHRoZSBgcmVnaW9uYCBpbiB0aGUgY29uZmlnOg0KICAgLSBgbGVmdGA6IFggcG9zaXRpb24gb2YgbGVmdCBlZGdlDQogICAtIGB0b3BgOiBZIHBvc2l0aW9uIG9mIHRvcCBlZGdlICANCiAgIC0gYHdpZHRoYDogV2lkdGggb2YgdGhlIHJlZ2lvbg0KICAgLSBgaGVpZ2h0YDogSGVpZ2h0IG9mIHRoZSByZWdpb24NCg0KIyMjIFN3aXRjaGluZyBHYW1lcw0KDQoqKk9wdGlvbiBBOiBFZGl0IGNvbmZpZyBmaWxlKioNCkNoYW5nZSBgImN1cnJlbnRfZ2FtZSJgIGluIGBnYW1lc19jb25maWcuanNvbmANCg0KKipPcHRpb24gQjogVXNlIHN3aXRjaCBzY3JpcHQqKg0KYGBgYmFzaA0KcHl0aG9uIHN3aXRjaF9nYW1lLnB5ICJFbGRlbiBSaW5nIg0KYGBgDQoNCiMjIE9CUyBJbnRlZ3JhdGlvbg0KDQpUaGUgZGVhdGggY291bnRlciB3cml0ZXMgdG8gdGV4dCBmaWxlcyB0aGF0IE9CUyBjYW4gcmVhZDoNCg0KLSAqKlRvdGFsIGRlYXRoczoqKiBgQzpcZGVhdGhjb3VudGVyXGRlYXRoX2NvdW50ZXIudHh0YA0KLSAqKlBlci1nYW1lIGRlYXRoczoqKiBgQzpcZGVhdGhjb3VudGVyXGRlYXRoX2NvdW50ZXJfR2FtZU5hbWUudHh0YA0KDQojIyMgT0JTIFNldHVwDQoNCjEuIEluIE9CUywgYWRkIGEgKipUZXh0IChHREkrKSoqIHNvdXJjZQ0KMi4gQ2hlY2sgKioiUmVhZCBmcm9tIGZpbGUiKioNCjMuIEJyb3dzZSB0bzogYEM6XGRlYXRoY291bnRlclxkZWF0aF9jb3VudGVyLnR4dGANCjQuIEN1c3RvbWl6ZSB0aGUgZm9udC9zdHlsZSBhcyBkZXNpcmVkDQoNCiMjIERlYnVnZ2luZw0KDQojIyMgVGVzdCBZb3VyIFNldHVwDQoNClJ1biB0aGUgdGVzdCBzY3JpcHQgdG8gdmVyaWZ5IGV2ZXJ5dGhpbmcgd29ya3M6DQpgYGBiYXNoDQpweXRob24gdGVzdF9wcmVwcm9jZXNzaW5nLnB5DQpgYGANCg0KVGhpcyB3aWxsOg0KLSBDYXB0dXJlIHRoZSBjb25maWd1cmVkIHJlZ2lvbg0KLSBTaG93IHByZXByb2Nlc3NpbmcgcmVzdWx0cw0KLSBUZXN0IE9DUiBkZXRlY3Rpb24NCi0gU2F2ZSBkZWJ1ZyBpbWFnZXMgdG8gYEM6XGRlYXRoY291bnRlclxgDQoNCiMjIyBEZWJ1ZyBJbWFnZXMNCg0KVGhlIGRhZW1vbiBzYXZlcyBkZWJ1ZyBpbWFnZXMgZXZlcnkgMzAgdGlja3MgKGRlZmF1bHQpOg0KLSBgZGVidWdfY2FwdHVyZV9yYXcucG5nYCAtIE9yaWdpbmFsIHNjcmVlbnNob3QNCi0gYGRlYnVnX2NhcHR1cmUucG5nYCAtIFByb2Nlc3NlZCBpbWFnZSAod2hhdCBPQ1Igc2VlcykNCg0KIyMjIExvZyBGaWxlDQoNCkNoZWNrIGBDOlxkZWF0aGNvdW50ZXJcZGVidWcubG9nYCBmb3IgZGV0YWlsZWQgaW5mb3JtYXRpb246DQotIE9DUiByZXN1bHRzDQotIERldGVjdGlvbiBzdGF0dXMNCi0gRGVhdGggY291bnRzDQotIEVycm9ycw0KDQojIyMgQ29tbW9uIElzc3Vlcw0KDQoqKkJsYWNrIHByb2Nlc3NlZCBpbWFnZSAoZml4ZWQhKToqKg0KLSBUaGUgbmV3IHZlcnNpb24gdXNlcyBhZGFwdGl2ZSB0aHJlc2hvbGQgZmFsbGJhY2sNCi0gU2hvdWxkIGFsd2F5cyBwcm9kdWNlIGEgdmlzaWJsZSBpbWFnZSBub3cNCi0gSWYgc3RpbGwgYmxhY2ssIGNoZWNrIHJlZ2lvbiBjb29yZGluYXRlcw0KDQoqKk5vdCBkZXRlY3RpbmcgZGVhdGhzOioqDQoxLiBDaGVjayBgZGVidWdfY2FwdHVyZV9yYXcucG5nYCAtIGlzIHRoZSByZWdpb24gY29ycmVjdD8NCjIuIENoZWNrIGBkZWJ1Z19jYXB0dXJlLnBuZ2AgLSBjYW4geW91IHNlZSB0ZXh0Pw0KMy4gVmVyaWZ5IG1vbml0b3IgaW5kZXggaXMgY29ycmVjdA0KNC4gVHJ5IGFkanVzdGluZyBrZXl3b3JkcyBpbiBjb25maWcNCg0KKipGYWxzZSBwb3NpdGl2ZXM6KioNCjEuIEluY3JlYXNlIGBjb25zZWN1dGl2ZV9oaXRzYCAocmVxdWlyZXMgbW9yZSBkZXRlY3Rpb25zKQ0KMi4gSW5jcmVhc2UgYGNvb2xkb3duX3NlY29uZHNgIChsb25nZXIgdGltZSBiZXR3ZWVuIGRlYXRocykNCg0KKipUZXNzZXJhY3QgZXJyb3JzOioqDQoxLiBWZXJpZnkgVGVzc2VyYWN0IGlzIGluc3RhbGxlZA0KMi4gQ2hlY2sgYFRFU1NFUkFDVF9FWEVgIHBhdGggaW4gdGhlIHNjcmlwdA0KMy4gRW5zdXJlIFRlc3NlcmFjdCBpcyBpbiBQQVRIDQoNCiMjIFN0cmVhbWVyLmJvdCBJbnRlZ3JhdGlvbg0KDQojIyMgU2V0dXANCg0KMS4gQ29weSB0aGUgYC5jc2AgZmlsZXMgdG8geW91ciBTdHJlYW1lci5ib3QgYWN0aW9ucyBmb2xkZXIgKG9yIHBhc3RlIGRpcmVjdGx5KQ0KMi4gQ3JlYXRlIGFjdGlvbnMgZm9yIGVhY2ggc2NyaXB0Og0KICAgLSAqKlN0YXJ0IERlYXRoIENvdW50ZXIqKiAtIFVzZXMgYFN0cmVhbWVyQm90X1N0YXJ0RGVhdGhDb3VudGVyLmNzYA0KICAgLSAqKlN0b3AgRGVhdGggQ291bnRlcioqIC0gVXNlcyBgU3RyZWFtZXJCb3RfU3RvcERlYXRoQ291bnRlci5jc2ANCiAgIC0gKipHZXQgRGVhdGggQ291bnQqKiAtIFVzZXMgYFN0cmVhbWVyQm90X0dldERlYXRoQ291bnQuY3NgIChzZXRzIHZhcmlhYmxlcykNCiAgIC0gKipTd2l0Y2ggR2FtZSoqIC0gVXNlcyBgU3RyZWFtZXJCb3RfU3dpdGNoR2FtZS5jc2ANCg0KIyMjIEltcG9ydGFudDogVXBkYXRlIFBhdGhzDQoNClRoZSBzY3JpcHQgcGF0aCBpbiBgU3RyZWFtZXJCb3RfU3RhcnREZWF0aENvdW50ZXIuY3NgIGlzIGFscmVhZHkgY29uZmlndXJlZCBmb3IgYEM6XGRlYXRoY291bnRlclxgLiANCklmIHlvdSBtb3ZlZCB0aGUgZmlsZXMgdG8gYSBkaWZmZXJlbnQgbG9jYXRpb24sIHVwZGF0ZSB0aGUgcGF0aDoNCmBgYGNzaGFycA0Kc3RyaW5nIHNjcmlwdFBhdGggPSBAIkM6XGRlYXRoY291bnRlclxtdWx0aV9nYW1lX2RlYXRoX2NvdW50ZXIucHkiOw0KYGBgDQoNCiMjIyBWYXJpYWJsZXMgU2V0IGJ5IEdldCBEZWF0aCBDb3VudA0KDQotIGBEZWF0aENvdW50VG90YWxgIC0gVG90YWwgZGVhdGhzIGFjcm9zcyBhbGwgZ2FtZXMNCi0gYERlYXRoQ291bnRHYW1lYCAtIERlYXRocyBmb3IgY3VycmVudCBnYW1lDQotIGBEZWF0aENvdW50ZXJDdXJyZW50R2FtZWAgLSBOYW1lIG9mIGN1cnJlbnQgZ2FtZQ0KDQojIyBUcm91Ymxlc2hvb3RpbmcNCg0KKipEYWVtb24gd29uJ3Qgc3RhcnQ6KioNCi0gQ2hlY2sgaWYgYW5vdGhlciBpbnN0YW5jZSBpcyBydW5uaW5nIChsb29rIGZvciBgZGFlbW9uLmxvY2tgKQ0KLSBEZWxldGUgYGRhZW1vbi5sb2NrYCBpZiBwcmV2aW91cyBpbnN0YW5jZSBjcmFzaGVkDQotIENoZWNrIGBkZWJ1Zy5sb2dgIGZvciBlcnJvcnMNCg0KKipEZWF0aHMgbm90IGNvdW50aW5nOioqDQotIFZlcmlmeSByZWdpb24gY2FwdHVyZXMgIllPVSBESUVEIiB0ZXh0DQotIENoZWNrIGRlYnVnIGltYWdlcw0KLSBMb3dlciBgY29uc2VjdXRpdmVfaGl0c2AgaWYgZGV0ZWN0aW9uIGlzIGluY29uc2lzdGVudA0KLSBWZXJpZnkga2V5d29yZHMgbWF0Y2ggT0NSIG91dHB1dA0KDQoqKkhpZ2ggQ1BVIHVzYWdlOioqDQotIEluY3JlYXNlIGB0aWNrX3NlY29uZHNgIChzbG93ZXIgY2hlY2tpbmcgPSBsb3dlciBDUFUpDQotIFJlZHVjZSBgZGVidWdfZXZlcnlfdGlja3NgIChsZXNzIGZyZXF1ZW50IGltYWdlIHNhdmluZykNCg0KIyMgQWRkaW5nIE5ldyBHYW1lcw0KDQoxLiBBZGQgZW50cnkgdG8gYGdhbWVzYCBpbiBgZ2FtZXNfY29uZmlnLmpzb25gOg0KYGBganNvbg0KIllvdXIgR2FtZSBOYW1lIjogew0KICAicmVnaW9uIjogeyJsZWZ0IjogWCwgInRvcCI6IFksICJ3aWR0aCI6IFcsICJoZWlnaHQiOiBIfSwNCiAgImtleXdvcmRzIjogWyJLRVlXT1JEMSIsICJLRVlXT1JEMiJdLA0KICAidGVzc2VyYWN0X2NvbmZpZyI6ICItLW9lbSAzIC0tcHNtIDciLA0KICAibW9uaXRvcl9pbmRleCI6IDENCn0NCmBgYA0KDQoyLiBTd2l0Y2ggdG8gdGhlIG5ldyBnYW1lIHVzaW5nIGBzd2l0Y2hfZ2FtZS5weWAgb3IgZWRpdCBjb25maWcNCg0KIyMgU3VwcG9ydA0KDQpNb3N0IGlzc3VlcyBjYW4gYmUgcmVzb2x2ZWQgYnk6DQoxLiBDaGVja2luZyBkZWJ1ZyBpbWFnZXMgKGBkZWJ1Z19jYXB0dXJlX3Jhdy5wbmdgIGFuZCBgZGVidWdfY2FwdHVyZS5wbmdgKQ0KMi4gUmV2aWV3aW5nIGBkZWJ1Zy5sb2dgIGZvciBlcnJvciBtZXNzYWdlcw0KMy4gVmVyaWZ5aW5nIHJlZ2lvbiBjb29yZGluYXRlcyBhbmQgbW9uaXRvciBpbmRleA0KNC4gQWRqdXN0aW5nIGRldGVjdGlvbiBwYXJhbWV0ZXJzIGluIGNvbmZpZw0KDQpUaGUgbmV3IHZlcnNpb24gZml4ZXMgdGhlICJibGFjayBpbWFnZSIgaXNzdWUgYnkgdXNpbmcgcm9idXN0IHByZXByb2Nlc3Npbmcgd2l0aCBhZGFwdGl2ZSB0aHJlc2hvbGQgZmFsbGJhY2suDQoNCg==",
  "change_monitor_id.py": "IiIiDQpTY3JpcHQgdG8gZWFzaWx5IGNoYW5nZSB0aGUgbW9uaXRvciBJRCBmb3IgZ2FtZXMgaW4gdGhlIGNvbmZpZy4NCkhlbHBzIHdoZW4gYXV0by1kZXRlY3Rpb24gaXNuJ3Qgd29ya2luZyBvciB5b3Ugd2FudCB0byBtYW51YWxseSBzZXQgaXQuDQoiIiINCg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQganNvbg0KDQojIEdldCB0aGUgZGlyZWN0b3J5IHdoZXJlIHRoaXMgc2NyaXB0IGlzIGxvY2F0ZWQNCmRlZiBnZXRfYmFzZV9kaXIoKToNCiAgICAiIiJHZXQgdGhlIGJhc2UgZGlyZWN0b3J5IC0gc2FtZSBmb2xkZXIgYXMgdGhpcyBzY3JpcHQuIiIiDQogICAgaWYgZ2V0YXR0cihzeXMsICdmcm96ZW4nLCBGYWxzZSk6DQogICAgICAgIHJldHVybiBvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKHN5cy5leGVjdXRhYmxlKSkNCiAgICBlbHNlOg0KICAgICAgICByZXR1cm4gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChfX2ZpbGVfXykpDQoNCkJBU0VfRElSID0gZ2V0X2Jhc2VfZGlyKCkNCkNPTkZJR19GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZ2FtZXNfY29uZmlnLmpzb24iKQ0KDQoNCmRlZiBsb2FkX2NvbmZpZygpOg0KICAgICIiIkxvYWQgZ2FtZSBjb25maWd1cmF0aW9ucyBmcm9tIEpTT04gZmlsZS4iIiINCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoQ09ORklHX0ZJTEUpOg0KICAgICAgICBwcmludChmIkVSUk9SOiBDb25maWcgZmlsZSBub3QgZm91bmQ6IHtDT05GSUdfRklMRX0iKQ0KICAgICAgICByZXR1cm4gTm9uZQ0KICAgIA0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAiciIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBjb25maWcgPSBqc29uLmxvYWQoZikNCiAgICAgICAgcmV0dXJuIGNvbmZpZw0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJFcnJvciBsb2FkaW5nIGNvbmZpZzoge2V9IikNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KDQpkZWYgc2F2ZV9jb25maWcoY29uZmlnKToNCiAgICAiIiJTYXZlIGNvbmZpZ3VyYXRpb24gdG8gSlNPTiBmaWxlLiIiIg0KICAgIHRyeToNCiAgICAgICAgd2l0aCBvcGVuKENPTkZJR19GSUxFLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICBqc29uLmR1bXAoY29uZmlnLCBmLCBpbmRlbnQ9MikNCiAgICAgICAgcmV0dXJuIFRydWUNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRXJyb3Igc2F2aW5nIGNvbmZpZzoge2V9IikNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCg0KZGVmIGxpc3RfbW9uaXRvcnMoKToNCiAgICAiIiJMaXN0IGF2YWlsYWJsZSBtb25pdG9ycy4iIiINCiAgICB0cnk6DQogICAgICAgIGZyb20gbXNzIGltcG9ydCBtc3MNCiAgICAgICAgd2l0aCBtc3MoKSBhcyBzY3Q6DQogICAgICAgICAgICBwcmludCgiXG5BdmFpbGFibGUgbW9uaXRvcnM6IikNCiAgICAgICAgICAgIGZvciBpLCBtb24gaW4gZW51bWVyYXRlKHNjdC5tb25pdG9ycyk6DQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIE1vbml0b3Ige2l9OiB7bW9uWyd3aWR0aCddfXh7bW9uWydoZWlnaHQnXX0gYXQgKHttb25bJ2xlZnQnXX0sIHttb25bJ3RvcCddfSkiKQ0KICAgICAgICAgICAgcmV0dXJuIGxlbihzY3QubW9uaXRvcnMpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIkVycm9yIGxpc3RpbmcgbW9uaXRvcnM6IHtlfSIpDQogICAgICAgIHJldHVybiAwDQoNCg0KZGVmIG1haW4oKToNCiAgICBjb25maWcgPSBsb2FkX2NvbmZpZygpDQogICAgaWYgbm90IGNvbmZpZzoNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgZ2FtZXMgPSBjb25maWcuZ2V0KCJnYW1lcyIsIHt9KQ0KICAgIGlmIG5vdCBnYW1lczoNCiAgICAgICAgcHJpbnQoIk5vIGdhbWVzIGNvbmZpZ3VyZWQhIikNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgcHJpbnQoIj0iICogNjApDQogICAgcHJpbnQoIk1vbml0b3IgSUQgQ2hhbmdlciIpDQogICAgcHJpbnQoIj0iICogNjApDQogICAgDQogICAgIyBMaXN0IGF2YWlsYWJsZSBtb25pdG9ycw0KICAgIG51bV9tb25pdG9ycyA9IGxpc3RfbW9uaXRvcnMoKQ0KICAgIA0KICAgICMgTGlzdCBnYW1lcw0KICAgIHByaW50KCJcbkNvbmZpZ3VyZWQgZ2FtZXM6IikNCiAgICBnYW1lX2xpc3QgPSBsaXN0KGdhbWVzLmtleXMoKSkNCiAgICBmb3IgaSwgZ2FtZV9uYW1lIGluIGVudW1lcmF0ZShnYW1lX2xpc3QsIDEpOg0KICAgICAgICBjdXJyZW50X21vbml0b3IgPSBnYW1lc1tnYW1lX25hbWVdLmdldCgibW9uaXRvcl9pbmRleCIsIGNvbmZpZy5nZXQoInNldHRpbmdzIiwge30pLmdldCgibW9uaXRvcl9pbmRleCIsIDEpKQ0KICAgICAgICBwcmludChmIiAge2l9LiB7Z2FtZV9uYW1lfSAoTW9uaXRvcjoge2N1cnJlbnRfbW9uaXRvcn0pIikNCiAgICANCiAgICAjIEdldCBnYW1lIHNlbGVjdGlvbg0KICAgIHByaW50KCkNCiAgICB0cnk6DQogICAgICAgIGNob2ljZSA9IGlucHV0KCJFbnRlciBnYW1lIG51bWJlciB0byBjaGFuZ2UgKG9yICdhbGwnIGZvciBhbGwgZ2FtZXMpOiAiKS5zdHJpcCgpLmxvd2VyKCkNCiAgICAgICAgDQogICAgICAgIGlmIGNob2ljZSA9PSAnYWxsJzoNCiAgICAgICAgICAgIHNlbGVjdGVkX2dhbWVzID0gZ2FtZV9saXN0DQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBnYW1lX2lkeCA9IGludChjaG9pY2UpIC0gMQ0KICAgICAgICAgICAgaWYgMCA8PSBnYW1lX2lkeCA8IGxlbihnYW1lX2xpc3QpOg0KICAgICAgICAgICAgICAgIHNlbGVjdGVkX2dhbWVzID0gW2dhbWVfbGlzdFtnYW1lX2lkeF1dDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHByaW50KCJJbnZhbGlkIHNlbGVjdGlvbiEiKQ0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgIGV4Y2VwdCAoVmFsdWVFcnJvciwgS2V5Ym9hcmRJbnRlcnJ1cHQpOg0KICAgICAgICBwcmludCgiXG5DYW5jZWxsZWQuIikNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgIyBHZXQgbW9uaXRvciBJRA0KICAgIHByaW50KCkNCiAgICB0cnk6DQogICAgICAgIG1vbml0b3JfaWQgPSBpbnB1dChmIkVudGVyIG1vbml0b3IgSUQgKDAte251bV9tb25pdG9ycy0xfSk6ICIpLnN0cmlwKCkNCiAgICAgICAgbW9uaXRvcl9pZCA9IGludChtb25pdG9yX2lkKQ0KICAgICAgICANCiAgICAgICAgaWYgbW9uaXRvcl9pZCA8IDAgb3IgbW9uaXRvcl9pZCA+PSBudW1fbW9uaXRvcnM6DQogICAgICAgICAgICBwcmludChmIkludmFsaWQgbW9uaXRvciBJRCEgTXVzdCBiZSBiZXR3ZWVuIDAgYW5kIHtudW1fbW9uaXRvcnMtMX0iKQ0KICAgICAgICAgICAgcmV0dXJuDQogICAgZXhjZXB0IChWYWx1ZUVycm9yLCBLZXlib2FyZEludGVycnVwdCk6DQogICAgICAgIHByaW50KCJcbkNhbmNlbGxlZC4iKQ0KICAgICAgICByZXR1cm4NCiAgICANCiAgICAjIFVwZGF0ZSBtb25pdG9yIElEcw0KICAgIHByaW50KCkNCiAgICBmb3IgZ2FtZV9uYW1lIGluIHNlbGVjdGVkX2dhbWVzOg0KICAgICAgICBnYW1lc1tnYW1lX25hbWVdWyJtb25pdG9yX2luZGV4Il0gPSBtb25pdG9yX2lkDQogICAgICAgIHByaW50KGYi4pyTIFNldCB7Z2FtZV9uYW1lfSB0byBtb25pdG9yIHttb25pdG9yX2lkfSIpDQogICAgDQogICAgIyBTYXZlIGNvbmZpZw0KICAgIGlmIHNhdmVfY29uZmlnKGNvbmZpZyk6DQogICAgICAgIHByaW50KGYiXG7inJMgQ29uZmlnIHNhdmVkIHRvIHtDT05GSUdfRklMRX0iKQ0KICAgICAgICBwcmludCgiXG5Ob3RlOiBUaGUgZGFlbW9uIHdpbGwgYXV0by1kZXRlY3QgdGhlIG1vbml0b3IsIGJ1dCB0aGlzIHNldHRpbmciKQ0KICAgICAgICBwcmludCgid2lsbCBiZSB1c2VkIGFzIGEgZmFsbGJhY2sgaWYgYXV0by1kZXRlY3Rpb24gZmFpbHMuIikNCiAgICBlbHNlOg0KICAgICAgICBwcmludCgiXG7inJcgRmFpbGVkIHRvIHNhdmUgY29uZmlnISIpDQoNCg0KaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoNCiAgICBtYWluKCkNCg0K",
  "capture_debug_once.py": "IiIiDQpPbmUtdGltZSBkZWJ1ZyBpbWFnZSBjYXB0dXJlIHNjcmlwdC4NCkNhcHR1cmVzIHRoZSBjdXJyZW50IGdhbWUncyByZWdpb24gYW5kIHNhdmVzIGJvdGggcmF3IGFuZCBwcmVwcm9jZXNzZWQgaW1hZ2VzLg0KUnVuIHRoaXMgYW55dGltZSB0byBzZWUgd2hhdCB0aGUgT0NSIGlzIHNlZWluZy4NCiIiIg0KDQppbXBvcnQgb3MNCmltcG9ydCBzeXMNCmltcG9ydCBzdWJwcm9jZXNzDQppbXBvcnQgY3R5cGVzDQppbXBvcnQganNvbg0KZnJvbSB0eXBpbmcgaW1wb3J0IERpY3QsIFR1cGxlDQoNCmltcG9ydCBjdjINCmltcG9ydCBudW1weSBhcyBucA0KZnJvbSBQSUwgaW1wb3J0IEltYWdlDQpmcm9tIG1zcyBpbXBvcnQgbXNzDQppbXBvcnQgcHl0ZXNzZXJhY3QNCg0KIyBHZXQgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGlzIHNjcmlwdCBpcyBsb2NhdGVkDQpkZWYgZ2V0X2Jhc2VfZGlyKCk6DQogICAgIiIiR2V0IHRoZSBiYXNlIGRpcmVjdG9yeSAtIHNhbWUgZm9sZGVyIGFzIHRoaXMgc2NyaXB0LiIiIg0KICAgIGlmIGdldGF0dHIoc3lzLCAnZnJvemVuJywgRmFsc2UpOg0KICAgICAgICByZXR1cm4gb3MucGF0aC5kaXJuYW1lKG9zLnBhdGguYWJzcGF0aChzeXMuZXhlY3V0YWJsZSkpDQogICAgZWxzZToNCiAgICAgICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KDQpCQVNFX0RJUiA9IGdldF9iYXNlX2RpcigpDQpDT05GSUdfRklMRSA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImdhbWVzX2NvbmZpZy5qc29uIikNCg0KIyBUcnkgdG8gZmluZCBUZXNzZXJhY3QgLSBjaGVjayBjb21tb24gbG9jYXRpb25zIGFuZCBQQVRIDQpkZWYgZmluZF90ZXNzZXJhY3QoKToNCiAgICAiIiJGaW5kIFRlc3NlcmFjdCBPQ1IgZXhlY3V0YWJsZS4iIiINCiAgICAjIENoZWNrIGlmIHRlc3NlcmFjdCBpcyBpbiBQQVRIDQogICAgdHJ5Og0KICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3Rlc3NlcmFjdCcsICctLXZlcnNpb24nXSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MikNCiAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgPT0gMDoNCiAgICAgICAgICAgIHJldHVybiAndGVzc2VyYWN0JyAgIyBVc2UgY29tbWFuZCBuYW1lIGlmIGluIFBBVEgNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICANCiAgICAjIENoZWNrIGNvbW1vbiBpbnN0YWxsYXRpb24gcGF0aHMNCiAgICBjb21tb25fcGF0aHMgPSBbDQogICAgICAgIHIiQzpcUHJvZ3JhbSBGaWxlc1xUZXNzZXJhY3QtT0NSXHRlc3NlcmFjdC5leGUiLA0KICAgICAgICByIkM6XFByb2dyYW0gRmlsZXMgKHg4NilcVGVzc2VyYWN0LU9DUlx0ZXNzZXJhY3QuZXhlIiwNCiAgICAgICAgb3MucGF0aC5qb2luKG9zLmdldGVudignUHJvZ3JhbUZpbGVzJywgcidDOlxQcm9ncmFtIEZpbGVzJyksICdUZXNzZXJhY3QtT0NSJywgJ3Rlc3NlcmFjdC5leGUnKSwNCiAgICAgICAgb3MucGF0aC5qb2luKG9zLmdldGVudignUHJvZ3JhbUZpbGVzKHg4NiknLCByJ0M6XFByb2dyYW0gRmlsZXMgKHg4NiknKSwgJ1Rlc3NlcmFjdC1PQ1InLCAndGVzc2VyYWN0LmV4ZScpLA0KICAgIF0NCiAgICANCiAgICBmb3IgcGF0aCBpbiBjb21tb25fcGF0aHM6DQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHBhdGgpOg0KICAgICAgICAgICAgcmV0dXJuIHBhdGgNCiAgICANCiAgICAjIERlZmF1bHQgZmFsbGJhY2sNCiAgICByZXR1cm4gciJDOlxQcm9ncmFtIEZpbGVzXFRlc3NlcmFjdC1PQ1JcdGVzc2VyYWN0LmV4ZSINCg0KdGVzc2VyYWN0X3BhdGggPSBmaW5kX3Rlc3NlcmFjdCgpDQpweXRlc3NlcmFjdC5weXRlc3NlcmFjdC50ZXNzZXJhY3RfY21kID0gdGVzc2VyYWN0X3BhdGgNCg0KREVCVUdfUkFXID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVidWdfY2FwdHVyZV9yYXcucG5nIikNCkRFQlVHX09DUiA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgImRlYnVnX2NhcHR1cmUucG5nIikNCg0KDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCiMgRFBJIEFXQVJFTkVTUw0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQpkZWYgZW5hYmxlX2RwaV9hd2FyZW5lc3MoKToNCiAgICB0cnk6DQogICAgICAgIGN0eXBlcy53aW5kbGwuc2hjb3JlLlNldFByb2Nlc3NEcGlBd2FyZW5lc3MoMikNCiAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjdHlwZXMud2luZGxsLnVzZXIzMi5TZXRQcm9jZXNzRFBJQXdhcmUoKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uOg0KICAgICAgICAgICAgcGFzcw0KDQoNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KIyBDT05GSUdVUkFUSU9OIE1BTkFHRU1FTlQNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGxvYWRfY29uZmlnKCkgLT4gRGljdDoNCiAgICAiIiJMb2FkIGdhbWUgY29uZmlndXJhdGlvbnMgZnJvbSBKU09OIGZpbGUuIiIiDQogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKENPTkZJR19GSUxFKToNCiAgICAgICAgcHJpbnQoZiJFUlJPUjogQ29uZmlnIGZpbGUgbm90IGZvdW5kOiB7Q09ORklHX0ZJTEV9IikNCiAgICAgICAgcmV0dXJuIE5vbmUNCiAgICANCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihDT05GSUdfRklMRSwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgY29uZmlnID0ganNvbi5sb2FkKGYpDQogICAgICAgIHJldHVybiBjb25maWcNCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRXJyb3IgbG9hZGluZyBjb25maWc6IHtlfSIpDQogICAgICAgIHJldHVybiBOb25lDQoNCg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQojIElNQUdFIFBST0NFU1NJTkcNCiMgPT09PT09PT09PT09PT09PT09PT09PT09PQ0KZGVmIGdyYWJfcmVnaW9uKHNjdDogbXNzLCBtb25pdG9yX2luZGV4OiBpbnQsIHJlZ2lvbjogZGljdCkgLT4gSW1hZ2UuSW1hZ2U6DQogICAgIiIiQ2FwdHVyZSBhIHJlZ2lvbiBmcm9tIHRoZSBzcGVjaWZpZWQgbW9uaXRvci4iIiINCiAgICBhY3R1YWxfaW5kZXggPSBtb25pdG9yX2luZGV4IGlmIG1vbml0b3JfaW5kZXggPT0gMCBlbHNlIG1vbml0b3JfaW5kZXgNCiAgICANCiAgICBpZiBhY3R1YWxfaW5kZXggPj0gbGVuKHNjdC5tb25pdG9ycyk6DQogICAgICAgIHByaW50KGYiV0FSTklORzogTW9uaXRvciB7bW9uaXRvcl9pbmRleH0gbm90IGZvdW5kLiBVc2luZyBtb25pdG9yIDEuIikNCiAgICAgICAgYWN0dWFsX2luZGV4ID0gMQ0KICAgIA0KICAgIG1vbiA9IHNjdC5tb25pdG9yc1thY3R1YWxfaW5kZXhdDQogICAgYWJzX3JlZ2lvbiA9IHsNCiAgICAgICAgImxlZnQiOiBtb25bImxlZnQiXSArIHJlZ2lvblsibGVmdCJdLA0KICAgICAgICAidG9wIjogbW9uWyJ0b3AiXSArIHJlZ2lvblsidG9wIl0sDQogICAgICAgICJ3aWR0aCI6IHJlZ2lvblsid2lkdGgiXSwNCiAgICAgICAgImhlaWdodCI6IHJlZ2lvblsiaGVpZ2h0Il0sDQogICAgfQ0KICAgIGdyYWIgPSBzY3QuZ3JhYihhYnNfcmVnaW9uKQ0KICAgIHJldHVybiBJbWFnZS5mcm9tYnl0ZXMoIlJHQiIsIGdyYWIuc2l6ZSwgZ3JhYi5yZ2IpDQoNCg0KZGVmIHByZXByb2Nlc3NfZm9yX29jcihpbWdfcmdiOiBJbWFnZS5JbWFnZSkgLT4gVHVwbGVbSW1hZ2UuSW1hZ2UsIERpY3RdOg0KICAgICIiIg0KICAgIFByZXByb2Nlc3MgaW1hZ2UgZm9yIE9DUiB3aXRoIG11bHRpcGxlIGZhbGxiYWNrIHN0cmF0ZWdpZXMuDQogICAgU2FtZSBhcyB0aGUgbWFpbiBkYWVtb24gc2NyaXB0Lg0KICAgICIiIg0KICAgIHJnYiA9IG5wLmFycmF5KGltZ19yZ2IpDQogICAgYmdyID0gY3YyLmN2dENvbG9yKHJnYiwgY3YyLkNPTE9SX1JHQjJCR1IpDQogICAgDQogICAgZGVmIHVwc2NhbGUoaW1nX2N2KToNCiAgICAgICAgIiIiVXBzY2FsZSBpbWFnZSAyeCBmb3IgYmV0dGVyIE9DUi4iIiINCiAgICAgICAgcmV0dXJuIGN2Mi5yZXNpemUoaW1nX2N2LCBOb25lLCBmeD0yLjAsIGZ5PTIuMCwgaW50ZXJwb2xhdGlvbj1jdjIuSU5URVJfQ1VCSUMpDQogICAgDQogICAgIyBTdHJhdGVneSAxOiBUcnkgSFNWIHJlZCBtYXNrIChmb3IgIllPVSBESUVEIiByZWQgdGV4dCkNCiAgICBoc3YgPSBjdjIuY3Z0Q29sb3IoYmdyLCBjdjIuQ09MT1JfQkdSMkhTVikNCiAgICANCiAgICAjIFdpZGUgcmVkIHRocmVzaG9sZHMgKGJvdGggbG93IGFuZCBoaWdoIGh1ZSByYW5nZXMpDQogICAgbG93ZXIxID0gbnAuYXJyYXkoWzAsIDMwLCAzMF0sIGR0eXBlPW5wLnVpbnQ4KQ0KICAgIHVwcGVyMSA9IG5wLmFycmF5KFsxNSwgMjU1LCAyNTVdLCBkdHlwZT1ucC51aW50OCkNCiAgICBsb3dlcjIgPSBucC5hcnJheShbMTY1LCAzMCwgMzBdLCBkdHlwZT1ucC51aW50OCkNCiAgICB1cHBlcjIgPSBucC5hcnJheShbMTgwLCAyNTUsIDI1NV0sIGR0eXBlPW5wLnVpbnQ4KQ0KICAgIA0KICAgIG1hc2sxID0gY3YyLmluUmFuZ2UoaHN2LCBsb3dlcjEsIHVwcGVyMSkNCiAgICBtYXNrMiA9IGN2Mi5pblJhbmdlKGhzdiwgbG93ZXIyLCB1cHBlcjIpDQogICAgbWFzayA9IGN2Mi5iaXR3aXNlX29yKG1hc2sxLCBtYXNrMikNCiAgICANCiAgICAjIENsZWFuIG5vaXNlDQogICAga2VybmVsID0gbnAub25lcygoMywgMyksIG5wLnVpbnQ4KQ0KICAgIG1hc2sgPSBjdjIubW9ycGhvbG9neUV4KG1hc2ssIGN2Mi5NT1JQSF9PUEVOLCBrZXJuZWwsIGl0ZXJhdGlvbnM9MSkNCiAgICBtYXNrID0gY3YyLm1vcnBob2xvZ3lFeChtYXNrLCBjdjIuTU9SUEhfQ0xPU0UsIGtlcm5lbCwgaXRlcmF0aW9ucz0yKQ0KICAgIG1hc2sgPSBjdjIuZGlsYXRlKG1hc2ssIGtlcm5lbCwgaXRlcmF0aW9ucz0xKQ0KICAgIA0KICAgIHdoaXRlID0gaW50KGN2Mi5jb3VudE5vblplcm8obWFzaykpDQogICAgdG90YWwgPSBpbnQobWFzay5zaGFwZVswXSAqIG1hc2suc2hhcGVbMV0pDQogICAgY292ZXJhZ2UgPSB3aGl0ZSAvIG1heCgxLCB0b3RhbCkNCiAgICANCiAgICBpbmZvID0geyJtb2RlIjogIkhTVl9SRUQiLCAiY292ZXJhZ2UiOiBjb3ZlcmFnZX0NCiAgICANCiAgICAjIFVzZSByZWQgbWFzayBpZiBjb3ZlcmFnZSBpcyByZWFzb25hYmxlIChhdCBsZWFzdCAwLjUlIG9mIGltYWdlKQ0KICAgIGlmIGNvdmVyYWdlID49IDAuMDA1Og0KICAgICAgICAjIEludmVydCBtYXNrOiB3aGl0ZSB0ZXh0IG9uIGJsYWNrIGJhY2tncm91bmQgLT4gYmxhY2sgdGV4dCBvbiB3aGl0ZQ0KICAgICAgICBpbnYgPSBjdjIuYml0d2lzZV9ub3QobWFzaykNCiAgICAgICAgb3V0ID0gdXBzY2FsZShpbnYpDQogICAgICAgIHJldHVybiBJbWFnZS5mcm9tYXJyYXkob3V0KSwgaW5mbw0KICAgIA0KICAgICMgU3RyYXRlZ3kgMjogR3JheXNjYWxlIHdpdGggYWRhcHRpdmUgdGhyZXNob2xkICh3b3JrcyBmb3IgYW55IHRleHQgY29sb3IpDQogICAgZ3JheSA9IGN2Mi5jdnRDb2xvcihiZ3IsIGN2Mi5DT0xPUl9CR1IyR1JBWSkNCiAgICBncmF5X2JsdXIgPSBjdjIuR2F1c3NpYW5CbHVyKGdyYXksICgzLCAzKSwgMCkNCiAgICB0aHJfYWRhcHQgPSBjdjIuYWRhcHRpdmVUaHJlc2hvbGQoDQogICAgICAgIGdyYXlfYmx1ciwgMjU1LA0KICAgICAgICBjdjIuQURBUFRJVkVfVEhSRVNIX0dBVVNTSUFOX0MsDQogICAgICAgIGN2Mi5USFJFU0hfQklOQVJZLA0KICAgICAgICAzMSwgNQ0KICAgICkNCiAgICAjIEludmVydDogbWFrZSB0ZXh0IGRhcmsgb24gbGlnaHQgYmFja2dyb3VuZCAoVGVzc2VyYWN0IHByZWZlcnMgZGFyayB0ZXh0IG9uIGxpZ2h0KQ0KICAgIHRocl9hZGFwdF9pbnYgPSBjdjIuYml0d2lzZV9ub3QodGhyX2FkYXB0KQ0KICAgIG91dCA9IHVwc2NhbGUodGhyX2FkYXB0X2ludikNCiAgICBpbmZvWyJtb2RlIl0gPSAiQURBUFRJVkVfVEhSRVNIT0xEIg0KICAgIGluZm9bImNvdmVyYWdlIl0gPSAwLjANCiAgICByZXR1cm4gSW1hZ2UuZnJvbWFycmF5KG91dCksIGluZm8NCg0KDQojID09PT09PT09PT09PT09PT09PT09PT09PT0NCiMgTUFJTg0KIyA9PT09PT09PT09PT09PT09PT09PT09PT09DQpkZWYgbWFpbigpOg0KICAgIGVuYWJsZV9kcGlfYXdhcmVuZXNzKCkNCiAgICANCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocHl0ZXNzZXJhY3QucHl0ZXNzZXJhY3QudGVzc2VyYWN0X2NtZCk6DQogICAgICAgIHByaW50KGYiV0FSTklORzogVGVzc2VyYWN0IG5vdCBmb3VuZCBhdDoge3B5dGVzc2VyYWN0LnB5dGVzc2VyYWN0LnRlc3NlcmFjdF9jbWR9IikNCiAgICAgICAgcHJpbnQoIk9DUiB3b24ndCB3b3JrLCBidXQgaW1hZ2VzIHdpbGwgc3RpbGwgYmUgY2FwdHVyZWQuIikNCiAgICANCiAgICBjb25maWcgPSBsb2FkX2NvbmZpZygpDQogICAgaWYgbm90IGNvbmZpZzoNCiAgICAgICAgcmV0dXJuDQogICAgDQogICAgZ2FtZXMgPSBjb25maWcuZ2V0KCJnYW1lcyIsIHt9KQ0KICAgIGN1cnJlbnRfZ2FtZSA9IGNvbmZpZy5nZXQoImN1cnJlbnRfZ2FtZSIpDQogICAgDQogICAgaWYgbm90IGN1cnJlbnRfZ2FtZSBvciBjdXJyZW50X2dhbWUgbm90IGluIGdhbWVzOg0KICAgICAgICBwcmludChmIkVSUk9SOiBDdXJyZW50IGdhbWUgJ3tjdXJyZW50X2dhbWV9JyBub3QgZm91bmQgaW4gY29uZmlnLiIpDQogICAgICAgIHByaW50KGYiQXZhaWxhYmxlIGdhbWVzOiB7bGlzdChnYW1lcy5rZXlzKCkpfSIpDQogICAgICAgIHJldHVybg0KICAgIA0KICAgIGdhbWVfY29uZmlnID0gZ2FtZXNbY3VycmVudF9nYW1lXQ0KICAgIHJlZ2lvbiA9IGdhbWVfY29uZmlnLmdldCgicmVnaW9uIiwge30pDQogICAgbW9uaXRvcl9pbmRleCA9IGdhbWVfY29uZmlnLmdldCgibW9uaXRvcl9pbmRleCIsIGNvbmZpZy5nZXQoInNldHRpbmdzIiwge30pLmdldCgibW9uaXRvcl9pbmRleCIsIDEpKQ0KICAgIA0KICAgIHByaW50KCI9IiAqIDYwKQ0KICAgIHByaW50KCJEZWJ1ZyBJbWFnZSBDYXB0dXJlIikNCiAgICBwcmludCgiPSIgKiA2MCkNCiAgICBwcmludChmIkdhbWU6IHtjdXJyZW50X2dhbWV9IikNCiAgICBwcmludChmIk1vbml0b3I6IHttb25pdG9yX2luZGV4fSIpDQogICAgcHJpbnQoZiJSZWdpb246IHtyZWdpb259IikNCiAgICBwcmludCgpDQogICAgDQogICAgd2l0aCBtc3MoKSBhcyBzY3Q6DQogICAgICAgIHByaW50KGYiQXZhaWxhYmxlIG1vbml0b3JzOiB7bGVuKHNjdC5tb25pdG9ycyl9IikNCiAgICAgICAgZm9yIGksIG1vbiBpbiBlbnVtZXJhdGUoc2N0Lm1vbml0b3JzKToNCiAgICAgICAgICAgIHByaW50KGYiICBNb25pdG9yIHtpfToge21vblsnd2lkdGgnXX14e21vblsnaGVpZ2h0J119IGF0ICh7bW9uWydsZWZ0J119LCB7bW9uWyd0b3AnXX0pIikNCiAgICAgICAgcHJpbnQoKQ0KICAgICAgICANCiAgICAgICAgIyBDYXB0dXJlIHJlZ2lvbg0KICAgICAgICBwcmludCgiQ2FwdHVyaW5nIHJlZ2lvbi4uLiIpDQogICAgICAgIGltZ19yZ2IgPSBncmFiX3JlZ2lvbihzY3QsIG1vbml0b3JfaW5kZXgsIHJlZ2lvbikNCiAgICAgICAgDQogICAgICAgICMgU2F2ZSByYXcgaW1hZ2UNCiAgICAgICAgaW1nX3JnYi5zYXZlKERFQlVHX1JBVykNCiAgICAgICAgcHJpbnQoZiLinJMgUmF3IGltYWdlIHNhdmVkOiB7REVCVUdfUkFXfSIpDQogICAgICAgIHByaW50KGYiICBTaXplOiB7aW1nX3JnYi5zaXplWzBdfXh7aW1nX3JnYi5zaXplWzFdfSIpDQogICAgICAgIA0KICAgICAgICAjIFByZXByb2Nlc3MNCiAgICAgICAgcHJpbnQoIlByZXByb2Nlc3NpbmcgZm9yIE9DUi4uLiIpDQogICAgICAgIG9jcl9pbWcsIGluZm8gPSBwcmVwcm9jZXNzX2Zvcl9vY3IoaW1nX3JnYikNCiAgICAgICAgDQogICAgICAgICMgU2F2ZSBwcm9jZXNzZWQgaW1hZ2UNCiAgICAgICAgb2NyX2ltZy5zYXZlKERFQlVHX09DUikNCiAgICAgICAgcHJpbnQoZiLinJMgUHJvY2Vzc2VkIGltYWdlIHNhdmVkOiB7REVCVUdfT0NSfSIpDQogICAgICAgIHByaW50KGYiICBTaXplOiB7b2NyX2ltZy5zaXplWzBdfXh7b2NyX2ltZy5zaXplWzFdfSIpDQogICAgICAgIHByaW50KGYiICBNb2RlOiB7aW5mb1snbW9kZSddfSIpDQogICAgICAgIGlmICdjb3ZlcmFnZScgaW4gaW5mbzoNCiAgICAgICAgICAgIHByaW50KGYiICBDb3ZlcmFnZToge2luZm9bJ2NvdmVyYWdlJ106LjRmfSIpDQogICAgICAgIA0KICAgICAgICBwcmludCgpDQogICAgICAgIHByaW50KCJEb25lISBPcGVuIHRoZSBpbWFnZXMgdG8gc2VlIHdoYXQgT0NSIGlzIHByb2Nlc3NpbmcuIikNCg0KDQppZiBfX25hbWVfXyA9PSAiX19tYWluX18iOg0KICAgIG1haW4oKQ0KDQo=",
  "CHANGE_MONITOR_ID.bat": "QGVjaG8gb2ZmDQpSRU0gU2NyaXB0IHRvIGVhc2lseSBjaGFuZ2UgbW9uaXRvciBJRCBmb3IgZ2FtZXMNCmNkIC9kICIlfmRwMCINCnB5dGhvbiBjaGFuZ2VfbW9uaXRvcl9pZC5weQ0KaWYgZXJyb3JsZXZlbCAxICgNCiAgICBlY2hvLg0KICAgIGVjaG8gUHJlc3MgYW55IGtleSB0byBleGl0Li4uDQogICAgcGF1c2UgPm51bA0KKQ0KDQo=",
  "CAPTURE_DEBUG.bat": "QGVjaG8gb2ZmDQpSRU0gU2NyaXB0IHRvIGNhcHR1cmUgZGVidWcgaW1hZ2VzDQpjZCAvZCAiJX5kcDAiDQpweXRob24gY2FwdHVyZV9kZWJ1Z19vbmNlLnB5DQppZiBlcnJvcmxldmVsIDEgKA0KICAgIGVjaG8uDQogICAgZWNobyBQcmVzcyBhbnkga2V5IHRvIGV4aXQuLi4NCiAgICBwYXVzZSA+bnVsDQopDQoNCg==",
  "deathcounteraction.cs": "VTBKQlJSK0xDQUFBQUFBQUJBQ1ZXRmx6MmtnUWZ0K3EvUStzbnlPWERvUlJxdllCWkZzSWJCTEFYRnJ5TUJmU2hOR3hPb3h4S3Y5OVp5VEFDTWJlSkZXS2E2WjcrdnEra2JyNThlY2ZqY1pWU0hKdzlibnhReXo0TWdJaDRjdXJXd0x5b0dISFJaU1R0UEVYRnN1TXI4TVFSUGpxMDE0YkZIa1FwMEwvTVk0MlpQY0VJditMY3hRL2t6U2pjU1RrMnJWNnJSNEZtR1FvcFVtK0Z4N00wNmlSYjJtT2dnWUtRTjVZeDJtalNERElTWGJkS0RLU05UcEZIamZxb2ZHTlN1ZjZOS3A0WEVRZHRMY2ZGWXdkWkNHTmFGaUVzMk5rUWloa1AwdU5LMjdwdEJ5Z3RKSHhuWCtxbmNaQlZJb3BGdUZqb0xkeEcyTEYxQUZTbW9hS0ZVZ1FWQ3hrcmVFTndFYkxPcGFzUFBadlFZcXl5cnFtRVYwMWlhSmlxNlUwc1dZcWx0YTZVVEJzYVcyZHRGcXFpbW9uU1FRZ0k4SnJuaGFrSm5sQnJNRGtQbzNESHMzeU9OMXhwVFZnMlh0YVgwbUVhZVRMdEE0a2VLckFzQVVZZHBHbUpNb2JmNVhsejJwUitXbGNKR2NIYWdxQWJjRXU0NWpJdktXY1VYRjRST3RDanVJSVZjNWwwanlsdnMvUlBJWG9ES2E5bFpLNmJvbVlpamhraG1VcTY3YlZWSnJXMmxEYWJRMG9TTWN0anFhdVFsTS9UZUFFYkJPMmtXNjBPTVRHRFZhYWFxdXRXT1RHVUpxbXFwdm16ZHJTNFByaWFMNUxSRUdicW5ZdWVSZlFON2l5QXdPL25VcC92aTIrbmRZaksyRG5rclN5aXV4UlBya2RSMUg5ZnNvMFVySW1IQkpFTHR5VVl2dnphalduSE5kdHRsbzlVcFRHV2J6T3I0ZDNUNnZWZmNvZGIrTjAwMnF1VnM5Ti9tSXdWRU96VnFzd1EzSEtLTHpHakYzVlRYNDc5dzkzT2JGalhOSVVMNFlKREpFL05kZ3JkbWI1bDYwNk9OOTcyTEN2WXY5MmxHenh2SitCK2FPLzFGOENaRHo2STYzclR1WW0zek1abDkvY2ptTGZ0VHMrNnMwb2ROaDMxK2svUTMzcmp4Y0JXeG96MVp2NHlVR0hjSnZpYi9WMFZSUnRoalk5ck0vbDFZT004WTc3aXJqZEFPbXpPN0J3L2ErVGJzZmRQTFlXenBndEYrTjRxWE1pUldPR3FIdU01OFRQSys3MXkvdzgvVDczcGw0Q25hbXdNUkpuSHpiRFp6Z1g4bW04RE85ZnZlazRRWFRydStGUVExR2ZjYnZyOHR6RVZFbHZSQWRQV1MzbTh1a05WUlN5d3R0MU45NzhYZ1c5b1FQbUw4eTlWZjJwdzllMmVRdDFqWXFhRGQ3eXlGeTcveDB2K2p0dmJxb0x2Y29GN1Q3dzA3bXN6OE91N1UvRFdlRFozV2c1MTVqcm1BR2NUeitLOGVoelhPYlZzWGdjTXhqbUJUUnc0WDZYK0hWWTZOcEJtZFBEWnRZRUMyNXJGNVQreGlITHZNa21rZFJkZ2tYMWNGN3NVRGdyOEIwV3NRb3NLdHVzejViemNSYzZMMU52RWFnRFI4aG5wV3d3TWFjOC9ueGdiMlFZV3hKZmwzblk3V2YzWHZnWStaNHpDN0RqK3hWM1JyOVdyL0pNOENwd2RiOTM2QmNKWDhGODZRL3VTbzRWL0E0a25MK3ZnejFQa1ZydUo0UFI1VGtaOTZ2YUgzbDRWM0hyOFlONjFmMDhNSEYzMUZqT1dmV1grVFdLWnR6ZXlPZFl2Q0w5UHZJazhiL2RVNDBoWXhoNHVzQzFzM0UzaC9oSC9yRitkbkJUNThETUdnZ2U5dktMV3E4bnNqdjlIclpEQnNPVE9DZGRGZTY2VTZ3emRha0xySU1BUzNJVTc3UUhKczZPaDk1aStMcWNZMzVQajNra01wd2xITHlkM3ZuRmsyTkYvUDBZd3AyL2NZWE42Q1NlcDlnbitzSHV6SEtwak11UzNIcDlobnV6SGFUaW5UbGo5WGpPdU84TWVkMkdNYS94UFhHR0RQWEdDZFNidnJmdzYzZTBKK0hFM1hBMHNjMUhxT1BGY3RFdkJ2YUlqamtlMEhCYkhCdEdiUE5ZSDQ2THRDNGNVNVZqV0xpT0Y4RGU4TjFZMTV4RDY5SGZmMTk4L3BPVThQWWpvWXhJT3BqOUI1ZUIzU1FIcWF6SHFiN3I0Sm1NU1Zhdy9DbWVnWlNLdHVFajNacVc3QXRldFRPb1JUUkxOWnBLVzhXQWQwTHRsZ0xXcmJWaUdoaW9hOHovZzgyTGZMYUUrb0dJbFBmMDc3UTZsdmgzVVFjZ3VyaXlCWk5GOUhFdnhMc0o4aUo4L2tvWGhHTEdRSklSN0lqV3RONDk3YzhjOUt0dS9IOWEvTjl1MUNHTDBlYlgyK3VyOTRMYnQ2M3ZocGVRTktSNVR2QTAyemZCdFRvY3hTZDErSFNSM2UrMnc4Y01Ea09CWkNaNEEvTWlmeHFWUTRoa2lBbXJqazZ0UTFuTm5HOXpZczFQU256eWN2ZVNNSXBvYm9Na0wxTFp2YmppZUlCOVA2dlZndkdqT0NYZE9POGdKRVpLYWNDbGppdm16UWd3U2R4WlhLUlZLNnlkVlQvanM5aCtWSlZaM21zSThEN1FRaUFqRXhKbE5LZlAwdVI4RmtQQTdEaG12T09Peml0WWxOYmxzdVBvZGpiUWdTaC9xbTZ5K2g0MXR3Um1uT1FrbjVEMCtZeDhiMEtiVWM2UXVqQ240VUgvWlBSKys3VkFONm9kOHBMRUtTZXZHRmNQUHlKb1ZhQ1hnM3oxRTRNQ1dCSUFydlhuSHovL0ExV240T3JoRUFBQQ==",
  "test_daemon_start.py": "IiIiDQpUZXN0IHNjcmlwdCB0byB2ZXJpZnkgZGFlbW9uIGNhbiBzdGFydCBwcm9wZXJseS4NClJ1biB0aGlzIGRpcmVjdGx5IHRvIHNlZSB3aGF0IGVycm9ycyBvY2N1ci4NCiIiIg0KaW1wb3J0IG9zDQppbXBvcnQgc3lzDQppbXBvcnQgc3VicHJvY2Vzcw0KaW1wb3J0IHRpbWUNCg0KIyBHZXQgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGlzIHNjcmlwdCBpcyBsb2NhdGVkDQpCQVNFX0RJUiA9IG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KREFFTU9OX1NDUklQVCA9IG9zLnBhdGguam9pbihCQVNFX0RJUiwgIm11bHRpX2dhbWVfZGVhdGhfY291bnRlci5weSIpDQpMT0NLX0ZJTEUgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkYWVtb24ubG9jayIpDQpSRUFEWV9GSUxFID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGFlbW9uLnJlYWR5IikNCg0KZGVmIGZpbmRfcHl0aG9uKCk6DQogICAgIiIiRmluZCBQeXRob24gZXhlY3V0YWJsZS4iIiINCiAgICAjIFRyeSBzeXMuZXhlY3V0YWJsZSBmaXJzdA0KICAgIGlmIHN5cy5leGVjdXRhYmxlIGFuZCBzeXMuZXhlY3V0YWJsZS5lbmRzd2l0aCgncHl0aG9uLmV4ZScpOg0KICAgICAgICByZXR1cm4gc3lzLmV4ZWN1dGFibGUNCiAgICANCiAgICAjIFRyeSBjb21tb24gbG9jYXRpb25zDQogICAgaW1wb3J0IHdpbnJlZw0KICAgIHRyeToNCiAgICAgICAga2V5ID0gd2lucmVnLk9wZW5LZXkod2lucmVnLkhLRVlfTE9DQUxfTUFDSElORSwgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgciJTT0ZUV0FSRVxQeXRob25cUHl0aG9uQ29yZSIsIDAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2lucmVnLktFWV9SRUFEIHwgd2lucmVnLktFWV9XT1c2NF82NEtFWSkNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgdmVyc2lvbiA9IHdpbnJlZy5FbnVtS2V5KGtleSwgMCkNCiAgICAgICAgICAgIGluc3RhbGxfcGF0aF9rZXkgPSB3aW5yZWcuT3BlbktleShrZXksIGYie3ZlcnNpb259XFxJbnN0YWxsUGF0aCIpDQogICAgICAgICAgICBpbnN0YWxsX3BhdGggPSB3aW5yZWcuUXVlcnlWYWx1ZUV4KGluc3RhbGxfcGF0aF9rZXksICIiKVswXQ0KICAgICAgICAgICAgcHl0aG9uX2V4ZSA9IG9zLnBhdGguam9pbihpbnN0YWxsX3BhdGgsICJweXRob24uZXhlIikNCiAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKHB5dGhvbl9leGUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBweXRob25fZXhlDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHBhc3MNCiAgICBleGNlcHQ6DQogICAgICAgIHBhc3MNCiAgICANCiAgICAjIFRyeSBQQVRIDQogICAgdHJ5Og0KICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihbJ3doZXJlJywgJ3B5dGhvbiddLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUsIHRpbWVvdXQ9MikNCiAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgPT0gMCBhbmQgcmVzdWx0LnN0ZG91dC5zdHJpcCgpOg0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC5zdGRvdXQuc3RyaXAoKS5zcGxpdCgnXG4nKVswXQ0KICAgIGV4Y2VwdDoNCiAgICAgICAgcGFzcw0KICAgIA0KICAgIHJldHVybiBOb25lDQoNCmRlZiBtYWluKCk6DQogICAgcHJpbnQoIj0iICogNzApDQogICAgcHJpbnQoIkRBRU1PTiBTVEFSVFVQIFRFU1QiKQ0KICAgIHByaW50KCI9IiAqIDcwKQ0KICAgIHByaW50KGYiQmFzZSBkaXJlY3Rvcnk6IHtCQVNFX0RJUn0iKQ0KICAgIHByaW50KGYiRGFlbW9uIHNjcmlwdDoge0RBRU1PTl9TQ1JJUFR9IikNCiAgICBwcmludChmIlNjcmlwdCBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhEQUVNT05fU0NSSVBUKX0iKQ0KICAgIHByaW50KCkNCiAgICANCiAgICAjIENsZWFuIHVwIG9sZCBmaWxlcw0KICAgIGlmIG9zLnBhdGguZXhpc3RzKExPQ0tfRklMRSk6DQogICAgICAgIHByaW50KGYiUmVtb3Zpbmcgb2xkIGxvY2sgZmlsZToge0xPQ0tfRklMRX0iKQ0KICAgICAgICBvcy5yZW1vdmUoTE9DS19GSUxFKQ0KICAgIGlmIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOg0KICAgICAgICBwcmludChmIlJlbW92aW5nIG9sZCByZWFkeSBmaWxlOiB7UkVBRFlfRklMRX0iKQ0KICAgICAgICBvcy5yZW1vdmUoUkVBRFlfRklMRSkNCiAgICBwcmludCgpDQogICAgDQogICAgIyBGaW5kIFB5dGhvbg0KICAgIHB5dGhvbl9leGUgPSBmaW5kX3B5dGhvbigpDQogICAgaWYgbm90IHB5dGhvbl9leGU6DQogICAgICAgIHByaW50KCJFUlJPUjogQ291bGQgbm90IGZpbmQgUHl0aG9uIGV4ZWN1dGFibGUhIikNCiAgICAgICAgcmV0dXJuDQogICAgcHJpbnQoZiJQeXRob24gZXhlY3V0YWJsZToge3B5dGhvbl9leGV9IikNCiAgICBwcmludChmIlB5dGhvbiBleGlzdHM6IHtvcy5wYXRoLmV4aXN0cyhweXRob25fZXhlKX0iKQ0KICAgIHByaW50KCkNCiAgICANCiAgICAjIENoZWNrIGlmIHNjcmlwdCBleGlzdHMNCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoREFFTU9OX1NDUklQVCk6DQogICAgICAgIHByaW50KGYiRVJST1I6IERhZW1vbiBzY3JpcHQgbm90IGZvdW5kOiB7REFFTU9OX1NDUklQVH0iKQ0KICAgICAgICByZXR1cm4NCiAgICANCiAgICAjIFRlc3QgUHl0aG9uIGNhbiBpbXBvcnQgcmVxdWlyZWQgbW9kdWxlcw0KICAgIHByaW50KCJUZXN0aW5nIFB5dGhvbiBpbXBvcnRzLi4uIikNCiAgICB0ZXN0X2ltcG9ydHMgPSBbDQogICAgICAgICJpbXBvcnQgc3lzIiwNCiAgICAgICAgImltcG9ydCBvcyIsDQogICAgICAgICJpbXBvcnQganNvbiIsDQogICAgICAgICJpbXBvcnQgdGltZSIsDQogICAgICAgICJpbXBvcnQgc3VicHJvY2VzcyIsDQogICAgICAgICJpbXBvcnQgcHN1dGlsIiwNCiAgICAgICAgImltcG9ydCBjdjIiLA0KICAgICAgICAiaW1wb3J0IG51bXB5IiwNCiAgICAgICAgImZyb20gUElMIGltcG9ydCBJbWFnZSIsDQogICAgICAgICJmcm9tIG1zcyBpbXBvcnQgbXNzIiwNCiAgICAgICAgImltcG9ydCBweXRlc3NlcmFjdCINCiAgICBdDQogICAgDQogICAgZm9yIGltcG9ydF9zdG10IGluIHRlc3RfaW1wb3J0czoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oDQogICAgICAgICAgICAgICAgW3B5dGhvbl9leGUsICItYyIsIGltcG9ydF9zdG10XSwNCiAgICAgICAgICAgICAgICBjYXB0dXJlX291dHB1dD1UcnVlLA0KICAgICAgICAgICAgICAgIHRleHQ9VHJ1ZSwNCiAgICAgICAgICAgICAgICB0aW1lb3V0PTUNCiAgICAgICAgICAgICkNCiAgICAgICAgICAgIGlmIHJlc3VsdC5yZXR1cm5jb2RlID09IDA6DQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIOKckyB7aW1wb3J0X3N0bXR9IikNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIOKclyB7aW1wb3J0X3N0bXR9IC0gRXJyb3I6IHtyZXN1bHQuc3RkZXJyWzoxMDBdfSIpDQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgICAgIHByaW50KGYiICDinJcge2ltcG9ydF9zdG10fSAtIEV4Y2VwdGlvbjoge2V9IikNCiAgICBwcmludCgpDQogICAgDQogICAgIyBUcnkgdG8gcnVuIGRhZW1vbiBzY3JpcHQgZGlyZWN0bHkgKHdpbGwgc2hvdyBlcnJvcnMpDQogICAgcHJpbnQoIkF0dGVtcHRpbmcgdG8gc3RhcnQgZGFlbW9uICh3aWxsIHNob3cgYW55IGVycm9ycykuLi4iKQ0KICAgIHByaW50KCI9IiAqIDcwKQ0KICAgIHRyeToNCiAgICAgICAgcHJvY2VzcyA9IHN1YnByb2Nlc3MuUG9wZW4oDQogICAgICAgICAgICBbcHl0aG9uX2V4ZSwgREFFTU9OX1NDUklQVF0sDQogICAgICAgICAgICBjd2Q9QkFTRV9ESVIsDQogICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5QSVBFLA0KICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuU1RET1VULA0KICAgICAgICAgICAgdGV4dD1UcnVlLA0KICAgICAgICAgICAgYnVmc2l6ZT0xDQogICAgICAgICkNCiAgICAgICAgDQogICAgICAgICMgV2FpdCBhIGJpdCBhbmQgY2hlY2sgc3RhdHVzDQogICAgICAgIHRpbWUuc2xlZXAoMykNCiAgICAgICAgDQogICAgICAgIGlmIHByb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludCgi4pyTIERhZW1vbiBwcm9jZXNzIGlzIHJ1bm5pbmciKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoZiLinJcgRGFlbW9uIHByb2Nlc3MgZXhpdGVkIHdpdGggY29kZToge3Byb2Nlc3MucmV0dXJuY29kZX0iKQ0KICAgICAgICAgICAgc3Rkb3V0LCBfID0gcHJvY2Vzcy5jb21tdW5pY2F0ZSh0aW1lb3V0PTEpDQogICAgICAgICAgICBpZiBzdGRvdXQ6DQogICAgICAgICAgICAgICAgcHJpbnQoIlxuT3V0cHV0OiIpDQogICAgICAgICAgICAgICAgcHJpbnQoc3Rkb3V0WzoxMDAwXSkNCiAgICAgICAgDQogICAgICAgICMgQ2hlY2sgZm9yIGxvY2sgZmlsZQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhMT0NLX0ZJTEUpOg0KICAgICAgICAgICAgcHJpbnQoZiLinJMgTG9jayBmaWxlIGNyZWF0ZWQ6IHtMT0NLX0ZJTEV9IikNCiAgICAgICAgICAgIHdpdGggb3BlbihMT0NLX0ZJTEUsICdyJykgYXMgZjoNCiAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpDQogICAgICAgICAgICBwcmludChmIiAgUElEIGluIGxvY2sgZmlsZToge3BpZH0iKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoZiLinJcgTG9jayBmaWxlIE5PVCBjcmVhdGVkOiB7TE9DS19GSUxFfSIpDQogICAgICAgIA0KICAgICAgICAjIENoZWNrIGZvciByZWFkeSBmaWxlDQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKFJFQURZX0ZJTEUpOg0KICAgICAgICAgICAgcHJpbnQoZiLinJMgUmVhZHkgZmlsZSBjcmVhdGVkOiB7UkVBRFlfRklMRX0iKQ0KICAgICAgICAgICAgd2l0aCBvcGVuKFJFQURZX0ZJTEUsICdyJykgYXMgZjoNCiAgICAgICAgICAgICAgICBwaWQgPSBmLnJlYWQoKS5zdHJpcCgpDQogICAgICAgICAgICBwcmludChmIiAgUElEIGluIHJlYWR5IGZpbGU6IHtwaWR9IikNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHByaW50KGYi4pyXIFJlYWR5IGZpbGUgTk9UIGNyZWF0ZWQ6IHtSRUFEWV9GSUxFfSIpDQogICAgICAgIA0KICAgICAgICAjIENoZWNrIGRlYnVnLmxvZw0KICAgICAgICBkZWJ1Z19sb2cgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWJ1Zy5sb2ciKQ0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhkZWJ1Z19sb2cpOg0KICAgICAgICAgICAgcHJpbnQoZiJcbuKckyBEZWJ1ZyBsb2cgZXhpc3RzOiB7ZGVidWdfbG9nfSIpDQogICAgICAgICAgICB3aXRoIG9wZW4oZGVidWdfbG9nLCAncicsIGVuY29kaW5nPSd1dGYtOCcsIGVycm9ycz0naWdub3JlJykgYXMgZjoNCiAgICAgICAgICAgICAgICBsaW5lcyA9IGYucmVhZGxpbmVzKCkNCiAgICAgICAgICAgICAgICBwcmludChmIiAgTGFzdCAxMCBsaW5lczoiKQ0KICAgICAgICAgICAgICAgIGZvciBsaW5lIGluIGxpbmVzWy0xMDpdOg0KICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgICB7bGluZS5yc3RyaXAoKX0iKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQoZiJcbuKclyBEZWJ1ZyBsb2cgTk9UIGNyZWF0ZWQ6IHtkZWJ1Z19sb2d9IikNCiAgICAgICAgDQogICAgICAgICMgU3RvcCB0aGUgZGFlbW9uDQogICAgICAgIGlmIHByb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICBwcmludCgiXG5TdG9wcGluZyBkYWVtb24uLi4iKQ0KICAgICAgICAgICAgc3RvcF9maWxlID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiU1RPUCIpDQogICAgICAgICAgICB3aXRoIG9wZW4oc3RvcF9maWxlLCAndycpIGFzIGY6DQogICAgICAgICAgICAgICAgZi53cml0ZSgiIikNCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkNCiAgICAgICAgICAgIGlmIHByb2Nlc3MucG9sbCgpIGlzIE5vbmU6DQogICAgICAgICAgICAgICAgcHJvY2Vzcy50ZXJtaW5hdGUoKQ0KICAgICAgICAgICAgICAgIHRpbWUuc2xlZXAoMSkNCiAgICAgICAgICAgICAgICBpZiBwcm9jZXNzLnBvbGwoKSBpcyBOb25lOg0KICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmtpbGwoKQ0KICAgICAgICANCiAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgIHByaW50KGYiRVJST1IgcnVubmluZyBkYWVtb246IHtlfSIpDQogICAgICAgIGltcG9ydCB0cmFjZWJhY2sNCiAgICAgICAgdHJhY2ViYWNrLnByaW50X2V4YygpDQogICAgDQogICAgcHJpbnQoIlxuIiArICI9IiAqIDcwKQ0KICAgIHByaW50KCJURVNUIENPTVBMRVRFIikNCiAgICBwcmludCgiPSIgKiA3MCkNCg0KaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoNCiAgICBtYWluKCkNCg0K",
  "reset_death_counter.py": "IiIiDQpSZXNldCBEZWF0aCBDb3VudGVyDQpTaW1wbGUgc2NyaXB0IHRvIHJlc2V0IGFsbCBkZWF0aCBjb3VudHMgdG8gMC4NCldvcmtzIHdpdGggYW55IGluc3RhbGxhdGlvbiBsb2NhdGlvbi4NCiIiIg0KDQppbXBvcnQgb3MNCmltcG9ydCBzeXMNCmltcG9ydCBqc29uDQoNCiMgR2V0IHRoZSBkaXJlY3Rvcnkgd2hlcmUgdGhpcyBzY3JpcHQgaXMgbG9jYXRlZCAod29ya3MgZm9yIGJvdGggLmV4ZSBhbmQgLnB5KQ0KZGVmIGdldF9iYXNlX2RpcigpOg0KICAgICIiIkdldCB0aGUgYmFzZSBkaXJlY3RvcnkgLSBzYW1lIGZvbGRlciBhcyB0aGlzIHNjcmlwdC4iIiINCiAgICBpZiBnZXRhdHRyKHN5cywgJ2Zyb3plbicsIEZhbHNlKToNCiAgICAgICAgIyBSdW5uaW5nIGFzIGNvbXBpbGVkIC5leGUgLSB1c2UgdGhlIGRpcmVjdG9yeSB3aGVyZSAuZXhlIGlzIGxvY2F0ZWQNCiAgICAgICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoc3lzLmV4ZWN1dGFibGUpKQ0KICAgIGVsc2U6DQogICAgICAgICMgUnVubmluZyBhcyBzY3JpcHQgLSB1c2UgdGhlIGRpcmVjdG9yeSB3aGVyZSB0aGUgc2NyaXB0IGlzIGxvY2F0ZWQNCiAgICAgICAgcmV0dXJuIG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmFic3BhdGgoX19maWxlX18pKQ0KDQpCQVNFX0RJUiA9IGdldF9iYXNlX2RpcigpDQpTVEFURV9KU09OID0gb3MucGF0aC5qb2luKEJBU0VfRElSLCAiZGVhdGhfc3RhdGUuanNvbiIpDQpERUFUSF9UWFQgPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsICJkZWF0aF9jb3VudGVyLnR4dCIpDQoNCg0KZGVmIHJlc2V0X2RlYXRocygpOg0KICAgICIiIlJlc2V0IGFsbCBkZWF0aCBjb3VudHMgdG8gMC4iIiINCiAgICBwcmludCgiPSIgKiA2MCkNCiAgICBwcmludCgiUkVTRVQgREVBVEggQ09VTlRFUiIpDQogICAgcHJpbnQoIj0iICogNjApDQogICAgcHJpbnQoZiJJbnN0YWxsYXRpb24gZm9sZGVyOiB7QkFTRV9ESVJ9IikNCiAgICBwcmludCgpDQogICAgDQogICAgIyBSZXNldCBzdGF0ZSBKU09ODQogICAgaWYgb3MucGF0aC5leGlzdHMoU1RBVEVfSlNPTik6DQogICAgICAgIHRyeToNCiAgICAgICAgICAgICMgTG9hZCBleGlzdGluZyBzdGF0ZSB0byBwcmVzZXJ2ZSBnYW1lIGxpc3Qgc3RydWN0dXJlDQogICAgICAgICAgICB3aXRoIG9wZW4oU1RBVEVfSlNPTiwgInIiLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOg0KICAgICAgICAgICAgICAgIG9sZF9zdGF0ZSA9IGpzb24ubG9hZChmKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIENyZWF0ZSBuZXcgc3RhdGUgd2l0aCB6ZXJvcyBidXQgcHJlc2VydmUgZ2FtZSBzdHJ1Y3R1cmUNCiAgICAgICAgICAgIG5ld19zdGF0ZSA9IHsNCiAgICAgICAgICAgICAgICAidG90YWxfZGVhdGhzIjogMCwNCiAgICAgICAgICAgICAgICAiZ2FtZV9kZWF0aHMiOiB7fSwNCiAgICAgICAgICAgICAgICAidGljayI6IG9sZF9zdGF0ZS5nZXQoInRpY2siLCAwKSwgICMgS2VlcCB0aWNrIGNvdW50DQogICAgICAgICAgICAgICAgInN0cmVhayI6IDAsDQogICAgICAgICAgICAgICAgImxhc3RfZGVhdGhfdHMiOiAwLjAsDQogICAgICAgICAgICAgICAgImN1cnJlbnRfZ2FtZSI6IG9sZF9zdGF0ZS5nZXQoImN1cnJlbnRfZ2FtZSIsIE5vbmUpLA0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFByZXNlcnZlIGdhbWUgbmFtZXMgZnJvbSBvbGQgc3RhdGUsIHNldCBhbGwgdG8gMA0KICAgICAgICAgICAgaWYgImdhbWVfZGVhdGhzIiBpbiBvbGRfc3RhdGU6DQogICAgICAgICAgICAgICAgZm9yIGdhbWVfbmFtZSBpbiBvbGRfc3RhdGVbImdhbWVfZGVhdGhzIl0ua2V5cygpOg0KICAgICAgICAgICAgICAgICAgICBuZXdfc3RhdGVbImdhbWVfZGVhdGhzIl1bZ2FtZV9uYW1lXSA9IDANCiAgICAgICAgICAgIA0KICAgICAgICAgICAgIyBXcml0ZSBuZXcgc3RhdGUNCiAgICAgICAgICAgIHdpdGggb3BlbihTVEFURV9KU09OLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6DQogICAgICAgICAgICAgICAganNvbi5kdW1wKG5ld19zdGF0ZSwgZiwgaW5kZW50PTIpDQogICAgICAgICAgICBwcmludChmIuKckyBSZXNldCBzdGF0ZSBmaWxlOiB7bGVuKG5ld19zdGF0ZVsnZ2FtZV9kZWF0aHMnXSl9IGdhbWVzIHJlc2V0IHRvIDAiKQ0KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6DQogICAgICAgICAgICBwcmludChmIuKclyBFcnJvciByZXNldHRpbmcgc3RhdGUgZmlsZToge2V9IikNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgIGVsc2U6DQogICAgICAgIHByaW50KCLihLkgTm8gc3RhdGUgZmlsZSBmb3VuZCAod2lsbCBiZSBjcmVhdGVkIG9uIGZpcnN0IHJ1bikiKQ0KICAgIA0KICAgICMgUmVzZXQgbWFpbiB0ZXh0IGZpbGUNCiAgICB0cnk6DQogICAgICAgIHdpdGggb3BlbihERUFUSF9UWFQsICJ3IiwgZW5jb2Rpbmc9InV0Zi04IikgYXMgZjoNCiAgICAgICAgICAgIGYud3JpdGUoIjAiKQ0KICAgICAgICBwcmludCgi4pyTIFJlc2V0IG1haW4gdGV4dCBmaWxlIHRvIDAiKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiLinJcgRXJyb3IgcmVzZXR0aW5nIG1haW4gdGV4dCBmaWxlOiB7ZX0iKQ0KICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAgICAjIERlbGV0ZSBwZXItZ2FtZSB0ZXh0IGZpbGVzDQogICAgdHJ5Og0KICAgICAgICBkZWxldGVkX2NvdW50ID0gMA0KICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhCQVNFX0RJUik6DQogICAgICAgICAgICBmb3IgZmlsZW5hbWUgaW4gb3MubGlzdGRpcihCQVNFX0RJUik6DQogICAgICAgICAgICAgICAgaWYgZmlsZW5hbWUuc3RhcnRzd2l0aCgiZGVhdGhfY291bnRlcl8iKSBhbmQgZmlsZW5hbWUuZW5kc3dpdGgoIi50eHQiKSBhbmQgZmlsZW5hbWUgIT0gImRlYXRoX2NvdW50ZXIudHh0IjoNCiAgICAgICAgICAgICAgICAgICAgZmlsZXBhdGggPSBvcy5wYXRoLmpvaW4oQkFTRV9ESVIsIGZpbGVuYW1lKQ0KICAgICAgICAgICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoZmlsZXBhdGgpDQogICAgICAgICAgICAgICAgICAgICAgICBkZWxldGVkX2NvdW50ICs9IDENCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICAgICAgICAgcGFzcw0KICAgICAgICBpZiBkZWxldGVkX2NvdW50ID4gMDoNCiAgICAgICAgICAgIHByaW50KGYi4pyTIERlbGV0ZWQge2RlbGV0ZWRfY291bnR9IHBlci1nYW1lIHRleHQgZmlsZShzKSIpDQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICBwcmludChmIuKaoCBDb3VsZCBub3QgY2xlYW4gdXAgcGVyLWdhbWUgZmlsZXM6IHtlfSIpDQogICAgDQogICAgcHJpbnQoKQ0KICAgIHByaW50KCI9IiAqIDYwKQ0KICAgIHByaW50KCJTVUNDRVNTISBBbGwgZGVhdGggY291bnRzIHJlc2V0IHRvIDAuIikNCiAgICBwcmludCgiPSIgKiA2MCkNCiAgICBwcmludCgpDQogICAgcHJpbnQoIk5vdGU6IFRoZSBkYWVtb24gd2lsbCBhdXRvbWF0aWNhbGx5IHBpY2sgdXAgdGhlIGNoYW5nZXMuIikNCiAgICBwcmludCgiICAgICAgTm8gbmVlZCB0byByZXN0YXJ0IHRoZSBkYWVtb24uIikNCiAgICANCiAgICByZXR1cm4gVHJ1ZQ0KDQoNCmlmIF9fbmFtZV9fID09ICJfX21haW5fXyI6DQogICAgdHJ5Og0KICAgICAgICBzdWNjZXNzID0gcmVzZXRfZGVhdGhzKCkNCiAgICAgICAgaWYgbm90IHN1Y2Nlc3M6DQogICAgICAgICAgICBwcmludCgiXG5QcmVzcyBFbnRlciB0byBleGl0Li4uIikNCiAgICAgICAgICAgIGlucHV0KCkNCiAgICAgICAgICAgIHN5cy5leGl0KDEpDQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0Og0KICAgICAgICBwcmludCgiXG5cblJlc2V0IGNhbmNlbGxlZC4iKQ0KICAgICAgICBzeXMuZXhpdCgxKQ0KICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCiAgICAgICAgcHJpbnQoZiJcbuKclyBVbmV4cGVjdGVkIGVycm9yOiB7ZX0iKQ0KICAgICAgICBwcmludCgiXG5QcmVzcyBFbnRlciB0byBleGl0Li4uIikNCiAgICAgICAgaW5wdXQoKQ0KICAgICAgICBzeXMuZXhpdCgxKQ0KDQo=",
  "RESET_DEATH_COUNTER.bat": "QGVjaG8gb2ZmDQpSRU0gUmVzZXQgRGVhdGggQ291bnRlcg0KUkVNIFRoaXMgYmF0Y2ggZmlsZSByZXNldHMgYWxsIGRlYXRoIGNvdW50cyB0byAwDQoNCmNkIC9kICIlfmRwMCINCnB5dGhvbiByZXNldF9kZWF0aF9jb3VudGVyLnB5DQppZiBlcnJvcmxldmVsIDEgKA0KICAgIGVjaG8uDQogICAgZWNobyBQcmVzcyBhbnkga2V5IHRvIGV4aXQuLi4NCiAgICBwYXVzZSA+bnVsDQopDQoNCg=="
}

# Get the directory where the installer is located (works for both .exe and .py)
def get_install_dir():
    """Get the installation directory - same folder as the installer executable."""
    if getattr(sys, 'frozen', False):
        # Running as compiled .exe - use the directory where .exe is located
        return os.path.dirname(os.path.abspath(sys.executable))
    else:
        # Running as script - use the directory where the script is located
        return os.path.dirname(os.path.abspath(__file__))

INSTALL_DIR = get_install_dir()

def extract_files():
    """Extract all embedded files."""
    extracted = []
    os.makedirs(INSTALL_DIR, exist_ok=True)
    
    for filename, content_b64 in EMBEDDED_FILES.items():
        try:
            content = base64.b64decode(content_b64)
            filepath = os.path.join(INSTALL_DIR, filename)
            
            # Write file
            with open(filepath, 'wb') as f:
                f.write(content)
            
            extracted.append(filepath)
            print(f"Extracted: {filename}")
        except Exception as e:
            print(f"Error extracting {filename}: {e}")
    
    return extracted

def find_python_executable(use_pythonw=False):
    """Find the actual Python executable (not the installer exe).
    Comprehensive search for general public use.
    If use_pythonw=True, searches for pythonw.exe (no console window)."""
    # If running as a script (not frozen), use sys.executable
    if not getattr(sys, 'frozen', False):
        if use_pythonw:
            # Try to find pythonw.exe in the same directory as python.exe
            python_dir = os.path.dirname(sys.executable)
            pythonw_exe = os.path.join(python_dir, "pythonw.exe")
            if os.path.exists(pythonw_exe):
                return pythonw_exe
            return sys.executable  # Fallback to python.exe
        return sys.executable
    
    exe_name = "pythonw.exe" if use_pythonw else "python.exe"
    command_name = "pythonw" if use_pythonw else "python"
    
    # If running as PyInstaller exe, we need to find Python
    # Method 1: Try command (if in PATH) - most reliable
    if not use_pythonw:  # pythonw is rarely in PATH
        try:
            result = subprocess.run([command_name, '--version'], 
                                  capture_output=True, text=True, timeout=2)
            if result.returncode == 0:
                return command_name
        except:
            pass
    
    # Method 2: Try 'py' launcher (Windows Python launcher) - also reliable
    if not use_pythonw:  # py launcher doesn't support pythonw directly
        try:
            result = subprocess.run(['py', '--version'], 
                                  capture_output=True, text=True, timeout=2)
            if result.returncode == 0:
                return 'py'
        except:
            pass
    
    # Method 3: Search Windows Registry for Python installations
    try:
        import winreg
        # Check both 32-bit and 64-bit registry
        for arch in [winreg.KEY_WOW64_64KEY, winreg.KEY_WOW64_32KEY]:
            try:
                # Check HKEY_LOCAL_MACHINE
                key = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, 
                                    r"SOFTWARE\Python\PythonCore", 0,
                                    winreg.KEY_READ | arch)
                try:
                    # Get all installed Python versions
                    i = 0
                    while True:
                        try:
                            version = winreg.EnumKey(key, i)
                            install_path_key = winreg.OpenKey(key, f"{version}\\InstallPath")
                            try:
                                install_path = winreg.QueryValueEx(install_path_key, "")[0]
                                python_exe = os.path.join(install_path, exe_name)
                                if os.path.exists(python_exe):
                                    winreg.CloseKey(install_path_key)
                                    winreg.CloseKey(key)
                                    return python_exe
                                # If pythonw.exe not found, try python.exe as fallback
                                if use_pythonw:
                                    python_exe = os.path.join(install_path, "python.exe")
                                    if os.path.exists(python_exe):
                                        winreg.CloseKey(install_path_key)
                                        winreg.CloseKey(key)
                                        return python_exe
                                winreg.CloseKey(install_path_key)
                            except:
                                pass
                            i += 1
                        except OSError:
                            break
                    winreg.CloseKey(key)
                except:
                    try:
                        winreg.CloseKey(key)
                    except:
                        pass
            except:
                pass
    except:
        pass
    
    # Method 4: Search common installation locations
    userprofile = os.getenv('USERPROFILE', '')
    programfiles = os.getenv('ProgramFiles', r'C:\Program Files')
    programfiles_x86 = os.getenv('ProgramFiles(x86)', r'C:\Program Files (x86)')
    
    search_paths = []
    
    # User AppData locations (most common for Python 3.8+)
    if userprofile:
        appdata_local = os.path.join(userprofile, r"AppData\Local\Programs\Python")
        if os.path.exists(appdata_local):
            # Search all Python versions in this directory
            try:
                for item in os.listdir(appdata_local):
                    python_dir = os.path.join(appdata_local, item)
                    if os.path.isdir(python_dir):
                        python_exe = os.path.join(python_dir, exe_name)
                        if os.path.exists(python_exe):
                            search_paths.append(python_exe)
                        # If pythonw.exe not found, try python.exe as fallback
                        elif use_pythonw:
                            python_exe = os.path.join(python_dir, "python.exe")
                            if os.path.exists(python_exe):
                                search_paths.append(python_exe)
            except:
                pass
    
    # Common root-level Python installations
    for version in ['312', '311', '310', '39', '38']:
        search_paths.extend([
            os.path.join(r"C:\Python" + version, exe_name),
            os.path.join(programfiles, f"Python{version}", exe_name),
            os.path.join(programfiles_x86, f"Python{version}", exe_name),
        ])
        # If pythonw.exe not found, add python.exe as fallback
        if use_pythonw:
            search_paths.extend([
                os.path.join(r"C:\Python" + version, "python.exe"),
                os.path.join(programfiles, f"Python{version}", "python.exe"),
                os.path.join(programfiles_x86, f"Python{version}", "python.exe"),
            ])
    
    # Check all collected paths
    for path in search_paths:
        if os.path.exists(path):
            return path
    
    # Method 5: Recursive search in Program Files (last resort, slower)
    try:
        for root_dir in [programfiles, programfiles_x86]:
            if os.path.exists(root_dir):
                for root, dirs, files in os.walk(root_dir):
                    # Limit depth to avoid slow searches
                    depth = root[len(root_dir):].count(os.sep)
                    if depth > 2:  # Max 2 levels deep
                        dirs[:] = []  # Don't recurse deeper
                        continue
                    
                    if exe_name in files or (use_pythonw and 'python.exe' in files):
                        python_exe = os.path.join(root, exe_name if exe_name in files else 'python.exe')
                        # Verify it's actually Python
                        try:
                            result = subprocess.run([python_exe, '--version'], 
                                                  capture_output=True, timeout=1)
                            if result.returncode == 0:
                                return python_exe
                        except:
                            pass
    except:
        pass
    
    return None

def check_python():
    """Check if Python is installed."""
    python_exe = find_python_executable()
    if not python_exe:
        return False, None
    
    try:
        result = subprocess.run([python_exe, '--version'], 
                              capture_output=True, text=True, timeout=5)
        return True, result.stdout.strip()
    except:
        return False, None

def check_tesseract():
    """Check if Tesseract OCR is installed."""
    default_path = r"C:\Program Files\Tesseract-OCR\tesseract.exe"
    if os.path.exists(default_path):
        return True, default_path
    try:
        result = subprocess.run(['tesseract', '--version'], 
                              capture_output=True, text=True, timeout=5)
        if result.returncode == 0:
            return True, "tesseract"
    except:
        pass
    return False, None

def find_tesseract_tessdata():
    """Find the Tesseract tessdata directory."""
    # Default location
    default_tessdata = r"C:\Program Files\Tesseract-OCR\tessdata"
    if os.path.exists(default_tessdata):
        return default_tessdata
    
    # Try to find from tesseract.exe path
    tesseract_ok, tesseract_path = check_tesseract()
    if tesseract_ok and tesseract_path != "tesseract":
        # If tesseract.exe is at C:\Program Files\Tesseract-OCR\tesseract.exe
        # tessdata should be at C:\Program Files\Tesseract-OCR\tessdata
        tessdata_dir = os.path.join(os.path.dirname(tesseract_path), "tessdata")
        if os.path.exists(tessdata_dir):
            return tessdata_dir
    
    return None

def check_japanese_lang_pack():
    """Check if Japanese language pack is installed."""
    tessdata_dir = find_tesseract_tessdata()
    if not tessdata_dir:
        return False, None
    
    jpn_file = os.path.join(tessdata_dir, "jpn.traineddata")
    jpn_vert_file = os.path.join(tessdata_dir, "jpn_vert.traineddata")
    # At minimum, jpn.traineddata must exist (jpn_vert is optional but recommended)
    return os.path.exists(jpn_file), tessdata_dir

def download_japanese_lang_pack(tessdata_dir, log_callback=None):
    """Download Japanese language pack for Tesseract with multiple fallbacks."""
    jpn_file = os.path.join(tessdata_dir, "jpn.traineddata")
    jpn_vert_file = os.path.join(tessdata_dir, "jpn_vert.traineddata")
    jpn_url = "https://github.com/tesseract-ocr/tessdata/raw/main/jpn.traineddata"
    jpn_vert_url = "https://github.com/tesseract-ocr/tessdata/raw/main/jpn_vert.traineddata"

    def log(msg):
        if log_callback:
            log_callback(msg)

    def file_ok(filepath):
        return os.path.exists(filepath) and os.path.getsize(filepath) > 1024 * 1024

    def download_file(url, filepath, method_name="", ssl_ctx=None):
        """Helper to download a single file with given method."""
        try:
            if ssl_ctx:
                with urllib.request.urlopen(url, context=ssl_ctx) as resp, open(filepath, "wb") as f:
                    shutil.copyfileobj(resp, f)
            else:
                urllib.request.urlretrieve(url, filepath)
            return file_ok(filepath)
        except Exception as e:
            log(f"{method_name} failed for {os.path.basename(filepath)}: {e}")
            return False

    log("Downloading Japanese language packs for Tesseract...")
    log("Note: Japanese packs are required for reliable Sekiro detection (Japanese '' character)")

    import urllib.request
    import urllib.error
    import ssl
    import subprocess
    import shutil

    # Attempt 1: standard urllib (validated SSL)
    try:
        log("Attempt 1: Downloading with standard SSL verification...")
        jpn_ok = download_file(jpn_url, jpn_file, "Attempt 1")
        jpn_vert_ok = download_file(jpn_vert_url, jpn_vert_file, "Attempt 1")
        if jpn_ok and jpn_vert_ok:
            log("Japanese language packs downloaded successfully!")
            log("Sekiro detection is now fully supported!")
            return True
        elif jpn_ok:
            log("jpn.traineddata downloaded successfully!")
            log("Note: jpn_vert.traineddata failed, but basic support is available")
            return True
    except Exception as e:
        log(f"Attempt 1 (urllib with SSL verify) failed: {e}")

    # Attempt 2: urllib with relaxed SSL (ignore cert validation)
    try:
        log("Attempt 2: Downloading with relaxed SSL (ignoring certificate validation)...")
        ctx = ssl._create_unverified_context()
        jpn_ok = download_file(jpn_url, jpn_file, "Attempt 2", ctx)
        jpn_vert_ok = download_file(jpn_vert_url, jpn_vert_file, "Attempt 2", ctx)
        if jpn_ok and jpn_vert_ok:
            log("Japanese language packs downloaded successfully! (Attempt 2 - unverified SSL)")
            log("Sekiro detection is now fully supported!")
            return True
        elif jpn_ok:
            log("jpn.traineddata downloaded successfully! (Attempt 2)")
            log("Note: jpn_vert.traineddata failed, but basic support is available")
            return True
    except Exception as e:
        log(f"Attempt 2 (urllib ignore cert) failed: {e}")

    # Attempt 3: PowerShell Invoke-WebRequest with SkipCertificateCheck (Windows-only)
    try:
        log("Attempt 3: Downloading with PowerShell (bypassing certificate check)...")
        ps_script = f'''
$ProgressPreference = 'SilentlyContinue'
$ErrorActionPreference = 'Stop'
try {{
    Invoke-WebRequest -Uri "{jpn_url}" -UseBasicParsing -SkipCertificateCheck -OutFile "{jpn_file}" -TimeoutSec 30
    Invoke-WebRequest -Uri "{jpn_vert_url}" -UseBasicParsing -SkipCertificateCheck -OutFile "{jpn_vert_file}" -TimeoutSec 30
    exit 0
}} catch {{
    Write-Host $_.Exception.Message
    exit 1
}}
'''
        result = subprocess.run(
            ["powershell", "-NoProfile", "-ExecutionPolicy", "Bypass", "-Command", ps_script],
            check=False, capture_output=True, text=True, timeout=60
        )
        jpn_ok = file_ok(jpn_file)
        jpn_vert_ok = file_ok(jpn_vert_file)
        if jpn_ok and jpn_vert_ok:
            log("Japanese language packs downloaded successfully! (Attempt 3 - PowerShell)")
            log("Sekiro detection is now fully supported!")
            return True
        elif jpn_ok:
            log("jpn.traineddata downloaded successfully! (Attempt 3)")
            log("Note: jpn_vert.traineddata failed, but basic support is available")
            return True
        else:
            if result.stderr:
                log(f"PowerShell error: {result.stderr}")
    except Exception as e:
        log(f"Attempt 3 (PowerShell) failed: {e}")

    # Final fallback: guide manual download
    log("Japanese pack auto-download failed. Manual download recommended for Sekiro.")
    log("Download from:")
    log("  https://github.com/tesseract-ocr/tessdata/raw/main/jpn.traineddata")
    log("  https://github.com/tesseract-ocr/tessdata/raw/main/jpn_vert.traineddata")
    log(f"Save to: {tessdata_dir}")
    return False

def install_dependencies():
    """Install Python dependencies."""
    python_exe = find_python_executable()
    if not python_exe:
        return False
    
    try:
        packages = ['mss', 'pillow', 'pytesseract', 'opencv-python', 'numpy', 'psutil']
        subprocess.run([python_exe, '-m', 'pip', 'install', '--upgrade', 'pip'], 
                      check=False, capture_output=True)
        subprocess.run([python_exe, '-m', 'pip', 'install'] + packages, 
                      check=True, capture_output=True)
        return True
    except subprocess.CalledProcessError as e:
        return False

class InstallerGUI:
    def __init__(self, root):
        self.root = root
        self.root.title("Death Counter - Installer & Launcher")
        self.root.geometry("850x650")
        self.root.resizable(False, False)
        
        self.setup_complete = False
        self.streamerbot_imported = False
        self.create_ui()
        self.check_system()
    
    def create_ui(self):
        main_frame = ttk.Frame(self.root, padding="20")
        main_frame.grid(row=0, column=0, sticky=(tk.W, tk.E, tk.N, tk.S))
        
        title = ttk.Label(main_frame, text="Death Counter", 
                         font=("Arial", 18, "bold"))
        title.grid(row=0, column=0, columnspan=2, pady=(0, 20))
        
        status_frame = ttk.LabelFrame(main_frame, text="System Check", padding="10")
        status_frame.grid(row=1, column=0, columnspan=2, sticky=(tk.W, tk.E), pady=(0, 10))
        
        self.python_status = ttk.Label(status_frame, text="Checking Python...")
        self.python_status.grid(row=0, column=0, sticky=tk.W, pady=2)
        
        self.tesseract_status = ttk.Label(status_frame, text="Checking Tesseract OCR...")
        self.tesseract_status.grid(row=1, column=0, sticky=tk.W, pady=2)
        
        self.deps_status = ttk.Label(status_frame, text="Checking dependencies...")
        self.deps_status.grid(row=2, column=0, sticky=tk.W, pady=2)
        
        self.jpn_status = ttk.Label(status_frame, text="Checking Japanese pack...")
        self.jpn_status.grid(row=3, column=0, sticky=tk.W, pady=2)
        
        log_frame = ttk.LabelFrame(main_frame, text="Log", padding="10")
        log_frame.grid(row=2, column=0, columnspan=2, sticky=(tk.W, tk.E, tk.N, tk.S), pady=(0, 10))
        main_frame.rowconfigure(2, weight=1)
        
        self.log_text = scrolledtext.ScrolledText(log_frame, height=10, width=80)
        self.log_text.pack(fill=tk.BOTH, expand=True)
        
        # First row of buttons
        button_frame1 = ttk.Frame(main_frame)
        button_frame1.grid(row=3, column=0, columnspan=2, pady=(0, 5))
        
        self.install_button = ttk.Button(button_frame1, text="Install/Update Files", 
                                         command=self.install_files, width=22)
        self.install_button.pack(side=tk.LEFT, padx=3)
        
        self.install_python_button = ttk.Button(button_frame1, text="Install Python", 
                                               command=self.install_python, width=22)
        self.install_python_button.pack(side=tk.LEFT, padx=3)
        
        self.install_tesseract_button = ttk.Button(button_frame1, text="Install Tesseract", 
                                                   command=self.install_tesseract, width=22)
        self.install_tesseract_button.pack(side=tk.LEFT, padx=3)
        
        self.install_deps_button = ttk.Button(button_frame1, text="Install Dependencies", 
                                              command=self.install_deps, width=22)
        self.install_deps_button.pack(side=tk.LEFT, padx=3)
        
        # Second row of buttons
        button_frame2 = ttk.Frame(main_frame)
        button_frame2.grid(row=4, column=0, columnspan=2, pady=(0, 10))
        
        self.streamerbot_download_button = ttk.Button(button_frame2, text="Streamer.bot Download", 
                                                      command=self.download_streamerbot, width=22)
        self.streamerbot_download_button.pack(side=tk.LEFT, padx=3)
        
        self.streamerbot_import_button = ttk.Button(button_frame2, text="Import to Streamer.bot", 
                                                    command=self.import_streamerbot, width=22)
        self.streamerbot_import_button.pack(side=tk.LEFT, padx=3)
        
        self.confirm_import_button = ttk.Button(button_frame2, text=" Confirm Import", 
                                                command=self.confirm_import, width=22, state=tk.DISABLED)
        self.confirm_import_button.pack(side=tk.LEFT, padx=3)
        
        self.launch_button = ttk.Button(button_frame2, text="Launch Death Counter", 
                                       command=self.launch_app, width=22, state=tk.DISABLED)
        self.launch_button.pack(side=tk.LEFT, padx=3)
        
        info_text = ("1. Click 'Install/Update Files' to extract all files\n"
                    "2. Click 'Install Dependencies' to install Python packages\n"
                    "3. Install Tesseract OCR from: https://github.com/UB-Mannheim/tesseract/wiki\n"
                    "4. Click 'Streamer.bot Download' to download and install Streamer.bot\n"
                    "5. Click 'Import to Streamer.bot' and import the action file, then click 'Confirm Import'\n"
                    "6. Click 'Launch Death Counter' to start")
        info_label = ttk.Label(main_frame, text=info_text, justify=tk.LEFT)
        info_label.grid(row=5, column=0, columnspan=2, sticky=tk.W)
    
    def log(self, message):
        self.log_text.insert(tk.END, message + "\n")
        self.log_text.see(tk.END)
        self.root.update()
    
    def check_system(self):
        python_ok, python_version = check_python()
        if python_ok:
            self.python_status.config(text=f" Python: {python_version}", foreground="green")
        else:
            self.python_status.config(text=" Python not found", foreground="red")
        
        tesseract_ok, tesseract_path = check_tesseract()
        if tesseract_ok:
            self.tesseract_status.config(text=" Tesseract OCR: Found", foreground="green")
            # Check for Japanese language pack
            jpn_installed, tessdata_dir = check_japanese_lang_pack()
            if jpn_installed:
                self.jpn_status.config(text=" Japanese Pack: Installed (Sekiro ready)", foreground="green")
            else:
                self.jpn_status.config(text=" Japanese Pack: Missing (recommended for Sekiro)", foreground="orange")
        else:
            self.tesseract_status.config(text=" Tesseract OCR: Not found (install from link below)", foreground="orange")
            self.jpn_status.config(text=" Japanese Pack: Check after Tesseract install", foreground="gray")
        
        try:
            import mss
            import cv2
            import pytesseract
            import psutil
            self.deps_status.config(text=" Dependencies: Installed", foreground="green")
        except ImportError:
            self.deps_status.config(text=" Dependencies: Not installed", foreground="red")
        
        gui_path = os.path.join(INSTALL_DIR, "death_counter_gui.py")
        cs_file_path = os.path.join(INSTALL_DIR, "deathcounteraction.cs")
        if os.path.exists(gui_path):
            self.setup_complete = True
            if os.path.exists(cs_file_path):
                self.log("Files already installed. Import to Streamer.bot to enable launch button.")
                # Enable Confirm Import button if action file exists
                self.confirm_import_button.config(state=tk.NORMAL)
            else:
                self.log("Files already installed. Ready to launch!")
                self.update_launch_button_state()
        else:
            self.log("Files not yet installed. Click 'Install/Update Files' first.")
    
    def update_launch_button_state(self):
        """Update launch button state based on setup completion and Streamer.bot import status."""
        if self.setup_complete:
            if self.streamerbot_imported:
                self.launch_button.config(state=tk.NORMAL)
            else:
                cs_file_path = os.path.join(INSTALL_DIR, "deathcounteraction.cs")
                if not os.path.exists(cs_file_path):
                    # If no Streamer.bot action file, allow launch without import
                    self.launch_button.config(state=tk.NORMAL)
                else:
                    # Action file exists, require import confirmation
                    self.launch_button.config(state=tk.DISABLED)
    
    def install_python(self):
        """Open Python download page."""
        self.log("Opening Python download page...")
        webbrowser.open("https://www.python.org/downloads/")
        self.log("Python download page opened. After installing, restart this installer.")
        messagebox.showinfo("Python Installation", 
                          "After installing Python, please:\n"
                          "1. Check 'Add Python to PATH' during installation\n"
                          "2. Restart this installer")
    
    def install_tesseract(self):
        """Open Tesseract OCR download page."""
        self.log("Opening Tesseract OCR download page...")
        webbrowser.open("https://github.com/UB-Mannheim/tesseract/wiki")
        self.log("Tesseract OCR download page opened.")
        messagebox.showinfo("Tesseract OCR Installation", 
                          "Default install path: C:\\Program Files\\Tesseract-OCR\\\n"
                          "After installing, restart this installer.")
    
    def download_streamerbot(self):
        """Open Streamer.bot download page."""
        self.log("Opening Streamer.bot download page...")
        webbrowser.open("https://streamer.bot/")
        self.log("Streamer.bot download page opened.")
    
    def import_streamerbot(self):
        """Open file location for Streamer.bot action file."""
        cs_file_path = os.path.join(INSTALL_DIR, "deathcounteraction.cs")
        if not os.path.exists(cs_file_path):
            self.log("Action file not found. Please install files first.")
            messagebox.showerror("Error", 
                               "The action file has not been extracted yet.\n\n"
                               "Please click 'Install/Update Files' first to extract all files.")
            return
        
        # Open the file location in Explorer
        try:
            subprocess.Popen(f'explorer /select,"{cs_file_path}"')
            self.log("Opened file location: {cs_file_path}")
            self.log("Streamer.bot import instructions displayed.")
            # Enable the Confirm Import button after showing instructions
            self.confirm_import_button.config(state=tk.NORMAL)
            messagebox.showinfo("Import to Streamer.bot", 
                              "1. In Streamer.bot, go to Actions\n"
                              "2. Click 'Import'\n"
                              "3. Select the deathcounteraction.cs file\n"
                              "4. After importing, click 'Confirm Import' button")
        except Exception as e:
            self.log(f"Error opening file location: {e}")
            messagebox.showerror("Error", f"Could not open file location: {e}")
    
    def confirm_import(self):
        """Confirm that Streamer.bot action has been imported."""
        self.streamerbot_imported = True
        self.confirm_import_button.config(state=tk.DISABLED)
        self.update_launch_button_state()
        self.log("Streamer.bot import confirmed! Launch button enabled.")
        messagebox.showinfo("Import Confirmed", "Streamer.bot import confirmed. You can now launch the Death Counter!")
    
    def install_files(self):
        self.log("Installing files...")
        self.install_button.config(state=tk.DISABLED)
        
        def do_install():
            try:
                extracted = extract_files()
                self.log(f"Extracted {len(extracted)} files successfully!")
                self.setup_complete = True
                self.update_launch_button_state()
                
                # Check for Tesseract and Japanese language pack
                tesseract_ok, tesseract_path = check_tesseract()
                if tesseract_ok:
                    jpn_installed, tessdata_dir = check_japanese_lang_pack()
                    if not jpn_installed and tessdata_dir:
                        self.log("Japanese language pack not found. Attempting auto-download...")
                        self.log("Note: Japanese pack is required for reliable Sekiro detection (Japanese '' character)")
                        success = download_japanese_lang_pack(tessdata_dir, log_callback=self.log)
                        if success:
                            self.log("Japanese pack downloaded successfully! Sekiro detection is now fully supported!")
                            # Refresh system check to update status
                            self.root.after(100, self.check_system)
                        else:
                            self.log("Japanese pack auto-download failed. Manual download recommended for Sekiro.")
                            self.log("Download from: https://github.com/tesseract-ocr/tessdata/raw/main/jpn.traineddata")
                            self.log(f"Save to: {tessdata_dir}")
                            # Refresh system check to show missing status
                            self.root.after(100, self.check_system)
                    elif jpn_installed:
                        self.log("Japanese language pack already installed. Sekiro detection ready!")
                    else:
                        self.log("Note: Japanese pack is recommended for reliable Sekiro detection")
                else:
                    self.log("Tesseract not found. Install Tesseract first to enable Japanese pack download.")
            except Exception as e:
                self.log(f"Error installing files: {e}")
                messagebox.showerror("Error", f"Failed to install files: {e}")
            finally:
                self.install_button.config(state=tk.NORMAL)
        
        threading.Thread(target=do_install, daemon=True).start()
    
    def install_deps(self):
        self.log("Installing dependencies...")
        self.install_deps_button.config(state=tk.DISABLED)
        
        def do_install():
            try:
                if install_dependencies():
                    self.log("Dependencies installed successfully!")
                    self.check_system()
                else:
                    self.log("Failed to install dependencies.")
                    messagebox.showerror("Error", "Failed to install dependencies.")
            except Exception as e:
                self.log(f"Error: {e}")
                messagebox.showerror("Error", f"Failed to install dependencies: {e}")
            finally:
                self.install_deps_button.config(state=tk.NORMAL)
        
        threading.Thread(target=do_install, daemon=True).start()
    
    def launch_app(self):
        gui_path = os.path.join(INSTALL_DIR, "death_counter_gui.py")
        if not os.path.exists(gui_path):
            messagebox.showerror("Error", "Death Counter GUI not found. Please install files first.")
            return
        
        try:
            # Find pythonw.exe (no console window) for GUI applications
            python_exe = find_python_executable(use_pythonw=True)
            if not python_exe:
                error_msg = "Python executable not found. Please install Python and ensure it's in PATH."
                self.log(error_msg)
                messagebox.showerror("Error", error_msg)
                return
            
            self.log(f"Launching: {python_exe} {gui_path}")
            self.log(f"Working directory: {INSTALL_DIR}")
            
            # Launch with CREATE_NO_WINDOW to hide console window
            # Use pythonw.exe which doesn't create a console window
            CREATE_NO_WINDOW = 0x08000000 if hasattr(subprocess, 'CREATE_NO_WINDOW') else 0
            process = subprocess.Popen(
                [python_exe, gui_path], 
                cwd=INSTALL_DIR,
                stdout=subprocess.PIPE,
                stderr=subprocess.PIPE,
                creationflags=CREATE_NO_WINDOW  # Hide console window
            )
            
            # Give it a moment to start, then check if it's still running
            import time
            time.sleep(0.5)
            
            if process.poll() is None:
                # Process is still running (good)
                self.log("Death Counter launched successfully!")
                messagebox.showinfo("Success", "Death Counter GUI launched!")
            else:
                # Process exited immediately (error)
                stdout, stderr = process.communicate()
                error_msg = stderr.decode('utf-8', errors='ignore') if stderr else "Unknown error"
                self.log(f"Process exited immediately. Error: {error_msg}")
                messagebox.showerror("Error", f"Death Counter failed to start:\n{error_msg}")
                
        except Exception as e:
            import traceback
            error_details = traceback.format_exc()
            self.log(f"Error launching: {e}")
            self.log(f"Details: {error_details}")
            messagebox.showerror("Error", f"Failed to launch: {e}")

def main():
    root = tk.Tk()
    app = InstallerGUI(root)
    root.mainloop()

if __name__ == "__main__":
    main()
